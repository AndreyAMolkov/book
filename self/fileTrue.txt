 
2 
3 Preface 
4 
5 The computing world has undergone a revolution since the publication of The C 
6 Programming Language in 1978. Big computers are much bigger, and personal computers 
7 have capabilities that rival mainframes of a decade ago. During this time, C has changed too, 
8 although only modestly, and it has spread far beyond its origins as the language of the UNIX 
9 operating system. 
10 
11 The growing popularity of C, the changes in the language over the years, and the creation of 
12 compilers by groups not involved in its design, combined to demonstrate a need for a more 
13 precise and more contemporary definition of the language than the first edition of this book 
14 provided. In 1983, the American National Standards Institute (ANSI) established a committee 
15 whose goal was to produce ``an unambiguous and machine-independent definition of the 
16 language C'', while still retaining its spirit. The result is the ANSI standard for C. 
17 
18 The standard formalizes constructions that were hinted but not described in the first edition, 
19 particularly structure assignment and enumerations. It provides a new form of function 
20 declaration that permits cross-checking of definition with use. It specifies a standard library, 
21 with an extensive set of functions for performing input and output, memory management, 
22 string manipulation, and similar tasks. It makes precise the behavior of features that were not 
23 spelled out in the original definition, and at the same time states explicitly which aspects of 
24 the language remain machine-dependent. 
25 
26 This Second Edition of The C Programming Language describes C as defined by the ANSI 
27 standard. Although we have noted the places where the language has evolved, we have chosen 
28 to write exclusively in the new form. For the most part, this makes no significant difference; 
29 the most visible change is the new form of function declaration and definition. Modern 
30 compilers already support most features of the standard. 
31 
32 We have tried to retain the brevity of the first edition. C is not a big language, and it is not 
33 well served by a big book. We have improved the exposition of critical features, such as 
34 pointers, that are central to C programming. We have refined the original examples, and have 
35 added new examples in several chapters. For instance, the treatment of complicated 
36 declarations is augmented by programs that convert declarations into words and vice versa. 
37 As before, all examples have been tested directly from the text, which is in machine-readable 
38 form. 
39 
40 Appendix A, the reference manual, is not the standard, but our attempt to convey the 
41 essentials of the standard in a smaller space. It is meant for easy comprehension by 
42 programmers, but not as a definition for compiler writers -- that role properly belongs to the 
43 standard itself. Appendix B is a summary of the facilities of the standard library. It too is 
44 meant for reference by programmers, not implementers. Appendix C is a concise summary of 
45 the changes from the original version. 
46 
47 As we said in the preface to the first edition, C ``wears well as one's experience with it 
48 grows''. With a decade more experience, we still feel that way. We hope that this book will 
49 help you learn C and use it well. 
50 
51 
52 We are deeply indebted to friends who helped us to produce this second edition. Jon Bently, 
53 Doug Gwyn, Doug McIlroy, Peter Nelson, and Rob Pike gave us perceptive comments on 
54 almost every page of draft manuscripts. We are grateful for careful reading by Al Aho, Dennis 
55 Allison, Joe Campbell, G.R. Emlin, Karen Fortgang, Allen Holub, Andrew Hume, Dave 
56 Kristol, John Linderman, Dave Prosser, Gene Spafford, and Chris van Wyk. We also received 
57 helpful suggestions from Bill Cheswick, Mark Kernighan, Andy Koenig, Robin Lake, Tom 
58 London, Jim Reeds, Clovis Tondo, and Peter Weinberger. Dave Prosser answered many 
59 detailed questions about the ANSI standard. We used Bjarne Stroustrup's C++ translator 
60 extensively for local testing of our programs, and Dave Kristol provided us with an ANSI C 
61 compiler for final testing. Rich Drechsler helped greatly with typesetting. 
62 
 
65 Our sincere thanks to all. 
66 
67 Brian W. Kernighan 
68 Dennis M. Ritchie 
69 
70 
 
73 Preface to the first edition 
74 
75 C is a general-purpose programming language with features economy of expression, modern 
76 flow control and data structures, and a rich set of operators. C is not a ``very high level'' 
77 language, nor a ``big'' one, and is not specialized to any particular area of application. But its 
78 absence of restrictions and its generality make it more convenient and effective for many 
79 tasks than supposedly more powerful languages. 
80 
81 C was originally designed for and implemented on the UNIX operating system on the DEC 
82 PDP-11, by Dennis Ritchie. The operating system, the C compiler, and essentially all UNIX 
83 applications programs (including all of the software used to prepare this book) are written in 
84 C. Production compilers also exist for several other machines, including the IBM System/370, 
85 the Honeywell 6000, and the Interdata 8/32. C is not tied to any particular hardware or 
86 system, however, and it is easy to write programs that will run without change on any 
87 machine that supports C. 
88 
89 This book is meant to help the reader learn how to program in C. It contains a tutorial 
90 introduction to get new users started as soon as possible, separate chapters on each major 
91 feature, and a reference manual. Most of the treatment is based on reading, writing and 
92 revising examples, rather than on mere statements of rules. For the most part, the examples 
93 are complete, real programs rather than isolated fragments. All examples have been tested 
94 directly from the text, which is in machine-readable form. Besides showing how to make 
95 effective use of the language, we have also tried where possible to illustrate useful algorithms 
96 and principles of good style and sound design. 
97 
98 The book is not an introductory programming manual; it assumes some familiarity with basic 
99 programming concepts like variables, assignment statements, loops, and functions. 
100 Nonetheless, a novice programmer should be able to read along and pick up the language, 
101 although access to more knowledgeable colleague will help. 
102 
103 In our experience, C has proven to be a pleasant, expressive and versatile language for a wide 
104 variety of programs. It is easy to learn, and it wears well as on's experience with it grows. We 
105 hope that this book will help you to use it well. 
106 
107 The thoughtful criticisms and suggestions of many friends and colleagues have added greatly 
108 to this book and to our pleasure in writing it. In particular, Mike Bianchi, Jim Blue, Stu 
109 Feldman, Doug McIlroy Bill Roome, Bob Rosin and Larry Rosler all read multiple volumes 
110 with care. We are also indebted to Al Aho, Steve Bourne, Dan Dvorak, Chuck Haley, Debbie 
111 Haley, Marion Harris, Rick Holt, Steve Johnson, John Mashey, Bob Mitze, Ralph Muha, 
112 Peter Nelson, Elliot Pinson, Bill Plauger, Jerry Spivack, Ken Thompson, and Peter 
113 Weinberger for helpful comments at various stages, and to Mile Lesk and Joe Ossanna for 
114 invaluable assistance with typesetting. 
115 
 
118 Brian W. Kernighan 
119 Dennis M. Ritchie 
120 
121 
 
124 Chapter 1 - A Tutorial Introduction 
125 
126 Let us begin with a quick introduction in C. Our aim is to show the essential elements of the 
127 language in real programs, but without getting bogged down in details, rules, and exceptions. 
128 At this point, we are not trying to be complete or even precise (save that the examples are 
129 meant to be correct). We want to get you as quickly as possible to the point where you can 
130 write useful programs, and to do that we have to concentrate on the basics: variables and 
131 constants, arithmetic, control flow, functions, and the rudiments of input and output. We are 
132 intentionally leaving out of this chapter features of C that are important for writing bigger 
133 programs. These include pointers, structures, most of C's rich set of operators, several control-
134 flow statements, and the standard library. 
135 
136 This approach and its drawbacks. Most notable is that the complete story on any particular 
137 feature is not found here, and the tutorial, by being brief, may also be misleading. And 
138 because the examples do not use the full power of C, they are not as concise and elegant as 
139 they might be. We have tried to minimize these effects, but be warned. Another drawback is 
140 that later chapters will necessarily repeat some of this chapter. We hope that the repetition 
141 will help you more than it annoys. 
142 
143 In any case, experienced programmers should be able to extrapolate from the material in this 
144 chapter to their own programming needs. Beginners should supplement it by writing small, 
145 similar programs of their own. Both groups can use it as a framework on which to hang the 
146 more detailed descriptions that begin in Chapter 2. 
147 
148 1.1 Getting Started 
149 
150 The only way to learn a new programming language is by writing programs in it. The first 
151 program to write is the same for all languages: 
152 Print the words 
153 hello, world 
154 
155 This is a big hurdle; to leap over it you have to be able to create the program text somewhere, 
156 compile it successfully, load it, run it, and find out where your output went. With these 
157 mechanical details mastered, everything else is comparatively easy. 
158 
159 In C, the program to print ``hello, world'' is 
160 
 
 
 
 
 
 
 
 
177 Just how to run this program depends on the system you are using. As a specific example, on 
178 the UNIX operating system you must create the program in a file whose name ends in ``.c'', 
179 such as hello.c, then compile it with the command 
180 
 
 
 
187 
188 If you haven't botched anything, such as omitting a character or misspelling something, the 
189 compilation will proceed silently, and make an executable file called a.out. If you run a.out 
190 by typing the command 
191 
 
 
196 it will print 
197 
 
 
202 On other systems, the rules will be different; check with a local expert. 
203 
204 Now, for some explanations about the program itself. A C program, whatever its size, consists 
205 of functions and variables. A function contains statements that specify the computing 
206 operations to be done, and variables store values used during the computation. C functions are 
207 like the subroutines and functions in Fortran or the procedures and functions of Pascal. Our 
208 example is a function named main. Normally you are at liberty to give functions whatever 
209 names you like, but ``main'' is special - your program begins executing at the beginning of 
210 main. This means that every program must have a main somewhere. 
211 
212 main will usually call other functions to help perform its job, some that you wrote, and others 
213 from libraries that are provided for you. The first line of the program, 
214 
 
 
219 tells the compiler to include information about the standard input/output library; the line 
220 appears at the beginning of many C source files. The standard library is described in Chapter 
221 7 and Appendix B. 
222 
223 One method of communicating data between functions is for the calling function to provide a 
224 list of values, called arguments, to the function it calls. The parentheses after the function 
225 name surround the argument list. In this example, main is defined to be a function that expects 
226 no arguments, which is indicated by the empty list ( ). 
227 
228 --- 
229 
230 
 
233 #include <stdio.h> include information about standard 
234 library 
235 
236 main() define a function called main 
237 
 
240 { statements of main are enclosed in braces 
241 
 
 
246 } \n represents the newline character 
247 
248 The first C program 
249 
 
252 The statements of a function are enclosed in braces { }. The function main contains only one 
253 statement, 
254 
 
 
259 
260 A function is called by naming it, followed by a parenthesized list of arguments, so this calls 
261 the function printf with the argument "hello, world\n". printf is a library function that 
262 prints output, in this case the string of characters between the quotes. 
263 
264 A sequence of characters in double quotes, like "hello, world\n", is called a character 
265 string or string constant. For the moment our only use of character strings will be as 
266 arguments for printf and other functions. 
267 
268 The sequence \n in the string is C notation for the newline character, which when printed 
269 advances the output to the left margin on the next line. If you leave out the \n (a worthwhile 
270 experiment), you will find that there is no line advance after the output is printed. You must 
271 use \n to include a newline character in the printf argument; if you try something like 
272 
 
 
 
279 the C compiler will produce an error message. 
280 
281 printf never supplies a newline character automatically, so several calls may be used to 
282 build up an output line in stages. Our first program could just as well have been written 
283 
 
 
 
 
 
 
 
 
 
302 to produce identical output. 
303 
304 Notice that \n represents only a single character. An escape sequence like \n provides a 
305 general and extensible mechanism for representing hard-to-type or invisible characters. 
306 Among the others that C provides are \t for tab, \b for backspace, \" for the double quote 
307 and \\ for the backslash itself. There is a complete list in Section 2.3. 
308 
309 Exercise 1-1. Run the ``hello, world'' program on your system. Experiment with leaving 
310 out parts of the program, to see what error messages you get. 
311 
312 Exercise 1-2. Experiment to find out what happens when prints's argument string contains 
313 \c, where c is some character not listed above. 
314 
315 1.2 Variables and Arithmetic Expressions 
316 
317 The next program uses the formula oC=(5/9)(oF-32) to print the following table of Fahrenheit 
318 temperatures and their centigrade or Celsius equivalents: 
319 
320 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
355 The program itself still consists of the definition of a single function named main. It is longer 
356 than the one that printed ``hello, world'', but not complicated. It introduces several new 
357 ideas, including comments, declarations, variables, arithmetic expressions, loops , and 
358 formatted output. 
359 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
402 The two lines 
403 
 
 
 
410 are a comment, which in this case explains briefly what the program does. Any characters 
411 between /* and */ are ignored by the compiler; they may be used freely to make a program 
412 easier to understand. Comments may appear anywhere where a blank, tab or newline can. 
413 
414 In C, all variables must be declared before they are used, usually at the beginning of the 
415 function before any executable statements. A declaration announces the properties of 
416 variables; it consists of a name and a list of variables, such as 
417 
 
 
 
424 The type int means that the variables listed are integers; by contrast with float, which 
425 means floating point, i.e., numbers that may have a fractional part. The range of both int and 
426 float depends on the machine you are using; 16-bits ints, which lie between -32768 and 
427 
428 
429 +32767, are common, as are 32-bit ints. A float number is typically a 32-bit quantity, with 
430 at least six significant digits and magnitude generally between about 10-38 and 1038. 
431 
432 C provides several other data types besides int and float, including: 
433 
 
 
 
 
 
 
 
 
450 
451 
452 The size of these objects is also machine-dependent. There are also arrays, structures and 
453 unions of these basic types, pointers to them, and functions that return them, all of which we 
454 will meet in due course. 
455 
456 Computation in the temperature conversion program begins with the assignment statements 
457 
 
 
 
 
466 which set the variables to their initial values. Individual statements are terminated by 
467 semicolons. 
468 
469 Each line of the table is computed the same way, so we use a loop that repeats once per output 
470 line; this is the purpose of the while loop 
471 
 
 
 
 
 
482 The while loop operates as follows: The condition in parentheses is tested. If it is true (fahr 
483 is less than or equal to upper), the body of the loop (the three statements enclosed in braces) 
484 is executed. Then the condition is re-tested, and if true, the body is executed again. When the 
485 test becomes false (fahr exceeds upper) the loop ends, and execution continues at the 
486 statement that follows the loop. There are no further statements in this program, so it 
487 terminates. 
488 
489 The body of a while can be one or more statements enclosed in braces, as in the temperature 
490 converter, or a single statement without braces, as in 
491 
 
 
 
498 In either case, we will always indent the statements controlled by the while by one tab stop 
499 (which we have shown as four spaces) so you can see at a glance which statements are inside 
500 the loop. The indentation emphasizes the logical structure of the program. Although C 
501 compilers do not care about how a program looks, proper indentation and spacing are critical 
502 in making programs easy for people to read. We recommend writing only one statement per 
503 line, and using blanks around operators to clarify grouping. The position of braces is less 
504 important, although people hold passionate beliefs. We have chosen one of several popular 
505 styles. Pick a style that suits you, then use it consistently. 
506 
507 
508 Most of the work gets done in the body of the loop. The Celsius temperature is computed and 
509 assigned to the variable celsius by the statement 
510 
 
 
515 The reason for multiplying by 5 and dividing by 9 instead of just multiplying by 5/9 is that in 
516 C, as in many other languages, 
517 (Highlight comment ligr
518 29.10.2007 18:32:53
519 blank)
520 integer division truncates: any fractional part is discarded. 
521 Since 5 and 9 are integers. 5/9 would be truncated to zero and so all the Celsius temperatures 
522 would be reported as zero. 
523 
524 This example also shows a bit more of how printf works. printf is a general-purpose 
525 output formatting function, which we will describe in detail in Chapter 7. Its first argument is 
526 a string of characters to be printed, with each % indicating where one of the other (second, 
527 third, ...) arguments is to be substituted, and in what form it is to be printed. For instance, %d 
528 specifies an integer argument, so the statement 
529 
 
 
534 causes the values of the two integers fahr and celsius to be printed, with a tab (\t) between 
535 them. 
536 
537 Each % construction in the first argument of printf is paired with the corresponding second 
538 argument, third argument, etc.; they must match up properly by number and type, or you will 
539 get wrong answers. 
540 
541 By the way, printf is not part of the C language; there is no input or output defined in C 
542 itself. printf is just a useful function from the standard library of functions that are normally 
543 accessible to C programs. The behaviour of printf is defined in the ANSI standard, however, 
544 so its properties should be the same with any compiler and library that conforms to the 
545 standard. 
546 
547 In order to concentrate on C itself, we don't talk much about input and output until chapter 7. 
548 In particular, we will defer formatted input until then. If you have to input numbers, read the 
549 discussion of the function scanf in Section 7.4. scanf is like printf, except that it reads 
550 input instead of writing output. 
551 
552 There are a couple of problems with the temperature conversion program. The simpler one is 
553 that the output isn't very pretty because the numbers are not right-justified. That's easy to fix; 
554 if we augment each %d in the printf statement with a width, the numbers printed will be 
555 right-justified in their fields. For instance, we might say 
556 
 
 
561 to print the first number of each line in a field three digits wide, and the second in a field six 
562 digits wide, like this: 
563 
 
 
 
 
 
 
 
 
580 
581 The more serious problem is that because we have used integer arithmetic, the Celsius 
582 temperatures are not very accurate; for instance, 0oF is actually about -17.8oC, not -17. To get 
583 more accurate answers, we should use floating-point arithmetic instead of integer. This 
584 requires some changes in the program. Here is the second version: 
585 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
628 This is much the same as before, except that fahr and celsius are declared to be float and 
629 the formula for conversion is written in a more natural way. We were unable to use 5/9 in the 
630 previous version because integer division would truncate it to zero. A decimal point in a 
631 constant indicates that it is floating point, however, so 5.0/9.0 is not truncated because it is 
632 the ratio of two floating-point values. 
633 
634 If an arithmetic operator has integer operands, an integer operation is performed. If an 
635 arithmetic operator has one floating-point operand and one integer operand, however, the 
636 integer will be converted to floating point before the operation is done. If we had written 
637 (fahr-32), the 32 would be automatically converted to floating point. Nevertheless, writing 
638 floating-point constants with explicit decimal points even when they have integral values 
639 emphasizes their floating-point nature for human readers. 
640 
641 The detailed rules for when integers are converted to floating point are in Chapter 2. For now, 
642 notice that the assignment 
643 
 
 
648 and the test 
649 
 
 
654 also work in the natural way - the int is converted to float before the operation is done. 
655 
656 The printf conversion specification %3.0f says that a floating-point number (here fahr) is 
657 to be printed at least three characters wide, with no decimal point and no fraction digits. 
658 %6.1f describes another number (celsius) that is to be printed at least six characters wide, 
659 with 1 digit after the decimal point. The output looks like this: 
660 
 
 
 
 
669 
670 Width and precision may be omitted from a specification: %6f says that the number is to be at 
671 least six characters wide; %.2f specifies two characters after the decimal point, but the width 
672 is not constrained; and %f merely says to print the number as floating point. 
673 
 
 
 
 
 
 
 
 
 
 
 
 
698 
699 
700 Among others, printf also recognizes %o for octal, %x for hexadecimal, %c for character, %s 
701 for character string and %% for itself. 
702 
703 Exercise 1-3. Modify the temperature conversion program to print a heading above the table. 
704 
705 Exercise 1-4. Write a program to print the corresponding Celsius to Fahrenheit table. 
706 
707 1.3 The for statement 
708 
709 There are plenty of different ways to write a program for a particular task. Let's try a variation 
710 on the temperature converter. 
711 
 
 
 
 
 
 
 
 
 
 
 
734 This produces the same answers, but it certainly looks different. One major change is the 
735 elimination of most of the variables; only fahr remains, and we have made it an int. The 
736 lower and upper limits and the step size appear only as constants in the for statement, itself a 
737 new construction, and the expression that computes the Celsius temperature now appears as 
738 the third argument of printf instead of a separate assignment statement. 
739 
740 This last change is an instance of a general rule - in any context where it is permissible to use 
741 the value of some type, you can use a more complicated expression of that type. Since the 
742 third argument of printf must be a floating-point value to match the %6.1f, any floating-
743 point expression can occur here. 
744 
745 The for statement is a loop, a generalization of the while. If you compare it to the earlier 
746 while, its operation should be clear. Within the parentheses, there are three parts, separated 
747 by semicolons. The first part, the initialization 
748 
 
 
753 
754 is done once, before the loop proper is entered. The second part is the 
755 test or condition that controls the loop: 
756 
 
 
761 This condition is evaluated; if it is true, the body of the loop (here a single ptintf) is 
762 executed. Then the increment step 
763 
 
 
768 is executed, and the condition re-evaluated. The loop terminates if the condition has become 
769 false. As with the while, the body of the loop can be a single statement or a group of 
770 statements enclosed in braces. The initialization, condition and increment can be any 
771 expressions. 
772 
773 The choice between while and for is arbitrary, based on which seems clearer. The for is 
774 usually appropriate for loops in which the initialization and increment are single statements 
775 and logically related, since it is more compact than while and it keeps the loop control 
776 statements together in one place. 
777 
778 Exercise 1-5. Modify the temperature conversion program to print the table in reverse order, 
779 that is, from 300 degrees to 0. 
780 
781 1.4 Symbolic Constants 
782 
783 A final observation before we leave temperature conversion forever. It's bad practice to bury 
784 ``magic numbers'' like 300 and 20 in a program; they convey little information to someone 
785 who might have to read the program later, and they are hard to change in a systematic way. 
786 One way to deal with magic numbers is to give them meaningful names. A #define line 
787 defines a symbolic name or symbolic constant to be a particular string of characters: 
788 
 
791 Thereafter, any occurrence of name (not in quotes and not part of another name) will be 
792 replaced by the corresponding replacement text. The name has the same form as a variable 
793 name: a sequence of letters and digits that begins with a letter. The replacement text can be 
794 any sequence of characters; it is not limited to numbers. 
795 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
826 The quantities LOWER, UPPER and STEP are symbolic constants, not variables, so they do not 
827 appear in declarations. Symbolic constant names are conventionally written in upper case so 
828 they can ber readily distinguished from lower case variable names. Notice that there is no 
829 semicolon at the end of a #define line. 
830 
831 
832 1.5 Character Input and Output 
833 
834 We are going to consider a family of related programs for processing character data. You will 
835 find that many programs are just expanded versions of the prototypes that we discuss here. 
836 
837 The model of input and output supported by the standard library is very simple. Text input or 
838 output, regardless of where it originates or where it goes to, is dealt with as streams of 
839 characters. A text stream is a sequence of characters divided into lines; each line consists of 
840 zero or more characters followed by a newline character. It is the responsibility of the library 
841 to make each input or output stream confirm this model; the C programmer using the library 
842 need not worry about how lines are represented outside the program. 
843 
844 The standard library provides several functions for reading or writing one character at a time, 
845 of which getchar and putchar are the simplest. Each time it is called, getchar reads the 
846 next input character from a text stream and returns that as its value. That is, after 
847 
 
 
852 the variable c contains the next character of input. The characters normally come from the 
853 keyboard; input from files is discussed in Chapter 7. 
854 
855 The function putchar prints a character each time it is called: 
856 
 
 
861 prints the contents of the integer variable c as a character, usually on the screen. Calls to 
862 putchar and printf may be interleaved; the output will appear in the order in which the calls 
863 are made. 
864 
865 1.5.1 File Copying 
866 
867 Given getchar and putchar, you can write a surprising amount of useful code without 
868 knowing anything more about input and output. The simplest example is a program that 
869 copies its input to its output one character at a time: 
870 
 
873 read a character 
874 
 
 
 
881 Converting this into C gives: 
882 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
911 The relational operator != means ``not equal to''. 
912 
913 
914 What appears to be a character on the keyboard or screen is of course, like everything else, 
915 stored internally just as a bit pattern. The type char is specifically meant for storing such 
916 character data, but any integer type can be used. We used int for a subtle but important 
917 reason. 
918 
919 The problem is distinguishing the end of input from valid data. The solution is that getchar 
920 returns a distinctive value when there is no more input, a value that cannot be confused with 
921 any real character. This value is called EOF, for ``end of file''. We must declare c to be a type 
922 big enough to hold any value that getchar returns. We can't use char since c must be big 
923 enough to hold EOF in addition to any possible char. Therefore we use int. 
924 
925 EOF is an integer defined in <stdio.h>, but the specific numeric value doesn't matter as long as 
926 it is not the same as any char value. By using the symbolic constant, we are assured that 
927 nothing in the program depends on the specific numeric value. 
928 
929 The program for copying would be written more concisely by experienced C programmers. In 
930 C, any assignment, such as 
931 
 
 
936 is an expression and has a value, which is the value of the left hand side after the assignment. 
937 This means that a assignment can appear as part of a larger expression. If the assignment of a 
938 character to c is put inside the test part of a while loop, the copy program can be written this 
939 way: 
940 
 
 
 
 
 
 
 
 
 
 
 
963 The while gets a character, assigns it to c, and then tests whether the character was the end-
964 of-file signal. If it was not, the body of the while is executed, printing the character. The 
965 while then repeats. When the end of the input is finally reached, the while terminates and so 
966 does main. 
967 
968 This version centralizes the input - there is now only one reference to getchar - and shrinks 
969 the program. The resulting program is more compact, and, once the idiom is mastered, easier 
970 to read. You'll see this style often. (It's possible to get carried away and create impenetrable 
971 code, however, a tendency that we will try to curb.) 
972 
973 The parentheses around the assignment, within the condition are necessary. The precedence 
974 of != is higher than that of =, which means that in the absence of parentheses the relational 
975 test != would be done before the assignment =. So the statement 
976 
 
 
981 is equivalent to 
982 
 
 
987 
988 This has the undesired effect of setting c to 0 or 1, depending on whether or not the call of 
989 getchar returned end of file. (More on this in Chapter 2.) 
990 
991 Exercsise 1-6. Verify that the expression getchar() != EOF is 0 or 1. 
992 
993 Exercise 1-7. Write a program to print the value of EOF. 
994 
995 1.5.2 Character Counting 
996 
997 The next program counts characters; it is similar to the copy program. 
998 
 
 
 
 
 
 
 
 
 
 
 
 
 
1025 The statement 
1026 
 
 
1031 presents a new operator, ++, which means increment by one. You could instead write nc = nc 
1032 + 1 but ++nc is more concise and often more efficient. There is a corresponding operator -- 
1033 to decrement by 1. The operators ++ and -- can be either prefix operators (++nc) or postfix 
1034 operators (nc++); these two forms have different values in expressions, as will be shown in 
1035 Chapter 2, but ++nc and nc++ both increment nc. For the moment we will will stick to the 
1036 prefix form. 
1037 
1038 The character counting program accumulates its count in a long variable instead of an int. 
1039 long integers are at least 32 bits. Although on some machines, int and long are the same 
1040 size, on others an int is 16 bits, with a maximum value of 32767, and it would take relatively 
1041 little input to overflow an int counter. The conversion specification %ld tells printf that the 
1042 corresponding argument is a long integer. 
1043 
1044 It may be possible to cope with even bigger numbers by using a double (double precision 
1045 float). We will also use a for statement instead of a while, to illustrate another way to write 
1046 the loop. 
1047 
 
 
 
 
 
 
 
 
 
 
 
 
1072 
1073 printf uses %f for both float and double; %.0f suppresses the printing of the decimal point 
1074 and the fraction part, which is zero. 
1075 
1076 The body of this for loop is empty, because all the work is done in the test and increment 
1077 parts. But the grammatical rules of C require that a for statement have a body. The isolated 
1078 semicolon, called a null statement, is there to satisfy that requirement. We put it on a separate 
1079 line to make it visible. 
1080 
1081 Before we leave the character counting program, observe that if the input contains no 
1082 characters, the while or for test fails on the very first call to getchar, and the program 
1083 produces zero, the right answer. This is important. One of the nice things about while and 
1084 for is that they test at the top of the loop, before proceeding with the body. If there is nothing 
1085 to do, nothing is done, even if that means never going through the loop body. Programs 
1086 should act intelligently when given zero-length input. The while and for statements help 
1087 ensure that programs do reasonable things with boundary conditions. 
1088 
1089 1.5.3 Line Counting 
1090 
1091 The next program counts input lines. As we mentioned above, the standard library ensures 
1092 that an input text stream appears as a sequence of lines, each terminated by a newline. Hence, 
1093 counting lines is just counting newlines: 
1094 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
1123 The body of the while now consists of an if, which in turn controls the increment ++nl. The 
1124 if statement tests the parenthesized condition, and if the condition is true, executes the 
1125 statement (or group of statements in braces) that follows. We have again indented to show 
1126 what is controlled by what. 
1127 
1128 The double equals sign == is the C notation for ``is equal to'' (like Pascal's single = or 
1129 Fortran's .EQ.). This symbol is used to distinguish the equality test from the single = that C 
1130 uses for assignment. A word of caution: newcomers to C occasionally write = when they 
1131 mean ==. As we will see in Chapter 2, the result is usually a legal expression, so you will get 
1132 no warning. 
1133 
1134 A character written between single quotes represents an integer value equal to the numerical 
1135 value of the character in the machine's character set. This is called a character constant, 
1136 although it is just another way to write a small integer. So, for example, 'A' is a character 
1137 constant; in the ASCII character set its value is 65, the internal representation of the character 
1138 A. Of course, 'A' is to be preferred over 65: its meaning is obvious, and it is independent of a 
1139 particular character set. 
1140 
1141 
1142 The escape sequences used in string constants are also legal in character constants, so '\n' 
1143 stands for the value of the newline character, which is 10 in ASCII. You should note carefully 
1144 that '\n' is a single character, and in expressions is just an integer; on the other hand, '\n' is 
1145 a string constant that happens to contain only one character. The topic of strings versus 
1146 characters is discussed further in Chapter 2. 
1147 
1148 Exercise 1-8. Write a program to count blanks, tabs, and newlines. 
1149 
1150 Exercise 1-9. Write a program to copy its input to its output, replacing each string of one or 
1151 more blanks by a single blank. 
1152 
1153 Exercise 1-10. Write a program to copy its input to its output, replacing each tab by \t, each 
1154 backspace by \b, and each backslash by \\. This makes tabs and backspaces visible in an 
1155 unambiguous way. 
1156 
1157 1.5.4 Word Counting 
1158 
1159 The fourth in our series of useful programs counts lines, words, and characters, with the loose 
1160 definition that a word is any sequence of characters that does not contain a blank, tab or 
1161 newline. This is a bare-bones version of the UNIX program wc. 
1162 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
1215 Every time the program encounters the first character of a word, it counts one more word. The 
1216 variable state records whether the program is currently in a word or not; initially it is ``not in 
1217 a word'', which is assigned the value OUT. We prefer the symbolic constants IN and OUT to the 
1218 literal values 1 and 0 because they make the program more readable. In a program as tiny as 
1219 this, it makes little difference, but in larger programs, the increase in clarity is well worth the 
1220 modest extra effort to write it this way from the beginning. You'll also find that it's easier to 
1221 make extensive changes in programs where magic numbers appear only as symbolic 
1222 constants. 
1223 
1224 
1225 The line 
1226 
 
 
1231 sets all three variables to zero. This is not a special case, but a consequence of the fact that an 
1232 assignment is an expression with the value and assignments associated from right to left. It's 
1233 as if we had written 
1234 
 
 
1239 The operator || means OR, so the line 
1240 
 
 
1245 says ``if c is a blank or c is a newline or c is a tab''. (Recall that the escape sequence \t is a 
1246 visible representation of the tab character.) There is a corresponding operator && for AND; its 
1247 precedence is just higher than ||. Expressions connected by && or || are evaluated left to 
1248 right, and it is guaranteed that evaluation will stop as soon as the truth or falsehood is known. 
1249 If c is a blank, there is no need to test whether it is a newline or tab, so these tests are not 
1250 made. This isn't particularly important here, but is significant in more complicated situations, 
1251 as we will soon see. 
1252 
1253 The example also shows an else, which specifies an alternative action if the condition part of 
1254 an if statement is false. The general form is 
1255 
 
 
 
 
 
1266 One and only one of the two statements associated with an if-else is performed. If the 
1267 expression is true, statement1 is executed; if not, statement2 is executed. Each statement can 
1268 be a single statement or several in braces. In the word count program, the one after the else is 
1269 an if that controls two statements in braces. 
1270 
1271 Exercise 1-11. How would you test the word count program? What kinds of input are most 
1272 likely to uncover bugs if there are any? 
1273 
1274 Exercise 1-12. Write a program that prints its input one word per line. 
1275 
1276 1.6 Arrays 
1277 
1278 Let is write a program to count the number of occurrences of each digit, of white space 
1279 characters (blank, tab, newline), and of all other characters. This is artificial, but it permits us 
1280 to illustrate several aspects of C in one program. 
1281 
1282 There are twelve categories of input, so it is convenient to use an array to hold the number of 
1283 occurrences of each digit, rather than ten individual variables. Here is one version of the 
1284 program: 
1285 
1286 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
1341 The output of this program on itself is 
1342 
 
 
1347 The declaration 
1348 
 
 
1353 declares ndigit to be an array of 10 integers. Array subscripts always start at zero in C, so 
1354 the elements are ndigit[0], ndigit[1], ..., ndigit[9]. This is reflected in the for 
1355 loops that initialize and print the array. 
1356 
1357 A subscript can be any integer expression, which includes integer variables like i, and integer 
1358 constants. 
1359 
1360 This particular program relies on the properties of the character representation of the digits. 
1361 For example, the test 
1362 
 
 
1367 determines whether the character in c is a digit. If it is, the numeric value of that digit is 
1368 
 
 
1373 This works only if '0', '1', ..., '9' have consecutive increasing values. Fortunately, 
1374 this is true for all character sets. 
1375 
1376 By definition, chars are just small integers, so char variables and constants are identical to 
1377 ints in arithmetic expressions. This is natural and convenient; for example c-'0' is an 
1378 integer expression with a value between 0 and 9 corresponding to the character '0' to '9' 
1379 stored in c, and thus a valid subscript for the array ndigit. 
1380 
1381 The decision as to whether a character is a digit, white space, or something else is made with 
1382 the sequence 
1383 
1384 
 
 
 
 
 
 
 
1399 The pattern 
1400 
 
 
 
 
 
 
 
 
 
1419 occurs frequently in programs as a way to express a multi-way decision. The conditions are 
1420 evaluated in order from the top until some condition is satisfied; at that point the 
1421 corresponding statement part is executed, and the entire construction is finished. (Any 
1422 statement can be several statements enclosed in braces.) If none of the conditions is satisfied, 
1423 the statement after the final else is executed if it is present. If the final else and statement 
1424 are omitted, as in the word count program, no action takes place. There can be any number of 
1425 
1426 else if(condition) 
1427 statement 
1428 
1429 groups between the initial if and the final else. 
1430 
1431 As a matter of style, it is advisable to format this construction as we have shown; if each if 
1432 were indented past the previous else, a long sequence of decisions would march off the right 
1433 side of the page. 
1434 
1435 The switch statement, to be discussed in Chapter 4, provides another way to write a multi-
1436 way branch that is particulary suitable when the condition is whether some integer or 
1437 character expression matches one of a set of constants. For contrast, we will present a switch 
1438 version of this program in Section 3.4. 
1439 
1440 Exercise 1-13. Write a program to print a histogram of the lengths of words in its input. It is 
1441 easy to draw the histogram with the bars horizontal; a vertical orientation is more challenging. 
1442 
1443 Exercise 1-14. Write a program to print a histogram of the frequencies of different characters 
1444 in its input. 
1445 
1446 1.7 Functions 
1447 
1448 In C, a function is equivalent to a subroutine or function in Fortran, or a procedure or function 
1449 in Pascal. A function provides a convenient way to encapsulate some computation, which can 
1450 then be used without worrying about its implementation. With properly designed functions, it 
1451 is possible to ignore how a job is done; knowing what is done is sufficient. C makes the sue of 
1452 functions easy, convinient and efficient; you will often see a short function defined and called 
1453 only once, just because it clarifies some piece of code. 
1454 
1455 
1456 So far we have used only functions like printf, getchar and putchar that have been 
1457 provided for us; now it's time to write a few of our own. Since C has no exponentiation 
1458 operator like the ** of Fortran, let us illustrate the mechanics of function definition by writing 
1459 a function power(m,n) to raise an integer m to a positive integer power n. That is, the value of 
1460 power(2,5) is 32. This function is not a practical exponentiation routine, since it handles 
1461 only positive powers of small integers, but it's good enough for illustration.(The standard 
1462 library contains a function pow(x,y) that computes xy.) 
1463 
1464 Here is the function power and a main program to exercise it, so you can see the whole 
1465 structure at once. 
1466 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
1517 A function definition has this form: 
1518 
 
1521 return-type function-name(parameter declarations, if any) 
1522 
1523 { 
1524 
 
 
1529 } 
1530 
1531 Function definitions can appear in any order, and in one source file or several, although no 
1532 function can be split between files. If the source program appears in several files, you may 
1533 have to say more to compile and load it than if it all appears in one, but that is an operating 
1534 system matter, not a language attribute. For the moment, we will assume that both functions 
1535 are in the same file, so whatever you have learned about running C programs will still work. 
1536 
1537 The function power is called twice by main, in the line 
1538 
 
 
1543 Each call passes two arguments to power, which each time returns an integer to be formatted 
1544 and printed. In an expression, power(2,i) is an integer just as 2 and i are. (Not all functions 
1545 produce an integer value; we will take this up in Chapter 4.) 
1546 
1547 The first line of power itself, 
1548 
1549 
 
 
1554 declares the parameter types and names, and the type of the result that the function returns. 
1555 The names used by power for its parameters are local to power, and are not visible to any 
1556 other function: other routines can use the same names without conflict. This is also true of the 
1557 variables i and p: the i in power is unrelated to the i in main. 
1558 
1559 We will generally use parameter for a variable named in the parenthesized list in a function. 
1560 The terms formal argument and actual argument are sometimes used for the same distinction. 
1561 
1562 The value that power computes is returned to main by the return: statement. Any expression 
1563 may follow return: 
1564 
 
 
1569 A function need not return a value; a return statement with no expression causes control, but 
1570 no useful value, to be returned to the caller, as does ``falling off the end'' of a function by 
1571 reaching the terminating right brace. And the calling function can ignore a value returned by a 
1572 function. 
1573 
1574 You may have noticed that there is a return statement at the end of main. Since main is a 
1575 function like any other, it may return a value to its caller, which is in effect the environment in 
1576 which the program was executed. Typically, a return value of zero implies normal 
1577 termination; non-zero values signal unusual or erroneous termination conditions. In the 
1578 interests of simplicity, we have omitted return statements from our main functions up to this 
1579 point, but we will include them hereafter, as a reminder that programs should return status to 
1580 their environment. 
1581 
1582 The declaration 
1583 
 
 
1588 just before main says that power is a function that expects two int arguments and returns an 
1589 int. This declaration, which is called a function prototype, has to agree with the definition 
1590 and uses of power. It is an error if the definition of a function or any uses of it do not agree 
1591 with its prototype. 
1592 
1593 parameter names need not agree. Indeed, parameter names are optional in a function 
1594 prototype, so for the prototype we could have written 
1595 
 
 
1600 Well-chosen names are good documentation however, so we will often use them. 
1601 
1602 A note of history: the biggest change between ANSI C and earlier versions is how functions 
1603 are declared and defined. In the original definition of C, the power function would have been 
1604 written like this: 
1605 
1606 
 
 
 
 
 
 
 
 
 
 
 
 
 
1633 The parameters are named between the parentheses, and their types are declared before 
1634 opening the left brace; undeclared parameters are taken as int. (The body of the function is 
1635 the same as before.) 
1636 
1637 The declaration of power at the beginning of the program would have looked like this: 
1638 
 
 
1643 No parameter list was permitted, so the compiler could not readily check that power was 
1644 being called correctly. Indeed, since by default power would have been assumed to return an 
1645 int, the entire declaration might well have been omitted. 
1646 
1647 The new syntax of function prototypes makes it much easier for a compiler to detect errors in 
1648 the number of arguments or their types. The old style of declaration and definition still works 
1649 in ANSI C, at least for a transition period, but we strongly recommend that you use the new 
1650 form when you have a compiler that supports it. 
1651 
1652 Exercise 1.15. Rewrite the temperature conversion program of Section 1.2 to use a function 
1653 for conversion. 
1654 
1655 1.8 Arguments - Call by Value 
1656 
1657 One aspect of C functions may be unfamiliar to programmers who are used to some other 
1658 languages, particulary Fortran. In C, all function arguments are passed ``by value.'' This 
1659 means that the called function is given the values of its arguments in temporary variables 
1660 rather than the originals. This leads to some different properties than are seen with ``call by 
1661 reference'' languages like Fortran or with var parameters in Pascal, in which the called routine 
1662 has access to the original argument, not a local copy. 
1663 
1664 Call by value is an asset, however, not a liability. It usually leads to more compact programs 
1665 with fewer extraneous variables, because parameters can be treated as conveniently initialized 
1666 local variables in the called routine. For example, here is a version of power that makes use of 
1667 this property. 
1668 
 
 
 
 
 
 
 
 
 
1687 
1688 The parameter n is used as a temporary variable, and is counted down (a for loop that runs 
1689 backwards) until it becomes zero; there is no longer a need for the variable i. Whatever is 
1690 done to n inside power has no effect on the argument that power was originally called with. 
1691 
1692 When necessary, it is possible to arrange for a function to modify a variable in a calling 
1693 routine. The caller must provide the address of the variable to be set (technically a pointer to 
1694 the variable), and the called function must declare the parameter to be a pointer and access the 
1695 variable indirectly through it. We will cover pointers in Chapter 5. 
1696 
1697 The story is different for arrays. When the name of an array is used as an argument, the value 
1698 passed to the function is the location or address of the beginning of the array - there is no 
1699 copying of array elements. By subscripting this value, the function can access and alter any 
1700 argument of the array. This is the topic of the next section. 
1701 
1702 1.9 Character Arrays 
1703 
1704 The most common type of array in C is the array of characters. To illustrate the use of 
1705 character arrays and functions to manipulate them, let's write a program that reads a set of text 
1706 lines and prints the longest. The outline is simple enough: 
1707 
 
 
 
 
 
 
1720 This outline makes it clear that the program divides naturally into pieces. One piece gets a 
1721 new line, another saves it, and the rest controls the process. 
1722 
1723 Since things divide so nicely, it would be well to write them that way too. Accordingly, let us 
1724 first write a separate function getline to fetch the next line of input. We will try to make the 
1725 function useful in other contexts. At the minimum, getline has to return a signal about 
1726 possible end of file; a more useful design would be to return the length of the line, or zero if 
1727 end of file is encountered. Zero is an acceptable end-of-file return because it is never a valid 
1728 line length. Every text line has at least one character; even a line containing only a newline 
1729 has length 1. 
1730 
1731 When we find a line that is longer than the previous longest line, it must be saved somewhere. 
1732 This suggests a second function, copy, to copy the new line to a safe place. 
1733 
1734 Finally, we need a main program to control getline and copy. Here is the result. 
1735 
1736 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
1835 The functions getline and copy are declared at the beginning of the program, which we 
1836 assume is contained in one file. 
1837 
1838 main and getline communicate through a pair of arguments and a returned value. In 
1839 getline, the arguments are declared by the line 
1840 
 
 
1845 which specifies that the first argument, s, is an array, and the second, lim, is an integer. The 
1846 purpose of supplying the size of an array in a declaration is to set aside storage. The length of 
1847 an array s is not necessary in getline since its size is set in main. getline uses return to 
1848 
1849 
1850 send a value back to the caller, just as the function power did. This line also declares that 
1851 getline returns an int; since int is the default return type, it could be omitted. 
1852 
1853 Some functions return a useful value; others, like copy, are used only for their effect and 
1854 return no value. The return type of copy is void, which states explicitly that no value is 
1855 returned. 
1856 
1857 getline puts the character '\0' (the null character, whose value is zero) at the end of the 
1858 array it is creating, to mark the end of the string of characters. This conversion is also used by 
1859 the C language: when a string constant like 
1860 
 
 
1865 appears in a C program, it is stored as an array of characters containing the characters in the 
1866 string and terminated with a '\0' to mark the end. 
1867 
 
1870 The %s format specification in printf expects the corresponding argument to be a string 
1871 represented in this form. copy also relies on the fact that its input argument is terminated with 
1872 a '\0', and copies this character into the output. 
1873 
1874 It is worth mentioning in passing that even a program as small as this one presents some 
1875 sticky design problems. For example, what should main do if it encounters a line which is 
1876 bigger than its limit? getline works safely, in that it stops collecting when the array is full, 
1877 even if no newline has been seen. By testing the length and the last character returned, main 
1878 can determine whether the line was too long, and then cope as it wishes. In the interests of 
1879 brevity, we have ignored this issue. 
1880 
1881 There is no way for a user of getline to know in advance how long an input line might be, so 
1882 getline checks for overflow. On the other hand, the user of copy already knows (or can find 
1883 out) how big the strings are, so we have chosen not to add error checking to it. 
1884 
1885 Exercise 1-16. Revise the main routine of the longest-line program so it will correctly print 
1886 the length of arbitrary long input lines, and as much as possible of the text. 
1887 
1888 Exercise 1-17. Write a program to print all input lines that are longer than 80 characters. 
1889 
1890 Exercise 1-18. Write a program to remove trailing blanks and tabs from each line of input, 
1891 and to delete entirely blank lines. 
1892 
1893 Exercise 1-19. Write a function reverse(s) that reverses the character string s. Use it to 
1894 write a program that reverses its input a line at a time. 
1895 
1896 1.10 External Variables and Scope 
1897 
1898 The variables in main, such as line, longest, etc., are private or local to main. Because they 
1899 are declared within main, no other function can have direct access to them. The same is true 
1900 of the variables in other functions; for example, the variable i in getline is unrelated to the i 
1901 
1902 
1903 in copy. Each local variable in a function comes into existence only when the function is 
1904 called, and disappears when the function is exited. This is why such variables are usually 
1905 known as automatic variables, following terminology in other languages. We will use the 
1906 term automatic henceforth to refer to these local variables. (Chapter 4 discusses the static 
1907 storage class, in which local variables do retain their values between calls.) 
1908 
1909 Because automatic variables come and go with function invocation, they do not retain their 
1910 values from one call to the next, and must be explicitly set upon each entry. If they are not set, 
1911 they will contain garbage. 
1912 
1913 As an alternative to automatic variables, it is possible to define variables that are external to 
1914 all functions, that is, variables that can be accessed by name by any function. (This 
1915 mechanism is rather like Fortran COMMON or Pascal variables declared in the outermost 
1916 block.) Because external variables are globally accessible, they can be used instead of 
1917 argument lists to communicate data between functions. Furthermore, because external 
1918 variables remain in existence permanently, rather than appearing and disappearing as 
1919 functions are called and exited, they retain their values even after the functions that set them 
1920 have returned. 
1921 
1922 An external variable must be defined, exactly once, outside of any function; this sets aside 
1923 storage for it. The variable must also be declared in each function that wants to access it; this 
1924 states the type of the variable. The declaration may be an explicit extern statement or may be 
1925 implicit from context. To make the discussion concrete, let us rewrite the longest-line 
1926 program with line, longest, and max as external variables. This requires changing the calls, 
1927 declarations, and bodies of all three functions. 
1928 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
1987 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
2044 The external variables in main, getline and copy are defined by the first lines of the example 
2045 above, which state their type and cause storage to be allocated for them. Syntactically, 
2046 external definitions are just like definitions of local variables, but since they occur outside of 
2047 functions, the variables are external. Before a function can use an external variable, the name 
2048 of the variable must be made known to the function; the declaration is the same as before 
2049 except for the added keyword extern. 
2050 
2051 In certain circumstances, the extern declaration can be omitted. If the definition of the 
2052 external variable occurs in the source file before its use in a particular function, then there is 
2053 no need for an extern declaration in the function. The extern declarations in main, getline 
2054 and copy are thus redundant. In fact, common practice is to place definitions of all external 
2055 variables at the beginning of the source file, and then omit all extern declarations. 
2056 
2057 If the program is in several source files, and a variable is defined in file1 and used in file2 and 
2058 file3, then extern declarations are needed in file2 and file3 to connect the occurrences of the 
2059 variable. The usual practice is to collect extern declarations of variables and functions in a 
2060 separate file, historically called a header, that is included by #include at the front of each 
2061 source file. The suffix .h is conventional for header names. The functions of the standard 
2062 library, for example, are declared in headers like <stdio.h>. This topic is discussed at length 
2063 in Chapter 4, and the library itself in Chapter 7 and Appendix B. 
2064 
2065 Since the specialized versions of getline and copy have no arguments, logic would suggest 
2066 that their prototypes at the beginning of the file should be getline() and copy(). But for 
2067 compatibility with older C programs the standard takes an empty list as an old-style 
2068 declaration, and turns off all argument list checking; the word void must be used for an 
2069 explicitly empty list. We will discuss this further in Chapter 4. 
2070 
2071 You should note that we are using the words definition and declaration carefully when we 
2072 refer to external variables in this section.``Definition'' refers to the place where the variable is 
2073 
2074 
2075 created or assigned storage; ``declaration'' refers to places where the nature of the variable is 
2076 stated but no storage is allocated. 
2077 
2078 By the way, there is a tendency to make everything in sight an extern variable because it 
2079 appears to simplify communications - argument lists are short and variables are always there 
2080 when you want them. But external variables are always there even when you don't want them. 
2081 Relying too heavily on external variables is fraught with peril since it leads to programs 
2082 whose data connections are not all obvious - variables can be changed in unexpected and even 
2083 inadvertent ways, and the program is hard to modify. The second version of the longest-line 
2084 program is inferior to the first, partly for these reasons, and partly because it destroys the 
2085 generality of two useful functions by writing into them the names of the variables they 
2086 manipulate. 
2087 
2088 At this point we have covered what might be called the conventional core of C. With this 
2089 handful of building blocks, it's possible to write useful programs of considerable size, and it 
2090 would probably be a good idea if you paused long enough to do so. These exercises suggest 
2091 programs of somewhat greater complexity than the ones earlier in this chapter. 
2092 
2093 Exercise 1-20. Write a program detab that replaces tabs in the input with the proper number 
2094 of blanks to space to the next tab stop. Assume a fixed set of tab stops, say every n columns. 
2095 Should n be a variable or a symbolic parameter? 
2096 
2097 Exercise 1-21. Write a program entab that replaces strings of blanks by the minimum 
2098 number of tabs and blanks to achieve the same spacing. Use the same tab stops as for detab. 
2099 When either a tab or a single blank would suffice to reach a tab stop, which should be given 
2100 preference? 
2101 
2102 Exercise 1-22. Write a program to ``fold'' long input lines into two or more shorter lines after 
2103 the last non-blank character that occurs before the n-th column of input. Make sure your 
2104 program does something intelligent with very long lines, and if there are no blanks or tabs 
2105 before the specified column. 
2106 
2107 Exercise 1-23. Write a program to remove all comments from a C program. Don't forget to 
2108 handle quoted strings and character constants properly. C comments don't nest. 
2109 
2110 Exercise 1-24. Write a program to check a C program for rudimentary syntax errors like 
2111 unmatched parentheses, brackets and braces. Don't forget about quotes, both single and 
2112 double, escape sequences, and comments. (This program is hard if you do it in full 
2113 generality.) 
2114 
2115 
 
2118 Chapter 2 - Types, Operators and 
2119 Expressions 
2120 
2121 Variables and constants are the basic data objects manipulated in a program. Declarations list 
2122 the variables to be used, and state what type they have and perhaps what their initial values 
2123 are. Operators specify what is to be done to them. Expressions combine variables and 
2124 constants to produce new values. The type of an object determines the set of values it can 
2125 have and what operations can be performed on it. These building blocks are the topics of this 
2126 chapter. 
2127 
2128 The ANSI standard has made many small changes and additions to basic types and 
2129 expressions. There are now signed and unsigned forms of all integer types, and notations for 
2130 unsigned constants and hexadecimal character constants. Floating-point operations may be 
2131 done in single precision; there is also a long double type for extended precision. String 
2132 constants may be concatenated at compile time. Enumerations have become part of the 
2133 language, formalizing a feature of long standing. Objects may be declared const, which 
2134 prevents them from being changed. The rules for automatic coercions among arithmetic types 
2135 have been augmented to handle the richer set of types. 
2136 
2137 2.1 Variable Names 
2138 
2139 Although we didn't say so in Chapter 1, there are some restrictions on the names of variables 
2140 and symbolic constants. Names are made up of letters and digits; the first character must be a 
2141 letter. The underscore ``_'' counts as a letter; it is sometimes useful for improving the 
2142 readability of long variable names. Don't begin variable names with underscore, however, 
2143 since library routines often use such names. Upper and lower case letters are distinct, so x and 
2144 X are two different names. Traditional C practice is to use lower case for variable names, and 
2145 all upper case for symbolic constants. 
2146 
2147 At least the first 31 characters of an internal name are significant. For function names and 
2148 external variables, the number may be less than 31, because external names may be used by 
2149 assemblers and loaders over which the language has no control. For external names, the 
2150 standard guarantees uniqueness only for 6 characters and a single case. Keywords like if, 
2151 else, int, float, etc., are reserved: you can't use them as variable names. They must be in 
2152 lower case. 
2153 
2154 It's wise to choose variable names that are related to the purpose of the variable, and that are 
2155 unlikely to get mixed up typographically. We tend to use short names for local variables, 
2156 especially loop indices, and longer names for external variables. 
2157 
2158 2.2 Data Types and Sizes 
2159 
2160 There are only a few basic data types in C: 
2161 
2162 char 
2163 
2164 a single byte, capable of holding one character in the local character set 
2165 
2166 int 
2167 
2168 an integer, typically reflecting the natural size of integers on the host machine
2169 
2170 float 
2171 
2172 single-precision floating point 
2173 
2174 
2175 
2176 
2177 double 
2178 
2179 double-precision floating point 
2180 
2181 
2182 
2183 In addition, there are a number of qualifiers that can be applied to these basic types. short 
2184 and long apply to integers: 
2185 
 
 
 
2192 The word int can be omitted in such declarations, and typically it is. 
2193 
2194 The intent is that short and long should provide different lengths of integers where practical; 
2195 int will normally be the natural size for a particular machine. short is often 16 bits long, and 
2196 int either 16 or 32 bits. Each compiler is free to choose appropriate sizes for its own 
2197 hardware, subject only to the the restriction that shorts and ints are at least 16 bits, longs are 
2198 at least 32 bits, and short is no longer than int, which is no longer than long. 
2199 
2200 The qualifier signed or unsigned may be applied to char or any integer. unsigned numbers 
2201 are always positive or zero, and obey the laws of arithmetic modulo 2n, where n is the number 
2202 of bits in the type. So, for instance, if chars are 8 bits, unsigned char variables have values 
2203 between 0 and 255, while signed chars have values between -128 and 127 (in a two's 
2204 complement machine.) Whether plain chars are signed or unsigned is machine-dependent, 
2205 but printable characters are always positive. 
2206 
2207 The type long double specifies extended-precision floating point. As with integers, the sizes 
2208 of floating-point objects are implementation-defined; float, double and long double could 
2209 represent one, two or three distinct sizes. 
2210 
2211 The standard headers <limits.h> and <float.h> contain symbolic constants for all of these 
2212 sizes, along with other properties of the machine and compiler. These are discussed in 
2213 Appendix B. 
2214 
2215 Exercise 2-1. Write a program to determine the ranges of char, short, int, and long 
2216 variables, both signed and unsigned, by printing appropriate values from standard headers 
2217 and by direct computation. Harder if you compute them: determine the ranges of the various 
2218 floating-point types. 
2219 
2220 2.3 Constants 
2221 
2222 An integer constant like 1234 is an int. A long constant is written with a terminal l (ell) or 
2223 L, as in 123456789L; an integer constant too big to fit into an int will also be taken as a long. 
2224 Unsigned constants are written with a terminal u or U, and the suffix ul or UL indicates 
2225 unsigned long. 
2226 
2227 Floating-point constants contain a decimal point (123.4) or an exponent (1e-2) or both; their 
2228 type is double, unless suffixed. The suffixes f or F indicate a float constant; l or L indicate 
2229 a long double. 
2230 
2231 The value of an integer can be specified in octal or hexadecimal instead of decimal. A leading 
2232 0 (zero) on an integer constant means octal; a leading 0x or 0X means hexadecimal. For 
2233 example, decimal 31 can be written as 037 in octal and 0x1f or 0x1F in hex. Octal and 
2234 
2235 
2236 hexadecimal constants may also be followed by L to make them long and U to make them 
2237 unsigned: 0XFUL is an unsigned long constant with value 15 decimal. 
2238 
2239 A character constant is an integer, written as one character within single quotes, such as 
2240 'x'. The value of a character constant is the numeric value of the character in the machine's 
2241 character set. For example, in the ASCII character set the character constant '0' has the value 
2242 48, which is unrelated to the numeric value 0. If we write '0' instead of a numeric value like 
2243 48 that depends on the character set, the program is independent of the particular value and 
2244 easier to read. Character constants participate in numeric operations just as any other integers, 
2245 although they are most often used in comparisons with other characters. 
2246 
2247 Certain characters can be represented in character and string constants by escape sequences 
2248 like \n (newline); these sequences look like two characters, but represent only one. In 
2249 addition, an arbitrary byte-sized bit pattern can be specified by 
2250 
 
 
2255 where ooo is one to three octal digits (0...7) or by 
2256 
 
 
2261 where hh is one or more hexadecimal digits (0...9, a...f, A...F). So we might write 
2262 
 
 
 
2269 or, in hexadecimal, 
2270 
 
 
 
2277 The complete set of escape sequences is 
2278 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
2335 
2336 
2337 The character constant '\0' represents the character with value zero, the null character. '\0' 
2338 is often written instead of 0 to emphasize the character nature of some expression, but the 
2339 numeric value is just 0. 
2340 
2341 A constant expression is an expression that involves only constants. Such expressions may be 
2342 evaluated at during compilation rather than run-time, and accordingly may be used in any 
2343 place that a constant can occur, as in 
2344 
 
 
 
2351 or 
2352 
 
 
 
2359 
2360 A string constant, or string literal, is a sequence of zero or more characters surrounded by 
2361 double quotes, as in 
2362 
 
 
2367 or 
2368 
 
 
2373 The quotes are not part of the string, but serve only to delimit it. The same escape sequences 
2374 used in character constants apply in strings; \" represents the double-quote character. String 
2375 constants can be concatenated at compile time: 
2376 
 
 
2381 is equivalent to 
2382 
 
 
2387 This is useful for splitting up long strings across several source lines. 
2388 
2389 Technically, a string constant is an array of characters. The internal representation of a string 
2390 has a null character '\0' at the end, so the physical storage required is one more than the 
2391 number of characters written between the quotes. This representation means that there is no 
2392 limit to how long a string can be, but programs must scan a string completely to determine its 
2393 length. The standard library function strlen(s) returns the length of its character string 
2394 argument s, excluding the terminal '\0'. Here is our version: 
2395 
 
 
 
 
 
 
 
 
 
 
2416 strlen and other string functions are declared in the standard header <string.h>. 
2417 
2418 Be careful to distinguish between a character constant and a string that contains a single 
2419 character: 'x' is not the same as "x". The former is an integer, used to produce the numeric 
2420 value of the letter x in the machine's character set. The latter is an array of characters that 
2421 contains one character (the letter x) and a '\0'. 
2422 
2423 There is one other kind of constant, the enumeration constant. An enumeration is a list of 
2424 constant integer values, as in 
2425 
 
 
2430 The first name in an enum has value 0, the next 1, and so on, unless explicit values are 
2431 specified. If not all values are specified, unspecified values continue the progression from the 
2432 last specified value, as the second of these examples: 
2433 
 
 
 
 
 
 
 
2448 
2449 Names in different enumerations must be distinct. Values need not be distinct in the same 
2450 enumeration. 
2451 
2452 Enumerations provide a convenient way to associate constant values with names, an 
2453 alternative to #define with the advantage that the values can be generated for you. Although 
2454 variables of enum types may be declared, compilers need not check that what you store in 
2455 such a variable is a valid value for the enumeration. Nevertheless, enumeration variables offer 
2456 the chance of checking and so are often better than #defines. In addition, a debugger may be 
2457 able to print values of enumeration variables in their symbolic form. 
2458 
2459 2.4 Declarations 
2460 
2461 All variables must be declared before use, although certain declarations can be made 
2462 implicitly by content. A declaration specifies a type, and contains a list of one or more 
2463 variables of that type, as in 
2464 
 
 
 
2471 Variables can be distributed among declarations in any fashion; the lists above could well be 
2472 written as 
2473 
 
 
 
 
 
 
2486 The latter form takes more space, but is convenient for adding a comment to each declaration 
2487 for subsequent modifications. 
2488 
2489 A variable may also be initialized in its declaration. If the name is followed by an equals sign 
2490 and an expression, the expression serves as an initializer, as in 
2491 
 
 
 
 
 
2502 If the variable in question is not automatic, the initialization is done once only, conceptionally 
2503 before the program starts executing, and the initializer must be a constant expression. An 
2504 explicitly initialized automatic variable is initialized each time the function or block it is in is 
2505 entered; the initializer may be any expression. External and static variables are initialized to 
2506 zero by default. Automatic variables for which is no explicit initializer have undefined (i.e., 
2507 garbage) values. 
2508 
2509 The qualifier const can be applied to the declaration of any variable to specify that its value 
2510 will not be changed. For an array, the const qualifier says that the elements will not be 
2511 altered. 
2512 
 
 
 
2519 The const declaration can also be used with array arguments, to indicate that the function 
2520 does not change that array: 
2521 
 
 
2526 
2527 The result is implementation-defined if an attempt is made to change a const. 
2528 
2529 2.5 Arithmetic Operators 
2530 
2531 The binary arithmetic operators are +, -, *, /, and the modulus operator %. Integer division 
2532 truncates any fractional part. The expression 
2533 
 
 
2538 produces the remainder when x is divided by y, and thus is zero when y divides x exactly. For 
2539 example, a year is a leap year if it is divisible by 4 but not by 100, except that years divisible 
2540 by 400 are leap years. Therefore 
2541 
 
 
 
 
 
2552 The % operator cannot be applied to a float or double. The direction of truncation for / and 
2553 the sign of the result for % are machine-dependent for negative operands, as is the action taken 
2554 on overflow or underflow. 
2555 
2556 The binary + and - operators have the same precedence, which is lower than the precedence 
2557 of *, / and %, which is in turn lower than unary + and -. Arithmetic operators associate left to 
2558 right. 
2559 
2560 Table 2.1 at the end of this chapter summarizes precedence and associativity for all operators. 
2561 
2562 2.6 Relational and Logical Operators 
2563 
2564 The relational operators are 
2565 
 
 
2570 They all have the same precedence. Just below them in precedence are the equality operators: 
2571 
 
 
2576 Relational operators have lower precedence than arithmetic operators, so an expression like i 
2577 < lim-1 is taken as i < (lim-1), as would be expected. 
2578 
2579 More interesting are the logical operators && and ||. Expressions connected by && or || are 
2580 evaluated left to right, and evaluation stops as soon as the truth or falsehood of the result is 
2581 known. Most C programs rely on these properties. For example, here is a loop from the input 
2582 function getline that we wrote in Chapter 1: 
2583 
 
 
 
2590 Before reading a new character it is necessary to check that there is room to store it in the 
2591 array s, so the test i < lim-1 must be made first. Moreover, if this test fails, we must not go 
2592 on and read another character. 
2593 
2594 Similarly, it would be unfortunate if c were tested against EOF before getchar is called; 
2595 therefore the call and assignment must occur before the character in c is tested. 
2596 
2597 
2598 The precedence of && is higher than that of ||, and both are lower than relational and equality 
2599 operators, so expressions like 
2600 
 
 
2605 need no extra parentheses. But since the precedence of != is higher than assignment, 
2606 parentheses are needed in 
2607 
 
 
2612 to achieve the desired result of assignment to c and then comparison with '\n'. 
2613 
2614 By definition, the numeric value of a relational or logical expression is 1 if the relation is true, 
2615 and 0 if the relation is false. 
2616 
2617 The unary negation operator ! converts a non-zero operand into 0, and a zero operand in 1. A 
2618 common use of ! is in constructions like 
2619 
 
 
2624 rather than 
2625 
 
 
2630 It's hard to generalize about which form is better. Constructions like !valid read nicely (``if 
2631 not valid''), but more complicated ones can be hard to understand. 
2632 
2633 Exercise 2-2. Write a loop equivalent to the for loop above without using && or ||. 
2634 
2635 2.7 Type Conversions 
2636 
2637 When an operator has operands of different types, they are converted to a common type 
2638 according to a small number of rules. In general, the only automatic conversions are those that 
2639 convert a ``narrower'' operand into a ``wider'' one without losing information, such as 
2640 converting an integer into floating point in an expression like f + i. Expressions that don't 
2641 make sense, like using a float as a subscript, are disallowed. Expressions that might lose 
2642 information, like assigning a longer integer type to a shorter, or a floating-point type to an 
2643 integer, may draw a warning, but they are not illegal. 
2644 
2645 A char is just a small integer, so chars may be freely used in arithmetic expressions. This 
2646 permits considerable flexibility in certain kinds of character transformations. One is 
2647 exemplified by this naive implementation of the function atoi, which converts a string of 
2648 digits into its numeric equivalent. 
2649 
 
 
 
 
 
 
 
 
 
 
 
2672 As we discussed in Chapter 1, the expression 
2673 
 
2676 
 
2679 gives the numeric value of the character stored in s[i], because the values of '0', '1', etc., 
2680 form a contiguous increasing sequence. 
2681 
2682 Another example of char to int conversion is the function lower, which maps a single 
2683 character to lower case for the ASCII character set. If the character is not an upper case letter, 
2684 lower returns it unchanged. 
2685 
 
 
 
 
 
 
 
 
 
2704 This works for ASCII because corresponding upper case and lower case letters are a fixed 
2705 distance apart as numeric values and each alphabet is contiguous -- there is nothing but letters 
2706 between A and Z. This latter observation is not true of the EBCDIC character set, however, so 
2707 this code would convert more than just letters in EBCDIC. 
2708 
2709 The standard header <ctype.h>, described in Appendix B, defines a family of functions that 
2710 provide tests and conversions that are independent of character set. For example, the function 
2711 tolower is a portable replacement for the function lower shown above. Similarly, the test 
2712 
 
 
2717 can be replaced by 
2718 
 
 
2723 We will use the <ctype.h> functions from now on. 
2724 
2725 There is one subtle point about the conversion of characters to integers. The language does 
2726 not specify whether variables of type char are signed or unsigned quantities. When a char is 
2727 converted to an int, can it ever produce a negative integer? The answer varies from machine 
2728 to machine, reflecting differences in architecture. On some machines a char whose leftmost 
2729 bit is 1 will be converted to a negative integer (``sign extension''). On others, a char is 
2730 promoted to an int by adding zeros at the left end, and thus is always positive. 
2731 
2732 The definition of C guarantees that any character in the machine's standard printing character 
2733 set will never be negative, so these characters will always be positive quantities in 
2734 expressions. But arbitrary bit patterns stored in character variables may appear to be negative 
2735 on some machines, yet positive on others. For portability, specify signed or unsigned if non-
2736 character data is to be stored in char variables. 
2737 
2738 Relational expressions like i > j and logical expressions connected by && and || are defined 
2739 to have value 1 if true, and 0 if false. Thus the assignment 
2740 
 
 
2745 sets d to 1 if c is a digit, and 0 if not. However, functions like isdigit may return any non-
2746 zero value for true. In the test part of if, while, for, etc., ``true'' just means ``non-zero'', so 
2747 this makes no difference. 
2748 
2749 
2750 Implicit arithmetic conversions work much as expected. In general, if an operator like + or * 
2751 that takes two operands (a binary operator) has operands of different types, the ``lower'' type 
2752 is promoted to the ``higher'' type before the operation proceeds. The result is of the integer 
2753 type. Section 6 of Appendix A states the conversion rules precisely. If there are no unsigned 
2754 operands, however, the following informal set of rules will suffice: 
2755 
2756  If either operand is long double, convert the other to long double. 
2757  Otherwise, if either operand is double, convert the other to double. 
2758  Otherwise, if either operand is float, convert the other to float. 
2759  Otherwise, convert char and short to int. 
2760  Then, if either operand is long, convert the other to long. 
2761 
2762 
2763 Notice that floats in an expression are not automatically converted to double; this is a 
2764 change from the original definition. In general, mathematical functions like those in <math.h> 
2765 will use double precision. The main reason for using float is to save storage in large arrays, 
2766 or, less often, to save time on machines where double-precision arithmetic is particularly 
2767 expensive. 
2768 
2769 Conversion rules are more complicated when unsigned operands are involved. The problem 
2770 is that comparisons between signed and unsigned values are machine-dependent, because they 
2771 depend on the sizes of the various integer types. For example, suppose that int is 16 bits and 
2772 long is 32 bits. Then -1L < 1U, because 1U, which is an unsigned int, is promoted to a 
2773 signed long. But -1L > 1UL because -1L is promoted to unsigned long and thus appears 
2774 to be a large positive number. 
2775 
2776 Conversions take place across assignments; the value of the right side is converted to the type 
2777 of the left, which is the type of the result. 
2778 
2779 A character is converted to an integer, either by sign extension or not, as described above. 
2780 
2781 Longer integers are converted to shorter ones or to chars by dropping the excess high-order 
2782 bits. Thus in 
2783 
 
 
 
 
 
 
2796 the value of c is unchanged. This is true whether or not sign extension is involved. Reversing 
2797 the order of assignments might lose information, however. 
2798 
2799 If x is float and i is int, then x = i and i = x both cause conversions; float to int 
2800 causes truncation of any fractional part. When a double is converted to float, whether the 
2801 value is rounded or truncated is implementation dependent. 
2802 
2803 Since an argument of a function call is an expression, type conversion also takes place when 
2804 arguments are passed to functions. In the absence of a function prototype, char and short 
2805 become int, and float becomes double. This is why we have declared function arguments to 
2806 be int and double even when the function is called with char and float. 
2807 
2808 Finally, explicit type conversions can be forced (``coerced'') in any expression, with a unary 
2809 operator called a cast. In the construction 
2810 
2811 
 
2814 the expression is converted to the named type by the conversion rules above. The precise 
2815 meaning of a cast is as if the expression were assigned to a variable of the specified type, 
2816 which is then used in place of the whole construction. For example, the library routine sqrt 
2817 expects a double argument, and will produce nonsense if inadvertently handled something 
2818 else. (sqrt is declared in <math.h>.) So if n is an integer, we can use 
2819 
 
 
2824 to convert the value of n to double before passing it to sqrt. Note that the cast produces the 
2825 value of n in the proper type; n itself is not altered. The cast operator has the same high 
2826 precedence as other unary operators, as summarized in the table at the end of this chapter. 
2827 
2828 If arguments are declared by a function prototype, as the normally should be, the declaration 
2829 causes automatic coercion of any arguments when the function is called. Thus, given a 
2830 function prototype for sqrt: 
2831 
 
 
2836 the call 
2837 
 
 
2842 coerces the integer 2 into the double value 2.0 without any need for a cast. 
2843 
2844 The standard library includes a portable implementation of a pseudo-random number 
2845 generator and a function for initializing the seed; the former illustrates a cast: 
2846 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
2877 Exercise 2-3. Write a function htoi(s), which converts a string of hexadecimal digits 
2878 (including an optional 0x or 0X) into its equivalent integer value. The allowable digits are 0 
2879 through 9, a through f, and A through F. 
2880 
2881 2.8 Increment and Decrement Operators 
2882 
2883 C provides two unusual operators for incrementing and decrementing variables. The 
2884 increment operator ++ adds 1 to its operand, while the decrement operator -- subtracts 1. We 
2885 have frequently used ++ to increment variables, as in 
2886 
 
 
 
2893 
2894 The unusual aspect is that ++ and -- may be used either as prefix operators (before the 
2895 variable, as in ++n), or postfix operators (after the variable: n++). In both cases, the effect is to 
2896 increment n. But the expression ++n increments n before its value is used, while n++ 
2897 increments n after its value has been used. This means that in a context where the value is 
2898 being used, not just the effect, ++n and n++ are different. If n is 5, then 
2899 
 
 
2904 sets x to 5, but 
2905 
 
 
2910 sets x to 6. In both cases, n becomes 6. The increment and decrement operators can only be 
2911 applied to variables; an expression like (i+j)++ is illegal. 
2912 
2913 In a context where no value is wanted, just the incrementing effect, as in 
2914 
 
 
 
2921 prefix and postfix are the same. But there are situations where one or the other is specifically 
2922 called for. For instance, consider the function squeeze(s,c), which removes all occurrences 
2923 of the character c from the string s. 
2924 
 
 
 
 
 
 
 
 
 
 
 
2947 Each time a non-c occurs, it is copied into the current j position, and only then is j 
2948 incremented to be ready for the next character. This is exactly equivalent to 
2949 
 
 
 
 
 
2960 Another example of a similar construction comes from the getline function that we wrote in 
2961 Chapter 1, where we can replace 
2962 
 
 
 
 
 
2973 by the more compact 
2974 
 
 
 
2981 As a third example, consider the standard function strcat(s,t), which concatenates the 
2982 string t to the end of string s. strcat assumes that there is enough space in s to hold the 
2983 combination. As we have written it, strcat returns no value; the standard library version 
2984 returns a pointer to the resulting string. 
2985 
 
 
 
 
2994 
 
 
 
 
 
 
 
 
3011 As each member is copied from t to s, the postfix ++ is applied to both i and j to make sure 
3012 that they are in position for the next pass through the loop. 
3013 
3014 Exercise 2-4. Write an alternative version of squeeze(s1,s2) that deletes each character in 
3015 s1 that matches any character in the string s2. 
3016 
3017 Exercise 2-5. Write the function any(s1,s2), which returns the first location in a string s1 
3018 where any character from the string s2 occurs, or -1 if s1 contains no characters from s2. 
3019 (The standard library function strpbrk does the same job but returns a pointer to the 
3020 location.) 
3021 
3022 2.9 Bitwise Operators 
3023 
3024 C provides six operators for bit manipulation; these may only be applied to integral operands, 
3025 that is, char, short, int, and long, whether signed or unsigned. 
3026 
3027 & 
3028 
3029 bitwise AND 
3030 
3031 | 
3032 
3033 bitwise inclusive OR 
3034 
3035 ^ 
3036 
3037 bitwise exclusive OR 
3038 
3039 << 
3040 
3041 left shift 
3042 
3043 >> 
3044 
3045 right shift 
3046 
3047 ~ 
3048 
3049 one's complement (unary)
3050 
3051 
3052 
3053 The bitwise AND operator & is often used to mask off some set of bits, for example 
3054 
 
 
3059 sets to zero all but the low-order 7 bits of n. 
3060 
3061 The bitwise OR operator | is used to turn bits on: 
3062 
 
 
3067 sets to one in x the bits that are set to one in SET_ON. 
3068 
3069 The bitwise exclusive OR operator ^ sets a one in each bit position where its operands have 
3070 different bits, and zero where they are the same. 
3071 
3072 One must distinguish the bitwise operators & and | from the logical operators && and ||, 
3073 which imply left-to-right evaluation of a truth value. For example, if x is 1 and y is 2, then x 
3074 & y is zero while x && y is one. 
3075 
3076 The shift operators << and >> perform left and right shifts of their left operand by the number 
3077 of bit positions given by the right operand, which must be non-negative. Thus x << 2 shifts 
3078 
3079 
3080 the value of x by two positions, filling vacated bits with zero; this is equivalent to 
3081 multiplication by 4. Right shifting an unsigned quantity always fits the vacated bits with 
3082 zero. Right shifting a signed quantity will fill with bit signs (``arithmetic shift'') on some 
3083 machines and with 0-bits (``logical shift'') on others. 
3084 
3085 The unary operator ~ yields the one's complement of an integer; that is, it converts each 1-bit 
3086 into a 0-bit and vice versa. For example 
3087 
 
 
3092 sets the last six bits of x to zero. Note that x & ~077 is independent of word length, and is 
3093 thus preferable to, for example, x & 0177700, which assumes that x is a 16-bit quantity. The 
3094 portable form involves no extra cost, since ~077 is a constant expression that can be evaluated 
3095 at compile time. 
3096 
3097 As an illustration of some of the bit operators, consider the function getbits(x,p,n) that 
3098 returns the (right adjusted) n-bit field of x that begins at position p. We assume that bit 
3099 position 0 is at the right end and that n and p are sensible positive values. For example, 
3100 getbits(x,4,3) returns the three bits in positions 4, 3 and 2, right-adjusted. 
3101 
 
 
 
 
 
 
3114 The expression x >> (p+1-n) moves the desired field to the right end of the word. ~0 is all 
3115 1-bits; shifting it left n positions with ~0<<n places zeros in the rightmost n bits; 
3116 complementing that with ~ makes a mask with ones in the rightmost n bits. 
3117 
3118 Exercise 2-6. Write a function setbits(x,p,n,y) that returns x with the n bits that begin at 
3119 position p set to the rightmost n bits of y, leaving the other bits unchanged. 
3120 
3121 Exercise 2-7. Write a function invert(x,p,n) that returns x with the n bits that begin at 
3122 position p inverted (i.e., 1 changed into 0 and vice versa), leaving the others unchanged. 
3123 
3124 Exercise 2-8. Write a function rightrot(x,n) that returns the value of the integer x rotated 
3125 to the right by n positions. 
3126 
3127 2.10 Assignment Operators and Expressions 
3128 
3129 An expression such as 
3130 
 
 
3135 in which the variable on the left side is repeated immediately on the right, can be written in 
3136 the compressed form 
3137 
 
 
3142 The operator += is called an assignment operator. 
3143 
3144 Most binary operators (operators like + that have a left and right operand) have a 
3145 corresponding assignment operator op=, where op is one of 
3146 
3147 
 
 
3152 If expr1 and expr2 are expressions, then 
3153 
 
 
3158 is equivalent to 
3159 
 
 
3164 except that expr1 is computed only once. Notice the parentheses around expr2: 
3165 
 
 
3170 means 
3171 
 
 
3176 rather than 
3177 
 
 
3182 As an example, the function bitcount counts the number of 1-bits in its integer argument. 
3183 
 
 
 
 
 
 
 
 
 
 
 
3206 Declaring the argument x to be an unsigned ensures that when it is right-shifted, vacated bits 
3207 will be filled with zeros, not sign bits, regardless of the machine the program is run on. 
3208 
3209 Quite apart from conciseness, assignment operators have the advantage that they correspond 
3210 better to the way people think. We say ``add 2 to i'' or ``increment i by 2'', not ``take i, add 
3211 2, then put the result back in i''. Thus the expression i += 2 is preferable to i = i+2. In 
3212 addition, for a complicated expression like 
3213 
 
 
3218 the assignment operator makes the code easier to understand, since the reader doesn't have to 
3219 check painstakingly that two long expressions are indeed the same, or to wonder why they're 
3220 not. And an assignment operator may even help a compiler to produce efficient code. 
3221 
3222 We have already seen that the assignment statement has a value and can occur in expressions; 
3223 the most common example is 
3224 
 
 
 
3231 The other assignment operators (+=, -=, etc.) can also occur in expressions, although this is 
3232 less frequent. 
3233 
3234 In all such expressions, the type of an assignment expression is the type of its left operand, 
3235 and the value is the value after the assignment. 
3236 
3237 Exercise 2-9. In a two's complement number system, x &= (x-1) deletes the rightmost 1-bit 
3238 in x. Explain why. Use this observation to write a faster version of bitcount. 
3239 
3240 
3241 2.11 Conditional Expressions 
3242 
3243 The statements 
3244 
 
 
 
 
 
3255 compute in z the maximum of a and b. The conditional expression, written with the ternary 
3256 operator ``?:'', provides an alternate way to write this and similar constructions. In the 
3257 expression 
3258 
 
 
3263 the expression expr1 is evaluated first. If it is non-zero (true), then the expression expr2 is 
3264 evaluated, and that is the value of the conditional expression. Otherwise expr3 is evaluated, 
3265 and that is the value. Only one of expr2 and expr3 is evaluated. Thus to set z to the maximum 
3266 of a and b, 
3267 
 
 
3272 It should be noted that the conditional expression is indeed an expression, and it can be used 
3273 wherever any other expression can be. If expr2 and expr3 are of different types, the type of the 
3274 result is determined by the conversion rules discussed earlier in this chapter. For example, if f 
3275 is a float and n an int, then the expression 
3276 
 
 
3281 is of type float regardless of whether n is positive. 
3282 
3283 Parentheses are not necessary around the first expression of a conditional expression, since 
3284 the precedence of ?: is very low, just above assignment. They are advisable anyway, 
3285 however, since they make the condition part of the expression easier to see. 
3286 
3287 The conditional expression often leads to succinct code. For example, this loop prints n 
3288 elements of an array, 10 per line, with each column separated by one blank, and with each line 
3289 (including the last) terminated by a newline. 
3290 
 
 
 
3297 A newline is printed after every tenth element, and after the n-th. All other elements are 
3298 followed by one blank. This might look tricky, but it's more compact than the equivalent if-
3299 else. Another good example is 
3300 
 
 
3305 Exercise 2-10. Rewrite the function lower, which converts upper case letters to lower case, 
3306 with a conditional expression instead of if-else. 
3307 
3308 2.12 Precedence and Order of Evaluation 
3309 
3310 Table 2.1 summarizes the rules for precedence and associativity of all operators, including 
3311 those that we have not yet discussed. Operators on the same line have the same precedence; 
3312 rows are in order of decreasing precedence, so, for example, *, /, and % all have the same 
3313 precedence, which is higher than that of binary + and -. The ``operator'' () refers to function 
3314 call. The operators -> and . are used to access members of structures; they will be covered in 
3315 
3316 
3317 Chapter 6, along with sizeof (size of an object). Chapter 5 discusses * (indirection through a 
3318 pointer) and & (address of an object), and Chapter 3 discusses the comma operator. 
3319 
3320 Operators 
3321 
3322 Associativity 
3323 
3324 () [] -> . 
3325 
 
3328 ! ~ ++ -- + - * (type) sizeof 
3329 
 
3332 * / % 
3333 
 
3336 + - 
3337 
 
3340 << >> 
3341 
 
3344 < <= > >= 
3345 
 
3348 == != 
3349 
 
3352 & 
3353 
 
3356 ^ 
3357 
 
3360 | 
3361 
 
3364 && 
3365 
 
3368 || 
3369 
 
3372 ?: 
3373 
 
3376 = += -= *= /= %= &= ^= |= <<= >>=
3377 
 
3380 , 
3381 
 
3384 
3385 
3386 Unary & +, -, and * have higher precedence than the binary forms. 
3387 
3388 Table 2.1: Precedence and Associativity of Operators 
3389 
3390 Note that the precedence of the bitwise operators &, ^, and | falls below == and !=. This 
3391 implies that bit-testing expressions like 
3392 
 
 
3397 must be fully parenthesized to give proper results. 
3398 
3399 C, like most languages, does not specify the order in which the operands of an operator are 
3400 evaluated. (The exceptions are &&, ||, ?:, and `,'.) For example, in a statement like 
3401 
 
 
3406 f may be evaluated before g or vice versa; thus if either f or g alters a variable on which the 
3407 other depends, x can depend on the order of evaluation. Intermediate results can be stored in 
3408 temporary variables to ensure a particular sequence. 
3409 
3410 Similarly, the order in which function arguments are evaluated is not specified, so the 
3411 statement 
3412 
 
 
3417 can produce different results with different compilers, depending on whether n is incremented 
3418 before power is called. The solution, of course, is to write 
3419 
 
 
3424 
 
3427 Function calls, nested assignment statements, and increment and decrement operators cause 
3428 ``side effects'' - some variable is changed as a by-product of the evaluation of an expression. 
3429 In any expression involving side effects, there can be subtle dependencies on the order in 
3430 which variables taking part in the expression are updated. One unhappy situation is typified 
3431 by the statement 
3432 
 
 
3437 The question is whether the subscript is the old value of i or the new. Compilers can interpret 
3438 this in different ways, and generate different answers depending on their interpretation. The 
3439 standard intentionally leaves most such matters unspecified. When side effects (assignment to 
3440 variables) take place within an expression is left to the discretion of the compiler, since the 
3441 best order depends strongly on machine architecture. (The standard does specify that all side 
3442 effects on arguments take effect before a function is called, but that would not help in the call 
3443 to printf above.) 
3444 
3445 The moral is that writing code that depends on order of evaluation is a bad programming 
3446 practice in any language. Naturally, it is necessary to know what things to avoid, but if you 
3447 don't know how they are done on various machines, you won't be tempted to take advantage 
3448 of a particular implementation. 
3449 
3450 
 
3453 Chapter 3 - Control Flow 
3454 
3455 The control-flow of a language specify the order in which computations are performed. We 
3456 have already met the most common control-flow constructions in earlier examples; here we 
3457 will complete the set, and be more precise about the ones discussed before. 
3458 
3459 3.1 Statements and Blocks 
3460 
3461 An expression such as x = 0 or i++ or printf(...) becomes a statement when it is 
3462 followed by a semicolon, as in 
3463 
 
 
 
 
3472 In C, the semicolon is a statement terminator, rather than a separator as it is in languages like 
3473 Pascal. 
3474 
3475 Braces { and } are used to group declarations and statements together into a compound 
3476 statement, or block, so that they are syntactically equivalent to a single statement. The braces 
3477 that surround the statements of a function are one obvious example; braces around multiple 
3478 statements after an if, else, while, or for are another. (Variables can be declared inside any 
3479 block; we will talk about this in Chapter 4.) There is no semicolon after the right brace that 
3480 ends a block. 
3481 
3482 3.2 If-Else 
3483 
3484 The if-else statement is used to express decisions. Formally the syntax is 
3485 
 
 
 
 
 
3496 where the else part is optional. The expression is evaluated; if it is true (that is, if expression 
3497 has a non-zero value), statement1 is executed. If it is false (expression is zero) and if there is 
3498 an else part, statement2 is executed instead. 
3499 
3500 Since an if tests the numeric value of an expression, certain coding shortcuts are possible. 
3501 The most obvious is writing 
3502 
 
 
3507 instead of 
3508 
 
 
3513 Sometimes this is natural and clear; at other times it can be cryptic. 
3514 
3515 Because the else part of an if-else is optional,there is an ambiguity when an else if omitted 
3516 from a nested if sequence. This is resolved by associating the else with the closest previous 
3517 else-less if. For example, in 
3518 
3519 
 
 
 
 
 
 
3532 the else goes to the inner if, as we have shown by indentation. If that isn't what you want, 
3533 braces must be used to force the proper association: 
3534 
 
 
 
 
 
 
 
3549 The ambiguity is especially pernicious in situations like this: 
3550 
 
 
 
 
 
 
 
 
 
3569 The indentation shows unequivocally what you want, but the compiler doesn't get the 
3570 message, and associates the else with the inner if. This kind of bug can be hard to find; it's a 
3571 good idea to use braces when there are nested ifs. 
3572 
3573 By the way, notice that there is a semicolon after z = a in 
3574 
 
 
 
 
 
3585 This is because grammatically, a statement follows the if, and an expression statement like 
3586 ``z = a;'' is always terminated by a semicolon. 
3587 
3588 3.3 Else-If 
3589 
3590 The construction 
3591 
 
 
 
 
 
 
 
 
 
 
 
3614 occurs so often that it is worth a brief separate discussion. This sequence of if statements is 
3615 the most general way of writing a multi-way decision. The expressions are evaluated in order; 
3616 if an expression is true, the statement associated with it is executed, and this terminates the 
3617 whole chain. As always, the code for each statement is either a single statement, or a group of 
3618 them in braces. 
3619 
3620 
3621 The last else part handles the ``none of the above'' or default case where none of the other 
3622 conditions is satisfied. Sometimes there is no explicit action for the default; in that case the 
3623 trailing 
3624 
 
 
 
3631 can be omitted, or it may be used for error checking to catch an ``impossible'' condition. 
3632 
3633 To illustrate a three-way decision, here is a binary search function that decides if a particular 
3634 value x occurs in the sorted array v. The elements of v must be in increasing order. The 
3635 function returns the position (a number between 0 and n-1) if x occurs in v, and -1 if not. 
3636 
3637 Binary search first compares the input value x to the middle element of the array v. If x is less 
3638 than the middle value, searching focuses on the lower half of the table, otherwise on the upper 
3639 half. In either case, the next step is to compare x to the middle element of the selected half. 
3640 This process of dividing the range in two continues until the value is found or the range is 
3641 empty. 
3642 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
3681 The fundamental decision is whether x is less than, greater than, or equal to the middle 
3682 element v[mid] at each step; this is a natural for else-if. 
3683 
3684 Exercise 3-1. Our binary search makes two tests inside the loop, when one would suffice (at 
3685 the price of more tests outside.) Write a version with only one test inside the loop and 
3686 measure the difference in run-time. 
3687 
3688 3.4 Switch 
3689 
3690 The switch statement is a multi-way decision that tests whether an expression matches one of 
3691 a number of constant integer values, and branches accordingly. 
3692 
 
 
 
 
 
 
3705 
3706 Each case is labeled by one or more integer-valued constants or constant expressions. If a case 
3707 matches the expression value, execution starts at that case. All case expressions must be 
3708 different. The case labeled default is executed if none of the other cases are satisfied. A 
3709 default is optional; if it isn't there and if none of the cases match, no action at all takes place. 
3710 Cases and the default clause can occur in any order. 
3711 
3712 In Chapter 1 we wrote a program to count the occurrences of each digit, white space, and all 
3713 other characters, using a sequence of if ... else if ... else. Here is the same program 
3714 with a switch: 
3715 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
3782 The break statement causes an immediate exit from the switch. Because cases serve just as 
3783 labels, after the code for one case is done, execution falls through to the next unless you take 
3784 explicit action to escape. break and return are the most common ways to leave a switch. A 
3785 break statement can also be used to force an immediate exit from while, for, and do loops, 
3786 as will be discussed later in this chapter. 
3787 
3788 Falling through cases is a mixed blessing. On the positive side, it allows several cases to be 
3789 attached to a single action, as with the digits in this example. But it also implies that normally 
3790 each case must end with a break to prevent falling through to the next. Falling through from 
3791 one case to another is not robust, being prone to disintegration when the program is modified. 
3792 With the exception of multiple labels for a single computation, fall-throughs should be used 
3793 sparingly, and commented. 
3794 
3795 
3796 As a matter of good form, put a break after the last case (the default here) even though it's 
3797 logically unnecessary. Some day when another case gets added at the end, this bit of 
3798 defensive programming will save you. 
3799 
3800 Exercise 3-2. Write a function escape(s,t) that converts characters like newline and tab 
3801 into visible escape sequences like \n and \t as it copies the string t to s. Use a switch. Write 
3802 a function for the other direction as well, converting escape sequences into the real characters. 
3803 
3804 3.5 Loops - While and For 
3805 
3806 We have already encountered the while and for loops. In 
3807 
 
 
 
3814 the expression is evaluated. If it is non-zero, statement is executed and expression is re-
3815 evaluated. This cycle continues until expression becomes zero, at which point execution 
3816 resumes after statement. 
3817 
3818 The for statement 
3819 
 
 
 
3826 is equivalent to 
3827 
 
 
 
 
 
 
3840 except for the behaviour of continue, which is described in Section 3.7. 
3841 
3842 Grammatically, the three components of a for loop are expressions. Most commonly, expr1 
3843 and expr3 are assignments or function calls and expr2 is a relational expression. Any of the 
3844 three parts can be omitted, although the semicolons must remain. If expr1 or expr3 is omitted, 
3845 it is simply dropped from the expansion. If the test, expr2, is not present, it is taken as 
3846 permanently true, so 
3847 
 
 
 
 
3856 is an ``infinite'' loop, presumably to be broken by other means, such as a break or return. 
3857 
3858 Whether to use while or for is largely a matter of personal preference. For example, in 
3859 
 
 
 
3866 there is no initialization or re-initialization, so the while is most natural. 
3867 
3868 The for is preferable when there is a simple initialization and increment since it keeps the 
3869 loop control statements close together and visible at the top of the loop. This is most obvious 
3870 in 
3871 
3872 
 
 
 
3879 which is the C idiom for processing the first n elements of an array, the analog of the Fortran 
3880 DO loop or the Pascal for. The analogy is not perfect, however, since the index variable i 
3881 retains its value when the loop terminates for any reason. Because the components of the for 
3882 are arbitrary expressions, for loops are not restricted to arithmetic progressions. Nonetheless, 
3883 it is bad style to force unrelated computations into the initialization and increment of a for, 
3884 which are better reserved for loop control operations. 
3885 
3886 As a larger example, here is another version of atoi for converting a string to its numeric 
3887 equivalent. This one is slightly more general than the one in Chapter 2; it copes with optional 
3888 leading white space and an optional + or - sign. (Chapter 4 shows atof, which does the same 
3889 conversion for floating-point numbers.) 
3890 
3891 The structure of the program reflects the form of the input: 
3892 
 get sign, if any 
3895 get integer part and convert it 
3896 
3897 Each step does its part, and leaves things in a clean state for the next. The whole process 
3898 terminates on the first character that could not be part of a number. 
3899 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
3934 The standard library provides a more elaborate function strtol for conversion of strings to 
3935 long integers; see Section 5 of Appendix B. 
3936 
3937 The advantages of keeping loop control centralized are even more obvious when there are 
3938 several nested loops. The following function is a Shell sort for sorting an array of integers. 
3939 The basic idea of this sorting algorithm, which was invented in 1959 by D. L. Shell, is that in 
3940 early stages, far-apart elements are compared, rather than adjacent ones as in simpler 
3941 interchange sorts. This tends to eliminate large amounts of disorder quickly, so later stages 
3942 have less work to do. The interval between compared elements is gradually decreased to one, 
3943 at which point the sort effectively becomes an adjacent interchange method. 
3944 
 
 
 
 
3953 
 
 
 
 
 
 
 
 
 
 
3974 There are three nested loops. The outermost controls the gap between compared elements, 
3975 shrinking it from n/2 by a factor of two each pass until it becomes zero. The middle loop 
3976 steps along the elements. The innermost loop compares each pair of elements that is separated 
3977 by gap and reverses any that are out of order. Since gap is eventually reduced to one, all 
3978 elements are eventually ordered correctly. Notice how the generality of the for makes the 
3979 outer loop fit in the same form as the others, even though it is not an arithmetic progression. 
3980 
3981 One final C operator is the comma ``,'', which most often finds use in the for statement. A 
3982 pair of expressions separated by a comma is evaluated left to right, and the type and value of 
3983 the result are the type and value of the right operand. Thus in a for statement, it is possible to 
3984 place multiple expressions in the various parts, for example to process two indices in parallel. 
3985 This is illustrated in the function reverse(s), which reverses the string s in place. 
3986 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
4015 The commas that separate function arguments, variables in declarations, etc., are not comma 
4016 operators, and do not guarantee left to right evaluation. 
4017 
4018 Comma operators should be used sparingly. The most suitable uses are for constructs strongly 
4019 related to each other, as in the for loop in reverse, and in macros where a multistep 
4020 computation has to be a single expression. A comma expression might also be appropriate for 
4021 the exchange of elements in reverse, where the exchange can be thought of a single 
4022 operation: 
4023 
 
 
 
4030 Exercise 3-3. Write a function expand(s1,s2) that expands shorthand notations like a-z in 
4031 the string s1 into the equivalent complete list abc...xyz in s2. Allow for letters of either 
4032 case and digits, and be prepared to handle cases like a-b-c and a-z0-9 and -a-z. Arrange 
4033 that a leading or trailing - is taken literally. 
4034 
4035 3.6 Loops - Do-While 
4036 
4037 
4038 As we discussed in Chapter 1, the while and for loops test the termination condition at the 
4039 top. By contrast, the third loop in C, the do-while, tests at the bottom after making each pass 
4040 through the loop body; the body is always executed at least once. 
4041 
4042 The syntax of the do is 
4043 
 
 
 
 
4052 The statement is executed, then expression is evaluated. If it is true, statement is evaluated 
4053 again, and so on. When the expression becomes false, the loop terminates. Except for the 
4054 sense of the test, do-while is equivalent to the Pascal repeat-until statement. 
4055 
4056 Experience shows that do-while is much less used than while and for. Nonetheless, from 
4057 time to time it is valuable, as in the following function itoa, which converts a number to a 
4058 character string (the inverse of atoi). The job is slightly more complicated than might be 
4059 thought at first, because the easy methods of generating the digits generate them in the wrong 
4060 order. We have chosen to generate the string backwards, then reverse it. 
4061 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
4096 The do-while is necessary, or at least convenient, since at least one character must be 
4097 installed in the array s, even if n is zero. We also used braces around the single statement that 
4098 makes up the body of the do-while, even though they are unnecessary, so the hasty reader 
4099 will not mistake the while part for the beginning of a while loop. 
4100 
4101 Exercise 3-4. In a two's complement number representation, our version of itoa does not 
4102 handle the largest negative number, that is, the value of n equal to -(2wordsize-1). Explain why 
4103 not. Modify it to print that value correctly, regardless of the machine on which it runs. 
4104 
4105 Exercise 3-5. Write the function itob(n,s,b) that converts the integer n into a base b 
4106 character representation in the string s. In particular, itob(n,s,16) formats s as a 
4107 hexadecimal integer in s. 
4108 
4109 Exercise 3-6. Write a version of itoa that accepts three arguments instead of two. The third 
4110 argument is a minimum field width; the converted number must be padded with blanks on the 
4111 left if necessary to make it wide enough. 
4112 
4113 3.7 Break and Continue 
4114 
4115 
4116 It is sometimes convenient to be able to exit from a loop other than by testing at the top or 
4117 bottom. The break statement provides an early exit from for, while, and do, just as from 
4118 switch. A break causes the innermost enclosing loop or switch to be exited immediately. 
4119 
4120 The following function, trim, removes trailing blanks, tabs and newlines from the end of a 
4121 string, using a break to exit from a loop when the rightmost non-blank, non-tab, non-newline 
4122 is found. 
4123 
 
 
 
 
 
 
 
 
 
 
 
 
4148 strlen returns the length of the string. The for loop starts at the end and scans backwards 
4149 looking for the first character that is not a blank or tab or newline. The loop is broken when 
4150 one is found, or when n becomes negative (that is, when the entire string has been scanned). 
4151 You should verify that this is correct behavior even when the string is empty or contains only 
4152 white space characters. 
4153 
4154 The continue statement is related to break, but less often used; it causes the next iteration of 
4155 the enclosing for, while, or do loop to begin. In the while and do, this means that the test 
4156 part is executed immediately; in the for, control passes to the increment step. The continue 
4157 statement applies only to loops, not to switch. A continue inside a switch inside a loop 
4158 causes the next loop iteration. 
4159 
4160 As an example, this fragment processes only the non-negative elements in the array a; 
4161 negative values are skipped. 
4162 
 
 
 
 
 
4173 The continue statement is often used when the part of the loop that follows is complicated, 
4174 so that reversing a test and indenting another level would nest the program too deeply. 
4175 
4176 3.8 Goto and labels 
4177 
4178 C provides the infinitely-abusable goto statement, and labels to branch to. Formally, the goto 
4179 statement is never necessary, and in practice it is almost always easy to write code without it. 
4180 We have not used goto in this book. 
4181 
4182 Nevertheless, there are a few situations where gotos may find a place. The most common is 
4183 to abandon processing in some deeply nested structure, such as breaking out of two or more 
4184 loops at once. The break statement cannot be used directly since it only exits from the 
4185 innermost loop. Thus: 
4186 
4187 
 
 
 
 
 
 
 
 
 
 
4208 This organization is handy if the error-handling code is non-trivial, and if errors can occur in 
4209 several places. 
4210 
4211 A label has the same form as a variable name, and is followed by a colon. It can be attached to 
4212 any statement in the same function as the goto. The scope of a label is the entire function. 
4213 
4214 As another example, consider the problem of determining whether two arrays a and b have an 
4215 element in common. One possibility is 
4216 
 
 
 
 
 
 
 
 
 
 
4237 Code involving a goto can always be written without one, though perhaps at the price of 
4238 some repeated tests or an extra variable. For example, the array search becomes 
4239 
 
 
 
 
 
 
 
 
 
 
 
 
4264 With a few exceptions like those cited here, code that relies on goto statements is generally 
4265 harder to understand and to maintain than code without gotos. Although we are not dogmatic 
4266 about the matter, it does seem that goto statements should be used rarely, if at all. 
4267 
4268 
 
4271 Chapter 4 - Functions and Program 
4272 Structure 
4273 
4274 Functions break large computing tasks into smaller ones, and enable people to build on what 
4275 others have done instead of starting over from scratch. Appropriate functions hide details of 
4276 operation from parts of the program that don't need to know about them, thus clarifying the 
4277 whole, and easing the pain of making changes. 
4278 
4279 C has been designed to make functions efficient and easy to use; C programs generally consist 
4280 of many small functions rather than a few big ones. A program may reside in one or more 
4281 source files. Source files may be compiled separately and loaded together, along with 
4282 previously compiled functions from libraries. We will not go into that process here, however, 
4283 since the details vary from system to system. 
4284 
4285 Function declaration and definition is the area where the ANSI standard has made the most 
4286 changes to C. As we saw first in Chapter 1, it is now possible to declare the type of arguments 
4287 when a function is declared. The syntax of function declaration also changes, so that 
4288 declarations and definitions match. This makes it possible for a compiler to detect many more 
4289 errors than it could before. Furthermore, when arguments are properly declared, appropriate 
4290 type coercions are performed automatically. 
4291 
4292 The standard clarifies the rules on the scope of names; in particular, it requires that there be 
4293 only one definition of each external object. Initialization is more general: automatic arrays 
4294 and structures may now be initialized. 
4295 
4296 The C preprocessor has also been enhanced. New preprocessor facilities include a more 
4297 complete set of conditional compilation directives, a way to create quoted strings from macro 
4298 arguments, and better control over the macro expansion process. 
4299 
4300 4.1 Basics of Functions 
4301 
4302 To begin with, let us design and write a program to print each line of its input that contains a 
4303 particular ``pattern'' or string of characters. (This is a special case of the UNIX program 
4304 grep.) For example, searching for the pattern of letters ``ould'' in the set of lines 
4305 
 
 
 
 
 
4316 will produce the output 
4317 
 
 
 
 
4326 The job falls neatly into three pieces: 
4327 
 
4330 while (there's another line) 
4331 
 
 
4336 
4337 Although it's certainly possible to put the code for all of this in main, a better way is to use the 
4338 structure to advantage by making each part a separate function. Three small pieces are better 
4339 to deal with than one big one, because irrelevant details can be buried in the functions, and the 
4340 chance of unwanted interactions is minimized. And the pieces may even be useful in other 
4341 programs. 
4342 
4343 ``While there's another line'' is getline, a function that we wrote in Chapter 1, and ``print it'' 
4344 is printf, which someone has already provided for us. This means we need only write a 
4345 routine to decide whether the line contains an occurrence of the pattern. 
4346 
4347 We can solve that problem by writing a function strindex(s,t) that returns the position or 
4348 index in the string s where the string t begins, or -1 if s does not contain t. Because C arrays 
4349 begin at position zero, indexes will be zero or positive, and so a negative value like -1 is 
4350 convenient for signaling failure. When we later need more sophisticated pattern matching, we 
4351 only have to replace strindex; the rest of the code can remain the same. (The standard 
4352 library provides a function strstr that is similar to strindex, except that it returns a pointer 
4353 instead of an index.) 
4354 
4355 Given this much design, filling in the details of the program is straightforward. Here is the 
4356 whole thing, so you can see how the pieces fit together. For now, the pattern to be searched 
4357 for is a literal string, which is not the most general of mechanisms. We will return shortly to a 
4358 discussion of how to initialize character arrays, and in Chapter 5 will show how to make the 
4359 pattern a parameter that is set when the program is run. There is also a slightly different 
4360 version of getline; you might find it instructive to compare it to the one in Chapter 1. 
4361 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
4428 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
4463 Each function definition has the form 
4464 
 
4467 return-type function-name(argument declarations) 
4468 
4469 { 
4470 
 
4473 } 
4474 
4475 Various parts may be absent; a minimal function is 
4476 
 
 
4481 which does nothing and returns nothing. A do-nothing function like this is sometimes useful 
4482 as a place holder during program development. If the return type is omitted, int is assumed. 
4483 
4484 A program is just a set of definitions of variables and functions. Communication between the 
4485 functions is by arguments and values returned by the functions, and through external 
4486 variables. The functions can occur in any order in the source file, and the source program can 
4487 be split into multiple files, so long as no function is split. 
4488 
4489 The return statement is the mechanism for returning a value from the called function to its 
4490 caller. Any expression can follow return: 
4491 
 
 
4496 The expression will be converted to the return type of the function if necessary. Parentheses 
4497 are often used around the expression, but they are optional. 
4498 
4499 The calling function is free to ignore the returned value. Furthermore, there need to be no 
4500 expression after return; in that case, no value is returned to the caller. Control also returns to 
4501 the caller with no value when execution ``falls off the end'' of the function by reaching the 
4502 closing right brace. It is not illegal, but probably a sign of trouble, if a function returns a value 
4503 from one place and no value from another. In any case, if a function fails to return a value, its 
4504 ``value'' is certain to be garbage. 
4505 
4506 The pattern-searching program returns a status from main, the number of matches found. This 
4507 value is available for use by the environment that called the program 
4508 
4509 The mechanics of how to compile and load a C program that resides on multiple source files 
4510 vary from one system to the next. On the UNIX system, for example, the cc command 
4511 mentioned in Chapter 1 does the job. Suppose that the three functions are stored in three files 
4512 called main.c, getline.c, and strindex.c. Then the command 
4513 
4514 
 
 
4519 compiles the three files, placing the resulting object code in files main.o, getline.o, and 
4520 strindex.o, then loads them all into an executable file called a.out. If there is an error, say 
4521 in main.c, the file can be recompiled by itself and the result loaded with the previous object 
4522 files, with the command 
4523 
 
 
4528 The cc command uses the ``.c'' versus ``.o'' naming convention to distinguish source files 
4529 from object files. 
4530 
4531 Exercise 4-1. Write the function strindex(s,t) which returns the position of the rightmost 
4532 occurrence of t in s, or -1 if there is none. 
4533 
4534 4.2 Functions Returning Non-integers 
4535 
4536 So far our examples of functions have returned either no value (void) or an int. What if a 
4537 function must return some other type? many numerical functions like sqrt, sin, and cos 
4538 return double; other specialized functions return other types. To illustrate how to deal with 
4539 this, let us write and use the function atof(s), which converts the string s to its double-
4540 precision floating-point equivalent. atof if an extension of atoi, which we showed versions 
4541 of in Chapters 2 and 3. It handles an optional sign and decimal point, and the presence or 
4542 absence of either part or fractional part. Our version is not a high-quality input conversion 
4543 routine; that would take more space than we care to use. The standard library includes an 
4544 atof; the header <stdlib.h> declares it. 
4545 
4546 First, atof itself must declare the type of value it returns, since it is not int. The type name 
4547 precedes the function name: 
4548 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
4597 Second, and just as important, the calling routine must know that atof returns a non-int value. 
4598 One way to ensure this is to declare atof explicitly in the calling routine. The declaration is 
4599 shown in this primitive calculator (barely adequate for check-book balancing), which reads 
4600 
4601 
4602 one number per line, optionally preceded with a sign, and adds them up, printing the running 
4603 sum after each input: 
4604 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
4639 The declaration 
4640 
 
 
4645 says that sum is a double variable, and that atof is a function that takes one char[] argument 
4646 and returns a double. 
4647 
4648 The function atof must be declared and defined consistently. If atof itself and the call to it in 
4649 main have inconsistent types in the same source file, the error will be detected by the 
4650 compiler. But if (as is more likely) atof were compiled separately, the mismatch would not 
4651 be detected, atof would return a double that main would treat as an int, and meaningless 
4652 answers would result. 
4653 
4654 In the light of what we have said about how declarations must match definitions, this might 
4655 seem surprising. The reason a mismatch can happen is that if there is no function prototype, a 
4656 function is implicitly declared by its first appearance in an expression, such as 
4657 
 
 
4662 If a name that has not been previously declared occurs in an expression and is followed by a 
4663 left parentheses, it is declared by context to be a function name, the function is assumed to 
4664 return an int, and nothing is assumed about its arguments. Furthermore, if a function 
4665 declaration does not include arguments, as in 
4666 
 
 
4671 that too is taken to mean that nothing is to be assumed about the arguments of atof; all 
4672 parameter checking is turned off. This special meaning of the empty argument list is intended 
4673 to permit older C programs to compile with new compilers. But it's a bad idea to use it with 
4674 new C programs. If the function takes arguments, declare them; if it takes no arguments, use 
4675 void. 
4676 
4677 Given atof, properly declared, we could write atoi (convert a string to int) in terms of it: 
4678 
 
 
 
 
 
 
4691 
 
 
4696 Notice the structure of the declarations and the return statement. The value of the expression 
4697 in 
4698 
 
 
4703 is converted to the type of the function before the return is taken. Therefore, the value of 
4704 atof, a double, is converted automatically to int when it appears in this return, since the 
4705 function atoi returns an int. This operation does potentionally discard information, however, 
4706 so some compilers warn of it. The cast states explicitly that the operation is intended, and 
4707 suppresses any warning. 
4708 
4709 Exercise 4-2. Extend atof to handle scientific notation of the form 
4710 
 
 
4715 where a floating-point number may be followed by e or E and an optionally signed exponent. 
4716 
4717 4.3 External Variables 
4718 
4719 A C program consists of a set of external objects, which are either variables or functions. The 
4720 adjective ``external'' is used in contrast to ``internal'', which describes the arguments and 
4721 variables defined inside functions. External variables are defined outside of any function, and 
4722 are thus potentionally available to many functions. Functions themselves are always external, 
4723 because C does not allow functions to be defined inside other functions. By default, external 
4724 variables and functions have the property that all references to them by the same name, even 
4725 from functions compiled separately, are references to the same thing. (The standard calls this 
4726 property external linkage.) In this sense, external variables are analogous to Fortran 
4727 COMMON blocks or variables in the outermost block in Pascal. We will see later how to 
4728 define external variables and functions that are visible only within a single source file. 
4729 Because external variables are globally accessible, they provide an alternative to function 
4730 arguments and return values for communicating data between functions. Any function may 
4731 access an external variable by referring to it by name, if the name has been declared 
4732 somehow. 
4733 
4734 If a large number of variables must be shared among functions, external variables are more 
4735 convenient and efficient than long argument lists. As pointed out in Chapter 1, however, this 
4736 reasoning should be applied with some caution, for it can have a bad effect on program 
4737 structure, and lead to programs with too many data connections between functions. 
4738 
4739 External variables are also useful because of their greater scope and lifetime. Automatic 
4740 variables are internal to a function; they come into existence when the function is entered, and 
4741 disappear when it is left. External variables, on the other hand, are permanent, so they can 
4742 retain values from one function invocation to the next. Thus if two functions must share some 
4743 data, yet neither calls the other, it is often most convenient if the shared data is kept in 
4744 external variables rather than being passed in and out via arguments. 
4745 
4746 Let us examine this issue with a larger example. The problem is to write a calculator program 
4747 that provides the operators +, -, * and /. Because it is easier to implement, the calculator will 
4748 use reverse Polish notation instead of infix. (Reverse Polish notation is used by some pocket 
4749 calculators, and in languages like Forth and Postscript.) 
4750 
4751 In reverse Polish notation, each operator follows its operands; an infix expression like 
4752 
4753 
 
 
4758 is entered as 
4759 
 
 
4764 Parentheses are not needed; the notation is unambiguous as long as we know how many 
4765 operands each operator expects. 
4766 
4767 The implementation is simple. Each operand is pushed onto a stack; when an operator arrives, 
4768 the proper number of operands (two for binary operators) is popped, the operator is applied to 
4769 them, and the result is pushed back onto the stack. In the example above, for instance, 1 and 2 
4770 are pushed, then replaced by their difference, -1. Next, 4 and 5 are pushed and then replaced 
4771 by their sum, 9. The product of -1 and 9, which is -9, replaces them on the stack. The value on 
4772 the top of the stack is popped and printed when the end of the input line is encountered. 
4773 
4774 The structure of the program is thus a loop that performs the proper operation on each 
4775 operator and operand as it appears: 
4776 
 
 
 
 
 
 
 
 
 
 
 
 
4801 The operation of pushing and popping a stack are trivial, but by the time error detection and 
4802 recovery are added, they are long enough that it is better to put each in a separate function 
4803 than to repeat the code throughout the whole program. And there should be a separate 
4804 function for fetching the next input operator or operand. 
4805 
4806 The main design decision that has not yet been discussed is where the stack is, that is, which 
4807 routines access it directly. On possibility is to keep it in main, and pass the stack and the 
4808 current stack position to the routines that push and pop it. But main doesn't need to know 
4809 about the variables that control the stack; it only does push and pop operations. So we have 
4810 decided to store the stack and its associated information in external variables accessible to the 
4811 push and pop functions but not to main. 
4812 
4813 Translating this outline into code is easy enough. If for now we think of the program as 
4814 existing in one source file, it will look like this: 
4815 
 #defines 
4818 
 
 
 
 
4827 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 routines called by getop 
4910 Later we will discuss how this might be split into two or more source files. 
4911 
4912 The function main is a loop containing a big switch on the type of operator or operand; this is 
4913 a more typical use of switch than the one shown in . 
4914 
4915 Section 3.4
4916 
 
 
 
 
 
 
 
 
 
 
 
 
4941 
4942 Because + and * are commutative operators, the order in which the popped operands are 
4943 combined is irrelevant, but for - and / the left and right operand must be distinguished. In 
4944 
 
 
4949 the order in which the two calls of pop are evaluated is not defined. To guarantee the right 
4950 order, it is necessary to pop the first value into a temporary variable as we did in main. 
4951 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
5002 A variable is external if it is defined outside of any function. Thus the stack and stack index 
5003 that must be shared by push and pop are defined outside these functions. But main itself does 
5004 not refer to the stack or stack position - the representation can be hidden. 
5005 
5006 Let us now turn to the implementation of getop, the function that fetches the next operator or 
5007 operand. The task is easy. Skip blanks and tabs. If the next character is not a digit or a 
5008 hexadecimal point, return it. Otherwise, collect a string of digits (which might include a 
5009 decimal point), and return NUMBER, the signal that a number has been collected. 
5010 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
5053 
 
 
 
 
 
 
 
5068 What are getch and ungetch? It is often the case that a program cannot determine that it has 
5069 read enough input until it has read too much. One instance is collecting characters that make 
5070 up a number: until the first non-digit is seen, the number is not complete. But then the 
5071 program has read one character too far, a character that it is not prepared for. 
5072 
5073 The problem would be solved if it were possible to ``un-read'' the unwanted character. Then, 
5074 every time the program reads one character too many, it could push it back on the input, so 
5075 the rest of the code could behave as if it had never been read. Fortunately, it's easy to simulate 
5076 un-getting a character, by writing a pair of cooperating functions. getch delivers the next 
5077 input character to be considered; ungetch will return them before reading new input. 
5078 
5079 How they work together is simple. ungetch puts the pushed-back characters into a shared 
5080 buffer -- a character array. getch reads from the buffer if there is anything else, and calls 
5081 getchar if the buffer is empty. There must also be an index variable that records the position 
5082 of the current character in the buffer. 
5083 
5084 Since the buffer and the index are shared by getch and ungetch and must retain their values 
5085 between calls, they must be external to both routines. Thus we can write getch, ungetch, and 
5086 their shared variables as: 
5087 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
5124 The standard library includes a function ungetch that provides one character of pushback; we 
5125 will discuss it in Chapter 7. We have used an array for the pushback, rather than a single 
5126 character, to illustrate a more general approach. 
5127 
5128 Exercise 4-3. Given the basic framework, it's straightforward to extend the calculator. Add 
5129 the modulus (%) operator and provisions for negative numbers. 
5130 
5131 Exercise 4-4. Add the commands to print the top elements of the stack without popping, to 
5132 duplicate it, and to swap the top two elements. Add a command to clear the stack. 
5133 
5134 
5135 Exercise 4-5. Add access to library functions like sin, exp, and pow. See <math.h> in 
5136 Appendix B, Section 4. 
5137 
5138 Exercise 4-6. Add commands for handling variables. (It's easy to provide twenty-six variables 
5139 with single-letter names.) Add a variable for the most recently printed value. 
5140 
5141 Exercise 4-7. Write a routine ungets(s) that will push back an entire string onto the input. 
5142 Should ungets know about buf and bufp, or should it just use ungetch? 
5143 
5144 Exercise 4-8. Suppose that there will never be more than one character of pushback. Modify 
5145 getch and ungetch accordingly. 
5146 
5147 Exercise 4-9. Our getch and ungetch do not handle a pushed-back EOF correctly. Decide 
5148 what their properties ought to be if an EOF is pushed back, then implement your design. 
5149 
5150 Exercise 4-10. An alternate organization uses getline to read an entire input line; this makes 
5151 getch and ungetch unnecessary. Revise the calculator to use this approach. 
5152 
5153 4.4 Scope Rules 
5154 
5155 The functions and external variables that make up a C program need not all be compiled at the 
5156 same time; the source text of the program may be kept in several files, and previously 
5157 compiled routines may be loaded from libraries. Among the questions of interest are 
5158 
5159  How are declarations written so that variables are properly declared during 
5160 compilation? 
5161  How are declarations arranged so that all the pieces will be properly connected when 
5162 the program is loaded? 
5163  How are declarations organized so there is only one copy? 
5164  How are external variables initialized? 
5165 
5166 
5167 Let us discuss these topics by reorganizing the calculator program into several files. As a 
5168 practical matter, the calculator is too small to be worth splitting, but it is a fine illustration of 
5169 the issues that arise in larger programs. 
5170 
5171 The scope of a name is the part of the program within which the name can be used. For an 
5172 automatic variable declared at the beginning of a function, the scope is the function in which 
5173 the name is declared. Local variables of the same name in different functions are unrelated. 
5174 The same is true of the parameters of the function, which are in effect local variables. 
5175 
5176 The scope of an external variable or a function lasts from the point at which it is declared to 
5177 the end of the file being compiled. For example, if main, sp, val, push, and pop are defined 
5178 in one file, in the order shown above, that is, 
5179 
 
 
 
 
 
 
 
 
 
5198 
5199 then the variables sp and val may be used in push and pop simply by naming them; no 
5200 further declarations are needed. But these names are not visible in main, nor are push and pop 
5201 themselves. 
5202 
5203 On the other hand, if an external variable is to be referred to before it is defined, or if it is 
5204 defined in a different source file from the one where it is being used, then an extern 
5205 declaration is mandatory. 
5206 
5207 It is important to distinguish between the declaration of an external variable and its definition. 
5208 A declaration announces the properties of a variable (primarily its type); a definition also 
5209 causes storage to be set aside. If the lines 
5210 
 
 
 
5217 appear outside of any function, they define the external variables sp and val, cause storage to 
5218 be set aside, and also serve as the declarations for the rest of that source file. On the other 
5219 hand, the lines 
5220 
 
 
 
5227 declare for the rest of the source file that sp is an int and that val is a double array (whose 
5228 size is determined elsewhere), but they do not create the variables or reserve storage for them. 
5229 
5230 There must be only one definition of an external variable among all the files that make up the 
5231 source program; other files may contain extern declarations to access it. (There may also be 
5232 extern declarations in the file containing the definition.) Array sizes must be specified with 
5233 the definition, but are optional with an extern declaration. 
5234 
5235 Initialization of an external variable goes only with the definition. 
5236 
5237 Although it is not a likely organization for this program, the functions push and pop could be 
5238 defined in one file, and the variables val and sp defined and initialized in another. Then these 
5239 definitions and declarations would be necessary to tie them together: 
5240 
 
 
 
 
 
 
 
 
 
 
 
 
5265 Because the extern declarations in file1 lie ahead of and outside the function definitions, they 
5266 apply to all functions; one set of declarations suffices for all of file1. This same organization 
5267 would also bee needed if the definition of sp and val followed their use in one file. 
5268 
5269 4.5 Header Files 
5270 
5271 
5272 Let is now consider dividing the calculator program into several source files, as it might be is 
5273 each of the components were substantially bigger. The main function would go in one file, 
5274 which we will call main.c; push, pop, and their variables go into a second file, stack.c; 
5275 getop goes into a third, getop.c. Finally, getch and ungetch go into a fourth file, getch.c; 
5276 we separate them from the others because they would come from a separately-compiled 
5277 library in a realistic program. 
5278 
5279 There is one more thing to worry about - the definitions and declarations shared among files. 
5280 As much as possible, we want to centralize this, so that there is only one copy to get and keep 
5281 right as the program evolves. Accordingly, we will place this common material in a header 
5282 file, calc.h, which will be included as necessary. (The #include line is described in Section 
5283 4.11.) The resulting program then looks like this: 
5284 
 
5287 There is a tradeoff between the desire that each file have access only to the information it 
5288 needs for its job and the practical reality that it is harder to maintain more header files. Up to 
5289 some moderate program size, it is probably best to have one header file that contains 
5290 
5291 
5292 everything that is to be shared between any two parts of the program; that is the decision we 
5293 made here. For a much larger program, more organization and more headers would be needed. 
5294 
5295 4.6 Static Variables 
5296 
5297 The variables sp and val in stack.c, and buf and bufp in getch.c, are for the private use of 
5298 the functions in their respective source files, and are not meant to be accessed by anything 
5299 else. The static declaration, applied to an external variable or function, limits the scope of 
5300 that object to the rest of the source file being compiled. External static thus provides a way 
5301 to hide names like buf and bufp in the getch-ungetch combination, which must be external 
5302 so they can be shared, yet which should not be visible to users of getch and ungetch. 
5303 
5304 Static storage is specified by prefixing the normal declaration with the word static. If the 
5305 two routines and the two variables are compiled in one file, as in 
5306 
 
 
 
 
 
 
 
5321 then no other routine will be able to access buf and bufp, and those names will not conflict 
5322 with the same names in other files of the same program. In the same way, the variables that 
5323 push and pop use for stack manipulation can be hidden, by declaring sp and val to be 
5324 static. 
5325 
5326 The external static declaration is most often used for variables, but it can be applied to 
5327 functions as well. Normally, function names are global, visible to any part of the entire 
5328 program. If a function is declared static, however, its name is invisible outside of the file in 
5329 which it is declared. 
5330 
5331 The static declaration can also be applied to internal variables. Internal static variables are 
5332 local to a particular function just as automatic variables are, but unlike automatics, they 
5333 remain in existence rather than coming and going each time the function is activated. This 
5334 means that internal static variables provide private, permanent storage within a single 
5335 function. 
5336 
5337 Exercise 4-11. Modify getop so that it doesn't need to use ungetch. Hint: use an internal 
5338 static variable. 
5339 
5340 4.7 Register Variables 
5341 
5342 A register declaration advises the compiler that the variable in question will be heavily 
5343 used. The idea is that register variables are to be placed in machine registers, which may 
5344 result in smaller and faster programs. But compilers are free to ignore the advice. 
5345 
5346 The register declaration looks like 
5347 
 
 
 
5354 
5355 and so on. The register declaration can only be applied to automatic variables and to the 
5356 formal parameters of a function. In this later case, it looks like 
5357 
 
 
 
 
 
 
5370 In practice, there are restrictions on register variables, reflecting the realities of underlying 
5371 hardware. Only a few variables in each function may be kept in registers, and only certain 
5372 types are allowed. Excess register declarations are harmless, however, since the word 
5373 register is ignored for excess or disallowed declarations. And it is not possible to take the 
5374 address of a register variable (a topic covered in Chapter 5), regardless of whether the variable 
5375 is actually placed in a register. The specific restrictions on number and types of register 
5376 variables vary from machine to machine. 
5377 
5378 4.8 Block Structure 
5379 
5380 C is not a block-structured language in the sense of Pascal or similar languages, because 
5381 functions may not be defined within other functions. On the other hand, variables can be 
5382 defined in a block-structured fashion within a function. Declarations of variables (including 
5383 initializations) may follow the left brace that introduces any compound statement, not just the 
5384 one that begins a function. Variables declared in this way hide any identically named 
5385 variables in outer blocks, and remain in existence until the matching right brace. For example, 
5386 in 
5387 
 
 
 
 
 
 
 
5402 the scope of the variable i is the ``true'' branch of the if; this i is unrelated to any i outside 
5403 the block. An automatic variable declared and initialized in a block is initialized each time the 
5404 block is entered. 
5405 
5406 Automatic variables, including formal parameters, also hide external variables and functions 
5407 of the same name. Given the declarations 
5408 
 
 
 
 
 
 
 
 
5425 then within the function f, occurrences of x refer to the parameter, which is a double; outside 
5426 f, they refer to the external int. The same is true of the variable y. 
5427 
5428 As a matter of style, it's best to avoid variable names that conceal names in an outer scope; the 
5429 potential for confusion and error is too great. 
5430 
5431 4.9 Initialization 
5432 
5433 
5434 Initialization has been mentioned in passing many times so far, but always peripherally to 
5435 some other topic. This section summarizes some of the rules, now that we have discussed the 
5436 various storage classes. 
5437 
5438 In the absence of explicit initialization, external and static variables are guaranteed to be 
5439 initialized to zero; automatic and register variables have undefined (i.e., garbage) initial 
5440 values. 
5441 
5442 Scalar variables may be initialized when they are defined, by following the name with an 
5443 equals sign and an expression: 
5444 
 
 
 
 
5453 For external and static variables, the initializer must be a constant expression; the 
5454 initialization is done once, conceptionally before the program begins execution. For automatic 
5455 and register variables, the initializer is not restricted to being a constant: it may be any 
5456 expression involving previously defined values, even function calls. For example, the 
5457 initialization of the binary search program in Section 3.3 could be written as 
5458 
 
 
 
 
 
 
 
 
5475 instead of 
5476 
 
 
 
 
 
5487 In effect, initialization of automatic variables are just shorthand for assignment statements. 
5488 Which form to prefer is largely a matter of taste. We have generally used explicit 
5489 assignments, because initializers in declarations are harder to see and further away from the 
5490 point of use. 
5491 
5492 An array may be initialized by following its declaration with a list of initializers enclosed in 
5493 braces and separated by commas. For example, to initialize an array days with the number of 
5494 days in each month: 
5495 
 
 
5500 When the size of the array is omitted, the compiler will compute the length by counting the 
5501 initializers, of which there are 12 in this case. 
5502 
5503 If there are fewer initializers for an array than the specified size, the others will be zero for 
5504 external, static and automatic variables. It is an error to have too many initializers. There is no 
5505 way to specify repetition of an initializer, nor to initialize an element in the middle of an array 
5506 without supplying all the preceding values as well. 
5507 
5508 Character arrays are a special case of initialization; a string may be used instead of the braces 
5509 and commas notation: 
5510 
5511 
 
 
5516 is a shorthand for the longer but equivalent 
5517 
 
 
5522 In this case, the array size is five (four characters plus the terminating '\0'). 
5523 
5524 4.10 Recursion 
5525 
5526 C functions may be used recursively; that is, a function may call itself either directly or 
5527 indirectly. Consider printing a number as a character string. As we mentioned before, the 
5528 digits are generated in the wrong order: low-order digits are available before high-order digits, 
5529 but they have to be printed the other way around. 
5530 
5531 There are two solutions to this problem. On is to store the digits in an array as they are 
5532 generated, then print them in the reverse order, as we did with itoa in section 3.6. The 
5533 alternative is a recursive solution, in which printd first calls itself to cope with any leading 
5534 digits, then prints the trailing digit. Again, this version can fail on the largest negative 
5535 number. 
5536 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
5565 When a function calls itself recursively, each invocation gets a fresh set of all the automatic 
5566 variables, independent of the previous set. This in printd(123) the first printd receives the 
5567 argument n = 123. It passes 12 to a second printd, which in turn passes 1 to a third. The 
5568 third-level printd prints 1, then returns to the second level. That printd prints 2, then returns 
5569 to the first level. That one prints 3 and terminates. 
5570 
5571 Another good example of recursion is quicksort, a sorting algorithm developed by C.A.R. 
5572 Hoare in 1962. Given an array, one element is chosen and the others partitioned in two 
5573 subsets - those less than the partition element and those greater than or equal to it. The same 
5574 process is then applied recursively to the two subsets. When a subset has fewer than two 
5575 elements, it doesn't need any sorting; this stops the recursion. 
5576 
5577 Our version of quicksort is not the fastest possible, but it's one of the simplest. We use the 
5578 middle element of each subarray for partitioning. 
5579 
 
 
 
 
 
 
 
5594 
 
 
 
 
 
 
 
 
 
 
 
5617 We moved the swapping operation into a separate function swap because it occurs three times 
5618 in qsort. 
5619 
 
 
 
 
 
 
 
 
 
 
5640 The standard library includes a version of qsort that can sort objects of any type. 
5641 
5642 Recursion may provide no saving in storage, since somewhere a stack of the values being 
5643 processed must be maintained. Nor will it be faster. But recursive code is more compact, and 
5644 often much easier to write and understand than the non-recursive equivalent. Recursion is 
5645 especially convenient for recursively defined data structures like trees, we will see a nice 
5646 example in Section 6.6. 
5647 
5648 Exercise 4-12. Adapt the ideas of printd to write a recursive version of itoa; that is, convert 
5649 an integer into a string by calling a recursive routine. 
5650 
5651 Exercise 4-13. Write a recursive version of the function reverse(s), which reverses the 
5652 string s in place. 
5653 
5654 4.11 The C Preprocessor 
5655 
5656 C provides certain language facilities by means of a preprocessor, which is conceptionally a 
5657 separate first step in compilation. The two most frequently used features are #include, to 
5658 include the contents of a file during compilation, and #define, to replace a token by an 
5659 arbitrary sequence of characters. Other features described in this section include conditional 
5660 compilation and macros with arguments. 
5661 
5662 4.11.1 File Inclusion 
5663 
5664 File inclusion makes it easy to handle collections of #defines and declarations (among other 
5665 things). Any source line of the form 
5666 
 
 
5671 or 
5672 
 
 
5677 is replaced by the contents of the file filename. If the filename is quoted, searching for the file 
5678 typically begins where the source program was found; if it is not found there, or if the name is 
5679 
5680 
5681 enclosed in < and >, searching follows an implementation-defined rule to find the file. An 
5682 included file may itself contain #include lines. 
5683 
5684 There are often several #include lines at the beginning of a source file, to include common 
5685 #define statements and extern declarations, or to access the function prototype declarations 
5686 for library functions from headers like <stdio.h>. (Strictly speaking, these need not be files; 
5687 the details of how headers are accessed are implementation-dependent.) 
5688 
5689 #include is the preferred way to tie the declarations together for a large program. It 
5690 guarantees that all the source files will be supplied with the same definitions and variable 
5691 declarations, and thus eliminates a particularly nasty kind of bug. Naturally, when an included 
5692 file is changed, all files that depend on it must be recompiled. 
5693 
5694 4.11.2 Macro Substitution 
5695 
5696 A definition has the form 
5697 
 
 
5702 It calls for a macro substitution of the simplest kind - subsequent occurrences of the token 
5703 name will be replaced by the replacement text. The name in a #define has the same form as a 
5704 variable name; the replacement text is arbitrary. Normally the replacement text is the rest of 
5705 the line, but a long definition may be continued onto several lines by placing a \ at the end of 
5706 each line to be continued. The scope of a name defined with #define is from its point of 
5707 definition to the end of the source file being compiled. A definition may use previous 
5708 definitions. Substitutions are made only for tokens, and do not take place within quoted 
5709 strings. For example, if YES is a defined name, there would be no substitution in 
5710 printf("YES") or in YESMAN. 
5711 
5712 Any name may be defined with any replacement text. For example 
5713 
 
 
5718 defines a new word, forever, for an infinite loop. 
5719 
5720 It is also possible to define macros with arguments, so the replacement text can be different 
5721 for different calls of the macro. As an example, define a macro called max: 
5722 
 
 
5727 Although it looks like a function call, a use of max expands into in-line code. Each occurrence 
5728 of a formal parameter (here A or B) will be replaced by the corresponding actual argument. 
5729 Thus the line 
5730 
 
 
5735 will be replaced by the line 
5736 
 
 
5741 So long as the arguments are treated consistently, this macro will serve for any data type; 
5742 there is no need for different kinds of max for different data types, as there would be with 
5743 functions. 
5744 
5745 
5746 If you examine the expansion of max, you will notice some pitfalls. The expressions are 
5747 evaluated twice; this is bad if they involve side effects like increment operators or input and 
5748 output. For instance 
5749 
 
 
5754 will increment the larger twice. Some care also has to be taken with parentheses to make sure 
5755 the order of evaluation is preserved; consider what happens when the macro 
5756 
 
 
5761 is invoked as square(z+1). 
5762 
5763 Nonetheless, macros are valuable. One practical example comes from <stdio.h>, in which 
5764 getchar and putchar are often defined as macros to avoid the run-time overhead of a 
5765 function call per character processed. The functions in <ctype.h> are also usually 
5766 implemented as macros. 
5767 
5768 Names may be undefined with #undef, usually to ensure that a routine is really a function, not 
5769 a macro: 
5770 
 
 
 
 
5779 Formal parameters are not replaced within quoted strings. If, however, a parameter name is 
5780 preceded by a # in the replacement text, the combination will be expanded into a quoted string 
5781 with the parameter replaced by the actual argument. This can be combined with string 
5782 concatenation to make, for example, a debugging print macro: 
5783 
 
 
5788 When this is invoked, as in 
5789 
 
 
5794 the macro is expanded into 
5795 
 
 
5800 and the strings are concatenated, so the effect is 
5801 
 
 
5806 Within the actual argument, each " is replaced by \" and each \ by \\, so the result is a legal 
5807 string constant. 
5808 
5809 The preprocessor operator ## provides a way to concatenate actual arguments during macro 
5810 expansion. If a parameter in the replacement text is adjacent to a ##, the parameter is replaced 
5811 by the actual argument, the ## and surrounding white space are removed, and the result is re-
5812 scanned. For example, the macro paste concatenates its two arguments: 
5813 
 
 
5818 so paste(name, 1) creates the token name1. 
5819 
5820 The rules for nested uses of ## are arcane; further details may be found in Appendix A. 
5821 
5822 Exercise 4-14. Define a macro swap(t,x,y) that interchanges two arguments of type t. 
5823 (Block structure will help.) 
5824 
5825 
5826 4.11.3 Conditional Inclusion 
5827 
5828 It is possible to control preprocessing itself with conditional statements that are evaluated 
5829 during preprocessing. This provides a way to include code selectively, depending on the value 
5830 of conditions evaluated during compilation. 
5831 
5832 The #if line evaluates a constant integer expression (which may not include sizeof, casts, or 
5833 enum constants). If the expression is non-zero, subsequent lines until an #endif or #elif or 
5834 #else are included. (The preprocessor statement #elif is like else-if.) The expression 
5835 defined(name) in a #if is 1 if the name has been defined, and 0 otherwise. 
5836 
5837 For example, to make sure that the contents of a file hdr.h are included only once, the 
5838 contents of the file are surrounded with a conditional like this: 
5839 
 
 
 
 
 
 
 
5854 The first inclusion of hdr.h defines the name HDR; subsequent inclusions will find the name 
5855 defined and skip down to the #endif. A similar style can be used to avoid including files 
5856 multiple times. If this style is used consistently, then each header can itself include any other 
5857 headers on which it depends, without the user of the header having to deal with the 
5858 interdependence. 
5859 
5860 This sequence tests the name SYSTEM to decide which version of a header to include: 
5861 
 
 
 
 
 
 
 
 
 
 
 
5884 The #ifdef and #ifndef lines are specialized forms that test whether a name is defined. The 
5885 first example of #if above could have been written 
5886 
 
 
 
 
 
 
 
5901 
 
5904 Chapter 5 - Pointers and Arrays 
5905 
5906 A pointer is a variable that contains the address of a variable. Pointers are much used in C, 
5907 partly because they are sometimes the only way to express a computation, and partly because 
5908 they usually lead to more compact and efficient code than can be obtained in other ways. 
5909 Pointers and arrays are closely related; this chapter also explores this relationship and shows 
5910 how to exploit it. 
5911 
5912 Pointers have been lumped with the goto statement as a marvelous way to create impossible-
5913 to-understand programs. This is certainly true when they are used carelessly, and it is easy to 
5914 create pointers that point somewhere unexpected. With discipline, however, pointers can also 
5915 be used to achieve clarity and simplicity. This is the aspect that we will try to illustrate. 
5916 
5917 The main change in ANSI C is to make explicit the rules about how pointers can be 
5918 manipulated, in effect mandating what good programmers already practice and good 
5919 compilers already enforce. In addition, the type void * (pointer to void) replaces char * as 
5920 the proper type for a generic pointer. 
5921 
5922 5.1 Pointers and Addresses 
5923 
5924 Let us begin with a simplified picture of how memory is organized. A typical machine has an 
5925 array of consecutively numbered or addressed memory cells that may be manipulated 
5926 individually or in contiguous groups. One common situation is that any byte can be a char, a 
5927 pair of one-byte cells can be treated as a short integer, and four adjacent bytes form a long. 
5928 A pointer is a group of cells (often two or four) that can hold an address. So if c is a char and 
5929 p is a pointer that points to it, we could represent the situation this way: 
5930 
 
5933 The unary operator & gives the address of an object, so the statement 
5934 
 
 
5939 assigns the address of c to the variable p, and p is said to ``point to'' c. The & operator only 
5940 applies to objects in memory: variables and array elements. It cannot be applied to 
5941 expressions, constants, or register variables. 
5942 
5943 The unary operator * is the indirection or dereferencing operator; when applied to a pointer, it 
5944 accesses the object the pointer points to. Suppose that x and y are integers and ip is a pointer 
5945 to int. This artificial sequence shows how to declare a pointer and how to use & and *: 
5946 
 
 
 
 
5955 
 
 
 
 
5964 The declaration of x, y, and z are what we've seen all along. The declaration of the pointer ip, 
5965 
 
 
5970 is intended as a mnemonic; it says that the expression *ip is an int. The syntax of the 
5971 declaration for a variable mimics the syntax of expressions in which the variable might 
5972 appear. This reasoning applies to function declarations as well. For example, 
5973 
 
 
5978 says that in an expression *dp and atof(s) have values of double, and that the argument of 
5979 atof is a pointer to char. 
5980 
5981 You should also note the implication that a pointer is constrained to point to a particular kind 
5982 of object: every pointer points to a specific data type. (There is one exception: a ``pointer to 
5983 void'' is used to hold any type of pointer but cannot be dereferenced itself. We'll come back to 
5984 it in Section 5.11.) 
5985 
5986 If ip points to the integer x, then *ip can occur in any context where x could, so 
5987 
 
 
5992 increments *ip by 10. 
5993 
5994 The unary operators * and & bind more tightly than arithmetic operators, so the assignment 
5995 
 
 
6000 takes whatever ip points at, adds 1, and assigns the result to y, while 
6001 
 
 
6006 increments what ip points to, as do 
6007 
 
 
6012 and 
6013 
 
 
6018 The parentheses are necessary in this last example; without them, the expression would 
6019 increment ip instead of what it points to, because unary operators like * and ++ associate right 
6020 to left. 
6021 
6022 Finally, since pointers are variables, they can be used without dereferencing. For example, if 
6023 iq is another pointer to int, 
6024 
 
 
6029 copies the contents of ip into iq, thus making iq point to whatever ip pointed to. 
6030 
6031 5.2 Pointers and Function Arguments 
6032 
6033 Since C passes arguments to functions by value, there is no direct way for the called function 
6034 to alter a variable in the calling function. For instance, a sorting routine might exchange two 
6035 out-of-order arguments with a function called swap. It is not enough to write 
6036 
6037 
 
 
6042 where the swap function is defined as 
6043 
 
 
 
 
 
 
 
 
 
6062 Because of call by value, swap can't affect the arguments a and b in the routine that called it. 
6063 The function above swaps copies of a and b. 
6064 
6065 The way to obtain the desired effect is for the calling program to pass pointers to the values to 
6066 be changed: 
6067 
 
 
6072 Since the operator & produces the address of a variable, &a is a pointer to a. In swap itself, the 
6073 parameters are declared as pointers, and the operands are accessed indirectly through them. 
6074 
 
 
 
 
 
 
 
 
 
6093 Pictorially: 
6094 
6095 
 
6098 Pointer arguments enable a function to access and change objects in the function that called it. 
6099 As an example, consider a function getint that performs free-format input conversion by 
6100 breaking a stream of characters into integer values, one integer per call. getint has to return 
6101 the value it found and also signal end of file when there is no more input. These values have 
6102 to be passed back by separate paths, for no matter what value is used for EOF, that could also 
6103 be the value of an input integer. 
6104 
6105 One solution is to have getint return the end of file status as its function value, while using a 
6106 pointer argument to store the converted integer back in the calling function. This is the 
6107 scheme used by scanf as well; see Section 7.4. 
6108 
6109 The following loop fills an array with integers by calls to getint: 
6110 
 
 
 
 
 
6121 Each call sets array[n] to the next integer found in the input and increments n. Notice that it 
6122 is essential to pass the address of array[n] to getint. Otherwise there is no way for getint 
6123 to communicate the converted integer back to the caller. 
6124 
6125 Our version of getint returns EOF for end of file, zero if the next input is not a number, and a 
6126 positive value if the input contains a valid number. 
6127 
 
 
6132 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
6183 Throughout getint, *pn is used as an ordinary int variable. We have also used getch and 
6184 ungetch (described in Section 4.3) so the one extra character that must be read can be pushed 
6185 back onto the input. 
6186 
6187 Exercise 5-1. As written, getint treats a + or - not followed by a digit as a valid 
6188 representation of zero. Fix it to push such a character back on the input. 
6189 
6190 Exercise 5-2. Write getfloat, the floating-point analog of getint. What type does 
6191 getfloat return as its function value? 
6192 
6193 5.3 Pointers and Arrays 
6194 
6195 In C, there is a strong relationship between pointers and arrays, strong enough that pointers 
6196 and arrays should be discussed simultaneously. Any operation that can be achieved by array 
6197 subscripting can also be done with pointers. The pointer version will in general be faster but, 
6198 at least to the uninitiated, somewhat harder to understand. 
6199 
6200 The declaration 
6201 
 
 
6206 defines an array of size 10, that is, a block of 10 consecutive objects named a[0], a[1], 
6207 ...,a[9]. 
6208 
 
6211 
6212 The notation a[i] refers to the i-th element of the array. If pa is a pointer to an integer, 
6213 declared as 
6214 
 
 
6219 then the assignment 
6220 
 
 
6225 sets pa to point to element zero of a; that is, pa contains the address of a[0]. 
6226 
 
6229 Now the assignment 
6230 
 
 
6235 will copy the contents of a[0] into x. 
6236 
6237 If pa points to a particular element of an array, then by definition pa+1 points to the next 
6238 element, pa+i points i elements after pa, and pa-i points i elements before. Thus, if pa 
6239 points to a[0], 
6240 
 
 
6245 refers to the contents of a[1], pa+i is the address of a[i], and *(pa+i) is the contents of 
6246 a[i]. 
6247 
 
6250 These remarks are true regardless of the type or size of the variables in the array a. The 
6251 meaning of ``adding 1 to a pointer,'' and by extension, all pointer arithmetic, is that pa+1 
6252 points to the next object, and pa+i points to the i-th object beyond pa. 
6253 
6254 
6255 The correspondence between indexing and pointer arithmetic is very close. By definition, the 
6256 value of a variable or expression of type array is the address of element zero of the array. 
6257 Thus after the assignment 
6258 
 
 
6263 pa and a have identical values. Since the name of an array is a synonym for the location of the 
6264 initial element, the assignment pa=&a[0] can also be written as 
6265 
 
 
6270 Rather more surprising, at first sight, is the fact that a reference to a[i] can also be written as 
6271 *(a+i). In evaluating a[i], C converts it to *(a+i) immediately; the two forms are 
6272 equivalent. Applying the operator & to both parts of this equivalence, it follows that &a[i] 
6273 and a+i are also identical: a+i is the address of the i-th element beyond a. As the other side 
6274 of this coin, if pa is a pointer, expressions might use it with a subscript; pa[i] is identical to 
6275 *(pa+i). In short, an array-and-index expression is equivalent to one written as a pointer and 
6276 offset. 
6277 
6278 There is one difference between an array name and a pointer that must be kept in mind. A 
6279 pointer is a variable, so pa=a and pa++ are legal. But an array name is not a variable; 
6280 constructions like a=pa and a++ are illegal. 
6281 
6282 When an array name is passed to a function, what is passed is the location of the initial 
6283 element. Within the called function, this argument is a local variable, and so an array name 
6284 parameter is a pointer, that is, a variable containing an address. We can use this fact to write 
6285 another version of strlen, which computes the length of a string. 
6286 
 
 
 
 
 
 
 
 
 
 
6307 Since s is a pointer, incrementing it is perfectly legal; s++ has no effect on the character string 
6308 in the function that called strlen, but merely increments strlen's private copy of the 
6309 pointer. That means that calls like 
6310 
 
 
 
 
6319 all work. 
6320 
6321 As formal parameters in a function definition, 
6322 
 
 
6327 and 
6328 
 
 
6333 are equivalent; we prefer the latter because it says more explicitly that the variable is a 
6334 pointer. When an array name is passed to a function, the function can at its convenience 
6335 
6336 
6337 believe that it has been handed either an array or a pointer, and manipulate it accordingly. It 
6338 can even use both notations if it seems appropriate and clear. 
6339 
6340 It is possible to pass part of an array to a function, by passing a pointer to the beginning of the 
6341 subarray. For example, if a is an array, 
6342 
 
 
6347 and 
6348 
 
 
6353 both pass to the function f the address of the subarray that starts at a[2]. Within f, the 
6354 parameter declaration can read 
6355 
 
 
6360 or 
6361 
 
 
6366 So as far as f is concerned, the fact that the parameter refers to part of a larger array is of no 
6367 consequence. 
6368 
6369 If one is sure that the elements exist, it is also possible to index backwards in an array; p[-1], 
6370 p[-2], and so on are syntactically legal, and refer to the elements that immediately precede 
6371 p[0]. Of course, it is illegal to refer to objects that are not within the array bounds. 
6372 
6373 5.4 Address Arithmetic 
6374 
6375 If p is a pointer to some element of an array, then p++ increments p to point to the next 
6376 element, and p+=i increments it to point i elements beyond where it currently does. These 
6377 and similar constructions are the simples forms of pointer or address arithmetic. 
6378 
6379 C is consistent and regular in its approach to address arithmetic; its integration of pointers, 
6380 arrays, and address arithmetic is one of the strengths of the language. Let us illustrate by 
6381 writing a rudimentary storage allocator. There are two routines. The first, alloc(n), returns a 
6382 pointer to n consecutive character positions, which can be used by the caller of alloc for 
6383 storing characters. The second, afree(p), releases the storage thus acquired so it can be re-
6384 used later. The routines are ``rudimentary'' because the calls to afree must be made in the 
6385 opposite order to the calls made on alloc. That is, the storage managed by alloc and afree 
6386 is a stack, or last-in, first-out. The standard library provides analogous functions called 
6387 malloc and free that have no such restrictions; in Section 8.7 we will show how they can be 
6388 implemented. 
6389 
6390 The easiest implementation is to have alloc hand out pieces of a large character array that we 
6391 will call allocbuf. This array is private to alloc and afree. Since they deal in pointers, not 
6392 array indices, no other routine need know the name of the array, which can be declared 
6393 static in the source file containing alloc and afree, and thus be invisible outside it. In 
6394 practical implementations, the array may well not even have a name; it might instead be 
6395 obtained by calling malloc or by asking the operating system for a pointer to some unnamed 
6396 block of storage. 
6397 
6398 The other information needed is how much of allocbuf has been used. We use a pointer, 
6399 called allocp, that points to the next free element. When alloc is asked for n characters, it 
6400 
6401 
6402 checks to see if there is enough room left in allocbuf. If so, alloc returns the current value 
6403 of allocp (i.e., the beginning of the free block), then increments it by n to point to the next 
6404 free area. If there is no room, alloc returns zero. afree(p) merely sets allocp to p if p is 
6405 inside allocbuf. 
6406 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
6449 In general a pointer can be initialized just as any other variable can, though normally the only 
6450 meaningful values are zero or an expression involving the address of previously defined data 
6451 of appropriate type. The declaration 
6452 
 
 
6457 defines allocp to be a character pointer and initializes it to point to the beginning of 
6458 allocbuf, which is the next free position when the program starts. This could also have been 
6459 written 
6460 
 
 
6465 since the array name is the address of the zeroth element. 
6466 
6467 The test 
6468 
 
 
6473 
6474 checks if there's enough room to satisfy a request for n characters. If there is, the new value of 
6475 allocp would be at most one beyond the end of allocbuf. If the request can be satisfied, 
6476 alloc returns a pointer to the beginning of a block of characters (notice the declaration of the 
6477 function itself). If not, alloc must return some signal that there is no space left. C guarantees 
6478 that zero is never a valid address for data, so a return value of zero can be used to signal an 
6479 abnormal event, in this case no space. 
6480 
6481 Pointers and integers are not interchangeable. Zero is the sole exception: the constant zero 
6482 may be assigned to a pointer, and a pointer may be compared with the constant zero. The 
6483 symbolic constant NULL is often used in place of zero, as a mnemonic to indicate more clearly 
6484 that this is a special value for a pointer. NULL is defined in <stdio.h>. We will use NULL 
6485 henceforth. 
6486 
6487 Tests like 
6488 
 
 
6493 and 
6494 
 
 
6499 show several important facets of pointer arithmetic. First, pointers may be compared under 
6500 certain circumstances. If p and q point to members of the same array, then relations like ==, 
6501 !=, <, >=, etc., work properly. For example, 
6502 
 
 
6507 is true if p points to an earlier element of the array than q does. Any pointer can be 
6508 meaningfully compared for equality or inequality with zero. But the behavior is undefined for 
6509 arithmetic or comparisons with pointers that do not point to members of the same array. 
6510 (There is one exception: the address of the first element past the end of an array can be used in 
6511 pointer arithmetic.) 
6512 
6513 Second, we have already observed that a pointer and an integer may be added or subtracted. 
6514 The construction 
6515 
 
 
6520 means the address of the n-th object beyond the one p currently points to. This is true 
6521 regardless of the kind of object p points to; n is scaled according to the size of the objects p 
6522 points to, which is determined by the declaration of p. If an int is four bytes, for example, the 
6523 int will be scaled by four. 
6524 
6525 Pointer subtraction is also valid: if p and q point to elements of the same array, and p<q, then 
6526 q-p+1 is the number of elements from p to q inclusive. This fact can be used to write yet 
6527 another version of strlen: 
6528 
 
 
 
 
 
 
 
 
 
 
6549 
6550 In its declaration, p is initialized to s, that is, to point to the first character of the string. In the 
6551 while loop, each character in turn is examined until the '\0' at the end is seen. Because p 
6552 points to characters, p++ advances p to the next character each time, and p-s gives the number 
6553 of characters advanced over, that is, the string length. (The number of characters in the string 
6554 could be too large to store in an int. The header <stddef.h> defines a type ptrdiff_t that 
6555 is large enough to hold the signed difference of two pointer values. If we were being cautious, 
6556 however, we would use size_t for the return value of strlen, to match the standard library 
6557 version. size_t is the unsigned integer type returned by the sizeof operator. 
6558 
6559 Pointer arithmetic is consistent: if we had been dealing with floats, which occupy more 
6560 storage that chars, and if p were a pointer to float, p++ would advance to the next float. 
6561 Thus we could write another version of alloc that maintains floats instead of chars, merely 
6562 by changing char to float throughout alloc and afree. All the pointer manipulations 
6563 automatically take into account the size of the objects pointed to. 
6564 
6565 The valid pointer operations are assignment of pointers of the same type, adding or 
6566 subtracting a pointer and an integer, subtracting or comparing two pointers to members of the 
6567 same array, and assigning or comparing to zero. All other pointer arithmetic is illegal. It is not 
6568 legal to add two pointers, or to multiply or divide or shift or mask them, or to add float or 
6569 double to them, or even, except for void *, to assign a pointer of one type to a pointer of 
6570 another type without a cast. 
6571 
6572 5.5 Character Pointers and Functions 
6573 
6574 A string constant, written as 
6575 
 
 
6580 is an array of characters. In the internal representation, the array is terminated with the null 
6581 character '\0' so that programs can find the end. The length in storage is thus one more than 
6582 the number of characters between the double quotes. 
6583 
6584 Perhaps the most common occurrence of string constants is as arguments to functions, as in 
6585 
 
 
6590 When a character string like this appears in a program, access to it is through a character 
6591 pointer; printf receives a pointer to the beginning of the character array. That is, a string 
6592 constant is accessed by a pointer to its first element. 
6593 
6594 String constants need not be function arguments. If pmessage is declared as 
6595 
 
 
6600 then the statement 
6601 
 
 
6606 assigns to pmessage a pointer to the character array. This is not a string copy; only pointers 
6607 are involved. C does not provide any operators for processing an entire string of characters as 
6608 a unit. 
6609 
6610 There is an important difference between these definitions: 
6611 
 
6614 
 
 
6619 amessage is an array, just big enough to hold the sequence of characters and '\0' that 
6620 initializes it. Individual characters within the array may be changed but amessage will always 
6621 refer to the same storage. On the other hand, pmessage is a pointer, initialized to point to a 
6622 string constant; the pointer may subsequently be modified to point elsewhere, but the result is 
6623 undefined if you try to modify the string contents. 
6624 
 
6627 We will illustrate more aspects of pointers and arrays by studying versions of two useful 
6628 functions adapted from the standard library. The first function is strcpy(s,t), which copies 
6629 the string t to the string s. It would be nice just to say s=t but this copies the pointer, not the 
6630 characters. To copy the characters, we need a loop. The array version first: 
6631 
 
 
 
 
 
 
 
 
 
 
6652 For contrast, here is a version of strcpy with pointers: 
6653 
 
 
 
 
 
 
 
 
 
 
 
 
6678 Because arguments are passed by value, strcpy can use the parameters s and t in any way it 
6679 pleases. Here they are conveniently initialized pointers, which are marched along the arrays a 
6680 character at a time, until the '\0' that terminates t has been copied into s. 
6681 
6682 In practice, strcpy would not be written as we showed it above. Experienced C programmers 
6683 would prefer 
6684 
 
 
 
 
 
 
6697 
 
6700 This moves the increment of s and t into the test part of the loop. The value of *t++ is the 
6701 character that t pointed to before t was incremented; the postfix ++ doesn't change t until 
6702 after this character has been fetched. In the same way, the character is stored into the old s 
6703 position before s is incremented. This character is also the value that is compared against 
6704 '\0' to control the loop. The net effect is that characters are copied from t to s, up and 
6705 including the terminating '\0'. 
6706 
6707 As the final abbreviation, observe that a comparison against '\0' is redundant, since the 
6708 question is merely whether the expression is zero. So the function would likely be written as 
6709 
 
 
 
 
 
 
 
6724 Although this may seem cryptic at first sight, the notational convenience is considerable, and 
6725 the idiom should be mastered, because you will see it frequently in C programs. 
6726 
6727 The strcpy in the standard library (<string.h>) returns the target string as its function 
6728 value. 
6729 
6730 The second routine that we will examine is strcmp(s,t), which compares the character 
6731 strings s and t, and returns negative, zero or positive if s is lexicographically less than, equal 
6732 to, or greater than t. The value is obtained by subtracting the characters at the first position 
6733 where s and t disagree. 
6734 
 
 
 
 
 
 
 
 
 
 
 
6757 The pointer version of strcmp: 
6758 
 
 
 
 
 
 
 
 
 
6777 Since ++ and -- are either prefix or postfix operators, other combinations of * and ++ and -- 
6778 occur, although less frequently. For example, 
6779 
 
 
6784 decrements p before fetching the character that p points to. In fact, the pair of expressions 
6785 
 
 
 
6792 
6793 are the standard idiom for pushing and popping a stack; see Section 4.3. 
6794 
6795 The header <string.h> contains declarations for the functions mentioned in this section, plus 
6796 a variety of other string-handling functions from the standard library. 
6797 
6798 Exercise 5-3. Write a pointer version of the function strcat that we showed in Chapter 2: 
6799 strcat(s,t) copies the string t to the end of s. 
6800 
6801 Exercise 5-4. Write the function strend(s,t), which returns 1 if the string t occurs at the 
6802 end of the string s, and zero otherwise. 
6803 
6804 Exercise 5-5. Write versions of the library functions strncpy, strncat, and strncmp, which 
6805 operate on at most the first n characters of their argument strings. For example, 
6806 strncpy(s,t,n) copies at most n characters of t to s. Full descriptions are in Appendix B. 
6807 
6808 Exercise 5-6. Rewrite appropriate programs from earlier chapters and exercises with pointers 
6809 instead of array indexing. Good possibilities include getline (Chapters 1 and 4), atoi, itoa, 
6810 and their variants (Chapters 2, 3, and 4), reverse (Chapter 3), and strindex and getop 
6811 (Chapter 4). 
6812 
6813 5.6 Pointer Arrays; Pointers to Pointers 
6814 
6815 Since pointers are variables themselves, they can be stored in arrays just as other variables 
6816 can. Let us illustrate by writing a program that will sort a set of text lines into alphabetic 
6817 order, a stripped-down version of the UNIX program sort. 
6818 
6819 In Chapter 3, we presented a Shell sort function that would sort an array of integers, and in 
6820 Chapter 4 we improved on it with a quicksort. The same algorithms will work, except that 
6821 now we have to deal with lines of text, which are of different lengths, and which, unlike 
6822 integers, can't be compared or moved in a single operation. We need a data representation that 
6823 will cope efficiently and conveniently with variable-length text lines. 
6824 
6825 This is where the array of pointers enters. If the lines to be sorted are stored end-to-end in one 
6826 long character array, then each line can be accessed by a pointer to its first character. The 
6827 pointers themselves can bee stored in an array. Two lines can be compared by passing their 
6828 pointers to strcmp. When two out-of-order lines have to be exchanged, the pointers in the 
6829 pointer array are exchanged, not the text lines themselves. 
6830 
 
6833 This eliminates the twin problems of complicated storage management and high overhead that 
6834 would go with moving the lines themselves. 
6835 
6836 The sorting process has three steps: 
6837 
6838 
 sort them 
6841 print them in order 
6842 
6843 As usual, it's best to divide the program into functions that match this natural division, with 
6844 the main routine controlling the other functions. Let us defer the sorting step for a moment, 
6845 and concentrate on the data structure and the input and output. 
6846 
6847 The input routine has to collect and save the characters of each line, and build an array of 
6848 pointers to the lines. It will also have to count the number of input lines, since that 
6849 information is needed for sorting and printing. Since the input function can only cope with a 
6850 finite number of input lines, it can return some illegal count like -1 if too much input is 
6851 presented. 
6852 
6853 The output routine only has to print the lines in the order in which they appear in the array of 
6854 pointers. 
6855 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
6942 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
6973 The function getline is from Section 1.9. 
6974 
6975 The main new thing is the declaration for lineptr: 
6976 
 
 
6981 says that lineptr is an array of MAXLINES elements, each element of which is a pointer to a 
6982 char. That is, lineptr[i] is a character pointer, and *lineptr[i] is the character it points 
6983 to, the first character of the i-th saved text line. 
6984 
6985 Since lineptr is itself the name of an array, it can be treated as a pointer in the same manner 
6986 as in our earlier examples, and writelines can be written instead as 
6987 
 
 
 
 
 
 
 
7002 Initially, *lineptr points to the first line; each element advances it to the next line pointer 
7003 while nlines is counted down. 
7004 
7005 With input and output under control, we can proceed to sorting. The quicksort from Chapter 4 
7006 needs minor changes: the declarations have to be modified, and the comparison operation 
7007 must be done by calling strcmp. The algorithm remains the same, which gives us some 
7008 confidence that it will still work. 
7009 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
7042 
 
 
7047 Similarly, the swap routine needs only trivial changes: 
7048 
 
 
 
 
 
 
 
 
 
 
7069 Since any individual element of v (alias lineptr) is a character pointer, temp must be also, so 
7070 one can be copied to the other. 
7071 
7072 Exercise 5-7. Rewrite readlines to store lines in an array supplied by main, rather than 
7073 calling alloc to maintain storage. How much faster is the program? 
7074 
7075 5.7 Multi-dimensional Arrays 
7076 
7077 C provides rectangular multi-dimensional arrays, although in practice they are much less used 
7078 than arrays of pointers. In this section, we will show some of their properties. 
7079 
7080 Consider the problem of date conversion, from day of the month to day of the year and vice 
7081 versa. For example, March 1 is the 60th day of a non-leap year, and the 61st day of a leap 
7082 year. Let us define two functions to do the conversions: day_of_year converts the month and 
7083 day into the day of the year, and month_day converts the day of the year into the month and 
7084 day. Since this latter function computes two values, the month and day arguments will be 
7085 pointers: 
7086 
 
 
7091 sets m to 2 and d to 29 (February 29th). 
7092 
7093 These functions both need the same information, a table of the number of days in each month 
7094 (``thirty days hath September ...''). Since the number of days per month differs for leap years 
7095 and non-leap years, it's easier to separate them into two rows of a two-dimensional array than 
7096 to keep track of what happens to February during computation. The array and the functions 
7097 for performing the transformations are as follows: 
7098 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
7131 
 
 
 
 
 
 
 
 
 
 
 
7154 Recall that the arithmetic value of a logical expression, such as the one for leap, is either zero 
7155 (false) or one (true), so it can be used as a subscript of the array daytab. 
7156 
7157 The array daytab has to be external to both day_of_year and month_day, so they can both 
7158 use it. We made it char to illustrate a legitimate use of char for storing small non-character 
7159 integers. 
7160 
7161 daytab is the first two-dimensional array we have dealt with. In C, a two-dimensional array is 
7162 really a one-dimensional array, each of whose elements is an array. Hence subscripts are 
7163 written as 
7164 
 
 
7169 rather than 
7170 
 
 
7175 Other than this notational distinction, a two-dimensional array can be treated in much the 
7176 same way as in other languages. Elements are stored by rows, so the rightmost subscript, or 
7177 column, varies fastest as elements are accessed in storage order. 
7178 
7179 An array is initialized by a list of initializers in braces; each row of a two-dimensional array is 
7180 initialized by a corresponding sub-list. We started the array daytab with a column of zero so 
7181 that month numbers can run from the natural 1 to 12 instead of 0 to 11. Since space is not at a 
7182 premium here, this is clearer than adjusting the indices. 
7183 
7184 If a two-dimensional array is to be passed to a function, the parameter declaration in the 
7185 function must include the number of columns; the number of rows is irrelevant, since what is 
7186 passed is, as before, a pointer to an array of rows, where each row is an array of 13 ints. In 
7187 this particular case, it is a pointer to objects that are arrays of 13 ints. Thus if the array 
7188 daytab is to be passed to a function f, the declaration of f would be: 
7189 
 
 
7194 It could also be 
7195 
 
 
7200 since the number of rows is irrelevant, or it could be 
7201 
 
 
7206 which says that the parameter is a pointer to an array of 13 integers. The parentheses are 
7207 necessary since brackets [] have higher precedence than *. Without parentheses, the 
7208 declaration 
7209 
 
 
7214 
7215 is an array of 13 pointers to integers. More generally, only the first dimension (subscript) of 
7216 an array is free; all the others have to be specified. 
7217 
7218 Section 5.12 has a further discussion of complicated declarations. 
7219 
7220 Exercise 5-8. There is no error checking in day_of_year or month_day. Remedy this defect. 
7221 
7222 5.8 Initialization of Pointer Arrays 
7223 
7224 Consider the problem of writing a function month_name(n), which returns a pointer to a 
7225 character string containing the name of the n-th month. This is an ideal application for an 
7226 internal static array. month_name contains a private array of character strings, and returns a 
7227 pointer to the proper one when called. This section shows how that array of names is 
7228 initialized. 
7229 
7230 The syntax is similar to previous initializations: 
7231 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
7260 The declaration of name, which is an array of character pointers, is the same as lineptr in the 
7261 sorting example. The initializer is a list of character strings; each is assigned to the 
7262 corresponding position in the array. The characters of the i-th string are placed somewhere, 
7263 and a pointer to them is stored in name[i]. Since the size of the array name is not specified, 
7264 the compiler counts the initializers and fills in the correct number. 
7265 
7266 5.9 Pointers vs. Multi-dimensional Arrays 
7267 
7268 Newcomers to C are sometimes confused about the difference between a two-dimensional 
7269 array and an array of pointers, such as name in the example above. Given the definitions 
7270 
 
 
 
7277 then a[3][4] and b[3][4] are both syntactically legal references to a single int. But a is a 
7278 true two-dimensional array: 200 int-sized locations have been set aside, and the conventional 
7279 rectangular subscript calculation 20 * row +col is used to find the element a[row,col]. For b, 
7280 however, the definition only allocates 10 pointers and does not initialize them; initialization 
7281 must be done explicitly, either statically or with code. Assuming that each element of b does 
7282 point to a twenty-element array, then there will be 200 ints set aside, plus ten cells for the 
7283 pointers. The important advantage of the pointer array is that the rows of the array may be of 
7284 different lengths. That is, each element of b need not point to a twenty-element vector; some 
7285 may point to two elements, some to fifty, and some to none at all. 
7286 
7287 
7288 Although we have phrased this discussion in terms of integers, by far the most frequent use of 
7289 arrays of pointers is to store character strings of diverse lengths, as in the function 
7290 month_name. Compare the declaration and picture for an array of pointers: 
7291 
 
 
 
7298 with those for a two-dimensional array: 
7299 
 
 
 
7306 Exercise 5-9. Rewrite the routines day_of_year and month_day with pointers instead of 
7307 indexing. 
7308 
7309 5.10 Command-line Arguments 
7310 
7311 In environments that support C, there is a way to pass command-line arguments or parameters 
7312 to a program when it begins executing. When main is called, it is called with two arguments. 
7313 The first (conventionally called argc, for argument count) is the number of command-line 
7314 arguments the program was invoked with; the second (argv, for argument vector) is a pointer 
7315 to an array of character strings that contain the arguments, one per string. We customarily use 
7316 multiple levels of pointers to manipulate these character strings. 
7317 
7318 The simplest illustration is the program echo, which echoes its command-line arguments on a 
7319 single line, separated by blanks. That is, the command 
7320 
 
 
7325 prints the output 
7326 
 
 
7331 By convention, argv[0] is the name by which the program was invoked, so argc is at least 1. 
7332 If argc is 1, there are no command-line arguments after the program name. In the example 
7333 above, argc is 3, and argv[0], argv[1], and argv[2] are "echo", "hello,", and "world" 
7334 respectively. The first optional argument is argv[1] and the last is argv[argc-1]; 
7335 additionally, the standard requires that argv[argc] be a null pointer. 
7336 
7337 
 
7340 The first version of echo treats argv as an array of character pointers: 
7341 
 
 
 
 
 
 
 
 
 
 
 
 
 
7368 Since argv is a pointer to an array of pointers, we can manipulate the pointer rather than 
7369 index the array. This next variant is based on incrementing argv, which is a pointer to pointer 
7370 to char, while argc is counted down: 
7371 
 
 
 
 
 
 
 
 
 
 
 
7394 Since argv is a pointer to the beginning of the array of argument strings, incrementing it by 1 
7395 (++argv) makes it point at the original argv[1] instead of argv[0]. Each successive 
7396 increment moves it along to the next argument; *argv is then the pointer to that argument. At 
7397 the same time, argc is decremented; when it becomes zero, there are no arguments left to 
7398 print. 
7399 
7400 Alternatively, we could write the printf statement as 
7401 
 
 
7406 This shows that the format argument of printf can be an expression too. 
7407 
7408 As a second example, let us make some enhancements to the pattern-finding program from 
7409 Section 4.1. If you recall, we wired the search pattern deep into the program, an obviously 
7410 unsatisfactory arrangement. Following the lead of the UNIX program grep, let us enhance the 
7411 program so the pattern to be matched is specified by the first argument on the command line. 
7412 
7413 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
7460 The standard library function strstr(s,t) returns a pointer to the first occurrence of the 
7461 string t in the string s, or NULL if there is none. It is declared in <string.h>. 
7462 
7463 The model can now be elaborated to illustrate further pointer constructions. Suppose we want 
7464 to allow two optional arguments. One says ``print all the lines except those that match the 
7465 pattern;'' the second says ``precede each printed line by its line number.'' 
7466 
7467 A common convention for C programs on UNIX systems is that an argument that begins with 
7468 a minus sign introduces an optional flag or parameter. If we choose -x (for ``except'') to 
7469 signal the inversion, and -n (``number'') to request line numbering, then the command 
7470 
 
 
7475 will print each line that doesn't match the pattern, preceded by its line number. 
7476 
7477 Optional arguments should be permitted in any order, and the rest of the program should be 
7478 independent of the number of arguments that we present. Furthermore, it is convenient for 
7479 users if option arguments can be combined, as in 
7480 
 
 
7485 Here is the program: 
7486 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
7517 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
7574 argc is decremented and argv is incremented before each optional argument. At the end of 
7575 the loop, if there are no errors, argc tells how many arguments remain unprocessed and argv 
7576 points to the first of these. Thus argc should be 1 and *argv should point at the pattern. 
7577 Notice that *++argv is a pointer to an argument string, so (*++argv)[0] is its first character. 
7578 (An alternate valid form would be **++argv.) Because [] binds tighter than * and ++, the 
7579 parentheses are necessary; without them the expression would be taken as *++(argv[0]). In 
7580 fact, that is what we have used in the inner loop, where the task is to walk along a specific 
7581 argument string. In the inner loop, the expression *++argv[0] increments the pointer 
7582 argv[0]! 
7583 
7584 It is rare that one uses pointer expressions more complicated than these; in such cases, 
7585 breaking them into two or three steps will be more intuitive. 
7586 
7587 Exercise 5-10. Write the program expr, which evaluates a reverse Polish expression from the 
7588 command line, where each operator or operand is a separate argument. For example, 
7589 
 
 
7594 evaluates 2 * (3+4). 
7595 
7596 Exercise 5-11. Modify the program entab and detab (written as exercises in Chapter 1) to 
7597 accept a list of tab stops as arguments. Use the default tab settings if there are no arguments. 
7598 
7599 Exercise 5-12. Extend entab and detab to accept the shorthand 
7600 
 
 
7605 to mean tab stops every n columns, starting at column m. Choose convenient (for the user) 
7606 default behavior. 
7607 
7608 
7609 Exercise 5-13. Write the program tail, which prints the last n lines of its input. By default, n 
7610 is set to 10, let us say, but it can be changed by an optional argument so that 
7611 
 
 
7616 prints the last n lines. The program should behave rationally no matter how unreasonable the 
7617 input or the value of n. Write the program so it makes the best use of available storage; lines 
7618 should be stored as in the sorting program of Section 5.6, not in a two-dimensional array of 
7619 fixed size. 
7620 
7621 5.11 Pointers to Functions 
7622 
7623 In C, a function itself is not a variable, but it is possible to define pointers to functions, which 
7624 can be assigned, placed in arrays, passed to functions, returned by functions, and so on. We 
7625 will illustrate this by modifying the sorting procedure written earlier in this chapter so that if 
7626 the optional argument -n is given, it will sort the input lines numerically instead of 
7627 lexicographically. 
7628 
7629 A sort often consists of three parts - a comparison that determines the ordering of any pair of 
7630 objects, an exchange that reverses their order, and a sorting algorithm that makes comparisons 
7631 and exchanges until the objects are in order. The sorting algorithm is independent of the 
7632 comparison and exchange operations, so by passing different comparison and exchange 
7633 functions to it, we can arrange to sort by different criteria. This is the approach taken in our 
7634 new sort. 
7635 
7636 Lexicographic comparison of two lines is done by strcmp, as before; we will also need a 
7637 routine numcmp that compares two lines on the basis of numeric value and returns the same 
7638 kind of condition indication as strcmp does. These functions are declared ahead of main and 
7639 a pointer to the appropriate one is passed to qsort. We have skimped on error processing for 
7640 arguments, so as to concentrate on the main issues. 
7641 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
7694 
 
 
 
 
 
 
7707 In the call to qsort, strcmp and numcmp are addresses of functions. Since they are known to 
7708 be functions, the & is not necessary, in the same way that it is not needed before an array 
7709 name. 
7710 
7711 We have written qsort so it can process any data type, not just character strings. As indicated 
7712 by the function prototype, qsort expects an array of pointers, two integers, and a function 
7713 with two pointer arguments. The generic pointer type void * is used for the pointer 
7714 arguments. Any pointer can be cast to void * and back again without loss of information, so 
7715 we can call qsort by casting arguments to void *. The elaborate cast of the function 
7716 argument casts the arguments of the comparison function. These will generally have no effect 
7717 on actual representation, but assure the compiler that all is well. 
7718 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
7759 The declarations should be studied with some care. The fourth parameter of qsort is 
7760 
 
 
7765 which says that comp is a pointer to a function that has two void * arguments and returns an 
7766 int. 
7767 
7768 The use of comp in the line 
7769 
 
 
7774 is consistent with the declaration: comp is a pointer to a function, *comp is the function, and 
7775 
 
 
7780 is the call to it. The parentheses are needed so the components are correctly associated; 
7781 without them, 
7782 
 
 
7787 says that comp is a function returning a pointer to an int, which is very different. 
7788 
7789 
7790 We have already shown strcmp, which compares two strings. Here is numcmp, which 
7791 compares two strings on a leading numeric value, computed by calling atof: 
7792 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
7827 The swap function, which exchanges two pointers, is identical to what we presented earlier in 
7828 the chapter, except that the declarations are changed to void *. 
7829 
 
 
 
 
 
 
 
 
 
7848 A variety of other options can be added to the sorting program; some make challenging 
7849 exercises. 
7850 
7851 Exercise 5-14. Modify the sort program to handle a -r flag, which indicates sorting in reverse 
7852 (decreasing) order. Be sure that -r works with -n. 
7853 
7854 Exercise 5-15. Add the option -f to fold upper and lower case together, so that case 
7855 distinctions are not made during sorting; for example, a and A compare equal. 
7856 
7857 Exercise 5-16. Add the -d (``directory order'') option, which makes comparisons only on 
7858 letters, numbers and blanks. Make sure it works in conjunction with -f. 
7859 
7860 Exercise 5-17. Add a field-searching capability, so sorting may bee done on fields within 
7861 lines, each field sorted according to an independent set of options. (The index for this book 
7862 was sorted with -df for the index category and -n for the page numbers.) 
7863 
7864 5.12 Complicated Declarations 
7865 
7866 C is sometimes castigated for the syntax of its declarations, particularly ones that involve 
7867 pointers to functions. The syntax is an attempt to make the declaration and the use agree; it 
7868 works well for simple cases, but it can be confusing for the harder ones, because declarations 
7869 cannot be read left to right, and because parentheses are over-used. The difference between 
7870 
 
 
7875 and 
7876 
 
7879 
 
7882 illustrates the problem: * is a prefix operator and it has lower precedence than (), so 
7883 parentheses are necessary to force the proper association. 
7884 
7885 Although truly complicated declarations rarely arise in practice, it is important to know how 
7886 to understand them, and, if necessary, how to create them. One good way to synthesize 
7887 declarations is in small steps with typedef, which is discussed in Section 6.7. As an 
7888 alternative, in this section we will present a pair of programs that convert from valid C to a 
7889 word description and back again. The word description reads left to right. 
7890 
7891 The first, dcl, is the more complex. It converts a C declaration into a word description, as in 
7892 these examples: 
7893 
 
7896 char **argv 
7897 
 
7900 int (*daytab)[13] 
7901 
 
7904 int *daytab[13] 
7905 
 
7908 void *comp() 
7909 
 
7912 void (*comp)() 
7913 
 
7916 char (*(*x())[])() 
7917 
 
 
7922 char (*(*x[3])())[5] 
7923 
 
 
7928 dcl is based on the grammar that specifies a declarator, which is spelled out precisely in 
7929 Appendix A, Section 8.5; this is a simplified form: 
7930 
 
 
7935 dcl: optional *'s direct-dcl 
7936 
7937 direct-dcl name 
7938 
 
 
 
 
7947 In words, a dcl is a direct-dcl, perhaps preceded by *'s. A direct-dcl is a name, or a 
7948 parenthesized dcl, or a direct-dcl followed by parentheses, or a direct-dcl followed by 
7949 brackets with an optional size. 
7950 
7951 This grammar can be used to parse functions. For instance, consider this declarator: 
7952 
 
 
7957 pfa will be identified as a name and thus as a direct-dcl. Then pfa[] is also a direct-dcl. Then 
7958 *pfa[] is recognized as a dcl, so (*pfa[]) is a direct-dcl. Then (*pfa[])() is a direct-dcl 
7959 and thus a dcl. We can also illustrate the parse with a tree like this (where direct-dcl has been 
7960 abbreviated to dir-dcl): 
7961 
7962 
 
7965 The heart of the dcl program is a pair of functions, dcl and dirdcl, that parse a declaration 
7966 according to this grammar. Because the grammar is recursively defined, the functions call 
7967 each other recursively as they recognize pieces of a declaration; the program is called a 
7968 recursive-descent parser. 
7969 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
8018 
 
 
 
 
 
 
 
 
 
 
 
8041 Since the programs are intended to be illustrative, not bullet-proof, there are significant 
8042 restrictions on dcl. It can only handle a simple data type line char or int. It does not handle 
8043 argument types in functions, or qualifiers like const. Spurious blanks confuse it. It doesn't do 
8044 much error recovery, so invalid declarations will also confuse it. These improvements are left 
8045 as exercises. 
8046 
8047 Here are the global variables and the main routine: 
8048 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
8111 The function gettoken skips blanks and tabs, then finds the next token in the input; a ``token'' 
8112 is a name, a pair of parentheses, a pair of brackets perhaps including a number, or any other 
8113 single character. 
8114 
 
 
 
 
 
 
 
 
8131 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
8180 getch and ungetch are discussed in Chapter 4. 
8181 
8182 Going in the other direction is easier, especially if we do not worry about generating 
8183 redundant parentheses. The program undcl converts a word description like ``x is a function 
8184 returning a pointer to an array of pointers to functions returning char,'' which we will express 
8185 as 
8186 
 
 
8191 to 
8192 
 
 
8197 The abbreviated input syntax lets us reuse the gettoken function. undcl also uses the same 
8198 external variables as dcl does. 
8199 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
8246 
8247 Exercise 5-18. Make dcl recover from input errors. 
8248 
8249 Exercise 5-19. Modify undcl so that it does not add redundant parentheses to declarations. 
8250 
8251 Exercise 5-20. Expand dcl to handle declarations with function argument types, qualifiers 
8252 like const, and so on. 
8253 
8254 
 
8257 Chapter 6 - Structures 
8258 
8259 A structure is a collection of one or more variables, possibly of different types, grouped 
8260 together under a single name for convenient handling. (Structures are called ``records'' in 
8261 some languages, notably Pascal.) Structures help to organize complicated data, particularly in 
8262 large programs, because they permit a group of related variables to be treated as a unit instead 
8263 of as separate entities. 
8264 
8265 One traditional example of a structure is the payroll record: an employee is described by a set 
8266 of attributes such as name, address, social security number, salary, etc. Some of these in turn 
8267 could be structures: a name has several components, as does an address and even a salary. 
8268 Another example, more typical for C, comes from graphics: a point is a pair of coordinate, a 
8269 rectangle is a pair of points, and so on. 
8270 
8271 The main change made by the ANSI standard is to define structure assignment - structures 
8272 may be copied and assigned to, passed to functions, and returned by functions. This has been 
8273 supported by most compilers for many years, but the properties are now precisely defined. 
8274 Automatic structures and arrays may now also be initialized. 
8275 
8276 6.1 Basics of Structures 
8277 
8278 Let us create a few structures suitable for graphics. The basic object is a point, which we will 
8279 assume has an x coordinate and a y coordinate, both integers. 
8280 
 
8283 The two components can be placed in a structure declared like this: 
8284 
 
 
 
 
 
8295 The keyword struct introduces a structure declaration, which is a list of declarations 
8296 enclosed in braces. An optional name called a structure tag may follow the word struct (as 
8297 with point here). The tag names this kind of structure, and can be used subsequently as a 
8298 shorthand for the part of the declaration in braces. 
8299 
8300 
8301 The variables named in a structure are called members. A structure member or tag and an 
8302 ordinary (i.e., non-member) variable can have the same name without conflict, since they can 
8303 always be distinguished by context. Furthermore, the same member names may occur in 
8304 different structures, although as a matter of style one would normally use the same names 
8305 only for closely related objects. 
8306 
8307 A struct declaration defines a type. The right brace that terminates the list of members may 
8308 be followed by a list of variables, just as for any basic type. That is, 
8309 
 
 
8314 is syntactically analogous to 
8315 
 
 
8320 in the sense that each statement declares x, y and z to be variables of the named type and 
8321 causes space to be set aside for them. 
8322 
8323 A structure declaration that is not followed by a list of variables reserves no storage; it merely 
8324 describes a template or shape of a structure. If the declaration is tagged, however, the tag can 
8325 be used later in definitions of instances of the structure. For example, given the declaration of 
8326 point above, 
8327 
 
 
8332 defines a variable pt which is a structure of type struct point. A structure can be initialized 
8333 by following its definition with a list of initializers, each a constant expression, for the 
8334 members: 
8335 
 
 
8340 An automatic structure may also be initialized by assignment or by calling a function that 
8341 returns a structure of the right type. 
8342 
8343 A member of a particular structure is referred to in an expression by a construction of the 
8344 form 
8345 
 
8348 The structure member operator ``.'' connects the structure name and the member name. To 
8349 print the coordinates of the point pt, for instance, 
8350 
 
 
8355 or to compute the distance from the origin (0,0) to pt, 
8356 
 
 
 
 
8365 Structures can be nested. One representation of a rectangle is a pair of points that denote the 
8366 diagonally opposite corners: 
8367 
8368 
 
 
 
 
 
 
8381 The rect structure contains two point structures. If we declare screen as 
8382 
 
 
8387 then 
8388 
 
 
8393 refers to the x coordinate of the pt1 member of screen. 
8394 
8395 6.2 Structures and Functions 
8396 
8397 The only legal operations on a structure are copying it or assigning to it as a unit, taking its 
8398 address with &, and accessing its members. Copy and assignment include passing arguments 
8399 to functions and returning values from functions as well. Structures may not be compared. A 
8400 structure may be initialized by a list of constant member values; an automatic structure may 
8401 also be initialized by an assignment. 
8402 
8403 Let us investigate structures by writing some functions to manipulate points and rectangles. 
8404 There are at least three possible approaches: pass components separately, pass an entire 
8405 structure, or pass a pointer to it. Each has its good points and bad points. 
8406 
8407 The first function, makepoint, will take two integers and return a point structure: 
8408 
 
 
 
 
 
 
 
 
 
 
8429 Notice that there is no conflict between the argument name and the member with the same 
8430 name; indeed the re-use of the names stresses the relationship. 
8431 
8432 makepoint can now be used to initialize any structure dynamically, or to provide structure 
8433 arguments to a function: 
8434 
 
 
8439 
 
 
 
 
 
 
 
8454 The next step is a set of functions to do arithmetic on points. For instance, 
8455 
 
 
 
 
 
 
 
 
8472 Here both the arguments and the return value are structures. We incremented the components 
8473 in p1 rather than using an explicit temporary variable to emphasize that structure parameters 
8474 are passed by value like any others. 
8475 
8476 As another example, the function ptinrect tests whether a point is inside a rectangle, where 
8477 we have adopted the convention that a rectangle includes its left and bottom sides but not its 
8478 top and right sides: 
8479 
 
 
 
 
 
 
 
8494 This assumes that the rectangle is presented in a standard form where the pt1 coordinates are 
8495 less than the pt2 coordinates. The following function returns a rectangle guaranteed to be in 
8496 canonical form: 
8497 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
8528 If a large structure is to be passed to a function, it is generally more efficient to pass a pointer 
8529 than to copy the whole structure. Structure pointers are just like pointers to ordinary variables. 
8530 The declaration 
8531 
 
 
8536 says that pp is a pointer to a structure of type struct point. If pp points to a point structure, 
8537 *pp is the structure, and (*pp).x and (*pp).y are the members. To use pp, we might write, 
8538 for example, 
8539 
 
 
 
8546 
 
 
8551 The parentheses are necessary in (*pp).x because the precedence of the structure member 
8552 operator . is higher then *. The expression *pp.x means *(pp.x), which is illegal here 
8553 because x is not a pointer. 
8554 
8555 Pointers to structures are so frequently used that an alternative notation is provided as a 
8556 shorthand. If p is a pointer to a structure, then 
8557 
 
 
8562 refers to the particular member. So we could write instead 
8563 
 
 
8568 Both . and -> associate from left to right, so if we have 
8569 
 
 
8574 then these four expressions are equivalent: 
8575 
 
 
 
 
 
8586 The structure operators . and ->, together with () for function calls and [] for subscripts, are 
8587 at the top of the precedence hierarchy and thus bind very tightly. For example, given the 
8588 declaration 
8589 
 
 
 
 
 
8600 then 
8601 
 
 
8606 increments len, not p, because the implied parenthesization is ++(p->len). Parentheses can 
8607 be used to alter binding: (++p)->len increments p before accessing len, and (p++)->len 
8608 increments p afterward. (This last set of parentheses is unnecessary.) 
8609 
8610 In the same way, *p->str fetches whatever str points to; *p->str++ increments str after 
8611 accessing whatever it points to (just like *s++); (*p->str)++ increments whatever str points 
8612 to; and *p++->str increments p after accessing whatever str points to. 
8613 
8614 6.3 Arrays of Structures 
8615 
8616 Consider writing a program to count the occurrences of each C keyword. We need an array of 
8617 character strings to hold the names, and an array of integers for the counts. One possibility is 
8618 to use two parallel arrays, keyword and keycount, as in 
8619 
 
 
 
8626 But the very fact that the arrays are parallel suggests a different organization, an array of 
8627 structures. Each keyword is a pair: 
8628 
 
 
 
8635 and there is an array of pairs. The structure declaration 
8636 
8637 
 
 
 
 
 
8648 declares a structure type key, defines an array keytab of structures of this type, and sets aside 
8649 storage for them. Each element of the array is a structure. This could also be written 
8650 
 
 
 
 
 
 
 
8665 Since the structure keytab contains a constant set of names, it is easiest to make it an external 
8666 variable and initialize it once and for all when it is defined. The structure initialization is 
8667 analogous to earlier ones - the definition is followed by a list of initializers enclosed in braces: 
8668 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
8705 The initializers are listed in pairs corresponding to the structure members. It would be more 
8706 precise to enclose the initializers for each "row" or structure in braces, as in 
8707 
 
 
 
 
 
8718 but inner braces are not necessary when the initializers are simple variables or character 
8719 strings, and when all are present. As usual, the number of entries in the array keytab will be 
8720 computed if the initializers are present and the [] is left empty. 
8721 
8722 The keyword counting program begins with the definition of keytab. The main routine reads 
8723 the input by repeatedly calling a function getword that fetches one word at a time. Each word 
8724 is looked up in keytab with a version of the binary search function that we wrote in Chapter 
8725 3. The list of keywords must be sorted in increasing order in the table. 
8726 
 
 
 
 
 
 
 
 
 
8745 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
8820 We will show the function getword in a moment; for now it suffices to say that each call to 
8821 getword finds a word, which is copied into the array named as its first argument. 
8822 
8823 The quantity NKEYS is the number of keywords in keytab. Although we could count this by 
8824 hand, it's a lot easier and safer to do it by machine, especially if the list is subject to change. 
8825 One possibility would be to terminate the list of initializers with a null pointer, then loop 
8826 along keytab until the end is found. 
8827 
8828 But this is more than is needed, since the size of the array is completely determined at 
8829 compile time. The size of the array is the size of one entry times the number of entries, so the 
8830 number of entries is just 
8831 
 
8834 C provides a compile-time unary operator called sizeof that can be used to compute the size 
8835 of any object. The expressions 
8836 
 
 
8841 and 
8842 
 
 
8847 
8848 yield an integer equal to the size of the specified object or type in bytes. (Strictly, sizeof 
8849 produces an unsigned integer value whose type, size_t, is defined in the header 
8850 <stddef.h>.) An object can be a variable or array or structure. A type name can be the name 
8851 of a basic type like int or double, or a derived type like a structure or a pointer. 
8852 
8853 In our case, the number of keywords is the size of the array divided by the size of one 
8854 element. This computation is used in a #define statement to set the value of NKEYS: 
8855 
 
 
8860 Another way to write this is to divide the array size by the size of a specific element: 
8861 
 
 
8866 This has the advantage that it does not need to be changed if the type changes. 
8867 
8868 A sizeof can not be used in a #if line, because the preprocessor does not parse type names. 
8869 But the expression in the #define is not evaluated by the preprocessor, so the code here is 
8870 legal. 
8871 
8872 Now for the function getword. We have written a more general getword than is necessary for 
8873 this program, but it is not complicated. getword fetches the next ``word'' from the input, 
8874 where a word is either a string of letters and digits beginning with a letter, or a single non-
8875 white space character. The function value is the first character of the word, or EOF for end of 
8876 file, or the character itself if it is not alphabetic. 
8877 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
8926 getword uses the getch and ungetch that we wrote in Chapter 4. When the collection of an 
8927 alphanumeric token stops, getword has gone one character too far. The call to ungetch 
8928 pushes that character back on the input for the next call. getword also uses isspace to skip 
8929 whitespace, isalpha to identify letters, and isalnum to identify letters and digits; all are from 
8930 the standard header <ctype.h>. 
8931 
8932 Exercise 6-1. Our version of getword does not properly handle underscores, string constants, 
8933 comments, or preprocessor control lines. Write a better version. 
8934 
8935 
8936 6.4 Pointers to Structures 
8937 
8938 To illustrate some of the considerations involved with pointers to and arrays of structures, let 
8939 us write the keyword-counting program again, this time using pointers instead of array 
8940 indices. 
8941 
8942 The external declaration of keytab need not change, but main and binsearch do need 
8943 modification. 
8944 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
9033 There are several things worthy of note here. First, the declaration of binsearch must 
9034 indicate that it returns a pointer to struct key instead of an integer; this is declared both in 
9035 the function prototype and in binsearch. If binsearch finds the word, it returns a pointer to 
9036 it; if it fails, it returns NULL. 
9037 
9038 
9039 Second, the elements of keytab are now accessed by pointers. This requires significant 
9040 changes in binsearch. 
9041 
9042 The initializers for low and high are now pointers to the beginning and just past the end of the 
9043 table. 
9044 
9045 The computation of the middle element can no longer be simply 
9046 
 
 
9051 because the addition of pointers is illegal. Subtraction is legal, however, so high-low is the 
9052 number of elements, and thus 
9053 
 
 
9058 sets mid to the element halfway between low and high. 
9059 
9060 The most important change is to adjust the algorithm to make sure that it does not generate an 
9061 illegal pointer or attempt to access an element outside the array. The problem is that &tab[-
9062 1] and &tab[n] are both outside the limits of the array tab. The former is strictly illegal, and 
9063 it is illegal to dereference the latter. The language definition does guarantee, however, that 
9064 pointer arithmetic that involves the first element beyond the end of an array (that is, &tab[n]) 
9065 will work correctly. 
9066 
9067 In main we wrote 
9068 
 
 
9073 If p is a pointer to a structure, arithmetic on p takes into account the size of the structure, so 
9074 p++ increments p by the correct amount to get the next element of the array of structures, and 
9075 the test stops the loop at the right time. 
9076 
9077 Don't assume, however, that the size of a structure is the sum of the sizes of its members. 
9078 Because of alignment requirements for different objects, there may be unnamed ``holes'' in a 
9079 structure. Thus, for instance, if a char is one byte and an int four bytes, the structure 
9080 
 
 
 
 
 
9091 might well require eight bytes, not five. The sizeof operator returns the proper value. 
9092 
9093 Finally, an aside on program format: when a function returns a complicated type like a 
9094 structure pointer, as in 
9095 
 
 
9100 the function name can be hard to see, and to find with a text editor. Accordingly an alternate 
9101 style is sometimes used: 
9102 
 
 
 
9109 This is a matter of personal taste; pick the form you like and hold to it. 
9110 
9111 
9112 6.5 Self-referential Structures 
9113 
9114 Suppose we want to handle the more general problem of counting the occurrences of all the 
9115 words in some input. Since the list of words isn't known in advance, we can't conveniently 
9116 sort it and use a binary search. Yet we can't do a linear search for each word as it arrives, to 
9117 see if it's already been seen; the program would take too long. (More precisely, its running 
9118 time is likely to grow quadratically with the number of input words.) How can we organize 
9119 the data to copy efficiently with a list or arbitrary words? 
9120 
9121 One solution is to keep the set of words seen so far sorted at all times, by placing each word 
9122 into its proper position in the order as it arrives. This shouldn't be done by shifting words in a 
9123 linear array, though - that also takes too long. Instead we will use a data structure called a 
9124 binary tree. 
9125 
9126 The tree contains one ``node'' per distinct word; each node contains 
9127 
9128  A pointer to the text of the word, 
9129  A count of the number of occurrences, 
9130  A pointer to the left child node, 
9131  A pointer to the right child node. 
9132 
9133 
9134 No node may have more than two children; it might have only zero or one. 
9135 
9136 The nodes are maintained so that at any node the left subtree contains only words that are 
9137 lexicographically less than the word at the node, and the right subtree contains only words 
9138 that are greater. This is the tree for the sentence ``now is the time for all good men to come to 
9139 the aid of their party'', as built by inserting each word as it is encountered: 
9140 
 
9143 To find out whether a new word is already in the tree, start at the root and compare the new 
9144 word to the word stored at that node. If they match, the question is answered affirmatively. If 
9145 the new record is less than the tree word, continue searching at the left child, otherwise at the 
9146 right child. If there is no child in the required direction, the new word is not in the tree, and in 
9147 fact the empty slot is the proper place to add the new word. This process is recursive, since 
9148 the search from any node uses a search from one of its children. Accordingly, recursive 
9149 routines for insertion and printing will be most natural. 
9150 
9151 Going back to the description of a node, it is most conveniently represented as a structure 
9152 with four components: 
9153 
9154 
 
 
 
 
 
 
 
9169 This recursive declaration of a node might look chancy, but it's correct. It is illegal for a 
9170 structure to contain an instance of itself, but 
9171 
 
 
9176 declares left to be a pointer to a tnode, not a tnode itself. 
9177 
9178 Occasionally, one needs a variation of self-referential structures: two structures that refer to 
9179 each other. The way to handle this is: 
9180 
 
 
 
 
 
 
 
 
 
9199 The code for the whole program is surprisingly small, given a handful of supporting routines 
9200 like getword that we have already written. The main routine reads words with getword and 
9201 installs them in the tree with addtree. 
9202 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
9245 The function addtree is recursive. A word is presented by main to the top level (the root) of 
9246 the tree. At each stage, that word is compared to the word already stored at the node, and is 
9247 percolated down to either the left or right subtree by a recursive call to adtree. Eventually, 
9248 the word either matches something already in the tree (in which case the count is 
9249 incremented), or a null pointer is encountered, indicating that a node must be created and 
9250 added to the tree. If a new node is created, addtree returns a pointer to it, which is installed 
9251 in the parent node. 
9252 
 
9255 
9256 
 
 
 
9263 
 
 
 
9270 
9271 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
9306 Storage for the new node is fetched by a routine talloc, which returns a pointer to a free 
9307 space suitable for holding a tree node, and the new word is copied into a hidden space by 
9308 strdup. (We will discuss these routines in a moment.) The count is initialized, and the two 
9309 children are made null. This part of the code is executed only at the leaves of the tree, when a 
9310 new node is being added. We have (unwisely) omitted error checking on the values returned 
9311 by strdup and talloc. 
9312 
9313 treeprint prints the tree in sorted order; at each node, it prints the left subtree (all the words 
9314 less than this word), then the word itself, then the right subtree (all the words greater). If you 
9315 feel shaky about how recursion works, simulate treeprint as it operates on the tree shown 
9316 above. 
9317 
 
 
 
 
 
 
 
 
 
 
9338 A practical note: if the tree becomes ``unbalanced'' because the words don't arrive in random 
9339 order, the running time of the program can grow too much. As a worst case, if the words are 
9340 already in order, this program does an expensive simulation of linear search. There are 
9341 generalizations of the binary tree that do not suffer from this worst-case behavior, but we will 
9342 not describe them here. 
9343 
9344 Before leaving this example, it is also worth a brief digression on a problem related to storage 
9345 allocators. Clearly it's desirable that there be only one storage allocator in a program, even 
9346 though it allocates different kinds of objects. But if one allocator is to process requests for, 
9347 say, pointers to chars and pointers to struct tnodes, two questions arise. First, how does it 
9348 meet the requirement of most real machines that objects of certain types must satisfy 
9349 alignment restrictions (for example, integers often must be located at even addresses)? 
9350 Second, what declarations can cope with the fact that an allocator must necessarily return 
9351 different kinds of pointers? 
9352 
9353 
9354 Alignment requirements can generally be satisfied easily, at the cost of some wasted space, by 
9355 ensuring that the allocator always returns a pointer that meets all alignment restrictions. The 
9356 alloc of Chapter 5 does not guarantee any particular alignment, so we will use the standard 
9357 library function malloc, which does. In Chapter 8 we will show one way to implement 
9358 malloc. 
9359 
9360 The question of the type declaration for a function like malloc is a vexing one for any 
9361 language that takes its type-checking seriously. In C, the proper method is to declare that 
9362 malloc returns a pointer to void, then explicitly coerce the pointer into the desired type with 
9363 a cast. malloc and related routines are declared in the standard header <stdlib.h>. Thus 
9364 talloc can be written as 
9365 
 
 
 
 
 
 
 
 
9382 strdup merely copies the string given by its argument into a safe place, obtained by a call on 
9383 malloc: 
9384 
 
 
 
 
 
 
 
 
 
 
9405 malloc returns NULL if no space is available; strdup passes that value on, leaving error-
9406 handling to its caller. 
9407 
9408 Storage obtained by calling malloc may be freed for re-use by calling free; see Chapters 8 
9409 and 7. 
9410 
9411 Exercise 6-2. Write a program that reads a C program and prints in alphabetical order each 
9412 group of variable names that are identical in the first 6 characters, but different somewhere 
9413 thereafter. Don't count words within strings and comments. Make 6 a parameter that can be 
9414 set from the command line. 
9415 
9416 Exercise 6-3. Write a cross-referencer that prints a list of all words in a document, and for 
9417 each word, a list of the line numbers on which it occurs. Remove noise words like ``the,'' 
9418 ``and,'' and so on. 
9419 
9420 Exercise 6-4. Write a program that prints the distinct words in its input sorted into decreasing 
9421 order of frequency of occurrence. Precede each word by its count. 
9422 
9423 6.6 Table Lookup 
9424 
9425 In this section we will write the innards of a table-lookup package, to illustrate more aspects 
9426 of structures. This code is typical of what might be found in the symbol table management 
9427 
9428 
9429 routines of a macro processor or a compiler. For example, consider the #define statement. 
9430 When a line like 
9431 
 
 
9436 is encountered, the name IN and the replacement text 1 are stored in a table. Later, when the 
9437 name IN appears in a statement like 
9438 
 
 
9443 it must be replaced by 1. 
9444 
9445 There are two routines that manipulate the names and replacement texts. install(s,t) 
9446 records the name s and the replacement text t in a table; s and t are just character strings. 
9447 lookup(s) searches for s in the table, and returns a pointer to the place where it was found, 
9448 or NULL if it wasn't there. 
9449 
9450 The algorithm is a hash-search - the incoming name is converted into a small non-negative 
9451 integer, which is then used to index into an array of pointers. An array element points to the 
9452 beginning of a linked list of blocks describing names that have that hash value. It is NULL if no 
9453 names have hashed to that value. 
9454 
 
9457 A block in the list is a structure containing pointers to the name, the replacement text, and the 
9458 next block in the list. A null next-pointer marks the end of the list. 
9459 
 
 
 
 
 
 
9472 The pointer array is just 
9473 
 
 
 
 
9482 The hashing function, which is used by both lookup and install, adds each character value 
9483 in the string to a scrambled combination of the previous ones and returns the remainder 
9484 modulo the array size. This is not the best possible hash function, but it is short and effective. 
9485 
 
 
 
 
 
 
 
 
9502 
 
 
9507 Unsigned arithmetic ensures that the hash value is non-negative. 
9508 
9509 The hashing process produces a starting index in the array hashtab; if the string is to be 
9510 found anywhere, it will be in the list of blocks beginning there. The search is performed by 
9511 lookup. If lookup finds the entry already present, it returns a pointer to it; if not, it returns 
9512 NULL. 
9513 
 
 
 
 
 
 
 
 
 
 
 
9536 The for loop in lookup is the standard idiom for walking along a linked list: 
9537 
 
 
 
9544 install uses lookup to determine whether the name being installed is already present; if so, 
9545 the new definition will supersede the old one. Otherwise, a new entry is created. install 
9546 returns NULL if for any reason there is no room for a new entry. 
9547 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
9592 Exercise 6-6. Implement a simple version of the #define processor (i.e., no arguments) 
9593 suitable for use with C programs, based on the routines of this section. You may also find 
9594 getch and ungetch helpful. 
9595 
9596 6.7 Typedef 
9597 
9598 
9599 
 
9602 Exercise 6-5. Write a function undef that will remove a name and definition from the table 
9603 maintained by lookup and install. 
9604 
9605 
 
 
 
 
9614 Similarly, the declaration 
9615 
 
9618 
9619 
9620 C provides a facility called typedef for creating new data type names. For example, the 
9621 declaration 
9622 
9623 makes the name Length a synonym for int. The type Length can be used in declarations, 
9624 casts, etc., in exactly the same ways that the int type can be: 
9625 
 
 
9630 makes String a synonym for char * or character pointer, which may then be used in 
9631 declarations and casts: 
9632 
 
 
 
 
9641 Notice that the type being declared in a typedef appears in the position of a variable name, 
9642 not right after the word typedef. Syntactically, typedef is like the storage classes extern, 
9643 static, etc. We have used capitalized names for typedefs, to make them stand out. 
9644 
9645 As a more complicated example, we could make typedefs for the tree nodes shown earlier in 
9646 this chapter: 
9647 
 
 
 
 
 
 
 
 
 
9666 This creates two new type keywords called Treenode (a structure) and Treeptr (a pointer to 
9667 the structure). Then the routine talloc could become 
9668 
 
 
 
 
 
9679 It must be emphasized that a typedef declaration does not create a new type in any sense; it 
9680 merely adds a new name for some existing type. Nor are there any new semantics: variables 
9681 declared this way have exactly the same properties as variables whose declarations are spelled 
9682 out explicitly. In effect, typedef is like #define, except that since it is interpreted by the 
9683 compiler, it can cope with textual substitutions that are beyond the capabilities of the 
9684 preprocessor. For example, 
9685 
 
 
9690 creates the type PFI, for ``pointer to function (of two char * arguments) returning int,'' 
9691 which can be used in contexts like 
9692 
 
 
9697 in the sort program of Chapter 5. 
9698 
9699 Besides purely aesthetic issues, there are two main reasons for using typedefs. The first is to 
9700 parameterize a program against portability problems. If typedefs are used for data types that 
9701 
9702 
9703 may be machine-dependent, only the typedefs need change when the program is moved. One 
9704 common situation is to use typedef names for various integer quantities, then make an 
9705 appropriate set of choices of short, int, and long for each host machine. Types like size_t 
9706 and ptrdiff_t from the standard library are examples. 
9707 
9708 The second purpose of typedefs is to provide better documentation for a program - a type 
9709 called Treeptr may be easier to understand than one declared only as a pointer to a 
9710 complicated structure. 
9711 
9712 6.8 Unions 
9713 
9714 A union is a variable that may hold (at different times) objects of different types and sizes, 
9715 with the compiler keeping track of size and alignment requirements. Unions provide a way to 
9716 manipulate different kinds of data in a single area of storage, without embedding any 
9717 machine-dependent information in the program. They are analogous to variant records in 
9718 pascal. 
9719 
9720 As an example such as might be found in a compiler symbol table manager, suppose that a 
9721 constant may be an int, a float, or a character pointer. The value of a particular constant 
9722 must be stored in a variable of the proper type, yet it is most convenient for table management 
9723 if the value occupies the same amount of storage and is stored in the same place regardless of 
9724 its type. This is the purpose of a union - a single variable that can legitimately hold any of one 
9725 of several types. The syntax is based on structures: 
9726 
 
 
 
 
 
9737 The variable u will be large enough to hold the largest of the three types; the specific size is 
9738 implementation-dependent. Any of these types may be assigned to u and then used in 
9739 expressions, so long as the usage is consistent: the type retrieved must be the type most 
9740 recently stored. It is the programmer's responsibility to keep track of which type is currently 
9741 stored in a union; the results are implementation-dependent if something is stored as one type 
9742 and extracted as another. 
9743 
 
9746 or 
9747 
9748 just as for structures. If the variable utype is used to keep track of the current type stored in u, 
9749 then one might see code such as 
9750 
 
 
 
9757 
9758 
 
9761 Syntactically, members of a union are accessed as 
9762 
 
 
 
9769 
 
 
 
9776 Unions may occur within structures and arrays, and vice versa. The notation for accessing a 
9777 member of a union in a structure (or vice versa) is identical to that for nested structures. For 
9778 example, in the structure array defined by 
9779 
 
 
 
 
 
 
 
9794 the member ival is referred to as 
9795 
 
9798 and the first character of the string sval by either of 
9799 
 
 
9804 
9805 
 
 
 
 
 
 
 
 
9822 In effect, a union is a structure in which all members have offset zero from the base, the 
9823 structure is big enough to hold the ``widest'' member, and the alignment is appropriate for all 
9824 of the types in the union. The same operations are permitted on unions as on structures: 
9825 assignment to or copying as a unit, taking the address, and accessing a member. 
9826 
9827 A union may only be initialized with a value of the type of its first member; thus union u 
9828 described above can only be initialized with an integer value. 
9829 
9830 The storage allocator in Chapter 8 shows how a union can be used to force a variable to be 
9831 aligned on a particular kind of storage boundary. 
9832 
9833 6.9 Bit-fields 
9834 
9835 When storage space is at a premium, it may be necessary to pack several objects into a single 
9836 machine word; one common use is a set of single-bit flags in applications like compiler 
9837 symbol tables. Externally-imposed data formats, such as interfaces to hardware devices, also 
9838 often require the ability to get at pieces of a word. 
9839 
9840 Imagine a fragment of a compiler that manipulates a symbol table. Each identifier in a 
9841 program has certain information associated with it, for example, whether or not it is a 
9842 keyword, whether or not it is external and/or static, and so on. The most compact way to 
9843 encode such information is a set of one-bit flags in a single char or int. 
9844 
9845 The usual way this is done is to define a set of ``masks'' corresponding to the relevant bit 
9846 positions, as in 
9847 
 
 
 
 
9856 
9857 or 
9858 
 
 
9863 The numbers must be powers of two. Then accessing the bits becomes a matter of ``bit-
9864 fiddling'' with the shifting, masking, and complementing operators that were described in 
9865 Chapter 2. 
9866 
9867 Certain idioms appear frequently: 
9868 
 
 
9873 turns on the EXTERNAL and STATIC bits in flags, while 
9874 
 
9877 turns them off, and 
9878 
 
9881 is true if both bits are off. 
9882 
 
 
 
 
9891 This defines a variable table called flags that contains three 1-bit fields. The number 
9892 following the colon represents the field width in bits. The fields are declared unsigned int 
9893 to ensure that they are unsigned quantities. 
9894 
9895 Individual fields are referenced in the same way as other structure members: 
9896 flags.is_keyword, flags.is_extern, etc. Fields behave like small integers, and may 
9897 participate in arithmetic expressions just like other integers. Thus the previous examples may 
9898 be written more naturally as 
9899 
 
9902 to turn the bits on; 
9903 
 
9906 to turn them off; and 
9907 
 
 
9912 Almost everything about fields is implementation-dependent. Whether a field may overlap a 
9913 word boundary is implementation-defined. Fields need not be names; unnamed fields (a colon 
9914 and width only) are used for padding. The special width 0 may be used to force alignment at 
9915 the next word boundary. 
9916 
9917 
9918 
 
 
9923 Although these idioms are readily mastered, as an alternative C offers the capability of 
9924 defining and accessing fields within a word directly rather than by bitwise logical operators. 
9925 A bit-field, or field for short, is a set of adjacent bits within a single implementation-defined 
9926 storage unit that we will call a ``word.'' For example, the symbol table #defines above could 
9927 be replaced by the definition of three fields: 
9928 
 
 
 
 
 
9939 to test them. 
9940 
9941 
9942 Fields are assigned left to right on some machines and right to left on others. This means that 
9943 although fields are useful for maintaining internally-defined data structures, the question of 
9944 which end comes first has to be carefully considered when picking apart externally-defined 
9945 data; programs that depend on such things are not portable. Fields may be declared only as 
9946 ints; for portability, specify signed or unsigned explicitly. They are not arrays and they do 
9947 not have addresses, so the & operator cannot be applied on them. 
9948 
9949 
9950 
9951 
9952 Chapter 7 - Input and Output 
9953 
9954 Input and output are not part of the C language itself, so we have not emphasized them in our 
9955 presentation thus far. Nonetheless, programs interact with their environment in much more 
9956 complicated ways than those we have shown before. In this chapter we will describe the 
9957 standard library, a set of functions that provide input and output, string handling, storage 
9958 management, mathematical routines, and a variety of other services for C programs. We will 
9959 concentrate on input and output 
9960 
9961 The properties of library functions are specified in more than a dozen headers; we have 
9962 already seen several of these, including <stdio.h>, <string.h>, and <ctype.h>. We will 
9963 not present the entire library here, since we are more interested in writing C programs that use 
9964 it. The library is described in detail in Appendix B. 
9965 
9966 7.1 Standard Input and Output 
9967 
9968 As we said in Chapter 1, the library implements a simple model of text input and output. A 
9969 text stream consists of a sequence of lines; each line ends with a newline character. If the 
9970 system doesn't operate that way, the library does whatever necessary to make it appear as if it 
9971 does. For instance, the library might convert carriage return and linefeed to newline on input 
9972 and back again on output. 
9973 
9974 The simplest input mechanism is to read one character at a time from the standard input, 
9975 normally the keyboard, with getchar: 
9976 
9977 
9978 
 
9981 The ANSI standard defines these library functions precisely, so that they can exist in 
9982 compatible form on any system where C exists. Programs that confine their system 
9983 interactions to facilities provided by the standard library can be moved from one system to 
9984 another without change. 
9985 
 
 
9990 getchar returns the next input character each time it is called, or EOF when it encounters end 
9991 of file. The symbolic constant EOF is defined in <stdio.h>. The value is typically -1, bus 
9992 tests should be written in terms of EOF so as to be independent of the specific value. 
9993 
9994 In many environments, a file may be substituted for the keyboard by using the < convention 
9995 for input redirection: if a program prog uses getchar, then the command line 
9996 
 
 
10001 causes prog to read characters from infile instead. The switching of the input is done in 
10002 such a way that prog itself is oblivious to the change; in particular, the string ``<infile'' is 
10003 not included in the command-line arguments in argv. Input switching is also invisible if the 
10004 input comes from another program via a pipe mechanism: on some systems, the command 
10005 line 
10006 
 
 
10011 
10012 runs the two programs otherprog and prog, and pipes the standard output of otherprog into 
10013 the standard input for prog. 
10014 
10015 The function 
10016 
 
 
10021 is used for output: putchar(c) puts the character c on the standard output, which is by 
10022 default the screen. putchar returns the character written, or EOF is an error occurs. Again, 
10023 output can usually be directed to a file with >filename: if prog uses putchar, 
10024 
 
 
10029 will write the standard output to outfile instead. If pipes are supported, 
10030 
 
 
10035 puts the standard output of prog into the standard input of anotherprog. 
10036 
10037 Output produced by printf also finds its way to the standard output. Calls to putchar and 
10038 printf may be interleaved - output happens in the order in which the calls are made. 
10039 
10040 Each source file that refers to an input/output library function must contain the line 
10041 
 
 
10046 before the first reference. When the name is bracketed by < and > a search is made for the 
10047 header in a standard set of places (for example, on UNIX systems, typically in the directory 
10048 /usr/include). 
10049 
10050 Many programs read only one input stream and write only one output stream; for such 
10051 programs, input and output with getchar, putchar, and printf may be entirely adequate, 
10052 and is certainly enough to get started. This is particularly true if redirection is used to connect 
10053 the output of one program to the input of the next. For example, consider the program lower, 
10054 which converts its input to lower case: 
10055 
 
 
 
 
 
 
 
 
 
 
 
 
10080 The function tolower is defined in <ctype.h>; it converts an upper case letter to lower case, 
10081 and returns other characters untouched. As we mentioned earlier, ``functions'' like getchar 
10082 and putchar in <stdio.h> and tolower in <ctype.h> are often macros, thus avoiding the 
10083 overhead of a function call per character. We will show how this is done in Section 8.5. 
10084 Regardless of how the <ctype.h> functions are implemented on a given machine, programs 
10085 that use them are shielded from knowledge of the character set. 
10086 
10087 Exercise 7-1. Write a program that converts upper case to lower or lower case to upper, 
10088 depending on the name it is invoked with, as found in argv[0]. 
10089 
10090 
10091 7.2 Formatted Output - printf 
10092 
10093 The output function printf translates internal values to characters. We have used printf 
10094 informally in previous chapters. The description here covers most typical uses but is not 
10095 complete; for the full story, see Appendix B. 
10096 
 
 
10101 printf converts, formats, and prints its arguments on the standard output under control of the 
10102 format. It returns the number of characters printed. 
10103 
10104 The format string contains two types of objects: ordinary characters, which are copied to the 
10105 output stream, and conversion specifications, each of which causes conversion and printing of 
10106 the next successive argument to printf. Each conversion specification begins with a % and 
10107 ends with a conversion character. Between the % and the conversion character there may be, 
10108 in order: 
10109 
10110  A minus sign, which specifies left adjustment of the converted argument. 
10111  A number that specifies the minimum field width. The converted argument will be 
10112 printed in a field at least this wide. If necessary it will be padded on the left (or right, 
10113 if left adjustment is called for) to make up the field width. 
10114  A period, which separates the field width from the precision. 
10115  A number, the precision, that specifies the maximum number of characters to be 
10116 printed from a string, or the number of digits after the decimal point of a floating-point 
10117 value, or the minimum number of digits for an integer. 
10118  An h if the integer is to be printed as a short, or l (letter ell) if as a long. 
10119 
10120 
10121 Conversion characters are shown in Table 7.1. If the character after the % is not a conversion 
10122 specification, the behavior is undefined. 
10123 
10124 Table 7.1 Basic Printf Conversions 
10125 
10126 Character 
10127 
10128 Argument type; Printed As 
10129 
10130 d,i 
10131 
10132 int; decimal number 
10133 
10134 o 
10135 
10136 int; unsigned octal number (without a leading zero) 
10137 
10138 x,X 
10139 
10140 int; unsigned hexadecimal number (without a leading 0x or 0X), using abcdef or 
10141 ABCDEF for 10, ...,15. 
10142 
10143 u 
10144 
10145 int; unsigned decimal number 
10146 
10147 c 
10148 
10149 int; single character 
10150 
10151 s 
10152 
10153 char *; print characters from the string until a '\0' or the number of characters 
10154 given by the precision. 
10155 
10156 f 
10157 
10158 double; [-]m.dddddd, where the number of d's is given by the precision (default 
10159 6). 
10160 
10161 e,E 
10162 
10163 double; [-]m.dddddde+/-xx or [-]m.ddddddE+/-xx, where the number of d's is 
10164 given by the precision (default 6). 
10165 
10166 g,G 
10167 
10168 double; use %e or %E if the exponent is less than -4 or greater than or equal to the 
10169 precision; otherwise use %f. Trailing zeros and a trailing decimal point are not 
10170 printed. 
10171 
10172 p 
10173 
10174 void *; pointer (implementation-dependent representation). 
10175 
10176 
10177 
10178 
10179 % 
10180 
10181 no argument is converted; print a % 
10182 
10183 
10184 
10185 A width or precision may be specified as *, in which case the value is computed by 
10186 converting the next argument (which must be an int). For example, to print at most max 
10187 characters from a string s, 
10188 
 
 
10193 Most of the format conversions have been illustrated in earlier chapters. One exception is the 
10194 precision as it relates to strings. The following table shows the effect of a variety of 
10195 specifications in printing ``hello, world'' (12 characters). We have put colons around each 
10196 field so you can see it extent. 
10197 
 
 
10202 
10203 
 
 
 
 
 
 
 
10218 A warning: printf uses its first argument to decide how many arguments follow and what 
10219 their type is. It will get confused, and you will get wrong answers, if there are not enough 
10220 arguments of if they are the wrong type. You should also be aware of the difference between 
10221 these two calls: 
10222 
 
 
 
 
10231 Exercise 7-2. Write a program that will print arbitrary input in a sensible way. As a 
10232 minimum, it should print non-graphic characters in octal or hexadecimal according to local 
10233 custom, and break long text lines. 
10234 
10235 7.3 Variable-length Argument Lists 
10236 
10237 The proper declaration for printf is 
10238 
 
10241 where the declaration ... means that the number and types of these arguments may vary. The 
10242 declaration ... can only appear at the end of an argument list. Our minprintf is declared as 
10243 
 
10246 
10247 
 
10250 The function sprintf does the same conversions as printf does, but stores the output in a 
10251 string: 
10252 
10253 sprintf formats the arguments in arg1, arg2, etc., according to format as before, but places 
10254 the result in string instead of the standard output; string must be big enough to receive the 
10255 result. 
10256 
10257 This section contains an implementation of a minimal version of printf, to show how to 
10258 write a function that processes a variable-length argument list in a portable way. Since we are 
10259 mainly interested in the argument processing, minprintf will process the format string and 
10260 arguments but will call the real printf to do the format conversions. 
10261 
 
10264 
10265 since we will not return the character count that printf does. 
10266 
10267 The tricky bit is how minprintf walks along the argument list when the list doesn't even have 
10268 a name. The standard header <stdarg.h> contains a set of macro definitions that define how 
10269 to step through an argument list. The implementation of this header will vary from machine to 
10270 machine, but the interface it presents is uniform. 
10271 
10272 Each call of va_arg returns one argument and steps ap to the next; va_arg uses a type name 
10273 to determine what type to return and how big a step to take. Finally, va_end does whatever 
10274 cleanup is necessary. It must be called before the program returns. 
10275 
10276 These properties form the basis of our simplified printf: 
10277 
 
 
 
 
 
 
 
 
 
 
 
 
 
10304 
10305 
 
10308 The type va_list is used to declare a variable that will refer to each argument in turn; in 
10309 minprintf, this variable is called ap, for ``argument pointer.'' The macro va_start initializes 
10310 ap to point to the first unnamed argument. It must be called once before ap is used. There 
10311 must be at least one named argument; the final named argument is used by va_start to get 
10312 started. 
10313 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
10354 Exercise 7-3. Revise minprintf to handle more of the other facilities of printf. 
10355 
10356 
10357 
 
 
 
 
10366 
10367 7.4 Formatted Input - Scanf 
10368 
10369 The function scanf is the input analog of printf, providing many of the same conversion 
10370 facilities in the opposite direction. 
10371 
 
 
10376 scanf reads characters from the standard input, interprets them according to the specification 
10377 in format, and stores the results through the remaining arguments. The format argument is 
10378 described below; the other arguments, each of which must be a pointer, indicate where the 
10379 corresponding converted input should be stored. As with printf, this section is a summary of 
10380 the most useful features, not an exhaustive list. 
10381 
10382 scanf stops when it exhausts its format string, or when some input fails to match the control 
10383 specification. It returns as its value the number of successfully matched and assigned input 
10384 items. This can be used to decide how many items were found. On the end of file, EOF is 
10385 returned; note that this is different from 0, which means that the next input character does not 
10386 match the first specification in the format string. The next call to scanf resumes searching 
10387 immediately after the last character already converted. 
10388 
10389 There is also a function sscanf that reads from a string instead of the standard input: 
10390 
 
10393 It scans the string according to the format in format and stores the resulting values through 
10394 arg1, arg2, etc. These arguments must be pointers. 
10395 
10396  Blanks or tabs, which are not ignored. 
10397 
10398  Ordinary characters (not %), which are expected to match the next non-white space 
10399 character of the input stream. 
10400 
10401 A conversion specification directs the conversion of the next input field. Normally the result 
10402 is places in the variable pointed to by the corresponding argument. If assignment suppression 
10403 is indicated by the * character, however, the input field is skipped; no assignment is made. An 
10404 input field is defined as a string of non-white space characters; it extends either to the next 
10405 white space character or until the field width, is specified, is exhausted. This implies that 
10406 scanf will read across boundaries to find its input, since newlines are white space. (White 
10407 space characters are blank, tab, newline, carriage return, vertical tab, and formfeed.) 
10408 
10409 
10410 
 
10413 The format string usually contains conversion specifications, which are used to control 
10414 conversion of input. The format string may contain: 
10415 
10416  Conversion specifications, consisting of the character %, an optional assignment 
10417 suppression character *, an optional number specifying a maximum field width, an 
10418 optional h, l or L indicating the width of the target, and a conversion character. 
10419 
10420 
10421 The conversion character indicates the interpretation of the input field. The corresponding 
10422 argument must be a pointer, as required by the call-by-value semantics of C. Conversion 
10423 characters are shown in Table 7.2. 
10424 
10425 Table 7.2: Basic Scanf Conversions 
10426 
10427 Character 
10428 
10429 Input Data; Argument type 
10430 
10431 
10432 
10433 
10434 As a first example, the rudimentary calculator of Chapter 4 can be written with scanf to do 
10435 the input conversion: 
10436 
 
 
 
 
 
 
10449 Suppose we want to read input lines that contain dates of the form 
10450 
 
10453 The scanf statement is 
10454 
 
 
10459 Literal characters can appear in the scanf format string; they must match the same characters 
10460 in the input. So we could read dates of the form mm/dd/yy with the scanf statement: 
10461 
 
 
 
10468 
10469 
10470 d 
10471 
10472 decimal integer; int * 
10473 
10474 i 
10475 
10476 integer; int *. The integer may be in octal (leading 0) or hexadecimal (leading 
10477 0x or 0X). 
10478 
10479 o 
10480 
10481 octal integer (with or without leading zero); int * 
10482 
10483 u 
10484 
10485 unsigned decimal integer; unsigned int * 
10486 
10487 x 
10488 
10489 hexadecimal integer (with or without leading 0x or 0X); int * 
10490 
10491 c 
10492 
10493 characters; char *. The next input characters (default 1) are placed at the 
10494 indicated spot. The normal skip-over white space is suppressed; to read the next 
10495 non-white space character, use %1s 
10496 
10497 s 
10498 
10499 character string (not quoted); char *, pointing to an array of characters long 
10500 enough for the string and a terminating '\0' that will be added. 
10501 
10502 e,f,g 
10503 
10504 floating-point number with optional sign, optional decimal point and optional 
10505 exponent; float * 
10506 
10507 % 
10508 
10509 literal %; no assignment is made. 
10510 
10511 
10512 
10513 The conversion characters d, i, o, u, and x may be preceded by h to indicate that a pointer to 
10514 short rather than int appears in the argument list, or by l (letter ell) to indicate that a pointer 
10515 to long appears in the argument list. 
10516 
 
 
 
 
 
 
 
 
 
 
10537 No & is used with monthname, since an array name is a pointer. 
10538 
 
10541 
10542 scanf ignores blanks and tabs in its format string. Furthermore, it skips over white space 
10543 (blanks, tabs, newlines, etc.) as it looks for input values. To read input whose format is not 
10544 fixed, it is often best to read a line at a time, then pick it apart with scanf. For example, 
10545 suppose we want to read lines that might contain a date in either of the forms above. Then we 
10546 could write 
10547 
 
 
 
 
 
 
 
 
 
10566 Calls to scanf can be mixed with calls to other input functions. The next call to any input 
10567 function will begin by reading the first character not read by scanf. 
10568 
10569 A final warning: the arguments to scanf and sscanf must be pointers. By far the most 
10570 common error is writing 
10571 
 
 
10576 instead of 
10577 
 
 
10582 This error is not generally detected at compile time. 
10583 
10584 Exercise 7-4. Write a private version of scanf analogous to minprintf from the previous 
10585 section. 
10586 
10587 Exercise 5-5. Rewrite the postfix calculator of Chapter 4 to use scanf and/or sscanf to do 
10588 the input and number conversion. 
10589 
10590 7.5 File Access 
10591 
10592 The examples so far have all read the standard input and written the standard output, which 
10593 are automatically defined for a program by the local operating system. 
10594 
10595 The next step is to write a program that accesses a file that is not already connected to the 
10596 program. One program that illustrates the need for such operations is cat, which concatenates 
10597 a set of named files into the standard output. cat is used for printing files on the screen, and 
10598 as a general-purpose input collector for programs that do not have the capability of accessing 
10599 files by name. For example, the command 
10600 
 
 
10605 prints the contents of the files x.c and y.c (and nothing else) on the standard output. 
10606 
10607 The question is how to arrange for the named files to be read - that is, how to connect the 
10608 external names that a user thinks of to the statements that read the data. 
10609 
10610 The rules are simple. Before it can be read or written, a file has to be opened by the library 
10611 function fopen. fopen takes an external name like x.c or y.c, does some housekeeping and 
10612 
10613 
 
 
10618 putc writes the character c to the file fp and returns the character written, or EOF if an error 
10619 occurs. Like getchar and putchar, getc and putc may be macros instead of functions. 
10620 
10621 When a C program is started, the operating system environment is responsible for opening 
10622 three files and providing pointers for them. These files are the standard input, the standard 
10623 output, and the standard error; the corresponding file pointers are called stdin, stdout, and 
10624 stderr, and are declared in <stdio.h>. Normally stdin is connected to the keyboard and 
10625 
10626 negotiation with the operating system (details of which needn't concern us), and returns a 
10627 pointer to be used in subsequent reads or writes of the file. 
10628 
10629 This pointer, called the file pointer, points to a structure that contains information about the 
10630 file, such as the location of a buffer, the current character position in the buffer, whether the 
10631 file is being read or written, and whether errors or end of file have occurred. Users don't need 
10632 to know the details, because the definitions obtained from <stdio.h> include a structure 
10633 declaration called FILE. The only declaration needed for a file pointer is exemplified by 
10634 
 
 
 
10641 This says that fp is a pointer to a FILE, and fopen returns a pointer to a FILE. Notice that 
10642 FILE is a type name, like int, not a structure tag; it is defined with a typedef. (Details of 
10643 how fopen can be implemented on the UNIX system are given in Section 8.5.) 
10644 
10645 The call to fopen in a program is 
10646 
 
 
10651 The first argument of fopen is a character string containing the name of the file. The second 
10652 argument is the mode, also a character string, which indicates how one intends to use the file. 
10653 Allowable modes include read ("r"), write ("w"), and append ("a"). Some systems 
10654 distinguish between text and binary files; for the latter, a "b" must be appended to the mode 
10655 string. 
10656 
10657 If a file that does not exist is opened for writing or appending, it is created if possible. 
10658 Opening an existing file for writing causes the old contents to be discarded, while opening for 
10659 appending preserves them. Trying to read a file that does not exist is an error, and there may 
10660 be other causes of error as well, like trying to read a file when you don't have permission. If 
10661 there is any error, fopen will return NULL. (The error can be identified more precisely; see the 
10662 discussion of error-handling functions at the end of Section 1 in Appendix B.) 
10663 
10664 The next thing needed is a way to read or write the file once it is open. getc returns the next 
10665 character from a file; it needs the file pointer to tell it which file. 
10666 
 
 
10671 getc returns the next character from the stream referred to by fp; it returns EOF for end of file 
10672 or error. 
10673 
10674 putc is an output function: 
10675 
10676 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
10727 The file pointers stdin and stdout are objects of type FILE *. They are constants, however, 
10728 not variables, so it is not possible to assign to them. 
10729 
10730 The function 
10731 
 
 
10736 is the inverse of fopen, it breaks the connection between the file pointer and the external 
10737 name that was established by fopen, freeing the file pointer for another file. Since most 
10738 operating systems have some limit on the number of files that a program may have open 
10739 
10740 Section 7.1stdout and stderr are connected to the screen, but stdin and stdout may be redirected to 
10741 files or pipes as described in . 
10742 
10743 getchar and putchar can be defined in terms of getc, putc, stdin, and stdout as follows: 
10744 
 
 
10749 For formatted input or output of files, the functions fscanf and fprintf may be used. These 
10750 are identical to scanf and printf, except that the first argument is a file pointer that specifies 
10751 the file to be read or written; the format string is the second argument. 
10752 
 
 
 
10759 With these preliminaries out of the way, we are now in a position to write the program cat to 
10760 concatenate files. The design is one that has been found convenient for many programs. If 
10761 there are command-line arguments, they are interpreted as filenames, and processed in order. 
10762 If there are no arguments, the standard input is processed. 
10763 
 
 
 
 
 
 
 
10778 
10779 simultaneously, it's a good idea to free the file pointers when they are no longer needed, as we 
10780 did in cat. There is also another reason for fclose on an output file - it flushes the buffer in 
10781 which putc is collecting output. fclose is called automatically for each open file when a 
10782 program terminates normally. (You can close stdin and stdout if they are not needed. They 
10783 can also be reassigned by the library function freopen.) 
10784 
10785 The treatment of errors in cat is not ideal. The trouble is that if one of the files can't be 
10786 accessed for some reason, the diagnostic is printed at the end of the concatenated output. That 
10787 might be acceptable if the output is going to a screen, but not if it's going into a file or into 
10788 another program via a pipeline. 
10789 
10790 To handle this situation better, a second output stream, called stderr, is assigned to a 
10791 program in the same way that stdin and stdout are. Output written on stderr normally 
10792 appears on the screen even if the standard output is redirected. 
10793 
10794 Let us revise cat to write its error messages on the standard error. 
10795 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
10852 The program signals errors in two ways. First, the diagnostic output produced by fprintf 
10853 goes to stderr, so it finds its way to the screen instead of disappearing down a pipeline or 
10854 into an output file. We included the program name, from argv[0], in the message, so if this 
10855 program is used with others, the source of an error is identified. 
10856 
10857 Second, the program uses the standard library function exit, which terminates program 
10858 execution when it is called. The argument of exit is available to whatever process called this 
10859 one, so the success or failure of the program can be tested by another program that uses this 
10860 one as a sub-process. Conventionally, a return value of 0 signals that all is well; non-zero 
10861 
10862 
10863 values usually signal abnormal situations. exit calls fclose for each open output file, to 
10864 flush out any buffered output. 
10865 
10866 Within main, return expr is equivalent to exit(expr). exit has the advantage that it can be 
10867 called from other functions, and that calls to it can be found with a pattern-searching program 
10868 like those in Chapter 5. 
10869 
10870 The function ferror returns non-zero if an error occurred on the stream fp. 
10871 
 
 
10876 Although output errors are rare, they do occur (for example, if a disk fills up), so a production 
10877 program should check this as well. 
10878 
10879 The function feof(FILE *) is analogous to ferror; it returns non-zero if end of file has 
10880 occurred on the specified file. 
10881 
 
 
10886 We have generally not worried about exit status in our small illustrative programs, but any 
10887 serious program should take care to return sensible, useful status values. 
10888 
10889 7.7 Line Input and Output 
10890 
10891 The standard library provides an input and output routine fgets that is similar to the getline 
10892 function that we have used in earlier chapters: 
10893 
 
 
10898 fgets reads the next input line (including the newline) from file fp into the character array 
10899 line; at most maxline-1 characters will be read. The resulting line is terminated with '\0'. 
10900 Normally fgets returns line; on end of file or error it returns NULL. (Our getline returns the 
10901 line length, which is a more useful value; zero means end of file.) 
10902 
10903 For output, the function fputs writes a string (which need not contain a newline) to a file: 
10904 
 
 
10909 It returns EOF if an error occurs, and non-negative otherwise. 
10910 
10911 The library functions gets and puts are similar to fgets and fputs, but operate on stdin 
10912 and stdout. Confusingly, gets deletes the terminating '\n', and puts adds it. 
10913 
10914 To show that there is nothing special about functions like fgets and fputs, here they are, 
10915 copied from the standard library on our system: 
10916 
 
 
 
 
 
 
 
 
 
10935 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
10966 For no obvious reason, the standard specifies different return values for ferror and fputs. 
10967 
10968 It is easy to implement our getline from fgets: 
10969 
 
 
 
 
 
 
 
 
 
10988 Exercise 7-6. Write a program to compare two files, printing the first line where they differ. 
10989 
10990 Exercise 7-7. Modify the pattern finding program of Chapter 5 to take its input from a set of 
10991 named files or, if no files are named as arguments, from the standard input. Should the file 
10992 name be printed when a matching line is found? 
10993 
10994 Exercise 7-8. Write a program to print a set of files, starting each new one on a new page, 
10995 with a title and a running page count for each file. 
10996 
10997 7.8 Miscellaneous Functions 
10998 
10999 The standard library provides a wide variety of functions. This section is a brief synopsis of 
11000 the most useful. More details and many other functions can be found in Appendix B. 
11001 
11002 7.8.1 String Operations 
11003 
11004 We have already mentioned the string functions strlen, strcpy, strcat, and strcmp, found 
11005 in <string.h>. In the following, s and t are char *'s, and c and n are ints. 
11006 
11007 strcat(s,t) 
11008 
11009 concatenate t to end of s 
11010 
11011 strncat(s,t,n) 
11012 
11013 concatenate n characters of t to end of s 
11014 
11015 strcmp(s,t) 
11016 
11017 return negative, zero, or positive for s < t, s == t, s > t 
11018 
11019 strncmp(s,t,n) 
11020 
11021 same as strcmp but only in first n characters 
11022 
11023 strcpy(s,t) 
11024 
11025 copy t to s 
11026 
11027 strncpy(s,t,n) 
11028 
11029 copy at most n characters of t to s 
11030 
11031 strlen(s) 
11032 
11033 return length of s 
11034 
11035 
11036 
11037 
11038 strchr(s,c) 
11039 
11040 return pointer to first c in s, or NULL if not present 
11041 
11042 strrchr(s,c) 
11043 
11044 return pointer to last c in s, or NULL if not present 
11045 
11046 
11047 
11048 7.8.2 Character Class Testing and Conversion 
11049 
11050 Several functions from <ctype.h> perform character tests and conversions. In the following, 
11051 c is an int that can be represented as an unsigned char or EOF. The function returns int. 
11052 
11053 isalpha(c) 
11054 
11055 non-zero if c is alphabetic, 0 if not 
11056 
11057 isupper(c) 
11058 
11059 non-zero if c is upper case, 0 if not 
11060 
11061 islower(c) 
11062 
11063 non-zero if c is lower case, 0 if not 
11064 
11065 isdigit(c) 
11066 
11067 non-zero if c is digit, 0 if not 
11068 
11069 isalnum(c) 
11070 
11071 non-zero if isalpha(c) or isdigit(c), 0 if not 
11072 
11073 isspace(c) 
11074 
11075 non-zero if c is blank, tab, newline, return, formfeed, vertical tab 
11076 
11077 toupper(c) 
11078 
11079 return c converted to upper case 
11080 
11081 tolower(c) 
11082 
11083 return c converted to lower case 
11084 
11085 
11086 
11087 7.8.3 Ungetc 
11088 
11089 The standard library provides a rather restricted version of the function ungetch that we 
11090 wrote in Chapter 4; it is called ungetc. 
11091 
 
 
11096 pushes the character c back onto file fp, and returns either c, or EOF for an error. Only one 
11097 character of pushback is guaranteed per file. ungetc may be used with any of the input 
11098 functions like scanf, getc, or getchar. 
11099 
11100 7.8.4 Command Execution 
11101 
11102 The function system(char *s) executes the command contained in the character string s, 
11103 then resumes execution of the current program. The contents of s depend strongly on the local 
11104 operating system. As a trivial example, on UNIX systems, the statement 
11105 
 
 
11110 causes the program date to be run; it prints the date and time of day on the standard output. 
11111 system returns a system-dependent integer status from the command executed. In the UNIX 
11112 system, the status return is the value returned by exit. 
11113 
11114 7.8.5 Storage Management 
11115 
11116 The functions malloc and calloc obtain blocks of memory dynamically. 
11117 
 
 
11122 returns a pointer to n bytes of uninitialized storage, or NULL if the request cannot be satisfied. 
11123 
 
 
11128 returns a pointer to enough free space for an array of n objects of the specified size, or NULL if 
11129 the request cannot be satisfied. The storage is initialized to zero. 
11130 
11131 
11132 The pointer returned by malloc or calloc has the proper alignment for the object in question, 
11133 but it must be cast into the appropriate type, as in 
11134 
 
 
 
 
11143 free(p) frees the space pointed to by p, where p was originally obtained by a call to malloc 
11144 or calloc. There are no restrictions on the order in which space is freed, but it is a ghastly 
11145 error to free something not obtained by calling malloc or calloc. 
11146 
11147 It is also an error to use something after it has been freed. A typical but incorrect piece of 
11148 code is this loop that frees items from a list: 
11149 
 
 
 
11156 The right way is to save whatever is needed before freeing: 
11157 
 
 
 
 
 
11168 Section 8.7 shows the implementation of a storage allocator like malloc, in which allocated 
11169 blocks may be freed in any order. 
11170 
11171 7.8.6 Mathematical Functions 
11172 
11173 There are more than twenty mathematical functions declared in <math.h>; here are some of 
11174 the more frequently used. Each takes one or two double arguments and returns a double. 
11175 
11176 sin(x) 
11177 
11178 sine of x, x in radians 
11179 
11180 cos(x) 
11181 
11182 cosine of x, x in radians 
11183 
11184 atan2(y,x) 
11185 
11186 arctangent of y/x, in radians 
11187 
11188 exp(x) 
11189 
11190 exponential function ex 
11191 
11192 log(x) 
11193 
11194 natural (base e) logarithm of x (x>0) 
11195 
11196 log10(x) 
11197 
11198 common (base 10) logarithm of x (x>0) 
11199 
11200 pow(x,y) 
11201 
11202 xy 
11203 
11204 sqrt(x) 
11205 
11206 square root of x (x>0) 
11207 
11208 fabs(x) 
11209 
11210 absolute value of x 
11211 
11212 
11213 
11214 7.8.7 Random Number generation 
11215 
11216 The function rand() computes a sequence of pseudo-random integers in the range zero to 
11217 RAND_MAX, which is defined in <stdlib.h>. One way to produce random floating-point 
11218 numbers greater than or equal to zero but less than one is 
11219 
 
 
11224 (If your library already provides a function for floating-point random numbers, it is likely to 
11225 have better statistical properties than this one.) 
11226 
11227 
11228 The function srand(unsigned) sets the seed for rand. The portable implementation of rand 
11229 and srand suggested by the standard appears in Section 2.7. 
11230 
11231 Exercise 7-9. Functions like isupper can be implemented to save space or to save time. 
11232 Explore both possibilities. 
11233 
11234 
 
11237 Chapter 8 - The UNIX System Interface 
11238 
11239 The UNIX operating system provides its services through a set of system calls, which are in 
11240 effect functions within the operating system that may be called by user programs. This 
11241 chapter describes how to use some of the most important system calls from C programs. If 
11242 you use UNIX, this should be directly helpful, for it is sometimes necessary to employ system 
11243 calls for maximum efficiency, or to access some facility that is not in the library. Even if you 
11244 use C on a different operating system, however, you should be able to glean insight into C 
11245 programming from studying these examples; although details vary, similar code will be found 
11246 on any system. Since the ANSI C library is in many cases modeled on UNIX facilities, this 
11247 code may help your understanding of the library as well. 
11248 
11249 This chapter is divided into three major parts: input/output, file system, and storage allocation. 
11250 The first two parts assume a modest familiarity with the external characteristics of UNIX 
11251 systems. 
11252 
11253 Chapter 7 was concerned with an input/output interface that is uniform across operating 
11254 systems. On any particular system the routines of the standard library have to be written in 
11255 terms of the facilities provided by the host system. In the next few sections we will describe 
11256 the UNIX system calls for input and output, and show how parts of the standard library can be 
11257 implemented with them. 
11258 
11259 8.1 File Descriptors 
11260 
11261 In the UNIX operating system, all input and output is done by reading or writing files, 
11262 because all peripheral devices, even keyboard and screen, are files in the file system. This 
11263 means that a single homogeneous interface handles all communication between a program 
11264 and peripheral devices. 
11265 
11266 In the most general case, before you read and write a file, you must inform the system of your 
11267 intent to do so, a process called opening the file. If you are going to write on a file it may also 
11268 be necessary to create it or to discard its previous contents. The system checks your right to 
11269 do so (Does the file exist? Do you have permission to access it?) and if all is well, returns to 
11270 the program a small non-negative integer called a file descriptor. Whenever input or output is 
11271 to be done on the file, the file descriptor is used instead of the name to identify the file. (A file 
11272 descriptor is analogous to the file pointer used by the standard library, or to the file handle of 
11273 MS-DOS.) All information about an open file is maintained by the system; the user program 
11274 refers to the file only by the file descriptor. 
11275 
11276 Since input and output involving keyboard and screen is so common, special arrangements 
11277 exist to make this convenient. When the command interpreter (the ``shell'') runs a program, 
11278 three files are open, with file descriptors 0, 1, and 2, called the standard input, the standard 
11279 output, and the standard error. If a program reads 0 and writes 1 and 2, it can do input and 
11280 output without worrying about opening files. 
11281 
11282 The user of a program can redirect I/O to and from files with < and >: 
11283 
 
 
11288 
11289 In this case, the shell changes the default assignments for the file descriptors 0 and 1 to the 
11290 named files. Normally file descriptor 2 remains attached to the screen, so error messages can 
11291 go there. Similar observations hold for input or output associated with a pipe. In all cases, the 
11292 file assignments are changed by the shell, not by the program. The program does not know 
11293 where its input comes from nor where its output goes, so long as it uses file 0 for input and 1 
11294 and 2 for output. 
11295 
11296 8.2 Low Level I/O - Read and Write 
11297 
11298 Input and output uses the read and write system calls, which are accessed from C programs 
11299 through two functions called read and write. For both, the first argument is a file descriptor. 
11300 The second argument is a character array in your program where the data is to go to or to 
11301 come from. The third argument is the number is the number of bytes to be transferred. 
11302 
 
 
 
11309 Each call returns a count of the number of bytes transferred. On reading, the number of bytes 
11310 returned may be less than the number requested. A return value of zero bytes implies end of 
11311 file, and -1 indicates an error of some sort. For writing, the return value is the number of 
11312 bytes written; an error has occurred if this isn't equal to the number requested. 
11313 
11314 Any number of bytes can be read or written in one call. The most common values are 1, 
11315 which means one character at a time (``unbuffered''), and a number like 1024 or 4096 that 
11316 corresponds to a physical block size on a peripheral device. Larger sizes will be more efficient 
11317 because fewer system calls will be made. 
11318 
11319 Putting these facts together, we can write a simple program to copy its input to its output, the 
11320 equivalent of the file copying program written for Chapter 1. This program will copy anything 
11321 to anything, since the input and output can be redirected to any file or device. 
11322 
 
 
 
 
 
 
 
 
 
 
 
 
11347 We have collected function prototypes for the system calls into a file called syscalls.h so 
11348 we can include it in the programs of this chapter. This name is not standard, however. 
11349 
11350 The parameter BUFSIZ is also defined in syscalls.h; its value is a good size for the local 
11351 system. If the file size is not a multiple of BUFSIZ, some read will return a smaller number of 
11352 bytes to be written by write; the next call to read after that will return zero. 
11353 
11354 It is instructive to see how read and write can be used to construct higher-level routines like 
11355 getchar, putchar, etc. For example, here is a version of getchar that does unbuffered input, 
11356 by reading the standard input one character at a time. 
11357 
 
11360 
 
 
 
 
 
 
 
 
 
11379 c must be a char, because read needs a character pointer. Casting c to unsigned char in the 
11380 return statement eliminates any problem of sign extension. 
11381 
11382 The second version of getchar does input in big chunks, and hands out the characters one at 
11383 a time. 
11384 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
11417 If these versions of getchar were to be compiled with <stdio.h> included, it would be 
11418 necessary to #undef the name getchar in case it is implemented as a macro. 
11419 
11420 8.3 Open, Creat, Close, Unlink 
11421 
11422 Other than the default standard input, output and error, you must explicitly open files in order 
11423 to read or write them. There are two system calls for this, open and creat [sic]. 
11424 
11425 open is rather like the fopen discussed in Chapter 7, except that instead of returning a file 
11426 pointer, it returns a file descriptor, which is just an int. open returns -1 if any error occurs. 
11427 
 
 
 
 
 
 
 
11442 As with fopen, the name argument is a character string containing the filename. The second 
11443 argument, flags, is an int that specifies how the file is to be opened; the main values are 
11444 
11445 O_RDONLY 
11446 
11447 open for reading only 
11448 
11449 O_WRONLY 
11450 
11451 open for writing only 
11452 
11453 O_RDWR 
11454 
11455 open for both reading and writing
11456 
11457 
11458 
11459 
11460 These constants are defined in <fcntl.h> on System V UNIX systems, and in <sys/file.h> 
11461 on Berkeley (BSD) versions. 
11462 
11463 To open an existing file for reading, 
11464 
 
 
11469 The perms argument is always zero for the uses of open that we will discuss. 
11470 
11471 It is an error to try to open a file that does not exist. The system call creat is provided to 
11472 create new files, or to re-write old ones. 
11473 
 
 
 
 
11482 returns a file descriptor if it was able to create the file, and -1 if not. If the file already exists, 
11483 creat will truncate it to zero length, thereby discarding its previous contents; it is not an error 
11484 to creat a file that already exists. 
11485 
11486 If the file does not already exist, creat creates it with the permissions specified by the perms 
11487 argument. In the UNIX file system, there are nine bits of permission information associated 
11488 with a file that control read, write and execute access for the owner of the file, for the owner's 
11489 group, and for all others. Thus a three-digit octal number is convenient for specifying the 
11490 permissions. For example, 0775 specifies read, write and execute permission for the owner, 
11491 and read and execute permission for the group and everyone else. 
11492 
11493 To illustrate, here is a simplified version of the UNIX program cp, which copies one file to 
11494 another. Our version copies only one file, it does not permit the second argument to be a 
11495 directory, and it invents permissions instead of copying them. 
11496 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
11549 
11550 This program creates the output file with fixed permissions of 0666. With the stat system 
11551 call, described in Section 8.6, we can determine the mode of an existing file and thus give the 
11552 same mode to the copy. 
11553 
11554 Notice that the function error is called with variable argument lists much like printf. The 
11555 implementation of error illustrates how to use another member of the printf family. The 
11556 standard library function vprintf is like printf except that the variable argument list is 
11557 replaced by a single argument that has been initialized by calling the va_start macro. 
11558 Similarly, vfprintf and vsprintf match fprintf and sprintf. 
11559 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
11592 There is a limit (often about 20) on the number of files that a program may open 
11593 simultaneously. Accordingly, any program that intends to process many files must be 
11594 prepared to re-use file descriptors. The function close(int fd) breaks the connection 
11595 between a file descriptor and an open file, and frees the file descriptor for use with some other 
11596 file; it corresponds to fclose in the standard library except that there is no buffer to flush. 
11597 Termination of a program via exit or return from the main program closes all open files. 
11598 
11599 The function unlink(char *name) removes the file name from the file system. It 
11600 corresponds to the standard library function remove. 
11601 
11602 Exercise 8-1. Rewrite the program cat from Chapter 7 using read, write, open, and close 
11603 instead of their standard library equivalents. Perform experiments to determine the relative 
11604 speeds of the two versions. 
11605 
11606 8.4 Random Access - Lseek 
11607 
11608 Input and output are normally sequential: each read or write takes place at a position in the 
11609 file right after the previous one. When necessary, however, a file can be read or written in any 
11610 arbitrary order. The system call lseek provides a way to move around in a file without 
11611 reading or writing any data: 
11612 
 
 
11617 sets the current position in the file whose descriptor is fd to offset, which is taken relative to 
11618 the location specified by origin. Subsequent reading or writing will begin at that position. 
11619 origin can be 0, 1, or 2 to specify that offset is to be measured from the beginning, from 
11620 the current position, or from the end of the file respectively. For example, to append to a file 
11621 (the redirection >> in the UNIX shell, or "a" for fopen), seek to the end before writing: 
11622 
 
 
11627 
11628 To get back to the beginning (``rewind''), 
11629 
 
 
11634 Notice the 0L argument; it could also be written as (long) 0 or just as 0 if lseek is properly 
11635 declared. 
11636 
11637 With lseek, it is possible to treat files more or less like arrays, at the price of slower access. 
11638 For example, the following function reads any number of bytes from any arbitrary place in a 
11639 file. It returns the number read, or -1 on error. 
11640 
 
 
 
 
 
 
 
 
 
 
 
11663 The return value from lseek is a long that gives the new position in the file, or -1 if an error 
11664 occurs. The standard library function fseek is similar to lseek except that the first argument 
11665 is a FILE * and the return is non-zero if an error occurred. 
11666 
11667 8.5 Example - An implementation of Fopen and Getc 
11668 
11669 Let us illustrate how some of these pieces fit together by showing an implementation of the 
11670 standard library routines fopen and getc. 
11671 
11672 Recall that files in the standard library are described by file pointers rather than file 
11673 descriptors. A file pointer is a pointer to a structure that contains several pieces of information 
11674 about the file: a pointer to a buffer, so the file can be read in large chunks; a count of the 
11675 number of characters left in the buffer; a pointer to the next character position in the buffer; 
11676 the file descriptor; and flags describing read/write mode, error status, etc. 
11677 
11678 The data structure that describes a file is contained in <stdio.h>, which must be included (by 
11679 #include) in any source file that uses routines from the standard input/output library. It is 
11680 also included by functions in that library. In the following excerpt from a typical <stdio.h>, 
11681 names that are intended for use only by functions of the library begin with an underscore so 
11682 they are less likely to collide with names in a user's program. This convention is used by all 
11683 standard library routines. 
11684 
 
 
 
 
 
 
 
 
 
 
 
 
 
11711 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
11768 The getc macro normally decrements the count, advances the pointer, and returns the 
11769 character. (Recall that a long #define is continued with a backslash.) If the count goes 
11770 negative, however, getc calls the function _fillbuf to replenish the buffer, re-initialize the 
11771 structure contents, and return a character. The characters are returned unsigned, which 
11772 ensures that all characters will be positive. 
11773 
11774 Although we will not discuss any details, we have included the definition of putc to show 
11775 that it operates in much the same way as getc, calling a function _flushbuf when its buffer 
11776 is full. We have also included macros for accessing the error and end-of-file status and the file 
11777 descriptor. 
11778 
11779 The function fopen can now be written. Most of fopen is concerned with getting the file 
11780 opened and positioned at the right place, and setting the flag bits to indicate the proper state. 
11781 fopen does not allocate any buffer space; this is done by _fillbuf when the file is first read. 
11782 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
11817 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
11852 This version of fopen does not handle all of the access mode possibilities of the standard, 
11853 though adding them would not take much code. In particular, our fopen does not recognize 
11854 the ``b'' that signals binary access, since that is meaningless on UNIX systems, nor the ``+'' 
11855 that permits both reading and writing. 
11856 
11857 The first call to getc for a particular file finds a count of zero, which forces a call of 
11858 _fillbuf. If _fillbuf finds that the file is not open for reading, it returns EOF immediately. 
11859 Otherwise, it tries to allocate a buffer (if reading is to be buffered). 
11860 
11861 Once the buffer is established, _fillbuf calls read to fill it, sets the count and pointers, and 
11862 returns the character at the beginning of the buffer. Subsequent calls to _fillbuf will find a 
11863 buffer allocated. 
11864 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
11917 The only remaining loose end is how everything gets started. The array _iob must be defined 
11918 and initialized for stdin, stdout and stderr: 
11919 
 
 
11924 
 
 
 
 
11933 The initialization of the flag part of the structure shows that stdin is to be read, stdout is to 
11934 be written, and stderr is to be written unbuffered. 
11935 
11936 Exercise 8-2. Rewrite fopen and _fillbuf with fields instead of explicit bit operations. 
11937 Compare code size and execution speed. 
11938 
11939 Exercise 8-3. Design and write _flushbuf, fflush, and fclose. 
11940 
11941 Exercise 8-4. The standard library function 
11942 
 
 
11947 is identical to lseek except that fp is a file pointer instead of a file descriptor and return value 
11948 is an int status, not a position. Write fseek. Make sure that your fseek coordinates properly 
11949 with the buffering done for the other functions of the library. 
11950 
11951 8.6 Example - Listing Directories 
11952 
11953 A different kind of file system interaction is sometimes called for - determining information 
11954 about a file, not what it contains. A directory-listing program such as the UNIX command ls 
11955 is an example - it prints the names of files in a directory, and, optionally, other information, 
11956 such as sizes, permissions, and so on. The MS-DOS dir command is analogous. 
11957 
11958 Since a UNIX directory is just a file, ls need only read it to retrieve the filenames. But is is 
11959 necessary to use a system call to access other information about a file, such as its size. On 
11960 other systems, a system call may be needed even to access filenames; this is the case on MS-
11961 DOS for instance. What we want is provide access to the information in a relatively system-
11962 independent way, even though the implementation may be highly system-dependent. 
11963 
11964 We will illustrate some of this by writing a program called fsize. fsize is a special form of 
11965 ls that prints the sizes of all files named in its commandline argument list. If one of the files 
11966 is a directory, fsize applies itself recursively to that directory. If there are no arguments at 
11967 all, it processes the current directory. 
11968 
11969 Let us begin with a short review of UNIX file system structure. A directory is a file that 
11970 contains a list of filenames and some indication of where they are located. The ``location'' is 
11971 an index into another table called the ``inode list.'' The inode for a file is where all 
11972 information about the file except its name is kept. A directory entry generally consists of only 
11973 two items, the filename and an inode number. 
11974 
11975 Regrettably, the format and precise contents of a directory are not the same on all versions of 
11976 the system. So we will divide the task into two pieces to try to isolate the non-portable parts. 
11977 The outer level defines a structure called a Dirent and three routines opendir, readdir, and 
11978 closedir to provide system-independent access to the name and inode number in a directory 
11979 entry. We will write fsize with this interface. Then we will show how to implement these on 
11980 systems that use the same directory structure as Version 7 and System V UNIX; variants are 
11981 left as exercises. 
11982 
11983 
11984 The Dirent structure contains the inode number and the name. The maximum length of a 
11985 filename component is NAME_MAX, which is a system-dependent value. opendir returns a 
11986 pointer to a structure called DIR, analogous to FILE, which is used by readdir and closedir. 
11987 This information is collected into a file called dirent.h. 
11988 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
12023 The system call stat takes a filename and returns all of the information in the inode for that 
12024 file, or -1 if there is an error. That is, 
12025 
 
 
 
 
 
 
12038 fills the structure stbuf with the inode information for the file name. The structure describing 
12039 the value returned by stat is in <sys/stat.h>, and typically looks like this: 
12040 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
12071 Most of these values are explained by the comment fields. The types like dev_t and ino_t 
12072 are defined in <sys/types.h>, which must be included too. 
12073 
12074 The st_mode entry contains a set of flags describing the file. The flag definitions are also 
12075 included in <sys/types.h>; we need only the part that deals with file type: 
12076 
 
 
 
 
 
 
 
12091 
12092 Now we are ready to write the program fsize. If the mode obtained from stat indicates that 
12093 a file is not a directory, then the size is at hand and can be printed directly. If the name is a 
12094 directory, however, then we have to process that directory one file at a time; it may in turn 
12095 contain sub-directories, so the process is recursive. 
12096 
12097 The main routine deals with command-line arguments; it hands each argument to the function 
12098 fsize. 
12099 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
12142 The function fsize prints the size of the file. If the file is a directory, however, fsize first 
12143 calls dirwalk to handle all the files in it. Note how the flag names S_IFMT and S_IFDIR are 
12144 used to decide if the file is a directory. Parenthesization matters, because the precedence of & 
12145 is lower than that of ==. 
12146 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
12179 The function dirwalk is a general routine that applies a function to each file in a directory. It 
12180 opens the directory, loops through the files in it, calling the function on each, then closes the 
12181 directory and returns. Since fsize calls dirwalk on each directory, the two functions call 
12182 each other recursively. 
12183 
 
 
 
 
 
12194 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
12237 Each call to readdir returns a pointer to information for the next file, or NULL when there are 
12238 no files left. Each directory always contains entries for itself, called ".", and its parent, ".."; 
12239 these must be skipped, or the program will loop forever. 
12240 
12241 Down to this last level, the code is independent of how directories are formatted. The next 
12242 step is to present minimal versions of opendir, readdir, and closedir for a specific system. 
12243 The following routines are for Version 7 and System V UNIX systems; they use the directory 
12244 information in the header <sys/dir.h>, which looks like this: 
12245 
 
 
 
 
 
 
 
12260 Some versions of the system permit much longer names and have a more complicated 
12261 directory structure. 
12262 
12263 The type ino_t is a typedef that describes the index into the inode list. It happens to be 
12264 unsigned short on the systems we use regularly, but this is not the sort of information to 
12265 embed in a program; it might be different on a different system, so the typedef is better. A 
12266 complete set of ``system'' types is found in <sys/types.h>. 
12267 
12268 opendir opens the directory, verifies that the file is a directory (this time by the system call 
12269 fstat, which is like stat except that it applies to a file descriptor), allocates a directory 
12270 structure, and records the information: 
12271 
 
 
 
 
 
 
 
 
12288 
 
 || fstat(fd, &stbuf) == -1 
12293 || (stbuf.st_mode & S_IFMT) != S_IFDIR 
12294 || (dp = (DIR *) malloc(sizeof(DIR))) == NULL) 
12295 
 dp->fd = fd; 
12298 return dp; 
12299 
 closedir closes the directory file and frees the space: 
12302 
 void closedir(DIR *dp) 
12305 { 
12306 
 close(dp->fd); 
12309 free(dp); 
12310 
 } 
12313 Finally, readdir uses read to read each directory entry. If a directory slot is not currently in 
12314 use (because a file has been removed), the inode number is zero, and this position is skipped. 
12315 Otherwise, the inode number and name are placed in a static structure and a pointer to that 
12316 is returned to the user. Each call overwrites the information from the previous one. 
12317 
 
 Dirent *readdir(DIR *dp) 
12322 { 
12323 
 static Dirent d; /* return: portable structure */ 
12326 
 == sizeof(dirbuf)) { 
12329 if (dirbuf.d_ino == 0) /* slot not in use */ 
12330 
 d.ino = dirbuf.d_ino; 
12333 strncpy(d.name, dirbuf.d_name, DIRSIZ); 
12334 d.name[DIRSIZ] = '\0'; /* ensure termination */ 
12335 return &d; 
12336 
 return NULL; 
12339 } 
12340 Although the fsize program is rather specialized, it does illustrate a couple of important 
12341 ideas. First, many programs are not ``system programs''; they merely use information that is 
12342 maintained by the operating system. For such programs, it is crucial that the representation ofthe information appear only in standard headers, and that programs include those headers 
12343 instead of embedding the declarations in themselves. The second observation is that with care 
12344 it is possible to create an interface to system-dependent objects that is itself relatively system-
12345 independent. The functions of the standard library are good examples. 
12346 
12347 Exercise 8-5. Modify the fsize program to print the other information contained in the inode 
12348 entry. 
12349 
12350 8.7 Example - A Storage Allocator 
12351 In Chapter 5, we presented a vary limited stack-oriented storage allocator. The version that we 
12352 will now write is unrestricted. Calls to malloc and free may occur in any order; malloc calls 
12353 
12354 
12355 Rather than allocating from a compiled-in fixed-size array, malloc will request space from 
12356 the operating system as needed. Since other activities in the program may also request space 
12357 without calling this allocator, the space that malloc manages may not be contiguous. Thus its 
12358 free storage is kept as a list of free blocks. Each block contains a size, a pointer to the next 
12359 block, and the space itself. The blocks are kept in order of increasing storage address, and the 
12360 last block (highest address) points to the first. 
12361 
 
12364 When a request is made, the free list is scanned until a big-enough block is found. This 
12365 algorithm is called ``first fit,'' by contrast with ``best fit,'' which looks for the smallest block 
12366 that will satisfy the request. If the block is exactly the size requested it is unlinked from the 
12367 list and returned to the user. If the block is too big, it is split, and the proper amount is 
12368 returned to the user while the residue remains on the free list. If no big-enough block is found, 
12369 another large chunk is obtained by the operating system and linked into the free list. 
12370 
12371 Freeing also causes a search of the free list, to find the proper place to insert the block being 
12372 freed. If the block being freed is adjacent to a free block on either side, it is coalesced with it 
12373 into a single bigger block, so storage does not become too fragmented. Determining the 
12374 adjacency is easy because the free list is maintained in order of decreasing address. 
12375 
12376 One problem, which we alluded to in Chapter 5, is to ensure that the storage returned by 
12377 malloc is aligned properly for the objects that will be stored in it. Although machines vary, 
12378 for each machine there is a most restrictive type: if the most restrictive type can be stored at a 
12379 particular address, all other types may be also. On some machines, the most restrictive type is 
12380 a double; on others, int or long suffices. 
12381 
12382 A free block contains a pointer to the next block in the chain, a record of the size of the block, 
12383 and then the free space itself; the control information at the beginning is called the ``header.'' 
12384 To simplify alignment, all blocks are multiples of the header size, and the header is aligned 
12385 properly. This is achieved by a union that contains the desired header structure and an 
12386 instance of the most restrictive alignment type, which we have arbitrarily made a long: 
12387 
 
 
 
 
12396 
 
 
 
 
 
 
 
 
12413 The Align field is never used; it just forces each header to be aligned on a worst-case 
12414 boundary. 
12415 
12416 In malloc, the requested size in characters is rounded up to the proper number of header-sized 
12417 units; the block that will be allocated contains one more unit, for the header itself, and this is 
12418 the value recorded in the size field of the header. The pointer returned by malloc points at 
12419 the free space, not at the header itself. The user can do anything with the space requested, but 
12420 if anything is written outside of the allocated space the list is likely to be scrambled. 
12421 
 
12424 The size field is necessary because the blocks controlled by malloc need not be contiguous - 
12425 it is not possible to compute sizes by pointer arithmetic. 
12426 
12427 The variable base is used to get started. If freep is NULL, as it is at the first call of malloc, 
12428 then a degenerate free list is created; it contains one block of size zero, and points to itself. In 
12429 any case, the free list is then searched. The search for a free block of adequate size begins at 
12430 the point (freep) where the last block was found; this strategy helps keep the list 
12431 homogeneous. If a too-big block is found, the tail end is returned to the user; in this way the 
12432 header of the original needs only to have its size adjusted. In all cases, the pointer returned to 
12433 the user points to the free space within the block, which begins one unit beyond the header. 
12434 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
12467 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
12502 The function morecore obtains storage from the operating system. The details of how it does 
12503 this vary from system to system. Since asking the system for memory is a comparatively 
12504 expensive operation. we don't want to do that on every call to malloc, so morecore requests 
12505 al least NALLOC units; this larger block will be chopped up as needed. After setting the size 
12506 field, morecore inserts the additional memory into the arena by calling free. 
12507 
12508 The UNIX system call sbrk(n) returns a pointer to n more bytes of storage. sbrk returns -1 
12509 if there was no space, even though NULL could have been a better design. The -1 must be cast 
12510 to char * so it can be compared with the return value. Again, casts make the function 
12511 relatively immune to the details of pointer representation on different machines. There is still 
12512 one assumption, however, that pointers to different blocks returned by sbrk can be 
12513 meaningfully compared. This is not guaranteed by the standard, which permits pointer 
12514 comparisons only within an array. Thus this version of malloc is portable only among 
12515 machines for which general pointer comparison is meaningful. 
12516 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
12549 free itself is the last thing. It scans the free list, starting at freep, looking for the place to 
12550 insert the free block. This is either between two existing blocks or at the end of the list. In any 
12551 case, if the block being freed is adjacent to either neighbor, the adjacent blocks are combined. 
12552 The only troubles are keeping the pointers pointing to the right things and the sizes correct. 
12553 
 
 
 
 
12562 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
12601 Although storage allocation is intrinsically machine-dependent, the code above illustrates how 
12602 the machine dependencies can be controlled and confined to a very small part of the program. 
12603 The use of typedef and union handles alignment (given that sbrk supplies an appropriate 
12604 pointer). Casts arrange that pointer conversions are made explicit, and even cope with a 
12605 badly-designed system interface. Even though the details here are related to storage 
12606 allocation, the general approach is applicable to other situations as well. 
12607 
12608 Exercise 8-6. The standard library function calloc(n,size) returns a pointer to n objects of 
12609 size size, with the storage initialized to zero. Write calloc, by calling malloc or by 
12610 modifying it. 
12611 
12612 Exercise 8-7. malloc accepts a size request without checking its plausibility; free believes 
12613 that the block it is asked to free contains a valid size field. Improve these routines so they 
12614 make more pains with error checking. 
12615 
12616 Exercise 8-8. Write a routine bfree(p,n) that will free any arbitrary block p of n characters 
12617 into the free list maintained by malloc and free. By using bfree, a user can add a static or 
12618 external array to the free list at any time. 
12619 
12620 
 
12623 Appendix A - Reference Manual 
12624 
12625 A.1 Introduction 
12626 
12627 This manual describes the C language specified by the draft submitted to ANSI on 31 
12628 October, 1988, for approval as ``American Standard for Information Systems - programming 
12629 Language C, X3.159-1989.'' The manual is an interpretation of the proposed standard, not the 
12630 standard itself, although care has been taken to make it a reliable guide to the language. 
12631 
12632 For the most part, this document follows the broad outline of the standard, which in turn 
12633 follows that of the first edition of this book, although the organization differs in detail. Except 
12634 for renaming a few productions, and not formalizing the definitions of the lexical tokens or 
12635 the preprocessor, the grammar given here for the language proper is equivalent to that of the 
12636 standard. 
12637 
12638 Throughout this manual, commentary material is indented and written in smaller type, as this is. Most 
12639 often these comments highlight ways in which ANSI Standard C differs from the language defined by 
12640 the first edition of this book, or from refinements subsequently introduced in various compilers. 
12641 
12642 A.2 Lexical Conventions 
12643 
12644 A program consists of one or more translation units stored in files. It is translated in several 
12645 phases, which are described in Par.A.12. The first phases do low-level lexical 
12646 transformations, carry out directives introduced by the lines beginning with the # character, 
12647 and perform macro definition and expansion. When the preprocessing of Par.A.12 is 
12648 complete, the program has been reduced to a sequence of tokens. 
12649 
12650 A.2.1 Tokens 
12651 
12652 There are six classes of tokens: identifiers, keywords, constants, string literals, operators, and 
12653 other separators. Blanks, horizontal and vertical tabs, newlines, formfeeds and comments as 
12654 described below (collectively, ``white space'') are ignored except as they separate tokens. 
12655 Some white space is required to separate otherwise adjacent identifiers, keywords, and 
12656 constants. 
12657 
12658 If the input stream has been separated into tokens up to a given character, the next token is the 
12659 longest string of characters that could constitute a token. 
12660 
12661 A.2.2 Comments 
12662 
12663 The characters /* introduce a comment, which terminates with the characters */. Comments 
12664 do not nest, and they do not occur within a string or character literals. 
12665 
12666 A.2.3 Identifiers 
12667 
12668 An identifier is a sequence of letters and digits. The first character must be a letter; the 
12669 underscore _ counts as a letter. Upper and lower case letters are different. Identifiers may 
12670 have any length, and for internal identifiers, at least the first 31 characters are significant; 
12671 
12672 
12673 some implementations may take more characters significant. Internal identifiers include 
12674 preprocessor macro names and all other names that do not have external linkage (Par.A.11.2). 
12675 Identifiers with external linkage are more restricted: implementations may make as few as the 
12676 first six characters significant, and may ignore case distinctions. 
12677 
12678 A.2.4 Keywords 
12679 
12680 The following identifiers are reserved for the use as keywords, and may not be used 
12681 otherwise: 
12682 
 
 
 
 
 
 
 
 
 
12701 Some implementations also reserve the words fortran and asm. 
12702 
12703 The keywords const, signed, and volatile are new with the ANSI standard; enum and void 
12704 are new since the first edition, but in common use; entry, formerly reserved but never used, is no 
12705 longer reserved. 
12706 
12707 A.2.5 Constants 
12708 
12709 There are several kinds of constants. Each has a data type; Par.A.4.2 discusses the basic types: 
12710 
 integer-constant 
12713 character-constant 
12714 floating-constant 
12715 enumeration-constant 
12716 
12717 A.2.5.1 Integer Constants 
12718 
12719 An integer constant consisting of a sequence of digits is taken to be octal if it begins with 0 
12720 (digit zero), decimal otherwise. Octal constants do not contain the digits 8 or 9. A sequence of 
12721 digits preceded by 0x or 0X (digit zero) is taken to be a hexadecimal integer. The hexadecimal 
12722 digits include a or A through f or F with values 10 through 15. 
12723 
12724 An integer constant may be suffixed by the letter u or U, to specify that it is unsigned. It may 
12725 also be suffixed by the letter l or L to specify that it is long. 
12726 
12727 The type of an integer constant depends on its form, value and suffix. (See Par.A.4 for a 
12728 discussion of types). If it is unsuffixed and decimal, it has the first of these types in which its 
12729 value can be represented: int, long int, unsigned long int. If it is unsuffixed, octal or 
12730 hexadecimal, it has the first possible of these types: int, unsigned int, long int, 
12731 unsigned long int. If it is suffixed by u or U, then unsigned int, unsigned long int. If 
12732 it is suffixed by l or L, then long int, unsigned long int. If an integer constant is suffixed 
12733 by UL, it is unsigned long. 
12734 
12735 The elaboration of the types of integer constants goes considerably beyond the first edition, which 
12736 merely caused large integer constants to be long. The U suffixes are new. 
12737 
12738 
12739 A.2.5.2 Character Constants 
12740 
12741 A character constant is a sequence of one or more characters enclosed in single quotes as in 
12742 'x'. The value of a character constant with only one character is the numeric value of the 
12743 character in the machine's character set at execution time. The value of a multi-character 
12744 constant is implementation-defined. 
12745 
12746 Character constants do not contain the ' character or newlines; in order to represent them, and 
12747 certain other characters, the following escape sequences may be used: 
12748 
12749 newline 
12750 
12751 NL (LF) 
12752 
12753 \n 
12754 
12755 backslash 
12756 
12757 \ 
12758 
12759 \\ 
12760 
12761 horizontal tab 
12762 
12763 HT 
12764 
12765 \t 
12766 
12767 question mark
12768 
12769 \? 
12770 
12771 vertical tab 
12772 
12773 VT 
12774 
12775 \v 
12776 
12777 single quote 
12778 
12779 ' 
12780 
12781 \' 
12782 
12783 backspace 
12784 
12785 BS 
12786 
12787 \b 
12788 
12789 double quote 
12790 
12791 " 
12792 
12793 \" 
12794 
12795 carriage return 
12796 
12797 CR 
12798 
12799 \r 
12800 
12801 octal number 
12802 
12803 ooo
12804 
12805 \ooo 
12806 
12807 formfeed 
12808 
12809 FF 
12810 
12811 \f 
12812 
12813 hex number 
12814 
12815 hh 
12816 
12817 \xhh 
12818 
12819 audible alert 
12820 
12821 BEL 
12822 
12823 \a 
12824 
 
12827 
12828 
12829 The escape \ooo consists of the backslash followed by 1, 2, or 3 octal digits, which are taken 
12830 to specify the value of the desired character. A common example of this construction is \0 
12831 (not followed by a digit), which specifies the character NUL. The escape \xhh consists of the 
12832 backslash, followed by x, followed by hexadecimal digits, which are taken to specify the 
12833 value of the desired character. There is no limit on the number of digits, but the behavior is 
12834 undefined if the resulting character value exceeds that of the largest character. For either octal 
12835 or hexadecimal escape characters, if the implementation treats the char type as signed, the 
12836 value is sign-extended as if cast to char type. If the character following the \ is not one of 
12837 those specified, the behavior is undefined. 
12838 
12839 In some implementations, there is an extended set of characters that cannot be represented in 
12840 the char type. A constant in this extended set is written with a preceding L, for example L'x', 
12841 and is called a wide character constant. Such a constant has type wchar_t, an integral type 
12842 defined in the standard header <stddef.h>. As with ordinary character constants, 
12843 hexadecimal escapes may be used; the effect is undefined if the specified value exceeds that 
12844 representable with wchar_t. 
12845 
12846 Some of these escape sequences are new, in particular the hexadecimal character representation. 
12847 Extended characters are also new. The character sets commonly used in the Americas and western 
12848 Europe can be encoded to fit in the char type; the main intent in adding wchar_t was to 
12849 accommodate Asian languages. 
12850 
12851 A.2.5.3 Floating Constants 
12852 
12853 A floating constant consists of an integer part, a decimal part, a fraction part, an e or E, an 
12854 optionally signed integer exponent and an optional type suffix, one of f, F, l, or L. The integer 
12855 and fraction parts both consist of a sequence of digits. Either the integer part, or the fraction 
12856 part (not both) may be missing; either the decimal point or the e and the exponent (not both) 
12857 may be missing. The type is determined by the suffix; F or f makes it float, L or l makes it 
12858 long double, otherwise it is double. 
12859 
12860 A2.5.4 Enumeration Constants 
12861 
12862 
12863 Identifiers declared as enumerators (see Par.A.8.4) are constants of type int. 
12864 
12865 A.2.6 String Literals 
12866 A string literal, also called a string constant, is a sequence of characters surrounded by double 
12867 quotes as in "...". A string has type ``array of characters'' and storage class static (see 
12868 Par.A.3 below) and is initialized with the given characters. Whether identical string literals 
12869 are distinct is implementation-defined, and the behavior of a program that attempts to alter a 
12870 string literal is undefined. 
12871 
12872 Adjacent string literals are concatenated into a single string. After any concatenation, a null 
12873 byte \0 is appended to the string so that programs that scan the string can find its end. String 
12874 literals do not contain newline or double-quote characters; in order to represent them, the 
12875 same escape sequences as for character constants are available. 
12876 
12877 As with character constants, string literals in an extended character set are written with a 
12878 preceding L, as in L"...". Wide-character string literals have type ``array ofwchar_t.'' 
12879 Concatenation of ordinary and wide string literals is undefined. 
12880 
12881 The specification that string literals need not be distinct, and the prohibitionagainst modifyingthem, 
12882 are new in the ANSI standard, as is the concatenation of adjacent string literals. Wide-character string 
12883 literals are new. 
12884 
12885 A.3 Syntax Notation 
12886 In the syntax notation used in this manual, syntactic categories are indicated by italic type, 
12887 and literal words and characters in typewriter style. Alternative categories are usually listed 
12888 on separate lines; in a few cases, a long set of narrow alternatives is presented on one line, 
12889 marked by the phrase ``one of.'' An optional terminal or nonterminal symbol carries the 
12890 subscript ``opt,'' so that, for example, 
12891 
12892 { expressionopt } 
12893 
12894 means an optional expression, enclosed in braces. The syntax is summarized in Par.A.13. 
12895 
12896 Unlike the grammar given in the first edition of this book, the one given here makes precedence and 
12897 associativity of expression operators explicit. 
12898 
12899 A.4 Meaning of Identifiers 
12900 Identifiers, or names, refer to a variety of things: functions; tags of structures, unions, and 
12901 enumerations; members of structures or unions; enumeration constants; typedef names; and 
12902 objects. An object, sometimes called a variable, is a location in storage, and its interpretation 
12903 depends on two main attributes: its storage class and its type. The storage class determines the 
12904 lifetime of the storage associated with the identified object; the type determines the meaning 
12905 of the values found in the identified object. A name also has a scope, which is the region of 
12906 the program in which it is known, and a linkage, which determines whether the same name in 
12907 another scope refers to the same object or function. Scope and linkage are discussed in 
12908 Par.A.11. 
12909 
12910 A.4.1 Storage Class 
12911 
12912 There are two storage classes: automatic and static. Several keywords, together with the 
12913 context of an object's declaration, specify its storage class. Automatic objects are local to a 
12914 block (Par.9.3), and are discarded on exit from the block. Declarations within a block create 
12915 automatic objects if no storage class specification is mentioned, or if the auto specifier is 
12916 used. Objects declared register are automatic, and are (if possible) stored in fast registers of 
12917 the machine. 
12918 
12919 Static objects may be local to a block or external to all blocks, but in either case retain their 
12920 values across exit from and reentry to functions and blocks. Within a block, including a block 
12921 that provides the code for a function, static objects are declared with the keyword static. 
12922 The objects declared outside all blocks, at the same level as function definitions, are always 
12923 static. They may be made local to a particular translation unit by use of the static keyword; 
12924 this gives them internal linkage. They become global to an entire program by omitting an 
12925 explicit storage class, or by using the keyword extern; this gives them external linkage. 
12926 
12927 A.4.2 Basic Types 
12928 
12929 There are several fundamental types. The standard header <limits.h> described in Appendix 
12930 B defines the largest and smallest values of each type in the local implementation. The 
12931 numbers given in Appendix B show the smallest acceptable magnitudes. 
12932 
12933 Objects declared as characters (char) are large enough to store any member of the execution 
12934 character set. If a genuine character from that set is stored in a char object, its value is 
12935 equivalent to the integer code for the character, and is non-negative. Other quantities may be 
12936 stored into char variables, but the available range of values, and especially whether the value 
12937 is signed, is implementation-dependent. 
12938 
12939 Unsigned characters declared unsigned char consume the same amount of space as plain 
12940 characters, but always appear non-negative; explicitly signed characters declared signed 
12941 char likewise take the same space as plain characters. 
12942 
12943 unsigned char type does not appear in the first edition of this book, but is in common use. signed 
12944 char is new. 
12945 
12946 Besides the char types, up to three sizes of integer, declared short int, int, and long int, 
12947 are available. Plain int objects have the natural size suggested by the host machine 
12948 architecture; the other sizes are provided to meet special needs. Longer integers provide at 
12949 least as much storage as shorter ones, but the implementation may make plain integers 
12950 equivalent to either short integers, or long integers. The int types all represent signed values 
12951 unless specified otherwise. 
12952 
12953 Unsigned integers, declared using the keyword unsigned, obey the laws of arithmetic modulo 
12954 2n where n is the number of bits in the representation, and thus arithmetic on unsigned 
12955 quantities can never overflow. The set of non-negative values that can be stored in a signed 
12956 object is a subset of the values that can be stored in the corresponding unsigned object, and 
12957 the representation for the overlapping values is the same. 
12958 
12959 Any of single precision floating point (float), double precision floating point (double), and 
12960 extra precision floating point (long double) may be synonymous, but the ones later in the 
12961 list are at least as precise as those before. 
12962 
12963 
12964 long double is new. The first edition made long float equivalent to double; the locution has 
12965 been withdrawn. 
12966 
12967 Enumerations are unique types that have integral values; associated with each enumeration is 
12968 a set of named constants (Par.A.8.4). Enumerations behave like integers, but it is common for 
12969 a compiler to issue a warning when an object of a particular enumeration is assigned 
12970 something other than one of its constants, or an expression of its type. 
12971 
12972 Because objects of these types can be interpreted as numbers, they will be referred to as 
12973 arithmetic types. Types char, and int of all sizes, each with or without sign, and also 
12974 enumeration types, will collectively be called integral types. The types float, double, and 
12975 long double will be called floating types. 
12976 
12977 The void type specifies an empty set of values. It is used as the type returned by functions 
12978 that generate no value. 
12979 
12980 A.4.3 Derived types 
12981 
12982 Beside the basic types, there is a conceptually infinite class of derived types constructed from 
12983 the fundamental types in the following ways: 
12984 
 functions returning objects of a given type; 
12987 pointers to objects of a given type; 
12988 structures containing a sequence of objects of various types; 
12989 unions capable of containing any of one of several objects of various types. 
12990 
12991 In general these methods of constructing objects can be applied recursively. 
12992 
12993 A.4.4 Type Qualifiers 
12994 
12995 An object's type may have additional qualifiers. Declaring an object const announces that its 
12996 value will not be changed; declaring it volatile announces that it has special properties 
12997 relevant to optimization. Neither qualifier affects the range of values or arithmetic properties 
12998 of the object. Qualifiers are discussed in Par.A.8.2. 
12999 
13000 A.5 Objects and Lvalues 
13001 
13002 An Object is a named region of storage; an lvalue is an expression referring to an object. An 
13003 obvious example of an lvalue expression is an identifier with suitable type and storage class. 
13004 There are operators that yield lvalues, if E is an expression of pointer type, then *E is an lvalue 
13005 expression referring to the object to which E points. The name ``lvalue'' comes from the 
13006 assignment expression E1 = E2 in which the left operand E1 must be an lvalue expression. 
13007 The discussion of each operator specifies whether it expects lvalue operands and whether it 
13008 yields an lvalue. 
13009 
13010 A.6 Conversions 
13011 
13012 Some operators may, depending on their operands, cause conversion of the value of an 
13013 operand from one type to another. This section explains the result to be expected from such 
13014 
13015 
13016 conversions. Par.6.5 summarizes the conversions demanded by most ordinary operators; it 
13017 will be supplemented as required by the discussion of each operator. 
13018 
13019 A character, a short integer, or an integer bit-field, all either signed or not, or an object of 
13020 enumeration type, may be used in an expression wherever an integer may be used. If an int 
13021 can represent all the values of the original type, then the value is converted to int; otherwise 
13022 the value is converted to unsigned int. This process is called integral promotion. 
13023 
13024 A.6.2 Integral Conversions 
13025 
13026 Any integer is converted to a given unsigned type by finding the smallest non-negative value 
13027 that is congruent to that integer, modulo one more than the largest value that can be 
13028 represented in the unsigned type. In a two's complement representation, this is equivalent to 
13029 left-truncation if the bit pattern of the unsigned type is narrower, and to zero-filling unsigned 
13030 values and sign-extending signed values if the unsigned type is wider. 
13031 
13032 When any integer is converted to a signed type, the value is unchanged if it can be represented 
13033 in the new type and is implementation-defined otherwise. 
13034 
13035 A.6.3 Integer and Floating 
13036 
13037 When a value of floating type is converted to integral type, the fractional part is discarded; if 
13038 the resulting value cannot be represented in the integral type, the behavior is undefined. In 
13039 particular, the result of converting negative floating values to unsigned integral types is not 
13040 specified. 
13041 
13042 When a value of integral type is converted to floating, and the value is in the representable 
13043 range but is not exactly representable, then the result may be either the next higher or next 
13044 lower representable value. If the result is out of range, the behavior is undefined. 
13045 
13046 A.6.4 Floating Types 
13047 
13048 When a less precise floating value is converted to an equally or more precise floating type, the 
13049 value is unchanged. When a more precise floating value is converted to a less precise floating 
13050 type, and the value is within representable range, the result may be either the next higher or 
13051 the next lower representable value. If the result is out of range, the behavior is undefined. 
13052 
13053 A.6.5 Arithmetic Conversions 
13054 
13055 Many operators cause conversions and yield result types in a similar way. The effect is to 
13056 bring operands into a common type, which is also the type of the result. This pattern is called 
13057 the usual arithmetic conversions. 
13058 
13059  First, if either operand is long double, the other is converted to long double. 
13060 
13061  Otherwise, if either operand is double, the other is converted to double. 
13062 
13063  Otherwise, if either operand is float, the other is converted to float. 
13064 
13065  Otherwise, the integral promotions are performed on both operands; then, if either 
13066 operand is unsigned long int, the other is converted to unsigned long int. 
13067 
13068 
13069  Otherwise, if one operand is long int and the other is unsigned int, the effect 
13070 depends on whether a long int can represent all values of an unsigned int; if so, 
13071 the unsigned int operand is converted to long int; if not, both are converted to 
13072 unsigned long int. 
13073 
13074  Otherwise, if one operand is long int, the other is converted to long int. 
13075 
13076  Otherwise, if either operand is unsigned int, the other is converted to unsigned 
13077 int. 
13078 
13079  Otherwise, both operands have type int. 
13080 
13081 There are two changes here. First, arithmetic on float operands may be done in single precision, 
13082 rather than double; the first edition specified that all floating arithmetic was double precision. Second, 
13083 shorter unsigned types, when combined with a larger signed type, do not propagate the unsigned 
13084 property to the result type; in the first edition, the unsigned always dominated. The new rules are 
13085 slightly more complicated, but reduce somewhat the surprises that may occur when an unsigned 
13086 quantity meets signed. Unexpected results may still occur when an unsigned expression is compared to 
13087 a signed expression of the same size. 
13088 
13089 A.6.6 Pointers and Integers 
13090 
13091 An expression of integral type may be added to or subtracted from a pointer; in such a case 
13092 the integral expression is converted as specified in the discussion of the addition operator 
13093 (Par.A.7.7). 
13094 
13095 Two pointers to objects of the same type, in the same array, may be subtracted; the result is 
13096 converted to an integer as specified in the discussion of the subtraction operator (Par.A.7.7). 
13097 
13098 An integral constant expression with value 0, or such an expression cast to type void *, may 
13099 be converted, by a cast, by assignment, or by comparison, to a pointer of any type. This 
13100 produces a null pointer that is equal to another null pointer of the same type, but unequal to 
13101 any pointer to a function or object. 
13102 
13103 Certain other conversions involving pointers are permitted, but have implementation-defined 
13104 aspects. They must be specified by an explicit type-conversion operator, or cast (Pars.A.7.5 
13105 and A.8.8). 
13106 
13107 A pointer may be converted to an integral type large enough to hold it; the required size is 
13108 implementation-dependent. The mapping function is also implementation-dependent. 
13109 
13110 A pointer to one type may be converted to a pointer to another type. The resulting pointer may 
13111 cause addressing exceptions if the subject pointer does not refer to an object suitably aligned 
13112 in storage. It is guaranteed that a pointer to an object may be converted to a pointer to an 
13113 object whose type requires less or equally strict storage alignment and back again without 
13114 change; the notion of ``alignment'' is implementation-dependent, but objects of the char types 
13115 have least strict alignment requirements. As described in Par.A.6.8, a pointer may also be 
13116 converted to type void * and back again without change. 
13117 
13118 A pointer may be converted to another pointer whose type is the same except for the addition 
13119 or removal of qualifiers (Pars.A.4.4, A.8.2) of the object type to which the pointer refers. If 
13120 qualifiers are added, the new pointer is equivalent to the old except for restrictions implied by 
13121 the new qualifiers. If qualifiers are removed, operations on the underlying object remain 
13122 subject to the qualifiers in its actual declaration. 
13123 
13124 
13125 Finally, a pointer to a function may be converted to a pointer to another function type. Calling 
13126 the function specified by the converted pointer is implementation-dependent; however, if the 
13127 converted pointer is reconverted to its original type, the result is identical to the original 
13128 pointer. 
13129 
13130 A.6.7 Void 
13131 The (nonexistent) value of a void object may not be used in any way, and neither explicit nor 
13132 implicit conversion to any non-void type may be applied. Because a void expression denotes a 
13133 nonexistent value, such an expression may be used only where the value is not required, for 
13134 example as an expression statement (Par.A.9.2) or as the left operand of a comma operator 
13135 (Par.A.7.18). 
13136 
13137 An expression may be converted to type void by a cast. For example, a void cast documents 
13138 the discarding of the value of a function call used as an expression statement. 
13139 
13140 void did not appear in the first edition of this book, but has become common since. 
13141 
13142 A.6.8 Pointers to Void 
13143 Any pointer to an object may be converted to type void * without loss of information. If the 
13144 result is converted back to the original pointer type, the original pointer is recovered. Unlike 
13145 the pointer-to-pointer conversions discussed in Par.A.6.6, which generally require an explicit 
13146 cast, pointers may be assigned to and from pointers of type void *, and may be compared 
13147 with them. 
13148 
13149 This interpretation ofvoid * pointers is new; previously, char * pointers played the roleof generic 
13150 
13151 pointer. The ANSI standard specifically blesses the meeting of void * pointers with object pointers in
13152 
13153 assignments and relationals, while requiring explicit casts for other pointer mixtures. 
13154 
13155 A.7 Expressions 
13156 The precedence of expression operators is the same as the order of the major subsections of 
13157 this section, highest precedence first. Thus, for example, the expressions referred to as the 
13158 operands of + (Par.A.7.7) are those expressions defined in Pars.A.7.1-A.7.6. Within each 
13159 subsection, the operators have the same precedence. Left- or right-associativity is specified in 
13160 each subsection for the operators discussed therein. The grammar given in Par.13 incorporates 
13161 the precedence and associativity of the operators. 
13162 
13163 The precedence and associativity of operators is fully specified, but the order of evaluation of 
13164 expressions is, with certain exceptions, undefined, even if the subexpressions involve side 
13165 effects. That is, unless the definition of the operator guarantees that its operands are evaluated 
13166 in a particular order, the implementation is free to evaluate operands in any order, or even to 
13167 interleave their evaluation. However, each operator combines the values produced by its 
13168 operands in a way compatible with the parsing of the expression in which it appears. 
13169 
13170 This rule revokes the previous freedom to reorder expressions withoperators that are mathematicallycommutative and associative, but canfail to be computationally associative. The change affects only 
13171 floating-point computations near the limits of their accuracy, and situations where overflow is possible. 
13172 
13173 The handling of overflow, divide check, and other exceptions in expression evaluation is not 
13174 defined by the language. Most existing implementations of C ignore overflow in evaluation of 
13175 signed integral expressions and assignments, but this behavior is not guaranteed. Treatment of 
13176 
13177 
13178 division by 0, and all floating-point exceptions, varies among implementations; sometimes it 
13179 is adjustable by a non-standard library function. 
13180 
13181 A.7.1 Pointer Conversion 
13182 
13183 If the type of an expression or subexpression is ``array of T,'' for some type T, then the value 
13184 of the expression is a pointer to the first object in the array, and the type of the expression is 
13185 altered to ``pointer to T.'' This conversion does not take place if the expression is in the 
13186 operand of the unary & operator, or of ++, --, sizeof, or as the left operand of an assignment 
13187 operator or the . operator. Similarly, an expression of type ``function returning T,'' except 
13188 when used as the operand of the & operator, is converted to ``pointer to function returning T.'' 
13189 
13190 A.7.2 Primary Expressions 
13191 
13192 Primary expressions are identifiers, constants, strings, or expressions in parentheses. 
13193 
 identifier 
13196 constant 
13197 string 
13198 (expression) 
13199 
13200 An identifier is a primary expression, provided it has been suitably declared as discussed 
13201 below. Its type is specified by its declaration. An identifier is an lvalue if it refers to an object 
13202 (Par.A.5) and if its type is arithmetic, structure, union, or pointer. 
13203 
13204 A constant is a primary expression. Its type depends on its form as discussed in Par.A.2.5. 
13205 
13206 A string literal is a primary expression. Its type is originally ``array of char'' (for wide-char 
13207 strings, ``array of wchar_t''), but following the rule given in Par.A.7.1, this is usually 
13208 modified to ``pointer to char'' (wchar_t) and the result is a pointer to the first character in the 
13209 string. The conversion also does not occur in certain initializers; see Par.A.8.7. 
13210 
13211 A parenthesized expression is a primary expression whose type and value are identical to 
13212 those of the unadorned expression. The precedence of parentheses does not affect whether the 
13213 expression is an lvalue. 
13214 
13215 The operators in postfix expressions group left to right. 
13216 
 primary-expression 
13219 postfix-expression[expression] 
13220 postfix-expression(argument-expression-listopt) 
13221 postfix-expression.identifier 
13222 postfix-expression->identifier 
13223 postfix-expression++ 
13224 postfix-expression-- 
13225 
13226 
 assignment-expression 
13229 assignment-expression-list , assignment-expression 
13230 
13231 A.7.3.1 Array References 
13232 
13233 A postfix expression followed by an expression in square brackets is a postfix expression 
13234 denoting a subscripted array reference. One of the two expressions must have type ``pointer to 
13235 T'', where T is some type, and the other must have integral type; the type of the subscript 
13236 expression is T. The expression E1[E2] is identical (by definition) to *((E1)+(E2)). See 
13237 Par.A.8.6.2 for further discussion. 
13238 
13239 A.7.3.2 Function Calls 
13240 
13241 A function call is a postfix expression, called the function designator, followed by parentheses 
13242 containing a possibly empty, comma-separated list of assignment expressions (Par.A7.17), 
13243 which constitute the arguments to the function. If the postfix expression consists of an 
13244 identifier for which no declaration exists in the current scope, the identifier is implicitly 
13245 declared as if the declaration 
13246 
 
13249 had been given in the innermost block containing the function call. The postfix expression 
13250 (after possible explicit declaration and pointer generation, Par.A7.1) must be of type ``pointer 
13251 to function returning T,'' for some type T, and the value of the function call has type T. 
13252 
13253 In the first edition, the type was restricted to ``function,'' and an explicit * operator was required to call 
13254 through pointers to functions. The ANSI standard blesses the practice of some existing compilers by 
13255 permitting the same syntax for calls to functions and to functions specified by pointers. The older 
13256 syntax is still usable. 
13257 
13258 The term argument is used for an expression passed by a function call; the term parameter is 
13259 used for an input object (or its identifier) received by a function definition, or described in a 
13260 function declaration. The terms ``actual argument (parameter)'' and ``formal argument 
13261 (parameter)'' respectively are sometimes used for the same distinction. 
13262 
13263 In preparing for the call to a function, a copy is made of each argument; all argument-passing 
13264 is strictly by value. A function may change the values of its parameter objects, which are 
13265 copies of the argument expressions, but these changes cannot affect the values of the 
13266 arguments. However, it is possible to pass a pointer on the understanding that the function 
13267 may change the value of the object to which the pointer points. 
13268 
13269 There are two styles in which functions may be declared. In the new style, the types of 
13270 parameters are explicit and are part of the type of the function; such a declaration os also 
13271 called a function prototype. In the old style, parameter types are not specified. Function 
13272 declaration is issued in Pars.A.8.6.3 and A.10.1. 
13273 
13274 If the function declaration in scope for a call is old-style, then default argument promotion is 
13275 applied to each argument as follows: integral promotion (Par.A.6.1) is performed on each 
13276 argument of integral type, and each float argument is converted to double. The effect of the 
13277 call is undefined if the number of arguments disagrees with the number of parameters in the 
13278 definition of the function, or if the type of an argument after promotion disagrees with that of 
13279 the corresponding parameter. Type agreement depends on whether the function's definition is 
13280 
13281 
13282 new-style or old-style. If it is old-style, then the comparison is between the promoted type of 
13283 the arguments of the call, and the promoted type of the parameter, if the definition is new-
13284 style, the promoted type of the argument must be that of the parameter itself, without 
13285 promotion. 
13286 
13287 If the function declaration in scope for a call is new-style, then the arguments are converted, 
13288 as if by assignment, to the types of the corresponding parameters of the function's prototype. 
13289 The number of arguments must be the same as the number of explicitly described parameters, 
13290 unless the declaration's parameter list ends with the ellipsis notation (, ...). In that case, the 
13291 number of arguments must equal or exceed the number of parameters; trailing arguments 
13292 beyond the explicitly typed parameters suffer default argument promotion as described in the 
13293 preceding paragraph. If the definition of the function is old-style, then the type of each 
13294 parameter in the definition, after the definition parameter's type has undergone argument 
13295 promotion. 
13296 
13297 These rules are especially complicated because they must cater to a mixture of old- and new-style 
13298 functions. Mixtures are to be avoided if possible. 
13299 
13300 The order of evaluation of arguments is unspecified; take note that various compilers differ. 
13301 However, the arguments and the function designator are completely evaluated, including all 
13302 side effects, before the function is entered. Recursive calls to any function are permitted. 
13303 
13304 A.7.3.3 Structure References 
13305 
13306 A postfix expression followed by a dot followed by an identifier is a postfix expression. The 
13307 first operand expression must be a structure or a union, and the identifier must name a 
13308 member of the structure or union. The value is the named member of the structure or union, 
13309 and its type is the type of the member. The expression is an lvalue if the first expression is an 
13310 lvalue, and if the type of the second expression is not an array type. 
13311 
13312 A postfix expression followed by an arrow (built from - and >) followed by an identifier is a 
13313 postfix expression. The first operand expression must be a pointer to a structure or union, and 
13314 the identifier must name a member of the structure or union. The result refers to the named 
13315 member of the structure or union to which the pointer expression points, and the type is the 
13316 type of the member; the result is an lvalue if the type is not an array type. 
13317 
13318 Thus the expression E1->MOS is the same as (*E1).MOS. Structures and unions are discussed 
13319 in Par.A.8.3. 
13320 
13321 In the first edition of this book, it was already the rule that a member name in such an expression had to 
13322 belong to the structure or union mentioned in the postfix expression; however, a note admitted that this 
13323 rule was not firmly enforced. Recent compilers, and ANSI, do enforce it. 
13324 
13325 A.7.3.4 Postfix Incrementation 
13326 
13327 A postfix expression followed by a ++ or -- operator is a postfix expression. The value of the 
13328 expression is the value of the operand. After the value is noted, the operand is incremented ++ 
13329 or decremented -- by 1. The operand must be an lvalue; see the discussion of additive 
13330 operators (Par.A.7.7) and assignment (Par.A.7.17) for further constraints on the operand and 
13331 details of the operation. The result is not an lvalue. 
13332 
13333 A.7.4 Unary Operators 
13334 
13335 
13336 Expressions with unary operators group right-to-left. 
13337 
 postfix expression 
13340 ++unary expression 
13341 --unary expression 
13342 unary-operator cast-expression 
13343 sizeof unary-expression 
13344 sizeof(type-name) 
13345 
 & * + - ~ ! 
13348 
13349 A.7.4.1 Prefix Incrementation Operators 
13350 
13351 A unary expression followed by a ++ or -- operator is a unary expression. The operand is 
13352 incremented ++ or decremented -- by 1. The value of the expression is the value after the 
13353 incrementation (decrementation). The operand must be an lvalue; see the discussion of 
13354 additive operators (Par.A.7.7) and assignment (Par.A.7.17) for further constraints on the 
13355 operands and details of the operation. The result is not an lvalue. 
13356 
13357 A.7.4.2 Address Operator 
13358 
13359 The unary operator & takes the address of its operand. The operand must be an lvalue referring 
13360 neither to a bit-field nor to an object declared as register, or must be of function type. The 
13361 result is a pointer to the object or function referred to by the lvalue. If the type of the operand 
13362 is T, the type of the result is ``pointer to T.'' 
13363 
13364 A.7.4.3 Indirection Operator 
13365 
13366 The unary * operator denotes indirection, and returns the object or function to which its 
13367 operand points. It is an lvalue if the operand is a pointer to an object of arithmetic, structure, 
13368 union, or pointer type. If the type of the expression is ``pointer to T,'' the type of the result is 
13369 T. 
13370 
13371 A.7.4.4 Unary Plus Operator 
13372 
13373 The operand of the unary + operator must have arithmetic type, and the result is the value of 
13374 the operand. An integral operand undergoes integral promotion. The type of the result is the 
13375 type of the promoted operand. 
13376 
13377 The unary + is new with the ANSI standard. It was added for symmetry with the unary -. 
13378 
13379 A.7.4.5 Unary Minus Operator 
13380 
13381 The operand of the unary - operator must have arithmetic type, and the result is the negative 
13382 of its operand. An integral operand undergoes integral promotion. The negative of an 
13383 unsigned quantity is computed by subtracting the promoted value from the largest value of the 
13384 promoted type and adding one; but negative zero is zero. The type of the result is the type of 
13385 the promoted operand. 
13386 
13387 A.7.4.6 One's Complement Operator 
13388 
13389 
13390 The operand of the ~ operator must have integral type, and the result is the one's complement 
13391 of its operand. The integral promotions are performed. If the operand is unsigned, the result is 
13392 computed by subtracting the value from the largest value of the promoted type. If the operand 
13393 is signed, the result is computed by converting the promoted operand to the corresponding 
13394 unsigned type, applying ~, and converting back to the signed type. The type of the result is the 
13395 type of the promoted operand. 
13396 
13397 A.7.4.7 Logical Negation Operator 
13398 
13399 A.7.4.8 Sizeof Operator 
13400 
13401 The sizeof operator yields the number of bytes required to store an object of the type of its 
13402 operand. The operand is either an expression, which is not evaluated, or a parenthesized type 
13403 name. When sizeof is applied to a char, the result is 1; when applied to an array, the result is 
13404 the total number of bytes in the array. When applied to a structure or union, the result is the 
13405 number of bytes in the object, including any padding required to make the object tile an array: 
13406 the size of an array of n elements is n times the size of one element. The operator may not be 
13407 applied to an operand of function type, or of incomplete type, or to a bit-field. The result is an 
13408 unsigned integral constant; the particular type is implementation-defined. The standard header 
13409 <stddef.h> (See appendix B) defines this type as size_t. 
13410 
13411 A.7.5 Casts 
13412 
13413 A unary expression preceded by the parenthesized name of a type causes conversion of the 
13414 value of the expression to the named type. 
13415 
 unary expression 
13418 (type-name) cast-expression 
13419 
13420 This construction is called a cast. The names are described in Par.A.8.8. The effects of 
13421 conversions are described in Par.A.6. An expression with a cast is not an lvalue. 
13422 
13423 A.7.6 Multiplicative Operators 
13424 
13425 The multiplicative operators *, /, and % group left-to-right. 
13426 
 multiplicative-expression * cast-expression 
13429 multiplicative-expression / cast-expression 
13430 multiplicative-expression % cast-expression 
13431 
13432 The operands of * and / must have arithmetic type; the operands of % must have integral type. 
13433 The usual arithmetic conversions are performed on the operands, and predict the type of the 
13434 result. 
13435 
13436 The binary * operator denotes multiplication. 
13437 
13438 
13439 The binary / operator yields the quotient, and the % operator the remainder, of the division of 
13440 the first operand by the second; if the second operand is 0, the result is undefined. Otherwise, 
13441 it is always true that (a/b)*b + a%b is equal to a. If both operands are non-negative, then the 
13442 remainder is non-negative and smaller than the divisor, if not, it is guaranteed only that the 
13443 absolute value of the remainder is smaller than the absolute value of the divisor. 
13444 
13445 A.7.7 Additive Operators 
13446 
13447 The additive operators + and - group left-to-right. If the operands have arithmetic type, the 
13448 usual arithmetic conversions are performed. There are some additional type possibilities for 
13449 each operator. 
13450 
 multiplicative-expression 
13453 additive-expression + multiplicative-expression 
13454 additive-expression - multiplicative-expression 
13455 
13456 The result of the + operator is the sum of the operands. A pointer to an object in an array and a 
13457 value of any integral type may be added. The latter is converted to an address offset by 
13458 multiplying it by the size of the object to which the pointer points. The sum is a pointer of the 
13459 same type as the original pointer, and points to another object in the same array, appropriately 
13460 offset from the original object. Thus if P is a pointer to an object in an array, the expression 
13461 P+1 is a pointer to the next object in the array. If the sum pointer points outside the bounds of 
13462 the array, except at the first location beyond the high end, the result is undefined. 
13463 
13464 The provision for pointers just beyond the end of an array is new. It legitimizes a common idiom for 
13465 looping over the elements of an array. 
13466 
13467 The result of the - operator is the difference of the operands. A value of any integral type may 
13468 be subtracted from a pointer, and then the same conversions and conditions as for addition 
13469 apply. 
13470 
13471 If two pointers to objects of the same type are subtracted, the result is a signed integral value 
13472 representing the displacement between the pointed-to objects; pointers to successive objects 
13473 differ by 1. The type of the result is defined as ptrdiff_t in the standard header 
13474 <stddef.h>. The value is undefined unless the pointers point to objects within the same 
13475 array; however, if P points to the last member of an array, then (P+1)-P has value 1. 
13476 
13477 A.7.8 Shift Operators 
13478 
13479 The shift operators << and >> group left-to-right. For both operators, each operand must be 
13480 integral, and is subject to integral the promotions. The type of the result is that of the 
13481 promoted left operand. The result is undefined if the right operand is negative, or greater than 
13482 or equal to the number of bits in the left expression's type. 
13483 
 additive-expression 
13486 shift-expression << additive-expression 
13487 shift-expression >> additive-expression 
13488 
13489 The value of E1<<E2 is E1 (interpreted as a bit pattern) left-shifted E2 bits; in the absence of 
13490 overflow, this is equivalent to multiplication by 2E2. The value of E1>>E2 is E1 right-shifted 
13491 
13492 
13493 E2 bit positions. The right shift is equivalent to division by 2E2 if E1 is unsigned or it has a 
13494 non-negative value; otherwise the result is implementation-defined. 
13495 
13496 A.7.9 Relational Operators 
13497 
13498 The relational operators group left-to-right, but this fact is not useful; a<b<c is parsed as 
13499 (a<b)<c, and evaluates to either 0 or 1. 
13500 
 shift-expression 
13503 relational-expression < shift-expression 
13504 relational-expression > shift-expression 
13505 relational-expression <= shift-expression 
13506 relational-expression >= shift-expression 
13507 
13508 The operators < (less), > (greater), <= (less or equal) and >= (greater or equal) all yield 0 if the 
13509 specified relation is false and 1 if it is true. The type of the result is int. The usual arithmetic 
13510 conversions are performed on arithmetic operands. Pointers to objects of the same type 
13511 (ignoring any qualifiers) may be compared; the result depends on the relative locations in the 
13512 address space of the pointed-to objects. Pointer comparison is defined only for parts of the 
13513 same object; if two pointers point to the same simple object, they compare equal; if the 
13514 pointers are to members of the same structure, pointers to objects declared later in the 
13515 structure compare higher; if the pointers refer to members of an array, the comparison is 
13516 equivalent to comparison of the the corresponding subscripts. If P points to the last member of 
13517 an array, then P+1 compares higher than P, even though P+1 points outside the array. 
13518 Otherwise, pointer comparison is undefined. 
13519 
13520 These rules slightly liberalize the restrictions stated in the first edition, by permitting comparison of 
13521 pointers to different members of a structure or union. They also legalize comparison with a pointer just 
13522 off the end of an array. 
13523 
13524 A.7.10 Equality Operators 
13525 
 relational-expression 
13528 equality-expression == relational-expression 
13529 equality-expression != relational-expression 
13530 
13531 The == (equal to) and the != (not equal to) operators are analogous to the relational operators 
13532 except for their lower precedence. (Thus a<b == c<d is 1 whenever a<b and c<d have the 
13533 same truth-value.) 
13534 
13535 The equality operators follow the same rules as the relational operators, but permit additional 
13536 possibilities: a pointer may be compared to a constant integral expression with value 0, or to a 
13537 pointer to void. See Par.A.6.6. 
13538 
13539 A.7.11 Bitwise AND Operator 
13540 
 equality-expression 
13543 AND-expression & equality-expression 
13544 
13545 
13546 The usual arithmetic conversions are performed; the result is the bitwise AND function of the 
13547 operands. The operator applies only to integral operands. 
13548 
13549 A.7.12 Bitwise Exclusive OR Operator 
13550 
 AND-expression 
13553 exclusive-OR-expression ^ AND-expression 
13554 
13555 The usual arithmetic conversions are performed; the result is the bitwise exclusive OR 
13556 function of the operands. The operator applies only to integral operands. 
13557 
13558 A.7.13 Bitwise Inclusive OR Operator 
13559 
 exclusive-OR-expression 
13562 inclusive-OR-expression | exclusive-OR-expression 
13563 
13564 The usual arithmetic conversions are performed; the result is the bitwise inclusive OR 
13565 function of the operands. The operator applies only to integral operands. 
13566 
13567 A.7.14 Logical AND Operator 
13568 
 inclusive-OR-expression 
13571 logical-AND-expression && inclusive-OR-expression 
13572 
13573 The && operator groups left-to-right. It returns 1 if both its operands compare unequal to zero, 
13574 0 otherwise. Unlike &, && guarantees left-to-right evaluation: the first operand is evaluated, 
13575 including all side effects; if it is equal to 0, the value of the expression is 0. Otherwise, the 
13576 right operand is evaluated, and if it is equal to 0, the expression's value is 0, otherwise 1. 
13577 
13578 The operands need not have the same type, but each must have arithmetic type or be a pointer. 
13579 The result is int. 
13580 
13581 A.7.15 Logical OR Operator 
13582 
 logical-AND-expression 
13585 logical-OR-expression || logical-AND-expression 
13586 
13587 The || operator groups left-to-right. It returns 1 if either of its operands compare unequal to 
13588 zero, and 0 otherwise. Unlike |, || guarantees left-to-right evaluation: the first operand is 
13589 evaluated, including all side effects; if it is unequal to 0, the value of the expression is 1. 
13590 Otherwise, the right operand is evaluated, and if it is unequal to 0, the expression's value is 1, 
13591 otherwise 0. 
13592 
13593 The operands need not have the same type, but each must have arithmetic type or be a pointer. 
13594 The result is int. 
13595 
13596 A.7.16 Conditional Operator 
13597 
13598 
 logical-OR-expression 
13601 logical-OR-expression ? expression : conditional-expression 
13602 
13603 The first expression is evaluated, including all side effects; if it compares unequal to 0, the 
13604 result is the value of the second expression, otherwise that of the third expression. Only one of 
13605 the second and third operands is evaluated. If the second and third operands are arithmetic, 
13606 the usual arithmetic conversions are performed to bring them to a common type, and that type 
13607 is the type of the result. If both are void, or structures or unions of the same type, or pointers 
13608 to objects of the same type, the result has the common type. If one is a pointer and the other 
13609 the constant 0, the 0 is converted to the pointer type, and the result has that type. If one is a 
13610 pointer to void and the other is another pointer, the other pointer is converted to a pointer to 
13611 void, and that is the type of the result. 
13612 
13613 In the type comparison for pointers, any type qualifiers (Par.A.8.2) in the type to which the 
13614 pointer points are insignificant, but the result type inherits qualifiers from both arms of the 
13615 conditional. 
13616 
13617 A.7.17 Assignment Expressions 
13618 
13619 There are several assignment operators; all group right-to-left. 
13620 
 conditional-expression 
13623 unary-expression assignment-operator assignment-expression 
13624 
 = *= /= %= += -= <<= >>= &= ^= |= 
13627 
13628 All require an lvalue as left operand, and the lvalue must be modifiable: it must not be an 
13629 array, and must not have an incomplete type, or be a function. Also, its type must not be 
13630 qualified with const; if it is a structure or union, it must not have any member or, recursively, 
13631 submember qualified with const. The type of an assignment expression is that of its left 
13632 operand, and the value is the value stored in the left operand after the assignment has taken 
13633 place. 
13634 
13635 In the simple assignment with =, the value of the expression replaces that of the object 
13636 referred to by the lvalue. One of the following must be true: both operands have arithmetic 
13637 type, in which case the right operand is converted to the type of the left by the assignment; or 
13638 both operands are structures or unions of the same type; or one operand is a pointer and the 
13639 other is a pointer to void, or the left operand is a pointer and the right operand is a constant 
13640 expression with value 0; or both operands are pointers to functions or objects whose types are 
13641 the same except for the possible absence of const or volatile in the right operand. 
13642 
13643 An expression of the form E1 op= E2 is equivalent to E1 = E1 op (E2) except that E1 is 
13644 evaluated only once. 
13645 
13646 A.7.18 Comma Operator 
13647 
 assignment-expression 
13650 expression , assignment-expression 
13651 
13652 
13653 A pair of expressions separated by a comma is evaluated left-to-right, and the value of the left 
13654 expression is discarded. The type and value of the result are the type and value of the right 
13655 operand. All side effects from the evaluation of the left-operand are completed before 
13656 beginning the evaluation of the right operand. In contexts where comma is given a special 
13657 meaning, for example in lists of function arguments (Par.A.7.3.2) and lists of initializers 
13658 (Par.A.8.7), the required syntactic unit is an assignment expression, so the comma operator 
13659 appears only in a parenthetical grouping, for example, 
13660 
 
 
13665 has three arguments, the second of which has the value 5. 
13666 
13667 A.7.19 Constant Expressions 
13668 
13669 Syntactically, a constant expression is an expression restricted to a subset of operators: 
13670 
 conditional-expression 
13673 
13674 Expressions that evaluate to a constant are required in several contexts: after case, as array 
13675 bounds and bit-field lengths, as the value of an enumeration constant, in initializers, and in 
13676 certain preprocessor expressions. 
13677 
13678 Constant expressions may not contain assignments, increment or decrement operators, 
13679 function calls, or comma operators; except in an operand of sizeof. If the constant 
13680 expression is required to be integral, its operands must consist of integer, enumeration, 
13681 character, and floating constants; casts must specify an integral type, and any floating 
13682 constants must be cast to integer. This necessarily rules out arrays, indirection, address-of, 
13683 and structure member operations. (However, any operand is permitted for sizeof.) 
13684 
13685 More latitude is permitted for the constant expressions of initializers; the operands may be 
13686 any type of constant, and the unary & operator may be applied to external or static objects, and 
13687 to external and static arrays subscripted with a constant expression. The unary & operator can 
13688 also be applied implicitly by appearance of unsubscripted arrays and functions. Initializers 
13689 must evaluate either to a constant or to the address of a previously declared external or static 
13690 object plus or minus a constant. 
13691 
13692 Less latitude is allowed for the integral constant expressions after #if; sizeof expressions, 
13693 enumeration constants, and casts are not permitted. See Par.A.12.5. 
13694 
13695 A.8 Declarations 
13696 
13697 Declarations specify the interpretation given to each identifier; they do not necessarily reserve 
13698 storage associated with the identifier. Declarations that reserve storage are called definitions. 
13699 Declarations have the form 
13700 
 declaration-specifiers init-declarator-listopt; 
13703 
13704 The declarators in the init-declarator list contain the identifiers being declared; the 
13705 declaration-specifiers consist of a sequence of type and storage class specifiers. 
13706 
13707 
 storage-class-specifier declaration-specifiersopt 
13710 type-specifier declaration-specifiersopt 
13711 type-qualifier declaration-specifiersopt 
13712 
 init-declarator 
13715 init-declarator-list , init-declarator 
13716 
 declarator 
13719 declarator = initializer 
13720 
13721 Declarators will be discussed later (Par.A.8.5); they contain the names being declared. A 
13722 declaration must have at least one declarator, or its type specifier must declare a structure tag, 
13723 a union tag, or the members of an enumeration; empty declarations are not permitted. 
13724 
13725 A.8.1 Storage Class Specifiers 
13726 
13727 The storage class specifiers are: 
13728 
 auto 
13731 register 
13732 static 
13733 extern 
13734 typedef 
13735 
13736 The meaning of the storage classes were discussed in Par.A.4.4. 
13737 
13738 The auto and register specifiers give the declared objects automatic storage class, and may 
13739 be used only within functions. Such declarations also serve as definitions and cause storage to 
13740 be reserved. A register declaration is equivalent to an auto declaration, but hints that the 
13741 declared objects will be accessed frequently. Only a few objects are actually placed into 
13742 registers, and only certain types are eligible; the restrictions are implementation-dependent. 
13743 However, if an object is declared register, the unary & operator may not be applied to it, 
13744 explicitly or implicitly. 
13745 
13746 The rule that it is illegal to calculate the address of an object declared register, but actually taken to 
13747 be auto, is new. 
13748 
13749 The static specifier gives the declared objects static storage class, and may be used either 
13750 inside or outside functions. Inside a function, this specifier causes storage to be allocated, and 
13751 serves as a definition; for its effect outside a function, see Par.A.11.2. 
13752 
13753 A declaration with extern, used inside a function, specifies that the storage for the declared 
13754 objects is defined elsewhere; for its effects outside a function, see Par.A.11.2. 
13755 
13756 The typedef specifier does not reserve storage and is called a storage class specifier only for 
13757 syntactic convenience; it is discussed in Par.A.8.9. 
13758 
13759 
13760 At most one storage class specifier may be given in a declaration. If none is given, these rules 
13761 are used: objects declared inside a function are taken to be auto; functions declared within a 
13762 function are taken to be extern; objects and functions declared outside a function are taken to 
13763 be static, with external linkage. See Pars. A.10-A.11. 
13764 
13765 A.8.2 Type Specifiers 
13766 
13767 The type-specifiers are 
13768 
13769 At most one of the words long or short may be specified together with int; the meaning is 
13770 the same if int is not mentioned. The word long may be specified together with double. At 
13771 most one of signed or unsigned may be specified together with int or any of its short or 
13772 long varieties, or with char. Either may appear alone in which case int is understood. The 
13773 signed specifier is useful for forcing char objects to carry a sign; it is permissible but 
13774 redundant with other integral types. 
13775 
13776 Otherwise, at most one type-specifier may be given in a declaration. If the type-specifier is 
13777 missing from a declaration, it is taken to be int. 
13778 
13779 Types may also be qualified, to indicate special properties of the objects being declared. 
13780 
 const 
13783 volatile 
13784 
13785 Type qualifiers may appear with any type specifier. A const object may be initialized, but not 
13786 thereafter assigned to. There are no implementation-dependent semantics for volatile 
13787 objects. 
13788 
13789 The const and volatile properties are new with the ANSI standard. The purpose of const is to 
13790 announce objects that may be placed in read-only memory, and perhaps to increase opportunities for 
13791 optimization. The purpose of volatile is to force an implementation to suppress optimization that 
13792 could otherwise occur. For example, for a machine with memory-mapped input/output, a pointer to a 
13793 device register might be declared as a pointer to volatile, in order to prevent the compiler from 
13794 removing apparently redundant references through the pointer. Except that it should diagnose explicit 
13795 attempts to change const objects, a compiler may ignore these qualifiers. 
13796 
13797 A.8.3 Structure and Union Declarations 
13798 
13799 
13800 A structure is an object consisting of a sequence of named members of various types. A union 
13801 is an object that contains, at different times, any of several members of various types. 
13802 Structure and union specifiers have the same form. 
13803 
 struct-or-union identifieropt{ struct-declaration-list } 
13806 struct-or-union identifier 
13807 
 struct 
13810 union 
13811 
13812 A struct-declaration-list is a sequence of declarations for the members of the structure or 
13813 union: 
13814 
 struct declaration 
13817 struct-declaration-list struct declaration 
13818 
 
 type-specifier specifier-qualifier-listopt 
13823 type-qualifier specifier-qualifier-listopt 
13824 
 struct-declarator 
13827 struct-declarator-list , struct-declarator 
13828 
13829 Usually, a struct-declarator is just a declarator for a member of a structure or union. A 
13830 structure member may also consist of a specified number of bits. Such a member is also called 
13831 a bit-field; its length is set off from the declarator for the field name by a colon. 
13832 
 declarator declaratoropt : constant-expression 
13835 
13836 A type specifier of the form 
13837 
 
13840 declares the identifier to be the tag of the structure or union specified by the list. A subsequent 
13841 declaration in the same or an inner scope may refer to the same type by using the tag in a 
13842 specifier without the list: 
13843 
 
13846 If a specifier with a tag but without a list appears when the tag is not declared, an incomplete 
13847 type is specified. Objects with an incomplete structure or union type may be mentioned in 
13848 contexts where their size is not needed, for example in declarations (not definitions), for 
13849 specifying a pointer, or for creating a typedef, but not otherwise. The type becomes complete 
13850 on occurrence of a subsequent specifier with that tag, and containing a declaration list. Even 
13851 
13852 
13853 in specifiers with a list, the structure or union type being declared is incomplete within the 
13854 list, and becomes complete only at the } terminating the specifier. 
13855 
13856 A structure may not contain a member of incomplete type. Therefore, it is impossible to 
13857 declare a structure or union containing an instance of itself. However, besides giving a name 
13858 to the structure or union type, tags allow definition of self-referential structures; a structure or 
13859 union may contain a pointer to an instance of itself, because pointers to incomplete types may 
13860 be declared. 
13861 
13862 A very special rule applies to declarations of the form 
13863 
 
13866 that declare a structure or union, but have no declaration list and no declarators. Even if the 
13867 identifier is a structure or union tag already declared in an outer scope (Par.A.11.1), this 
13868 declaration makes the identifier the tag of a new, incompletely-typed structure or union in the 
13869 current scope. 
13870 
13871 This recondite is new with ANSI. It is intended to deal with mutually-recursive structures declared in an 
13872 inner scope, but whose tags might already be declared in the outer scope. 
13873 
13874 A structure or union specifier with a list but no tag creates a unique type; it can be referred to 
13875 directly only in the declaration of which it is a part. 
13876 
13877 The names of members and tags do not conflict with each other or with ordinary variables. A 
13878 member name may not appear twice in the same structure or union, but the same member 
13879 name may be used in different structures or unions. 
13880 
13881 In the first edition of this book, the names of structure and union members were not associated with 
13882 their parent. However, this association became common in compilers well before the ANSI standard. 
13883 
13884 A non-field member of a structure or union may have any object type. A field member (which 
13885 need not have a declarator and thus may be unnamed) has type int, unsigned int, or 
13886 signed int, and is interpreted as an object of integral type of the specified length in bits; 
13887 whether an int field is treated as signed is implementation-dependent. Adjacent field 
13888 members of structures are packed into implementation-dependent storage units in an 
13889 implementation-dependent direction. When a field following another field will not fit into a 
13890 partially-filled storage unit, it may be split between units, or the unit may be padded. An 
13891 unnamed field with width 0 forces this padding, so that the next field will begin at the edge of 
13892 the next allocation unit. 
13893 
13894 The ANSI standard makes fields even more implementation-dependent than did the first edition. It is 
13895 advisable to read the language rules for storing bit-fields as ``implementation-dependent'' without 
13896 qualification. Structures with bit-fields may be used as a portable way of attempting to reduce the 
13897 storage required for a structure (with the probable cost of increasing the instruction space, and time, 
13898 needed to access the fields), or as a non-portable way to describe a storage layout known at the bit-
13899 level. In the second case, it is necessary to understand the rules of the local implementation. 
13900 
13901 The members of a structure have addresses increasing in the order of their declarations. A 
13902 non-field member of a structure is aligned at an addressing boundary depending on its type; 
13903 therefore, there may be unnamed holes in a structure. If a pointer to a structure is cast to the 
13904 type of a pointer to its first member, the result refers to the first member. 
13905 
13906 
13907 A union may be thought of as a structure all of whose members begin at offset 0 and whose 
13908 size is sufficient to contain any of its members. At most one of the members can be stored in a 
13909 union at any time. If a pointr to a union is cast to the type of a pointer to a member, the result 
13910 refers to that member. 
13911 
13912 A simple example of a structure declaration is 
13913 
 
 
 
 
 
 
13926 which contains an array of 20 characters, an integer, and two pointers to similar structures. 
13927 Once this declaration has bene given, the declaration 
13928 
 
 
13933 declares s to be a structure of the given sort, and sp to be a pointer to a structure of the given 
13934 sort. With these declarations, the expression 
13935 
 
13938 refers to the count field of the structure to which sp points; 
13939 
 
 
13944 refers to the left subtree pointer of the structure s, and 
13945 
 
 
13950 refers to the first character of the tword member of the right subtree of s. 
13951 
13952 In general, a member of a union may not be inspected unless the value of the union has been 
13953 assigned using the same member. However, one special guarantee simplifies the use of 
13954 unions: if a union contains several structures that share a common initial sequence, and the 
13955 union currently contains one of these structures, it is permitted to refer to the common initial 
13956 part of any of the contained structures. For example, the following is a legal fragment: 
13957 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
13998 A.8.4 Enumerations 
13999 
14000 
14001 Enumerations are unique types with values ranging over a set of named constants called 
14002 enumerators. The form of an enumeration specifier borrows from that of structures and 
14003 unions. 
14004 
 enum identifieropt { enumerator-list } 
14007 enum identifier 
14008 
 enumerator 
14011 enumerator-list , enumerator 
14012 
 identifier 
14015 identifier = constant-expression 
14016 
14017 The identifiers in an enumerator list are declared as constants of type int, and may appear 
14018 wherever constants are required. If no enumerations with = appear, then the values of the 
14019 corresponding constants begin at 0 and increase by 1 as the declaration is read from left to 
14020 right. An enumerator with = gives the associated identifier the value specified; subsequent 
14021 identifiers continue the progression from the assigned value. 
14022 
14023 Enumerator names in the same scope must all be distinct from each other and from ordinary 
14024 variable names, but the values need not be distinct. 
14025 
14026 The role of the identifier in the enum-specifier is analogous to that of the structure tag in a 
14027 struct-specifier; it names a particular enumeration. The rules for enum-specifiers with and 
14028 without tags and lists are the same as those for structure or union specifiers, except that 
14029 incomplete enumeration types do not exist; the tag of an enum-specifier without an 
14030 enumerator list must refer to an in-scope specifier with a list. 
14031 
14032 Enumerations are new since the first edition of this book, but have been part of the language for some 
14033 years. 
14034 
14035 A.8.5 Declarators 
14036 
14037 Declarators have the syntax: 
14038 
 pointeropt direct-declarator 
14041 
 identifier 
14044 (declarator) 
14045 direct-declarator [ constant-expressionopt ] 
14046 direct-declarator ( parameter-type-list ) 
14047 direct-declarator ( identifier-listopt ) 
14048 
 * type-qualifier-listopt 
14051 * type-qualifier-listopt pointer 
14052 
14053 
 type-qualifier 
14056 type-qualifier-list type-qualifier 
14057 
14058 The structure of declarators resembles that of indirection, function, and array expressions; the 
14059 grouping is the same. 
14060 
14061 A.8.6 Meaning of Declarators 
14062 
14063 A list of declarators appears after a sequence of type and storage class specifiers. Each 
14064 declarator declares a unique main identifier, the one that appears as the first alternative of the 
14065 production for direct-declarator. The storage class specifiers apply directly to this identifier, 
14066 but its type depends on the form of its declarator. A declarator is read as an assertion that 
14067 when its identifier appears in an expression of the same form as the declarator, it yields an 
14068 object of the specified type. 
14069 
14070 Considering only the type parts of the declaration specifiers (Par. A.8.2) and a particular 
14071 declarator, a declaration has the form ``T D,'' where T is a type and D is a declarator. The type 
14072 attributed to the identifier in the various forms of declarator is described inductively using this 
14073 notation. 
14074 
14075 In a declaration T D where D is an unadored identifier, the type of the identifier is T. 
14076 
14077 In a declaration T D where D has the form 
14078 
 
 
14083 then the type of the identifier in D1 is the same as that of D. The parentheses do not alter the 
14084 type, but may change the binding of complex declarators. 
14085 
14086 A.8.6.1 Pointer Declarators 
14087 
14088 In a declaration T D where D has the form 
14089 
 
14092 and the type of the identifier in the declaration T D1 is ``type-modifier T,'' the type of the 
14093 identifier of D is ``type-modifier type-qualifier-list pointer to T.'' Qualifiers following * apply 
14094 to pointer itself, rather than to the object to which the pointer points. 
14095 
14096 For example, consider the declaration 
14097 
 
 
14102 Here, ap[] plays the role of D1; a declaration ``int ap[]'' (below) would give ap the type 
14103 ``array of int,'' the type-qualifier list is empty, and the type-modifier is ``array of.'' Hence the 
14104 actual declaration gives ap the type ``array to pointers to int.'' 
14105 
14106 As other examples, the declarations 
14107 
 
 
 
14114 
14115 declare an integer i and a pointer to an integer pi. The value of the constant pointer cpi may 
14116 not be changed; it will always point to the same location, although the value to which it refers 
14117 may be altered. The integer ci is constant, and may not be changed (though it may be 
14118 initialized, as here.) The type of pci is ``pointer to const int,'' and pci itself may be 
14119 changed to point to another place, but the value to which it points may not be altered by 
14120 assigning through pci. 
14121 
14122 A.8.6.2 Array Declarators 
14123 
14124 In a declaration T D where D has the form 
14125 
 
14128 and the type of the identifier in the declaration T D1 is ``type-modifier T,'' the type of the 
14129 identifier of D is ``type-modifier array of T.'' If the constant-expression is present, it must have 
14130 integral type, and value greater than 0. If the constant expression specifying the bound is 
14131 missing, the array has an incomplete type. 
14132 
14133 An array may be constructed from an arithmetic type, from a pointer, from a structure or 
14134 union, or from another array (to generate a multi-dimensional array). Any type from which an 
14135 array is constructed must be complete; it must not be an array of structure of incomplete type. 
14136 This implies that for a multi-dimensional array, only the first dimension may be missing. The 
14137 type of an object of incomplete aray type is completed by another, complete, declaration for 
14138 the object (Par.A.10.2), or by initializing it (Par.A.8.7). For example, 
14139 
 
 
14144 declares an array of float numbers and an array of pointers to float numbers. Also, 
14145 
 
 
14150 declares a static three-dimensional array of integers, with rank 3 X 5 X 7. In complete detail, 
14151 x3d is an array of three items: each item is an array of five arrays; each of the latter arrays is 
14152 an array of seven integers. Any of the expressions x3d, x3d[i], x3d[i][j], x3d[i][j][k] 
14153 may reasonably appear in an expression. The first three have type ``array,'', the last has type 
14154 int. More specifically, x3d[i][j] is an array of 7 integers, and x3d[i] is an array of 5 
14155 arrays of 7 integers. 
14156 
14157 The array subscripting operation is defined so that E1[E2] is identical to *(E1+E2). 
14158 Therefore, despite its asymmetric appearance, subscripting is a commutative operation. 
14159 Because of the conversion rules that apply to + and to arrays (Pars.A6.6, A.7.1, A.7.7), if E1 is 
14160 an array and E2 an integer, then E1[E2] refers to the E2-th member of E1. 
14161 
14162 In the example, x3d[i][j][k] is equivalent to *(x3d[i][j] + k). The first subexpression 
14163 x3d[i][j] is converted by Par.A.7.1 to type ``pointer to array of integers,'' by Par.A.7.7, the 
14164 addition involves multiplication by the size of an integer. It follows from the rules that arrays 
14165 are stored by rows (last subscript varies fastest) and that the first subscript in the declaration 
14166 helps determine the amount of storage consumed by an array, but plays no other part in 
14167 subscript calculations. 
14168 
14169 A.8.6.3 Function Declarators 
14170 
14171 In a new-style function declaration T D where D has the form 
14172 
14173 
14174 D1 (parameter-type-list) 
14175 
14176 and the type of the identifier in the declaration T D1 is ``type-modifierT,'' the type of the 
14177 identifier ofD is ``type-modifier function with arguments parameter-type-list returning T.'' 
14178 
14179 The syntax of the parameters is 
14180 
14181 parameter-type-list: 
14182 parameter-listparameter-list, ...
14183 
14184 parameter-list: 
14185 parameter-declarationparameter-list,parameter-declaration
14186 
14187 parameter-declaration: 
14188 declaration-specifiers declaratordeclaration-specifiers abstract-declaratoropt
14189 
14190 In the new-style declaration, the parameter list specifies the types of the parameters. As a 
14191 special case, the declarator for a new-style function with no parameters has a parameter list 
14192 consisting soley of the keyword void. If the parameter list ends with an ellipsis ``, ...'', thenthe function may accept more arguments than the number of parameters explicitly described, 
14193 see Par.A.7.3.2. 
14194 
14195 The types of parameters that are arrays or functions are altered to pointers, in accordance with 
14196 the rules for parameter conversions; see Par.A.10.1. The only storage class specifier permitted 
14197 in a parameter's declaration is register, and this specifier is ignored unless the function 
14198 declarator heads a function definition. Similarly, if the declarators in the parameter 
14199 declarations contain identifiers and the function declarator does not head a function definition, 
14200 the identifiers go out of scope immediately. Abstract declarators, which do not mention the 
14201 identifiers, are discussed in Par.A.8.8. 
14202 
14203 In an old-style function declaration T D where D has the form
14204 
14205 D1(identifier-listopt) 
14206 
14207 and the type of the identifier in the declaration T D1 is ``type-modifierT,'' the type of the 
14208 identifier ofD is ``type-modifier function of unspecified arguments returning T.'' Theparameters (if present) have the form
14209 
14210 identifier-list: 
14211 identifieridentifier-list,identifier
14212 
14213 In the old-style declarator, the identifier list must be absent unless the declarator is used in the 
14214 head of a function definition (Par.A.10.1). No information about the types of the parameters is 
14215 supplied by the declaration. 
14216 
14217 For example, the declaration 
14218 
14219 
 
14222 declares a function f returning an integer, a function fpi returning a pointer to an integer, and 
14223 a pointer pfi to a function returning an integer. In none of these are the parameter types 
14224 specified; they are old-style. 
14225 
14226 In the new-style declaration 
14227 
 
 
14232 strcpy is a function returning int, with two arguments, the first a character pointer, and the 
14233 second a pointer to constant characters. The parameter names are effectively comments. The 
14234 second function rand takes no arguments and returns int. 
14235 
14236 Function declarators with parameter prototypes are, by far, the most important language change 
14237 introduced by the ANSI standard. They offer an advantage over the ``old-style'' declarators of the first 
14238 edition by providing error-detection and coercion of arguments across function calls, but at a cost: 
14239 turmoil and confusion during their introduction, and the necessity of accomodating both forms. Some 
14240 syntactic ugliness was required for the sake of compatibility, namely void as an explicit marker of 
14241 new-style functions without parameters. 
14242 
14243 The ellipsis notation ``, ...'' for variadic functions is also new, and, together with the macros in the 
14244 standard header <stdarg.h>, formalizes a mechanism that was officially forbidden but unofficially 
14245 condoned in the first edition. 
14246 
14247 These notations were adapted from the C++ language. 
14248 
14249 When an object is declared, its init-declarator may specify an initial value for the identifier 
14250 being declared. The initializer is preceded by =, and is either an expression, or a list of 
14251 initializers nested in braces. A list may end with a comma, a nicety for neat formatting. 
14252 
 assignment-expression 
14255 { initializer-list } 
14256 { initializer-list , } 
14257 
 initializer 
14260 initializer-list , initializer 
14261 
14262 All the expressions in the initializer for a static object or array must be constant expressions as 
14263 described in Par.A.7.19. The expressions in the initializer for an auto or register object or 
14264 array must likewise be constant expressions if the initializer is a brace-enclosed list. However, 
14265 if the initializer for an automatic object is a single expression, it need not be a constant 
14266 expression, but must merely have appropriate type for assignment to the object. 
14267 
14268 The first edition did not countenance initialization of automatic structures, unions, or arrays. The ANSI 
14269 standard allows it, but only by constant constructions unless the initializer can be expressed by a simple 
14270 expression. 
14271 
14272 A static object not explicitly initialized is initialized as if it (or its members) were assigned the 
14273 constant 0. The initial value of an automatic object not explicitly intialized is undefined. 
14274 
14275 
14276 The initializer for a pointer or an object of arithmetic type is a single expression, perhaps in 
14277 braces. The expression is assigned to the object. 
14278 
14279 The initializer for a structure is either an expression of the same type, or a brace-enclosed list 
14280 of initializers for its members in order. Unnamed bit-field members are ignored, and are not 
14281 initialized. If there are fewer initializers in the list than members of the structure, the trailing 
14282 members are initialized with 0. There may not be more initializers than members. Unnamed 
14283 bit-field members are ignored,and are not initialized. 
14284 
14285 The initializer for an array is a brace-enclosed list of initializers for its members. If the array 
14286 has unknown size, the number of initializers determines the size of the array, and its type 
14287 becomes complete. If the array has fixed size, the number of initializers may not exceed the 
14288 number of members of the array; if there are fewer, the trailing members are initialized with 
14289 0. 
14290 
14291 As a special case, a character array may be initialized by a string literal; successive characters 
14292 of the string initialize successive members of the array. Similarly, a wide character literal 
14293 (Par.A.2.6) may initialize an array of type wchar_t. If the array has unknown size, the 
14294 number of characters in the string, including the terminating null character, determines its 
14295 size; if its size is fixed, the number of characters in the string, not counting the terminating 
14296 null character, must not exceed the size of the array. 
14297 
14298 The initializer for a union is either a single expression of the same type, or a brace-enclosed 
14299 initializer for the first member of the union. 
14300 
14301 The first edition did not allow initialization of unions. The ``first-member'' rule is clumsy, but is hard to 
14302 generalize without new syntax. Besides allowing unions to be explicitly initialized in at least a primitive 
14303 way, this ANSI rule makes definite the semantics of static unions not explicitly initialized. 
14304 
14305 An aggregate is a structure or array. If an aggregate contains members of aggregate type, the 
14306 initialization rules apply recursively. Braces may be elided in the initialization as follows: if 
14307 the initializer for an aggregate's member that itself is an aggregate begins with a left brace, 
14308 then the succeding comma-separated list of initializers initializes the members of the 
14309 subaggregate; it is erroneous for there to be more initializers than members. If, however, the 
14310 initializer for a subaggregate does not begin with a left brace, then only enough elements from 
14311 the list are taken into account for the members of the subaggregate; any remaining members 
14312 are left to initialize the next member of the aggregate of which the subaggregate is a part. 
14313 
14314 For example, 
14315 
 
 
14320 declares and initializes x as a 1-dimensional array with three members, since no size was 
14321 specified and there are three initializers. 
14322 
 
 
 
 
 
 
14335 is a completely-bracketed initialization: 1, 3 and 5 initialize the first row of the array y[0], 
14336 namely y[0][0], y[0][1], and y[0][2]. Likewise the next two lines initialize y[1] and 
14337 y[2]. The initializer ends early, and therefore the elements of y[3] are initialized with 0. 
14338 Precisely the same effect could have been achieved by 
14339 
14340 
 
 
 
 
14349 The initializer for y begins with a left brace, but that for y[0] does not; therefore three 
14350 elements from the list are used. Likewise the next three are taken successively for y[1] and 
14351 for y[2]. Also, 
14352 
 
 
 
 
14361 initializes the first column of y (regarded as a two-dimensional array) and leaves the rest 0. 
14362 
14363 Finally, 
14364 
 
 
14369 shows a character array whose members are initialized with a string; its size includes the 
14370 terminating null character. 
14371 
14372 A.8.8 Type names 
14373 
14374 In several contexts (to specify type conversions explicitly with a cast, to declare parameter 
14375 types in function declarators, and as argument of sizeof) it is necessary to supply the name 
14376 of a data type. This is accomplished using a type name, which is syntactically a declaration for 
14377 an object of that type omitting the name of the object. 
14378 
 specifier-qualifier-list abstract-declaratoropt 
14381 
 pointer 
14384 pointeropt direct-abstract-declarator 
14385 
 ( abstract-declarator ) 
14388 direct-abstract-declaratoropt [constant-expressionopt] 
14389 direct-abstract-declaratoropt (parameter-type-listopt) 
14390 
14391 It is possible to identify uniquely the location in the abstract-declarator where the identifier 
14392 would appear if the construction were a declarator in a declaration. The named type is then the 
14393 same as the type of the hypothetical identifier. For example, 
14394 
 
 
 
 
 
 
 
14409 name respectively the types ``integer,'' ``pointer to integer,'' ``array of 3 pointers to integers,'' 
14410 ``pointer to an unspecified number of integers,'' ``function of unspecified parameters returning 
14411 pointer to integer,'' and ``array, of unspecified size, of pointers to functions with no 
14412 parameters each returning an integer.'' 
14413 
14414 
14415 A.8.9 Typedef 
14416 
14417 Declarations whose storage class specifier is typedef do not declare objects; instead they 
14418 define identifiers that name types. These identifiers are called typedef names. 
14419 
 identifier 
14422 
14423 A typedef declaration attributes a type to each name among its declarators in the usual way 
14424 (see Par.A.8.6). Thereafter, each such typedef name is syntactically equivalent to a type 
14425 specifier keyword for the associated type. 
14426 
14427 For example, after 
14428 
 
 
 
 
 
 
14441 are legal declarations. The type of b is long, that of bp is ``pointer to long,'' and that of z is 
14442 the specified structure; zp is a pointer to such a structure. 
14443 
14444 typedef does not introduce new types, only synonyms for types that could be specified in 
14445 another way. In the example, b has the same type as any long object. 
14446 
14447 Typedef names may be redeclared in an inner scope, but a non-empty set of type specifiers 
14448 must be given. For example, 
14449 
 
14452 does not redeclare Blockno, but 
14453 
 
 
14458 does. 
14459 
14460 A.8.10 Type Equivalence 
14461 
14462 Two type specifier lists are equivalent if they contain the same set of type specifiers, taking 
14463 into account that some specifiers can be implied by others (for example, long alone implies 
14464 long int). Structures, unions, and enumerations with different tags are distinct, and a tagless 
14465 union, structure, or enumeration specifies a unique type. 
14466 
14467 Two types are the same if their abstract declarators (Par.A.8.8), after expanding any typedef 
14468 types, and deleting any function parameter specifiers, are the same up to the equivalence of 
14469 type specifier lists. Array sizes and function parameter types are significant. 
14470 
14471 A.9 Statements 
14472 
14473 Except as described, statements are executed in sequence. Statements are executed for their 
14474 effect, and do not have values. They fall into several groups. 
14475 
14476 
 labeled-statement 
14479 expression-statement 
14480 compound-statement 
14481 selection-statement 
14482 iteration-statement 
14483 jump-statement 
14484 
14485 A.9.1 Labeled Statements 
14486 
14487 Statements may carry label prefixes. 
14488 
 identifier : statement 
14491 case constant-expression : statement 
14492 default : statement 
14493 
14494 A label consisting of an identifier declares the identifier. The only use of an identifier label is 
14495 as a target of goto. The scope of the identifier is the current function. Because labels have 
14496 their own name space, they do not interfere with other identifiers and cannot be redeclared. 
14497 See Par.A.11.1. 
14498 
14499 Case labels and default labels are used with the switch statement (Par.A.9.4). The constant 
14500 expression of case must have integral type. 
14501 
14502 Labels themselves do not alter the flow of control. 
14503 
14504 A.9.2 Expression Statement 
14505 
14506 Most statements are expression statements, which have the form 
14507 
 expressionopt; 
14510 
14511 Most expression statements are assignments or function calls. All side effects from the 
14512 expression are completed before the next statement is executed. If the expression is missing, 
14513 the construction is called a null statement; it is often used to supply an empty body to an 
14514 iteration statement to place a label. 
14515 
14516 A.9.3 Compound Statement 
14517 
14518 So that several statements can be used where one is expected, the compound statement (also 
14519 called ``block'') is provided. The body of a function definition is a compound statement. 
14520 
 { declaration-listopt statement-listopt } 
14523 
 declaration 
14526 declaration-list declaration 
14527 
14528 
 statement 
14531 statement-list statement 
14532 
14533 If an identifier in the declaration-list was in scope outside the block, the outer declaration is 
14534 suspended within the block (see Par.A.11.1), after which it resumes its force. An identifier 
14535 may be declared only once in the same block. These rules apply to identifiers in the same 
14536 name space (Par.A.11); identifiers in different name spaces are treated as distinct. 
14537 
14538 Initialization of automatic objects is performed each time the block is entered at the top, and 
14539 proceeds in the order of the declarators. If a jump into the block is executed, these 
14540 initializations are not performed. Initialization of static objects are performed only once, 
14541 before the program begins execution. 
14542 
14543 A.9.4 Selection Statements 
14544 
14545 Selection statements choose one of several flows of control. 
14546 
 if (expression) statement 
14549 if (expression) statement else statement 
14550 switch (expression) statement 
14551 
14552 In both forms of the if statement, the expression, which must have arithmetic or pointer type, 
14553 is evaluated, including all side effects, and if it compares unequal to 0, the first substatement 
14554 is executed. In the second form, the second substatement is executed if the expression is 0. 
14555 The else ambiguity is resolved by connecting an else with the last encountered else-less if 
14556 at the same block nesting level. 
14557 
14558 The switch statement causes control to be transferred to one of several statements depending 
14559 on the value of an expression, which must have integral type. The substatement controlled by 
14560 a switch is typically compound. Any statement within the substatement may be labeled with 
14561 one or more case labels (Par.A.9.1). The controlling expression undergoes integral promotion 
14562 (Par.A.6.1), and the case constants are converted to the promoted type. No two of these case 
14563 constants associated with the same switch may have the same value after conversion. There 
14564 may also be at most one default label associated with a switch. Switches may be nested; a 
14565 case or default label is associated with the smallest switch that contains it. 
14566 
14567 When the switch statement is executed, its expression is evaluated, including all side effects, 
14568 and compared with each case constant. If one of the case constants is equal to the value of the 
14569 expression, control passes to the statement of the matched case label. If no case constant 
14570 matches the expression, and if there is a default label, control passes to the labeled 
14571 statement. If no case matches, and if there is no default, then none of the substatements of 
14572 the swtich is executed. 
14573 
14574 In the first edition of this book, the controlling expression of switch, and the case constants, were 
14575 required to have int type. 
14576 
14577 A.9.5 Iteration Statements 
14578 
14579 Iteration statements specify looping. 
14580 
14581 
 while (expression) statement 
14584 do statement while (expression); 
14585 for (expressionopt; expressionopt; expressionopt) statement 
14586 
14587 In the while and do statements, the substatement is executed repeatedly so long as the value 
14588 of the expression remains unequal to 0; the expression must have arithmetic or pointer type. 
14589 With while, the test, including all side effects from the expression, occurs before each 
14590 execution of the statement; with do, the test follows each iteration. 
14591 
14592 In the for statement, the first expression is evaluated once, and thus specifies initialization for 
14593 the loop. There is no restriction on its type. The second expression must have arithmetic or 
14594 pointer type; it is evaluated before each iteration, and if it becomes equal to 0, the for is 
14595 terminated. The third expression is evaluated after each iteration, and thus specifies a re-
14596 initialization for the loop. There is no restriction on its type. Side-effects from each expression 
14597 are completed immediately after its evaluation. If the substatement does not contain 
14598 continue, a statement 
14599 
 
14602 is equivalent to 
14603 
 
14606 expression1; 
14607 
14608 while (expression2) { 
14609 
 
 
14614 } 
14615 
14616 Any of the three expressions may be dropped. A missing second expression makes the 
14617 implied test equivalent to testing a non-zero element. 
14618 
14619 A.9.6 Jump statements 
14620 
14621 Jump statements transfer control unconditionally. 
14622 
 goto identifier; 
14625 continue; 
14626 break; 
14627 return expressionopt; 
14628 
14629 In the goto statement, the identifier must be a label (Par.A.9.1) located in the current 
14630 function. Control transfers to the labeled statement. 
14631 
14632 A continue statement may appear only within an iteration statement. It causes control to pass 
14633 to the loop-continuation portion of the smallest enclosing such statement. More precisely, 
14634 within each of the statements 
14635 
 
 
 
 
 
14646 
14647 a continue not contained in a smaller iteration statement is the same as goto contin. 
14648 
14649 A function returns to its caller by the return statement. When return is followed by an 
14650 expression, the value is returned to the caller of the function. The expression is converted, as 
14651 by assignment, to the type returned by the function in which it appears. 
14652 
14653 Flowing off the end of a function is equivalent to a return with no expression. In either case, 
14654 the returned value is undefined. 
14655 
14656 A.10 External Declarations 
14657 
14658 The unit of input provided to the C compiler is called a translation unit; it consists of a 
14659 sequence of external declarations, which are either declarations or function definitions. 
14660 
 external-declaration 
14663 translation-unit external-declaration 
14664 
 function-definition 
14667 declaration 
14668 
14669 The scope of external declarations persists to the end of the translation unit in which they are 
14670 declared, just as the effect of declarations within the blocks persists to the end of the block. 
14671 The syntax of external declarations is the same as that of all declarations, except that only at 
14672 this level may the code for functions be given. 
14673 
14674 A.10.1 Function Definitions 
14675 
14676 Function definitions have the form 
14677 
 declaration-specifiersopt declarator declaration-listopt compound-statement 
14680 
14681 The only storage-class specifiers allowed among the declaration specifiers are extern or 
14682 static; see Par.A.11.2 for the distinction between them. 
14683 
14684 A function may return an arithmetic type, a structure, a union, a pointer, or void, but not a 
14685 function or an array. The declarator in a function declaration must specify explicitly that the 
14686 declared identifier has function type; that is, it must contain one of the forms (see 
14687 Par.A.8.6.3). 
14688 
 direct-declarator ( identifier-listopt ) 
14691 
14692 where the direct-declarator is an identifier or a parenthesized identifier. In particular, it must 
14693 not achieve function type by means of a typedef. 
14694 
14695 
14696 In the first form, the definition is a new-style function, and its parameters, together with their 
14697 types, are declared in its parameter type list; the declaration-list following the function's 
14698 declarator must be absent. Unless the parameter type list consists solely of void, showing that 
14699 the function takes no parameters, each declarator in the parameter type list must contain an 
14700 identifier. If the parameter type list ends with ``, ...'' then the function may be called with 
14701 more arguments than parameters; the va_arg macro mechanism defined in the standard 
14702 header <stdarg.h> and described in Appendix B must be used to refer to the extra 
14703 arguments. Variadic functions must have at least one named parameter. 
14704 
14705 In the second form, the definition is old-style: the identifier list names the parameters, while 
14706 the declaration list attributes types to them. If no declaration is given for a parameter, its type 
14707 is taken to be int. The declaration list must declare only parameters named in the list, 
14708 initialization is not permitted, and the only storage-class specifier possible is register. 
14709 
14710 In both styles of function definition, the parameters are understood to be declared just after 
14711 the beginning of the compound statement constituting the function's body, and thus the same 
14712 identifiers must not be redeclared there (although they may, like other identifiers, be 
14713 redeclared in inner blocks). If a parameter is declared to have type ``array of type,'' the 
14714 declaration is adjusted to read ``pointer to type;'' similarly, if a parameter is declared to have 
14715 type ``function returning type,'' the declaration is adjusted to read ``pointer to function 
14716 returning type.'' During the call to a function, the arguments are converted as necessary and 
14717 assigned to the parameters; see Par.A.7.3.2. 
14718 
14719 New-style function definitions are new with the ANSI standard. There is also a small change in the 
14720 details of promotion; the first edition specified that the declarations of float parameters were adjusted 
14721 to read double. The difference becomes noticable when a pointer to a parameter is generated within a 
14722 function. 
14723 
14724 A complete example of a new-style function definition is 
14725 
 
 
 
 
 
 
 
 
14742 Here int is the declaration specifier; max(int a, int b, int c) is the function's 
14743 declarator, and { ... } is the block giving the code for the function. The corresponding old-
14744 style definition would be 
14745 
 
 
 
 
 
 
14758 where now int max(a, b, c) is the declarator, and int a, b, c; is the declaration list for 
14759 the parameters. 
14760 
14761 A.10.2 External Declarations 
14762 
14763 External declarations specify the characteristics of objects, functions and other identifiers. The 
14764 term ``external'' refers to their location outside functions, and is not directly connected with 
14765 
14766 
14767 the extern keyword; the storage class for an externally-declared object may be left empty, or 
14768 it may be specified as extern or static. 
14769 
14770 Several external declarations for the same identifier may exist within the same translation unit 
14771 if they agree in type and linkage, and if there is at most one definition for the identifier. 
14772 
14773 Two declarations for an object or function are deemed to agree in type under the rule 
14774 discussed in Par.A.8.10. In addition, if the declarations differ because one type is an 
14775 incomplete structure, union, or enumeration type (Par.A.8.3) and the other is the 
14776 corresponding completed type with the same tag, the types are taken to agree. Moreover, if 
14777 one type is an incomplete array type (Par.A.8.6.2) and the other is a completed array type, the 
14778 types, if otherwise identical, are also taken to agree. Finally, if one type specifies an old-style 
14779 function, and the other an otherwise identical new-style function, with parameter declarations, 
14780 the types are taken to agree. 
14781 
14782 If the first external declarator for a function or object includes the static specifier, the 
14783 identifier has internal linkage; otherwise it has external linkage. Linkage is discussed in 
14784 Par.11.2. 
14785 
14786 An external declaration for an object is a definition if it has an initializer. An external object 
14787 declaration that does not have an initializer, and does not contain the extern specifier, is a 
14788 tentative definition. If a definition for an object appears in a translation unit, any tentative 
14789 definitions are treated merely as redundant declarations. If no definition for the object appears 
14790 in the translation unit, all its tentative definitions become a single definition with initializer 0. 
14791 
14792 Each object must have exactly one definition. For objects with internal linkage, this rule 
14793 applies separately to each translation unit, because internally-linked objects are unique to a 
14794 translation unit. For objects with external linkage, it applies to the entire program. 
14795 
14796 Although the one-definition rule is formulated somewhat differently in the first edition of this book, it is 
14797 in effect identical to the one stated here. Some implementations relax it by generalizing the notion of 
14798 tentative definition. In the alternate formulation, which is usual in UNIX systems and recognized as a 
14799 common extension by the Standard, all the tentative definitions for an externally linked object, 
14800 throughout all the translation units of the program, are considered together instead of in each translation 
14801 unit separately. If a definition occurs somewhere in the program, then the tentative definitions become 
14802 merely declarations, but if no definition appears, then all its tentative definitions become a definition 
14803 with initializer 0. 
14804 
14805 A.11 Scope and Linkage 
14806 
14807 A program need not all be compiled at one time: the source text may be kept in several files 
14808 containing translation units, and precompiled routines may be loaded from libraries. 
14809 Communication among the functions of a program may be carried out both through calls and 
14810 through manipulation of external data. 
14811 
14812 Therefore, there are two kinds of scope to consider: first, the lexical scope of an identifier 
14813 which is the region of the program text within which the identifier's characteristics are 
14814 understood; and second, the scope associated with objects and functions with external linkage, 
14815 which determines the connections between identifiers in separately compiled translation units. 
14816 
14817 A.11.1 Lexical Scope 
14818 
14819 
14820 Identifiers fall into several name spaces that do not interfere with one another; the same 
14821 identifier may be used for different purposes, even in the same scope, if the uses are in 
14822 different name spaces. These classes are: objects, functions, typedef names, and enum 
14823 constants; labels; tags of structures or unions, and enumerations; and members of each 
14824 structure or union individually. 
14825 
14826 These rules differ in several ways from those described in the first edition of this manual. Labels did not 
14827 previously have their own name space; tags of structures and unions each had a separate space, and in 
14828 some implementations enumerations tags did as well; putting different kinds of tags into the same space 
14829 is a new restriction. The most important departure from the first edition is that each structure or union 
14830 creates a separate name space for its members, so that the same name may appear in several different 
14831 structures. This rule has been common practice for several years. 
14832 
14833 The lexical scope of an object or function identifier in an external declaration begins at the 
14834 end of its declarator and persists to the end of the translation unit in which it appears. The 
14835 scope of a parameter of a function definition begins at the start of the block defining the 
14836 function, and persists through the function; the scope of a parameter in a function declaration 
14837 ends at the end of the declarator. The scope of an identifier declared at the head of a block 
14838 begins at the end of its declarator, and persists to the end of the block. The scope of a label is 
14839 the whole of the function in which it appears. The scope of a structure, union, or enumeration 
14840 tag, or an enumeration constant, begins at its appearance in a type specifier, and persists to the 
14841 end of a translation unit (for declarations at the external level) or to the end of the block (for 
14842 declarations within a function). 
14843 
14844 If an identifier is explicitly declared at the head of a block, including the block constituting a 
14845 function, any declaration of the identifier outside the block is suspended until the end of the 
14846 block. 
14847 
14848 A.11.2 Linkage 
14849 
14850 Within a translation unit, all declarations of the same object or function identifier with 
14851 internal linkage refer to the same thing, and the object or function is unique to that translation 
14852 unit. All declarations for the same object or function identifier with external linkage refer to 
14853 the same thing, and the object or function is shared by the entire program. 
14854 
14855 As discussed in Par.A.10.2, the first external declaration for an identifier gives the identifier 
14856 internal linkage if the static specifier is used, external linkage otherwise. If a declaration for 
14857 an identifier within a block does not include the extern specifier, then the identifier has no 
14858 linkage and is unique to the function. If it does include extern, and an external declaration 
14859 for is active in the scope surrounding the block, then the identifier has the same linkage as the 
14860 external declaration, and refers to the same object or function; but if no external declaration is 
14861 visible, its linkage is external. 
14862 
14863 A.12 Preprocessing 
14864 
14865 A preprocessor performs macro substitution, conditional compilation, and inclusion of named 
14866 files. Lines beginning with #, perhaps preceded by white space, communicate with this 
14867 preprocessor. The syntax of these lines is independent of the rest of the language; they may 
14868 appear anywhere and have effect that lasts (independent of scope) until the end of the 
14869 translation unit. Line boundaries are significant; each line is analyzed individually (bus see 
14870 Par.A.12.2 for how to adjoin lines). To the preprocessor, a token is any language token, or a 
14871 character sequence giving a file name as in the #include directive (Par.A.12.4); in addition, 
14872 
14873 
14874 any character not otherwise defined is taken as a token. However, the effect of white spaces 
14875 other than space and horizontal tab is undefined within preprocessor lines. 
14876 
14877 Preprocessing itself takes place in several logically successive phases that may, in a particular 
14878 implementation, be condensed. 
14879 
14880 First, trigraph sequences as described in Par.A.12.1 are replaced by their equivalents. 
14881 Should the operating system environment require it, newline characters are introduced 
14882 between the lines of the source file. 
14883 Each occurrence of a backslash character \ followed by a newline is deleted, this 
14884 splicing lines (Par.A.12.2). 
14885 The program is split into tokens separated by white-space characters; comments are 
14886 replaced by a single space. Then preprocessing directives are obeyed, and macros 
14887 (Pars.A.12.3-A.12.10) are expanded. 
14888 4. Escape sequences in character constants and string literals (Pars. A.2.5.2, A.2.6) are 
14889 replaced by their equivalents; then adjacent string literals are concatenated. 
14890 
14891 
14892 5. The result is translated, then linked together with other programs and libraries, by 
14893 collecting the necessary programs and data, and connecting external functions and 
14894 object references to their definitions. 
14895 
14896 A.12.1 Trigraph Sequences 
14897 
14898 The character set of C source programs is contained within seven-bit ASCII, but is a superset 
14899 of the ISO 646-1983 Invariant Code Set. In order to enable programs to be represented in the 
14900 reduced set, all occurrences of the following trigraph sequences are replaced by the 
14901 corresponding single character. This replacement occurs before any other processing. 
14902 
 
 
 
 
14911 Trigraph sequences are new with the ANSI standard. 
14912 
14913 A.12.2 Line Splicing 
14914 
14915 Lines that end with the backslash character \ are folded by deleting the backslash and the 
14916 following newline character. This occurs before division into tokens. 
14917 
14918 A.12.3 Macro Definition and Expansion 
14919 
14920 A control line of the form 
14921 
 
14924 causes the preprocessor to replace subsequent instances of the identifier with the given 
14925 sequence of tokens; leading and trailing white space around the token sequence is discarded. 
14926 A second #define for the same identifier is erroneous unless the second token sequence is 
14927 identical to the first, where all white space separations are taken to be equivalent. 
14928 
14929 A line of the form 
14930 
 
14933 
14934 where there is no space between the first identifier and the (, is a macro definition with 
14935 parameters given by the identifier list. As with the first form, leading and trailing white space 
14936 arround the token sequence is discarded, and the macro may be redefined only with a 
14937 definition in which the number and spelling of parameters, and the token sequence, is 
14938 identical. 
14939 
14940 A control line of the form 
14941 
 
14944 causes the identifier's preprocessor definition to be forgotten. It is not erroneous to apply 
14945 #undef to an unknown identifier. 
14946 
14947 When a macro has been defined in the second form, subsequent textual instances of the macro 
14948 identifier followed by optional white space, and then by (, a sequence of tokens separated by 
14949 commas, and a ) constitute a call of the macro. The arguments of the call are the comma-
14950 separated token sequences; commas that are quoted or protected by nested parentheses do not 
14951 separate arguments. During collection, arguments are not macro-expanded. The number of 
14952 arguments in the call must match the number of parameters in the definition. After the 
14953 arguments are isolated, leading and trailing white space is removed from them. Then the 
14954 token sequence resulting from each argument is substituted for each unquoted occurrence of 
14955 the corresponding parameter's identifier in the replacement token sequence of the macro. 
14956 Unless the parameter in the replacement sequence is preceded by #, or preceded or followed 
14957 by ##, the argument tokens are examined for macro calls, and expanded as necessary, just 
14958 before insertion. 
14959 
14960 Two special operators influence the replacement process. First, if an occurrence of a 
14961 parameter in the replacement token sequence is immediately preceded by #, string quotes (") 
14962 are placed around the corresponding parameter, and then both the # and the parameter 
14963 identifier are replaced by the quoted argument. A \ character is inserted before each " or \ 
14964 character that appears surrounding, or inside, a string literal or character constant in the 
14965 argument. 
14966 
14967 Second, if the definition token sequence for either kind of macro contains a ## operator, then 
14968 just after replacement of the parameters, each ## is deleted, together with any white space on 
14969 either side, so as to concatenate the adjacent tokens and form a new token. The effect is 
14970 undefined if invalid tokens are produced, or if the result depends on the order of processing of 
14971 the ## operators. Also, ## may not appear at the beginning or end of a replacement token 
14972 sequence. 
14973 
14974 In both kinds of macro, the replacement token sequence is repeatedly rescanned for more 
14975 defined identifiers. However, once a given identifier has been replaced in a given expansion, 
14976 it is not replaced if it turns up again during rescanning; instead it is left unchanged. 
14977 
14978 Even if the final value of a macro expansion begins with with #, it is not taken to be a 
14979 preprocessing directive. 
14980 
14981 The details of the macro-expansion process are described more precisely in the ANSI standard than in 
14982 the first edition. The most important change is the addition of the # and ## operators, which make 
14983 quotation and concatenation admissible. Some of the new rules, especially those involving 
14984 concatenation, are bizarre. (See example below.) 
14985 
14986 
14987 For example, this facility may be used for ``manifest-constants,'' as in 
14988 
 
 
 
14995 The definition 
14996 
 
 
15001 defines a macro to return the absolute value of the difference between its arguments. Unlike a 
15002 function to do the same thing, the arguments and returned value may have any arithmetic type 
15003 or even be pointers. Also, the arguments, which might have side effects, are evaluated twice, 
15004 once for the test and once to produce the value. 
15005 
15006 Given the definition 
15007 
 
 
15012 the macro call tempfile(/usr/tmp) yields 
15013 
 
 
15018 which will subsequently be catenated into a single string. After 
15019 
 
 
15024 the call cat(var, 123) yields var123. However, the call cat(cat(1,2),3) is undefined: 
15025 the presence of ## prevents the arguments of the outer call from being expanded. Thus it 
15026 produces the token string 
15027 
 
 
15032 and )3 (the catenation of the last token of the first argument with the first token of the second) 
15033 is not a legal token. If a second level of macro definition is introduced, 
15034 
 
 
15039 things work more smoothly; xcat(xcat(1, 2), 3) does produce 123, because the 
15040 expansion of xcat itself does not involve the ## operator. 
15041 
15042 Likewise, ABSDIFF(ABSDIFF(a,b),c) produces the expected, fully-expanded result. 
15043 
15044 A.12.4 File Inclusion 
15045 
15046 A control line of the form 
15047 
 
15050 causes the replacement of that line by the entire contents of the file filename. The characters 
15051 in the name filename must not include > or newline, and the effect is undefined if it contains 
15052 any of ", ', \, or /*. The named file is searched for in a sequence of implementation-defined 
15053 places. 
15054 
15055 Similarly, a control line of the form 
15056 
 
15059 
15060 searches first in association with the original source file (a deliberately implementation-
15061 dependent phrase), and if that search fails, then as in the first form. The effect of using ', \, or 
15062 /* in the filename remains undefined, but > is permitted. 
15063 
15064 Finally, a directive of the form 
15065 
 
15068 not matching one of the previous forms is interpreted by expanding the token sequence as for 
15069 normal text; one of the two forms with <...> or "..." must result, and is then treated as 
15070 previously described. 
15071 
15072 #include files may be nested. 
15073 
15074 A.12.5 Conditional Compilation 
15075 
15076 Parts of a program may be compiled conditionally, according to the following schematic 
15077 syntax. 
15078 
 if-line text elif-parts else-partopt #endif 
15081 
 # if constant-expression 
15084 # ifdef identifier 
15085 # ifndef identifier 
15086 
 elif-line text 
15089 elif-partsopt 
15090 
 # elif constant-expression 
15093 
 else-line text 
15096 
 #else 
15099 
15100 Each of the directives (if-line, elif-line, else-line, and #endif) appears alone on a line. The 
15101 constant expressions in #if and subsequent #elif lines are evaluated in order until an 
15102 expression with a non-zero value is found; text following a line with a zero value is discarded. 
15103 The text following the successful directive line is treated normally. ``Text'' here refers to any 
15104 material, including preprocessor lines, that is not part of the conditional structure; it may be 
15105 empty. Once a successful #if or #elif line has been found and its text processed, succeeding 
15106 #elif and #else lines, together with their text, are discarded. If all the expressions are zero, 
15107 and there is an #else, the text following the #else is treated normally. Text controlled by 
15108 inactive arms of the conditional is ignored except for checking the nesting of conditionals. 
15109 
15110 
15111 The constant expression in #if and #elif is subject to ordinary macro replacement. 
15112 Moreover, any expressions of the form 
15113 
 
15116 or 
15117 
 
15120 The resulting constant expression (Par.A.7.19) is restricted: it must be integral, and may not 
15121 contain sizeof, a cast, or an enumeration constant. 
15122 
15123 The control lines 
15124 
 #ifndef identifier 
15127 
15128 are equivalent to 
15129 
 # if ! defined identifier 
15132 
15133 respectively. 
15134 
15135 #elif is new since the first edition, although it has been available is some preprocessors. The 
15136 defined preprocessor operator is also new. 
15137 
15138 A.12.6 Line Control 
15139 
15140 For the benefit of other preprocessors that generate C programs, a line in one of the forms 
15141 
 # line constant 
15144 
15145 causes the compiler to believe, for purposes of error diagnostics, that the line number of the 
15146 next source line is given by the decimal integer constant and the current input file is named by 
15147 the identifier. If the quoted filename is absent, the remembered name does not change. Macros 
15148 in the line are expanded before it is interpreted. 
15149 
15150 A.12.7 Error Generation 
15151 
15152 A preprocessor line of the form 
15153 
 
15156 causes the preprocessor to write a diagnostic message that includes the token sequence. 
15157 
15158 
15159 A.12.8 Pragmas 
15160 
15161 A control line of the form 
15162 
 
15165 causes the preprocessor to perform an implementation-dependent action. An unrecognized 
15166 pragma is ignored. 
15167 
15168 A.12.9 Null directive 
15169 
15170 A control line of the form 
15171 
 
15174 has no effect. 
15175 
15176 A.12.10 Predefined names 
15177 
15178 Several identifiers are predefined, and expand to produce special information. They, and also 
15179 the preprocessor expansion operator defined, may not be undefined or redefined. 
15180 
15181 __LINE__ 
15182 
15183 A decimal constant containing the current source line number. 
15184 
15185 __FILE__ 
15186 
15187 A string literal containing the name of the file being compiled. 
15188 
15189 __DATE__ 
15190 
15191 A string literal containing the date of compilation, in the form "Mmmm dd yyyy" 
15192 
15193 __TIME__ 
15194 
15195 A string literal containing the time of compilation, in the form "hh:mm:ss" 
15196 
15197 __STDC__ 
15198 
15199 The constant 1. It is intended that this identifier be defined to be 1 only in standard-
15200 conforming implementations. 
15201 
15202 #error and #pragma are new with the ANSI standard; the predefined preprocessor macros are new, 
15203 but some of them have been available in some implementations. 
15204 
15205 A.13 Grammar 
15206 
15207 Below is a recapitulation of the grammar that was given throughout the earlier part of this 
15208 appendix. It has exactly the same content, but is in different order. 
15209 
15210 The grammar has undefined terminal symbols integer-constant, character-constant, floating-
15211 constant, identifier, string, and enumeration-constant; the typewriter style words and 
15212 symbols are terminals given literally. This grammar can be transformed mechanically into 
15213 input acceptable for an automatic parser-generator. Besides adding whatever syntactic 
15214 marking is used to indicate alternatives in productions, it is necessary to expand the ``one of'' 
15215 constructions, and (depending on the rules of the parser-generator) to duplicate each 
15216 production with an opt symbol, once with the symbol and once without. With one further 
15217 change, namely deleting the production typedef-name: identifier and making typedef-name a 
15218 terminal symbol, this grammar is acceptable to the YACC parser-generator. It has only one 
15219 conflict, generated by the if-else ambiguity. 
15220 
 external-declaration 
15223 translation-unit external-declaration 
15224 
15225 
 function-definition 
15228 declaration 
15229 
 declaration-specifiersopt declarator declaration-listopt compound-statement 
15232 
 declaration-specifiers init-declarator-listopt; 
15235 
 declaration 
15238 declaration-list declaration 
15239 
 storage-class-specifier declaration-specifiersopt 
15242 type-specifier declaration-specifiersopt 
15243 type-qualifier declaration-specifiersopt 
15244 
 auto register static extern typedef 
15247 
 void char short int long float double signed 
15250 unsigned struct-or-union-specifier enum-specifier typedef-name 
15251 
 const volatile 
15254 
 struct-or-union identifieropt { struct-declaration-list } 
15257 struct-or-union identifier 
15258 
 struct union 
15261 
 struct declaration 
15264 struct-declaration-list struct declaration 
15265 
 init-declarator 
15268 init-declarator-list, init-declarator 
15269 
 declarator 
15272 declarator = initializer 
15273 
 specifier-qualifier-list struct-declarator-list; 
15276 
15277 
 type-specifier specifier-qualifier-listopt 
15280 type-qualifier specifier-qualifier-listopt 
15281 
 struct-declarator 
15284 struct-declarator-list , struct-declarator 
15285 
 declarator 
15288 declaratoropt : constant-expression 
15289 
 enum identifieropt { enumerator-list } 
15292 enum identifier 
15293 
 enumerator 
15296 enumerator-list , enumerator 
15297 
 identifier 
15300 identifier = constant-expression 
15301 
 pointeropt direct-declarator 
15304 
 identifier 
15307 (declarator) 
15308 direct-declarator [ constant-expressionopt ] 
15309 direct-declarator ( parameter-type-list ) 
15310 direct-declarator ( identifier-listopt ) 
15311 
 * type-qualifier-listopt 
15314 * type-qualifier-listopt pointer 
15315 
 type-qualifier 
15318 type-qualifier-list type-qualifier 
15319 
 parameter-list 
15322 parameter-list , ... 
15323 
 parameter-declaration 
15326 parameter-list , parameter-declaration 
15327 
15328 
 declaration-specifiers declarator 
15331 declaration-specifiers abstract-declaratoropt 
15332 
 identifier 
15335 identifier-list , identifier 
15336 
 assignment-expression 
15339 { initializer-list } 
15340 { initializer-list , } 
15341 
 initializer 
15344 initializer-list , initializer 
15345 
 specifier-qualifier-list abstract-declaratoropt 
15348 
 pointer 
15351 pointeropt direct-abstract-declarator 
15352 
 ( abstract-declarator ) 
15355 direct-abstract-declaratoropt [constant-expressionopt] 
15356 direct-abstract-declaratoropt (parameter-type-listopt) 
15357 
 identifier 
15360 
 labeled-statement 
15363 expression-statement 
15364 compound-statement 
15365 selection-statement 
15366 iteration-statement 
15367 jump-statement 
15368 
 identifier : statement 
15371 case constant-expression : statement 
15372 default : statement 
15373 
 expressionopt; 
15376 
 { declaration-listopt statement-listopt } 
15379 
15380 
 statement 
15383 statement-list statement 
15384 
 if (expression) statement 
15387 if (expression) statement else statement 
15388 switch (expression) statement 
15389 
 while (expression) statement 
15392 do statement while (expression); 
15393 for (expressionopt; expressionopt; expressionopt) statement 
15394 
 goto identifier; 
15397 continue; 
15398 break; 
15399 return expressionopt; 
15400 
 assignment-expression 
15403 expression , assignment-expression 
15404 
 conditional-expression 
15407 unary-expression assignment-operator assignment-expression 
15408 
 = *= /= %= += -= <<= >>= &= ^= |= 
15411 
 logical-OR-expression 
15414 logical-OR-expression ? expression : conditional-expression 
15415 
 conditional-expression 
15418 
 logical-AND-expression 
15421 logical-OR-expression || logical-AND-expression 
15422 
 inclusive-OR-expression 
15425 logical-AND-expression && inclusive-OR-expression 
15426 
 exclusive-OR-expression 
15429 inclusive-OR-expression | exclusive-OR-expression 
15430 
15431 
 AND-expression 
15434 exclusive-OR-expression ^ AND-expression 
15435 
 equality-expression 
15438 AND-expression & equality-expression 
15439 
 relational-expression 
15442 equality-expression == relational-expression 
15443 equality-expression != relational-expression 
15444 
 shift-expression 
15447 relational-expression < shift-expression 
15448 relational-expression > shift-expression 
15449 relational-expression <= shift-expression 
15450 relational-expression >= shift-expression 
15451 
 additive-expression 
15454 shift-expression << additive-expression 
15455 shift-expression >> additive-expression 
15456 
 multiplicative-expression 
15459 additive-expression + multiplicative-expression 
15460 additive-expression - multiplicative-expression 
15461 
 multiplicative-expression * cast-expression 
15464 multiplicative-expression / cast-expression 
15465 multiplicative-expression % cast-expression 
15466 
 unary expression 
15469 (type-name) cast-expression 
15470 
 postfix expression 
15473 ++unary expression 
15474 --unary expression 
15475 unary-operator cast-expression 
15476 sizeof unary-expression 
15477 sizeof (type-name) 
15478 
 & * + - ~ ! 
15481 
 primary-expression 
15484 
15485 
 postfix-expression(argument-expression-listopt) 
15488 postfix-expression.identifier 
15489 postfix-expression->+identifier 
15490 postfix-expression++ 
15491 postfix-expression-- 
15492 
 identifier 
15495 constant 
15496 string 
15497 (expression) 
15498 
 assignment-expression 
15501 assignment-expression-list , assignment-expression 
15502 
15503 The following grammar for the preprocessor summarizes the structure of control lines, but is 
15504 not suitable for mechanized parsing. It includes the symbol text, which means ordinary 
15505 program text, non-conditional preprocessor control lines, or complete preprocessor 
15506 conditional instructions. 
15507 
 # define identifier token-sequence 
15510 # define identifier(identifier, ... , identifier) token-sequence 
15511 # undef identifier 
15512 # include <filename> 
15513 # include "filename" 
15514 # line constant "filename" 
15515 # line constant 
15516 # error token-sequenceopt 
15517 # pragma token-sequenceopt 
15518 # 
15519 preprocessor-conditional 
15520 
 if-line text elif-parts else-partopt #endif 
15523 
 # if constant-expression 
15526 # ifdef identifier 
15527 # ifndef identifier 
15528 
 elif-line text 
15531 elif-partsopt 
15532 
15533 
 # elif constant-expression 
15536 
 else-line text 
15539 
15540 
 
15543 Appendix B - Standard Library 
15544 
15545 This appendix is a summary of the library defined by the ANSI standard. The standard library 
15546 is not part of the C language proper, but an environment that supports standard C will provide 
15547 the function declarations and type and macro definitions of this library. We have omitted a 
15548 few functions that are of limited utility or easily synthesized from others; we have omitted 
15549 multi-byte characters; and we have omitted discussion of locale issues; that is, properties that 
15550 depend on local language, nationality, or culture. 
15551 
 
 
 
 
15560 A header can be accessed by 
15561 
 
15564 Headers may be included in any order and any number of times. A header must be included 
15565 outside of any external declaration or definition and before any use of anything it declares. A 
15566 header need not be a source file. 
15567 
15568 External identifiers that begin with an underscore are reserved for use by the library, as are all 
15569 other identifiers that begin with an underscore and an upper-case letter or another underscore. 
15570 
15571 B.1 Input and Output: <stdio.h> 
15572 
15573 The input and output functions, types, and macros defined in <stdio.h> represent nearly one 
15574 third of the library. 
15575 
15576 A stream is a source or destination of data that may be associated with a disk or other 
15577 peripheral. The library supports text streams and binary streams, although on some systems, 
15578 notably UNIX, these are identical. A text stream is a sequence of lines; each line has zero or 
15579 more characters and is terminated by '\n'. An environment may need to convert a text stream 
15580 to or from some other representation (such as mapping '\n' to carriage return and linefeed). 
15581 A binary stream is a sequence of unprocessed bytes that record internal data, with the property 
15582 that if it is written, then read back on the same system, it will compare equal. 
15583 
15584 A stream is connected to a file or device by opening it; the connection is broken by closing 
15585 the stream. Opening a file returns a pointer to an object of type FILE, which records whatever 
15586 information is necessary to control the stream. We will use ``file pointer'' and ``stream'' 
15587 interchangeably when there is no ambiguity. 
15588 
15589 When a program begins execution, the three streams stdin, stdout, and stderr are already 
15590 open. 
15591 
15592 B.1.1 File Operations 
15593 
15594 
15595 The following functions deal with operations on files. The type size_t is the unsigned 
15596 integral type produced by the sizeof operator. 
15597 
15598 FILE *fopen(const char *filename, const char *mode) 
15599 
15600 fopen opens the named file, and returns a stream, or NULL if the attempt fails. Legal 
15601 values for mode include: 
15602 
15603 "r" 
15604 
15605 open text file for reading 
15606 
15607 "w" 
15608 
15609 create text file for writing; discard previous contents if any 
15610 
15611 "a" 
15612 
15613 append; open or create text file for writing at end of file 
15614 
15615 "r+" 
15616 
15617 open text file for update (i.e., reading and writing) 
15618 
15619 "w+" 
15620 
15621 create text file for update, discard previous contents if any 
15622 
15623 "a+" 
15624 
15625 append; open or create text file for update, writing at end 
15626 
15627 Update mode permits reading and writing the same file; fflush or a file-positioning 
15628 function must be called between a read and a write or vice versa. If the mode includes 
15629 b after the initial letter, as in "rb" or "w+b", that indicates a binary file. Filenames are 
15630 limited to FILENAME_MAX characters. At most FOPEN_MAX files may be open at once. 
15631 
15632 FILE *freopen(const char *filename, const char *mode, FILE *stream) 
15633 
15634 freopen opens the file with the specified mode and associates the stream with it. It 
15635 returns stream, or NULL if an error occurs. freopen is normally used to change the 
15636 files associated with stdin, stdout, or stderr. 
15637 
15638 int fflush(FILE *stream) 
15639 
15640 On an output stream, fflush causes any buffered but unwritten data to be written; on 
15641 an input stream, the effect is undefined. It returns EOF for a write error, and zero 
15642 otherwise. fflush(NULL) flushes all output streams. 
15643 
15644 int fclose(FILE *stream) 
15645 
15646 fclose flushes any unwritten data for stream, discards any unread buffered input, 
15647 frees any automatically allocated buffer, then closes the stream. It returns EOF if any 
15648 errors occurred, and zero otherwise. 
15649 
15650 int remove(const char *filename) 
15651 
15652 remove removes the named file, so that a subsequent attempt to open it will fail. It 
15653 returns non-zero if the attempt fails. 
15654 
15655 rename changes the name of a file; it returns non-zero if the attempt fails. 
15656 
15657 FILE *tmpfile(void) 
15658 
15659 tmpfile creates a temporary file of mode "wb+" that will be automatically removed 
15660 when closed or when the program terminates normally. tmpfile returns a stream, or 
15661 NULL if it could not create the file. 
15662 
15663 char *tmpnam(char s[L_tmpnam]) 
15664 
15665 tmpnam(NULL) creates a string that is not the name of an existing file, and returns a 
15666 pointer to an internal static array. tmpnam(s) stores the string in s as well as returning 
15667 it as the function value; s must have room for at least L_tmpnam characters. tmpnam 
15668 generates a different name each time it is called; at most TMP_MAX different names are 
15669 guaranteed during execution of the program. Note that tmpnam creates a name, not a 
15670 file. 
15671 
15672 int setvbuf(FILE *stream, char *buf, int mode, size_t size) 
15673 
15674 setvbuf controls buffering for the stream; it must be called before reading, writing or 
15675 any other operation. A mode of _IOFBF causes full buffering, _IOLBF line buffering of 
15676 text files, and _IONBF no buffering. If buf is not NULL, it will be used as the buffer, 
15677 otherwise a buffer will be allocated. size determines the buffer size. setvbuf returns 
15678 non-zero for any error. 
15679 
15680 void setbuf(FILE *stream, char *buf) 
15681 
15682 
15683 If buf is NULL, buffering is turned off for the stream. Otherwise, setbuf is equivalent 
15684 to (void) setvbuf(stream, buf, _IOFBF, BUFSIZ). 
15685 
15686 B.1.2 Formatted Output 
15687 
15688 The printf functions provide formatted output conversion. 
15689 
 
 
15694 fprintf converts and writes output to stream under the control of format. The return value 
15695 is the number of characters written, or negative if an error occurred. 
15696 
15697 The format string contains two types of objects: ordinary characters, which are copied to the 
15698 output stream, and conversion specifications, each of which causes conversion and printing of 
15699 the next successive argument to fprintf. Each conversion specification begins with the 
15700 character % and ends with a conversion character. Between the % and the conversion character 
15701 there may be, in order: 
15702 
15703  Flags (in any order), which modify the specification: 
15704 
15705 o -, which specifies left adjustment of the converted argument in its field. 
15706 
15707 o +, which specifies that the number will always be printed with a sign. 
15708 
15709 o space: if the first character is not a sign, a space will be prefixed. 
15710 
15711 o 0: for numeric conversions, specifies padding to the field width with leading 
15712 zeros. 
15713 
15714 o #, which specifies an alternate output form. For o, the first digit will become 
15715 zero. For x or X, 0x or 0X will be prefixed to a non-zero result. For e, E, f, g, 
15716 and G, the output will always have a decimal point; for g and G, trailing zeros 
15717 will not be removed. 
15718 
15719  A number specifying a minimum field width. The converted argument will be printed 
15720 in a field at least this wide, and wider if necessary. If the converted argument has 
15721 fewer characters than the field width it will be padded on the left (or right, if left 
15722 adjustment has been requested) to make up the field width. The padding character is 
15723 normally space, but is 0 if the zero padding flag is present. 
15724 
15725  A period, which separates the field width from the precision. 
15726 
15727  A number, the precision, that specifies the maximum number of characters to be 
15728 printed from a string, or the number of digits to be printed after the decimal point for 
15729 e, E, or f conversions, or the number of significant digits for g or G conversion, or the 
15730 number of digits to be printed for an integer (leading 0s will be added to make up the 
15731 necessary width). 
15732 
15733  A length modifier h, l (letter ell), or L. ``h'' indicates that the corresponding argument 
15734 is to be printed as a short or unsigned short; ``l'' indicates that the argument is a 
15735 long or unsigned long, ``L'' indicates that the argument is a long double. 
15736 
15737 Width or precision or both may be specified as *, in which case the value is computed by 
15738 converting the next argument(s), which must be int. 
15739 
15740 The conversion characters and their meanings are shown in Table B.1. If the character after 
15741 the % is not a conversion character, the behavior is undefined. 
15742 
15743 Table B.1 Printf Conversions 
15744 
15745 Character 
15746 
15747 Argument type; Printed As 
15748 
15749 
15750 d,i 
15751 
15752 int; signed decimal notation. 
15753 
15754 o 
15755 
15756 int; unsigned octal notation (without a leading zero). 
15757 
15758 x,X 
15759 
15760 unsigned int; unsigned hexadecimal notation (without a leading 0x or 0X), 
15761 using abcdef for 0x or ABCDEF for 0X. 
15762 
15763 u 
15764 
15765 int; unsigned decimal notation. 
15766 
15767 c 
15768 
15769 int; single character, after conversion to unsigned char 
15770 
15771 s 
15772 
15773 char *; characters from the string are printed until a '\0' is reached or until the 
15774 number of characters indicated by the precision have been printed. 
15775 
15776 f 
15777 
15778 double; decimal notation of the form [-]mmm.ddd, where the number of d's is 
15779 given by the precision. The default precision is 6; a precision of 0 suppresses the 
15780 decimal point. 
15781 
15782 e,E 
15783 
15784 double; decimal notation of the form [-]m.dddddde+/-xx or [-]m.ddddddE+/-
15785 xx, where the number of d's is specified by the precision. The default precision is 
15786 6; a precision of 0 suppresses the decimal point. 
15787 
15788 g,G 
15789 
15790 double; %e or %E is used if the exponent is less than -4 or greater than or equal to 
15791 the precision; otherwise %f is used. Trailing zeros and a trailing decimal point are 
15792 not printed. 
15793 
15794 p 
15795 
15796 void *; print as a pointer (implementation-dependent representation). 
15797 
15798 n 
15799 
15800 int *; the number of characters written so far by this call to printf is written 
15801 into the argument. No argument is converted. 
15802 
15803 % 
15804 
15805 no argument is converted; print a % 
15806 
15807 int printf(const char *format, ...) 
15808 
15809 printf(...) is equivalent to fprintf(stdout, ...). 
15810 
15811 int sprintf(char *s, const char *format, ...) 
15812 
15813 sprintf is the same as printf except that the output is written into the string s, 
15814 terminated with '\0'. s must be big enough to hold the result. The return count does 
15815 not include the '\0'. 
15816 
15817 int vprintf(const char *format, va_list arg) 
15818 int vfprintf(FILE *stream, const char *format, va_list arg) 
15819 int vsprintf(char *s, const char *format, va_list arg) 
15820 
15821 The functions vprintf, vfprintf, and vsprintf are equivalent to the corresponding 
15822 printf functions, except that the variable argument list is replaced by arg, which has 
15823 been initialized by the va_start macro and perhaps va_arg calls. See the discussion 
15824 of <stdarg.h> in Section B.7. 
15825 
15826 B.1.3 Formatted Input 
15827 
15828 The scanf function deals with formatted input conversion. 
15829 
 
15832 int fscanf(FILE *stream, const char *format, ...) 
15833 
15834 fscanf reads from stream under control of format, and assigns converted values through 
15835 subsequent arguments, each of which must be a pointer. It returns when format is exhausted. 
15836 fscanf returns EOF if end of file or an error occurs before any conversion; otherwise it returns 
15837 the number of input items converted and assigned. 
15838 
15839 The format string usually contains conversion specifications, which are used to direct 
15840 interpretation of input. The format string may contain: 
15841 
15842  Blanks or tabs, which are not ignored. 
15843 
15844 
15845  Ordinary characters (not %), which are expected to match the next non-white space 
15846 character of the input stream. 
15847 
15848  Conversion specifications, consisting of a %, an optional assignment suppression 
15849 character *, an optional number specifying a maximum field width, an optional h, l, or 
15850 L indicating the width of the target, and a conversion character. 
15851 
15852 A conversion specification determines the conversion of the next input field. Normally the 
15853 result is placed in the variable pointed to by the corresponding argument. If assignment 
15854 suppression is indicated by *, as in %*s, however, the input field is simply skipped; no 
15855 assignment is made. An input field is defined as a string of non-white space characters; it 
15856 extends either to the next white space character or until the field width, if specified, is 
15857 exhausted. This implies that scanf will read across line boundaries to find its input, since 
15858 newlines are white space. (White space characters are blank, tab, newline, carriage return, 
15859 vertical tab, and formfeed.) 
15860 
15861 The conversion character indicates the interpretation of the input field. The corresponding 
15862 argument must be a pointer. The legal conversion characters are shown in Table B.2. 
15863 
15864 The conversion characters d, i, n, o, u, and x may be preceded by h if the argument is a 
15865 pointer to short rather than int, or by l (letter ell) if the argument is a pointer to long. The 
15866 conversion characters e, f, and g may be preceded by l if a pointer to double rather than 
15867 float is in the argument list, and by L if a pointer to a long double. 
15868 
15869 Table B.2 Scanf Conversions 
15870 
15871 Character 
15872 
15873 Input Data; Argument type 
15874 
15875 d 
15876 
15877 decimal integer; int* 
15878 
15879 i 
15880 
15881 integer; int*. The integer may be in octal (leading 0) or hexadecimal (leading 0x 
15882 or 0X). 
15883 
15884 o 
15885 
15886 octal integer (with or without leading zero); int *. 
15887 
15888 u 
15889 
15890 unsigned decimal integer; unsigned int *. 
15891 
15892 x 
15893 
15894 hexadecimal integer (with or without leading 0x or 0X); int*. 
15895 
15896 c 
15897 
15898 characters; char*. The next input characters are placed in the indicated array, up 
15899 to the number given by the width field; the default is 1. No '\0' is added. The 
15900 normal skip over white space characters is suppressed in this case; to read the next 
15901 non-white space character, use %1s. 
15902 
15903 s 
15904 
15905 string of non-white space characters (not quoted); char *, pointing to an array of 
15906 characters large enough to hold the string and a terminating '\0' that will be 
15907 added. 
15908 
15909 e,f,g 
15910 
15911 floating-point number; float *. The input format for float's is an optional sign, 
15912 a string of numbers possibly containing a decimal point, and an optional exponent 
15913 field containing an E or e followed by a possibly signed integer. 
15914 
15915 p 
15916 
15917 pointer value as printed by printf("%p");, void *. 
15918 
15919 n 
15920 
15921 writes into the argument the number of characters read so far by this call; int *. 
15922 No input is read. The converted item count is not incremented. 
15923 
15924 [...] 
15925 
15926 matches the longest non-empty string of input characters from the set between 
15927 brackets; char *. A '\0' is added. []...] includes ] in the set. 
15928 
15929 
15930 [^...] 
15931 
15932 matches the longest non-empty string of input characters not from the set between 
15933 brackets; char *. A '\0' is added. [^]...] includes ] in the set. 
15934 
15935 % 
15936 
15937 literal %; no assignment is made. 
15938 
15939 int scanf(const char *format, ...) 
15940 
15941 scanf(...) is identical to fscanf(stdin, ...). 
15942 
15943 int sscanf(const char *s, const char *format, ...) 
15944 
15945 sscanf(s, ...) is equivalent to scanf(...) except that the input characters are 
15946 taken from the string s. 
15947 
15948 B.1.4 Character Input and Output Functions 
15949 
15950 int fgetc(FILE *stream) 
15951 
15952 fgetc returns the next character of stream as an unsigned char (converted to an 
15953 int), or EOF if end of file or error occurs. 
15954 
15955 char *fgets(char *s, int n, FILE *stream) 
15956 
15957 fgets reads at most the next n-1 characters into the array s, stopping if a newline is 
15958 encountered; the newline is included in the array, which is terminated by '\0'. fgets 
15959 returns s, or NULL if end of file or error occurs. 
15960 
15961 int fputc(int c, FILE *stream) 
15962 
15963 fputc writes the character c (converted to an unsigend char) on stream. It returns 
15964 the character written, or EOF for error. 
15965 
15966 int fputs(const char *s, FILE *stream) 
15967 
15968 fputs writes the string s (which need not contain \n) on stream; it returns non-
15969 negative, or EOF for an error. 
15970 
15971 int getc(FILE *stream) 
15972 
15973 getc is equivalent to fgetc except that if it is a macro, it may evaluate stream more 
15974 than once. 
15975 
15976 int getchar(void) 
15977 
15978 getchar is equivalent to getc(stdin). 
15979 
15980 char *gets(char *s) 
15981 
15982 gets reads the next input line into the array s; it replaces the terminating newline with 
15983 '\0'. It returns s, or NULL if end of file or error occurs. 
15984 
15985 int putc(int c, FILE *stream) 
15986 
15987 putc is equivalent to fputc except that if it is a macro, it may evaluate stream more 
15988 than once. 
15989 
15990 int putchar(int c) 
15991 
15992 putchar(c) is equivalent to putc(c,stdout). 
15993 
15994 int puts(const char *s) 
15995 
15996 puts writes the string s and a newline to stdout. It returns EOF if an error occurs, 
15997 non-negative otherwise. 
15998 
15999 int ungetc(int c, FILE *stream) 
16000 
16001 ungetc pushes c (converted to an unsigned char) back onto stream, where it will be 
16002 returned on the next read. Only one character of pushback per stream is guaranteed. 
16003 EOF may not be pushed back. ungetc returns the character pushed back, or EOF for 
16004 error. 
16005 
16006 B.1.5 Direct Input and Output Functions 
16007 
16008 fread reads from stream into the array ptr at most nobj objects of size size. fread 
16009 returns the number of objects read; this may be less than the number requested. feof 
16010 and ferror must be used to determine status. 
16011 
16012 size_t fwrite(const void *ptr, size_t size, size_t nobj, FILE *stream) 
16013 
16014 
16015 fwrite writes, from the array ptr, nobj objects of size size on stream. It returns the 
16016 number of objects written, which is less than nobj on error. 
16017 
16018 B.1.6 File Positioning Functions 
16019 
16020 int fseek(FILE *stream, long offset, int origin) 
16021 
16022 fseek sets the file position for stream; a subsequent read or write will access data 
16023 beginning at the new position. For a binary file, the position is set to offset 
16024 characters from origin, which may be SEEK_SET (beginning), SEEK_CUR (current 
16025 position), or SEEK_END (end of file). For a text stream, offset must be zero, or a value 
16026 returned by ftell (in which case origin must be SEEK_SET). fseek returns non-zero 
16027 on error. 
16028 
16029 long ftell(FILE *stream) 
16030 
16031 ftell returns the current file position for stream, or -1 on error. 
16032 
16033 void rewind(FILE *stream) 
16034 
16035 rewind(fp) is equivalent to fseek(fp, 0L, SEEK_SET); clearerr(fp). 
16036 
16037 int fgetpos(FILE *stream, fpos_t *ptr) 
16038 
16039 fgetpos records the current position in stream in *ptr, for subsequent use by 
16040 fsetpos. The type fpos_t is suitable for recording such values. fgetpos returns non-
16041 zero on error. 
16042 
16043 int fsetpos(FILE *stream, const fpos_t *ptr) 
16044 
16045 fsetpos positions stream at the position recorded by fgetpos in *ptr. fsetpos 
16046 returns non-zero on error. 
16047 
16048 B.1.7 Error Functions 
16049 
16050 Many of the functions in the library set status indicators when error or end of file occur. These 
16051 indicators may be set and tested explicitly. In addition, the integer expression errno (declared 
16052 in <errno.h>) may contain an error number that gives further information about the most 
16053 recent error. 
16054 
16055 void clearerr(FILE *stream) 
16056 
16057 clearerr clears the end of file and error indicators for stream. 
16058 
16059 int feof(FILE *stream) 
16060 
16061 feof returns non-zero if the end of file indicator for stream is set. 
16062 
16063 int ferror(FILE *stream) 
16064 
16065 ferror returns non-zero if the error indicator for stream is set. 
16066 
16067 void perror(const char *s) 
16068 
16069 perror(s) prints s and an implementation-defined error message corresponding to 
16070 the integer in errno, as if by 
16071 
 
16074 See strerror in Section B.3. 
16075 
16076 B.2 Character Class Tests: <ctype.h> 
16077 
16078 The header <ctype.h> declares functions for testing characters. For each function, the 
16079 argument list is an int, whose value must be EOF or representable as an unsigned char, and 
16080 the return value is an int. The functions return non-zero (true) if the argument c satisfies the 
16081 condition described, and zero if not. 
16082 
16083 isalnum(c) 
16084 
16085 isalpha(c) or isdigit(c) is true 
16086 
16087 isalpha(c) 
16088 
16089 isupper(c) or islower(c) is true 
16090 
16091 
16092 iscntrl(c) 
16093 
16094 control character 
16095 
16096 isdigit(c) 
16097 
16098 decimal digit 
16099 
16100 isgraph(c) 
16101 
16102 printing character except space 
16103 
16104 islower(c) 
16105 
16106 lower-case letter 
16107 
16108 isprint(c) 
16109 
16110 printing character including space 
16111 
16112 ispunct(c) 
16113 
16114 printing character except space or letter or digit 
16115 
16116 isspace(c) 
16117 
16118 space, formfeed, newline, carriage return, tab, vertical tab 
16119 
16120 isupper(c) 
16121 
16122 upper-case letter 
16123 
16124 isxdigit(c) 
16125 
16126 hexadecimal digit 
16127 
16128 In the seven-bit ASCII character set, the printing characters are 0x20 (' ') to 0x7E ('-'); 
16129 the control characters are 0 NUL to 0x1F (US), and 0x7F (DEL). 
16130 
16131 In addition, there are two functions that convert the case of letters: 
16132 
16133 int tolower(c)
16134 
16135 convert c to lower case
16136 
16137 int toupper(c)
16138 
16139 convert c to upper case
16140 
16141 If c is an upper-case letter, tolower(c) returns the corresponding lower-case letter, 
16142 toupper(c) returns the corresponding upper-case letter; otherwise it returns c. 
16143 
16144 B.3 String Functions: <string.h> 
16145 
16146 There are two groups of string functions defined in the header <string.h>. The first have 
16147 names beginning with str; the second have names beginning with mem. Except for memmove, 
16148 the behavior is undefined if copying takes place between overlapping objects. Comparison 
16149 functions treat arguments as unsigned char arrays. 
16150 
16151 In the following table, variables s and t are of type char *; cs and ct are of type const 
16152 char *; n is of type size_t; and c is an int converted to char. 
16153 
16154 char *strcpy(s,ct) 
16155 
16156 copy string ct to string s, including '\0'; return s. 
16157 
16158 char 
16159 *strncpy(s,ct,n) 
16160 
16161 copy at most n characters of string ct to s; return s. Pad with '\0''s 
16162 if ct has fewer than n characters. 
16163 
16164 char *strcat(s,ct) 
16165 
16166 concatenate string ct to end of string s; return s. 
16167 
16168 char 
16169 *strncat(s,ct,n) 
16170 
16171 concatenate at most n characters of string ct to string s, terminate s 
16172 with '\0'; return s. 
16173 
16174 int strcmp(cs,ct) 
16175 
16176 compare string cs to string ct, return <0 if cs<ct, 0 if cs==ct, or >0 
16177 if cs>ct. 
16178 
16179 int 
16180 strncmp(cs,ct,n) 
16181 
16182 compare at most n characters of string cs to string ct; return <0 if 
16183 cs<ct, 0 if cs==ct, or >0 if cs>ct. 
16184 
16185 char *strchr(cs,c) 
16186 
16187 return pointer to first occurrence of c in cs or NULL if not present. 
16188 
16189 char *strrchr(cs,c) 
16190 
16191 return pointer to last occurrence of c in cs or NULL if not present. 
16192 
16193 size_t 
16194 strspn(cs,ct) 
16195 
16196 return length of prefix of cs consisting of characters in ct. 
16197 
16198 
16199 size_t 
16200 strcspn(cs,ct) 
16201 
16202 return length of prefix of cs consisting of characters not in ct. 
16203 
16204 char 
16205 *strpbrk(cs,ct) 
16206 
16207 return pointer to first occurrence in string cs of any character string 
16208 ct, or NULL if not present. 
16209 
16210 return pointer to first occurrence of string ct in cs, or NULL if not 
16211 present. 
16212 
16213 size_t strlen(cs) 
16214 
16215 return length of cs. 
16216 
16217 char *strerror(n) 
16218 
16219 return pointer to implementation-defined string corresponding to 
16220 error n. 
16221 
16222 char *strtok(s,ct) 
16223 
16224 strtok searches s for tokens delimited by characters from ct; see 
16225 below. 
16226 
16227 A sequence of calls of strtok(s,ct) splits s into tokens, each delimited by a character from 
16228 ct. The first call in a sequence has a non-NULL s, it finds the first token in s consisting of 
16229 characters not in ct; it terminates that by overwriting the next character of s with '\0' and 
16230 returns a pointer to the token. Each subsequent call, indicated by a NULL value of s, returns the 
16231 next such token, searching from just past the end of the previous one. strtok returns NULL 
16232 when no further token is found. The string ct may be different on each call. 
16233 
16234 The mem... functions are meant for manipulating objects as character arrays; the intent is an 
16235 interface to efficient routines. In the following table, s and t are of type void *; cs and ct 
16236 are of type const void *; n is of type size_t; and c is an int converted to an unsigned 
16237 char. 
16238 
16239 void 
16240 *memcpy(s,ct,n) 
16241 
16242 copy n characters from ct to s, and return s. 
16243 
16244 void 
16245 *memmove(s,ct,n) 
16246 
16247 same as memcpy except that it works even if the objects overlap. 
16248 
16249 int memcmp(cs,ct,n) 
16250 
16251 compare the first n characters of cs with ct; return as with strcmp. 
16252 
16253 void 
16254 *memchr(cs,c,n) 
16255 
16256 return pointer to first occurrence of character c in cs, or NULL if not 
16257 present among the first n characters. 
16258 
16259 void *memset(s,c,n) 
16260 
16261 place character c into first n characters of s, return s. 
16262 
16263 B.4 Mathematical Functions: <math.h> 
16264 
16265 The header <math.h> declares mathematical functions and macros. 
16266 
16267 The macros EDOM and ERANGE (found in <errno.h>) are non-zero integral constants that are 
16268 used to signal domain and range errors for the functions; HUGE_VAL is a positive double 
16269 value. A domain error occurs if an argument is outside the domain over which the function is 
16270 defined. On a domain error, errno is set to EDOM; the return value is implementation-defined. 
16271 A range error occurs if the result of the function cannot be represented as a double. If the 
16272 result overflows, the function returns HUGE_VAL with the right sign, and errno is set to 
16273 ERANGE. If the result underflows, the function returns zero; whether errno is set to ERANGE is 
16274 implementation-defined. 
16275 
16276 In the following table, x and y are of type double, n is an int, and all functions return 
16277 double. Angles for trigonometric functions are expressed in radians. 
16278 
16279 
16280 sin-1(x) in range [-pi/2,pi/2], x in [-1,1]. 
16281 
16282 xy. A domain error occurs if x=0 and y<=0, or if x<0 and y is not an 
16283 integer. 
16284 
16285 x*2n 
16286 
16287 cos-1(x) in range [0,pi], x in [-1,1]. 
16288 
16289 tan-1(x) in range [-pi/2,pi/2]. 
16290 
16291 tan-1(y/x) in range [-pi,pi]. 
16292 
16293 exponential function ex 
16294 
16295 base 10 logarithm log10(x), x>0. 
16296 
16297 
16298 
16299 sin(x) 
16300 
16301 sine of x 
16302 
16303 cos(x) 
16304 
16305 cosine of x 
16306 
16307 tan(x) 
16308 
16309 tangent of x 
16310 
16311 asin(x) 
16312 
16313 acos(x) 
16314 
16315 atan2(y,x) 
16316 
16317 sinh(x) 
16318 
16319 hyperbolic sine of x 
16320 
16321 cosh(x) 
16322 
16323 hyperbolic cosine of x 
16324 
16325 tanh(x) 
16326 
16327 hyperbolic tangent of x 
16328 
16329 exp(x) 
16330 
16331 log(x) 
16332 
16333 natural logarithm ln(x), x>0. 
16334 
16335 log10(x) 
16336 
16337 pow(x,y) 
16338 
16339 sqrt(x) 
16340 
16341 sqare root of x, x>=0. 
16342 
16343 ceil(x) 
16344 
16345 smallest integer not less than x, as a double. 
16346 
16347 floor(x) 
16348 
16349 largest integer not greater than x, as a double. 
16350 
16351 fabs(x) 
16352 
16353 absolute value |x| 
16354 
16355 ldexp(x,n) 
16356 
16357 frexp(x, int 
16358 *ip) 
16359 
16360 splits x into a normalized fraction in the interval [1/2,1) which is returned, 
16361 and a power of 2, which is stored in *exp. If x is zero, both parts of the 
16362 result are zero. 
16363 
16364 modf(x, 
16365 double *ip) 
16366 
16367 splits x into integral and fractional parts, each with the same sign as x. It 
16368 stores the integral part in *ip, and returns the fractional part. 
16369 
16370 fmod(x,y) 
16371 
16372 floating-point remainder of x/y, with the same sign as x. If y is zero, the 
16373 result is implementation-defined. 
16374 
16375 B.5 Utility Functions: <stdlib.h> 
16376 
16377 The header <stdlib.h> declares functions for number conversion, storage allocation, and 
16378 similar tasks. double atof(const char *s) 
16379 
16380 atof converts s to double; it is equivalent to strtod(s, (char**)NULL). 
16381 
16382 int atoi(const char *s) 
16383 
16384 converts s to int; it is equivalent to (int)strtol(s, (char**)NULL, 10). 
16385 
16386 long atol(const char *s) 
16387 
16388 converts s to long; it is equivalent to strtol(s, (char**)NULL, 10). 
16389 
16390 double strtod(const char *s, char **endp) 
16391 
16392 strtod converts the prefix of s to double, ignoring leading white space; it stores a 
16393 pointer to any unconverted suffix in *endp unless endp is NULL. If the answer would 
16394 overflow, HUGE_VAL is returned with the proper sign; if the answer would underflow, 
16395 zero is returned. In either case errno is set to ERANGE. 
16396 
16397 long strtol(const char *s, char **endp, int base) 
16398 
16399 strtol converts the prefix of s to long, ignoring leading white space; it stores a 
16400 pointer to any unconverted suffix in *endp unless endp is NULL. If base is between 2 
16401 
16402 
16403 and 36, conversion is done assuming that the input is written in that base. If base is 
16404 zero, the base is 8, 10, or 16; leading 0 implies octal and leading 0x or 0X 
16405 hexadecimal. Letters in either case represent digits from 10 to base-1; a leading 0x or 
16406 0X is permitted in base 16. If the answer would overflow, LONG_MAX or LONG_MIN is 
16407 returned, depending on the sign of the result, and errno is set to ERANGE. 
16408 
16409 unsigned long strtoul(const char *s, char **endp, int base) 
16410 
16411 strtoul is the same as strtol except that the result is unsigned long and the error 
16412 value is ULONG_MAX. 
16413 
16414 int rand(void) 
16415 
16416 rand returns a pseudo-random integer in the range 0 to RAND_MAX, which is at least 
16417 32767. 
16418 
16419 void srand(unsigned int seed) 
16420 
16421 srand uses seed as the seed for a new sequence of pseudo-random numbers. The 
16422 initial seed is 1. 
16423 
16424 void *calloc(size_t nobj, size_t size) 
16425 
16426 calloc returns a pointer to space for an array of nobj objects, each of size size, or 
16427 NULL if the request cannot be satisfied. The space is initialized to zero bytes. 
16428 
16429 void *malloc(size_t size) 
16430 
16431 malloc returns a pointer to space for an object of size size, or NULL if the request 
16432 cannot be satisfied. The space is uninitialized. 
16433 
16434 void *realloc(void *p, size_t size) 
16435 
16436 realloc changes the size of the object pointed to by p to size. The contents will be 
16437 unchanged up to the minimum of the old and new sizes. If the new size is larger, the 
16438 new space is uninitialized. realloc returns a pointer to the new space, or NULL if the 
16439 request cannot be satisfied, in which case *p is unchanged. 
16440 
16441 void free(void *p) 
16442 
16443 free deallocates the space pointed to by p; it does nothing if p is NULL. p must be a 
16444 pointer to space previously allocated by calloc, malloc, or realloc. 
16445 
16446 void abort(void) 
16447 
16448 abort causes the program to terminate abnormally, as if by raise(SIGABRT). 
16449 
16450 void exit(int status) 
16451 
16452 exit causes normal program termination. atexit functions are called in reverse order 
16453 of registration, open files are flushed, open streams are closed, and control is returned 
16454 to the environment. How status is returned to the environment is implementation-
16455 dependent, but zero is taken as successful termination. The values EXIT_SUCCESS and 
16456 EXIT_FAILURE may also be used. 
16457 
16458 int atexit(void (*fcn)(void)) 
16459 
16460 atexit registers the function fcn to be called when the program terminates normally; 
16461 it returns non-zero if the registration cannot be made. 
16462 
16463 int system(const char *s) 
16464 
16465 system passes the string s to the environment for execution. If s is NULL, system 
16466 returns non-zero if there is a command processor. If s is not NULL, the return value is 
16467 implementation-dependent. 
16468 
16469 char *getenv(const char *name) 
16470 
16471 getenv returns the environment string associated with name, or NULL if no string 
16472 exists. Details are implementation-dependent. 
16473 
 
16476 void *bsearch(const void *key, const void *base, 
16477 
 
 
16482 bsearch searches base[0]...base[n-1] for an item that matches *key. The function 
16483 cmp must return negative if its first argument (the search key) is less than its second (a 
16484 table entry), zero if equal, and positive if greater. Items in the array base must be in 
16485 ascending order. bsearch returns a pointer to a matching item, or NULL if none exists. 
16486 
16487 
 
16490 void qsort(void *base, size_t n, size_t size, 
16491 
 
16494 qsort sorts into ascending order an array base[0]...base[n-1] of objects of size 
16495 size. The comparison function cmp is as in bsearch. 
16496 
16497 int abs(int n) 
16498 
16499 abs returns the absolute value of its int argument. 
16500 
16501 long labs(long n) 
16502 
16503 labs returns the absolute value of its long argument. 
16504 
16505 div_t div(int num, int denom) 
16506 
16507 div computes the quotient and remainder of num/denom. The results are stored in the 
16508 int members quot and rem of a structure of type div_t. 
16509 
16510 ldiv_t ldiv(long num, long denom) 
16511 
16512 ldiv computes the quotient and remainder of num/denom. The results are stored in the 
16513 long members quot and rem of a structure of type ldiv_t. 
16514 
16515 B.6 Diagnostics: <assert.h> 
16516 
16517 The assert macro is used to add diagnostics to programs: 
16518 
 
16521 If expression is zero when 
16522 
 
16525 is executed, the assert macro will print on stderr a message, such as 
16526 
 
16529 It then calls abort to terminate execution. The source filename and line number come from 
16530 the preprocessor macros __FILE__ and __LINE__. 
16531 
16532 If NDEBUG is defined at the time <assert.h> is included, the assert macro is ignored. 
16533 
16534 B.7 Variable Argument Lists: <stdarg.h> 
16535 
16536 The header <stdarg.h> provides facilities for stepping through a list of function arguments 
16537 of unknown number and type. 
16538 
 
 
16543 ap must be initialized once with the macro va_start before any unnamed argument is 
16544 accessed: 
16545 
 
16548 
16549 Thereafter, each execution of the macro va_arg will produce a value that has the type and 
16550 value of the next unnamed argument, and will also modify ap so the next use of va_arg 
16551 returns the next argument: 
16552 
 
16555 The macro 
16556 
 
 
16561 must be called once after the arguments have been processed but before f is exited. 
16562 
16563 B.8 Non-local Jumps: <setjmp.h> 
16564 
16565 The declarations in <setjmp.h> provide a way to avoid the normal function call and return 
16566 sequence, typically to permit an immediate return from a deeply nested function call. 
16567 
16568 int setjmp(jmp_buf env) 
16569 
16570 The macro setjmp saves state information in env for use by longjmp. The return is 
16571 zero from a direct call of setjmp, and non-zero from a subsequent call of longjmp. A 
16572 call to setjmp can only occur in certain contexts, basically the test of if, switch, and 
16573 loops, and only in simple relational expressions. 
16574 
 
 
 
 
 
16585 void longjmp(jmp_buf env, int val) 
16586 
16587 longjmp restores the state saved by the most recent call to setjmp, using the 
16588 information saved in env, and execution resumes as if the setjmp function had just 
16589 executed and returned the non-zero value val. The function containing the setjmp 
16590 must not have terminated. Accessible objects have the values they had at the time 
16591 longjmp was called, except that non-volatile automatic variables in the function 
16592 calling setjmp become undefined if they were changed after the setjmp call. 
16593 
16594 B.9 Signals: <signal.h> 
16595 
16596 The header <signal.h> provides facilities for handling exceptional conditions that arise 
16597 during execution, such as an interrupt signal from an external source or an error in execution. 
16598 
 
16601 void (*signal(int sig, void (*handler)(int)))(int) 
16602 
16603 signal determines how subsequent signals will be handled. If handler is SIG_DFL, the 
16604 implementation-defined default behavior is used, if it is SIG_IGN, the signal is ignored; 
16605 otherwise, the function pointed to by handler will be called, with the argument of the type of 
16606 signal. Valid signals include 
16607 
16608 SIGABRT 
16609 
16610 abnormal termination, e.g., from abort 
16611 
16612 SIGFPE 
16613 
16614 arithmetic error, e.g., zero divide or overflow 
16615 
16616 SIGILL 
16617 
16618 illegal function image, e.g., illegal instruction 
16619 
16620 interactive attention, e.g., interrupt 
16621 
16622 SIGSEGV 
16623 
16624 illegal storage access, e.g., access outside memory limits 
16625 
16626 SIGTERM 
16627 
16628 termination request sent to this program 
16629 
16630 
16631 
16632 
 
 
16637 
16638 
16639 signal returns the previous value of handler for the specific signal, or SIG_ERR if an error 
16640 occurs. 
16641 
16642 When a signal sig subsequently occurs, the signal is restored to its default behavior; then the 
16643 signal-handler function is called, as if by (*handler)(sig). If the handler returns, execution 
16644 will resume where it was when the signal occurred. 
16645 
16646 The initial state of signals is implementation-defined. 
16647 
 
16650 int raise(int sig) 
16651 
16652 raise sends the signal sig to the program; it returns non-zero if unsuccessful. 
16653 
16654 B.10 Date and Time Functions: <time.h> 
16655 
16656 The header <time.h> declares types and functions for manipulating date and time. Some 
16657 functions process local time, which may differ from calendar time, for example because of 
16658 time zone. clock_t and time_t are arithmetic types representing times, and struct tm holds 
16659 the components of a calendar time: 
16660 
16661 int tm_sec; 
16662 
16663 seconds after the minute (0,61)
16664 
16665 int tm_min; 
16666 
16667 minutes after the hour (0,59) 
16668 
16669 int tm_hour; 
16670 
16671 hours since midnight (0,23) 
16672 
16673 int tm_mday; 
16674 
16675 day of the month (1,31) 
16676 
16677 int tm_mon; 
16678 
16679 months since January (0,11) 
16680 
16681 int tm_year; 
16682 
16683 years since 1900 
16684 
16685 int tm_wday; 
16686 
16687 days since Sunday (0,6) 
16688 
16689 int tm_yday; 
16690 
16691 days since January 1 (0,365) 
16692 
16693 int tm_isdst;
16694 
16695 Daylight Saving Time flag 
16696 
16697 
16698 
16699 tm_isdst is positive if Daylight Saving Time is in effect, zero if not, and negative if the 
16700 information is not available. 
16701 
16702 clock_t clock(void) 
16703 
16704 clock returns the processor time used by the program since the beginning of 
16705 execution, or -1 if unavailable. clock()/CLK_PER_SEC is a time in seconds. 
16706 
16707 time_t time(time_t *tp) 
16708 
16709 time returns the current calendar time or -1 if the time is not available. If tp is not 
16710 NULL, the return value is also assigned to *tp. 
16711 
16712 double difftime(time_t time2, time_t time1) 
16713 
16714 difftime returns time2-time1 expressed in seconds. 
16715 
16716 time_t mktime(struct tm *tp) 
16717 
16718 mktime converts the local time in the structure *tp into calendar time in the same 
16719 representation used by time. The components will have values in the ranges shown. 
16720 mktime returns the calendar time or -1 if it cannot be represented. 
16721 
16722 The next four functions return pointers to static objects that may be overwritten by other calls. 
16723 
16724 char *asctime(const struct tm *tp) 
16725 
16726 
16727 asctime</tt< converts the time in the structure *tp into a string of 
16728 the form 
16729 
 
 
16734 char *ctime(const time_t *tp) 
16735 
16736 ctime converts the calendar time *tp to local time; it is equivalent 
16737 to 
16738 
 
 
16743 struct tm *gmtime(const time_t *tp) 
16744 
16745 gmtime converts the calendar time *tp into Coordinated Universal Time 
16746 (UTC). It returns NULL if UTC is not available. The name gmtime has 
16747 historical significance. 
16748 
16749 struct tm *localtime(const time_t *tp) 
16750 
16751 localtime converts the calendar time *tp into local time. 
16752 
16753 size_t strftime(char *s, size_t smax, const char *fmt, const struct tm *tp) 
16754 
16755 strftime formats date and time information from *tp into s according 
16756 to fmt, which is analogous to a printf format. Ordinary characters 
16757 (including the terminating '\0') are copied into s. Each %c is 
16758 replaced as described below, using values appropriate for the local 
16759 environment. No more than smax characters are placed into s. strftime 
16760 returns the number of characters, excluding the '\0', or zero if more 
16761 than smax characters were produced. 
16762 
16763 %a 
16764 
16765 abbreviated weekday name. 
16766 
16767 %A 
16768 
16769 full weekday name. 
16770 
16771 %b 
16772 
16773 abbreviated month name. 
16774 
16775 %B 
16776 
16777 full month name. 
16778 
16779 %c 
16780 
16781 local date and time representation. 
16782 
16783 %d 
16784 
16785 day of the month (01-31). 
16786 
16787 %H 
16788 
16789 hour (24-hour clock) (00-23). 
16790 
16791 %I 
16792 
16793 hour (12-hour clock) (01-12). 
16794 
16795 %j 
16796 
16797 day of the year (001-366). 
16798 
16799 %m 
16800 
16801 month (01-12). 
16802 
16803 %M 
16804 
16805 minute (00-59). 
16806 
16807 %p 
16808 
16809 local equivalent of AM or PM. 
16810 
16811 %S 
16812 
16813 second (00-61). 
16814 
16815 %U 
16816 
16817 week number of the year (Sunday as 1st day of week) (00-53). 
16818 
16819 %w 
16820 
16821 weekday (0-6, Sunday is 0). 
16822 
16823 %W 
16824 
16825 week number of the year (Monday as 1st day of week) (00-53). 
16826 
16827 %x 
16828 
16829 local date representation. 
16830 
16831 %X 
16832 
16833 local time representation. 
16834 
16835 %y 
16836 
16837 year without century (00-99). 
16838 
16839 %Y 
16840 
16841 year with century. 
16842 
16843 %Z 
16844 
16845 time zone name, if any. 
16846 
16847 %% 
16848 
16849 % 
16850 
16851 
16852 
16853 B.11 Implementation-defined Limits: 
16854 <limits.h> and <float.h> 
16855 
16856 
16857 The header <limits.h> defines constants for the sizes of integral types. 
16858 The values below are acceptable minimum magnitudes; larger values may be 
16859 used. 
16860 
16861 CHAR_BIT 
16862 
16863 8 
16864 
16865 bits in a char 
16866 
16867 CHAR_MAX 
16868 
16869 UCHAR_MAX or SCHAR_MAX 
16870 
16871 maximum value of char 
16872 
16873 CHAR_MIN 
16874 
16875 0 or SCHAR_MIN 
16876 
16877 maximum value of char 
16878 
16879 INT_MAX 
16880 
16881 32767 
16882 
16883 maximum value of int 
16884 
16885 INT_MIN 
16886 
16887 -32767 
16888 
16889 minimum value of int 
16890 
16891 LONG_MAX 
16892 
16893 2147483647 
16894 
16895 maximum value of long 
16896 
16897 LONG_MIN 
16898 
16899 -2147483647 
16900 
16901 minimum value of long 
16902 
16903 SCHAR_MAX 
16904 
16905 +127 
16906 
16907 maximum value of signed char 
16908 
16909 SCHAR_MIN 
16910 
16911 -127 
16912 
16913 minimum value of signed char 
16914 
16915 SHRT_MAX 
16916 
16917 +32767 
16918 
16919 maximum value of short 
16920 
16921 SHRT_MIN 
16922 
16923 -32767 
16924 
16925 minimum value of short 
16926 
16927 UCHAR_MAX 
16928 
16929 255 
16930 
16931 maximum value of unsigned char 
16932 
16933 UINT_MAX 
16934 
16935 65535 
16936 
16937 maximum value of unsigned int 
16938 
16939 ULONG_MAX 
16940 
16941 4294967295 
16942 
16943 maximum value of unsigned long 
16944 
16945 USHRT_MAX 
16946 
16947 65535 
16948 
16949 maximum value of unsigned short 
16950 
16951 
16952 
16953 The names in the table below, a subset of <float.h>, are constants related 
16954 to floating-point arithmetic. When a value is given, it represents the 
16955 minimum magnitude for the corresponding quantity. Each implementation 
16956 defines appropriate values. 
16957 
16958 FLT_RADIX 
16959 
16960 2 
16961 
16962 radix of exponent, representation, e.g., 2, 16 
16963 
16964 FLT_ROUNDS 
16965 
 
16968 floating-point rounding mode for addition 
16969 
16970 FLT_DIG 
16971 
16972 6 
16973 
16974 decimal digits of precision 
16975 
16976 FLT_EPSILON 
16977 
16978 1E-5 
16979 
16980 smallest number x such that 1.0+x != 1.0 
16981 
16982 FLT_MANT_DIG 
16983 
 
16986 number of base FLT_RADIX in mantissa 
16987 
16988 FLT_MAX 
16989 
16990 1E+37 
16991 
16992 maximum floating-point number 
16993 
16994 FLT_MAX_EXP 
16995 
16996 maximum n such that FLT_RADIXn-1 is representable 
16997 
16998 FLT_MIN 
16999 
17000 1E-37 
17001 
17002 minimum normalized floating-point number 
17003 
17004 FLT_MIN_EXP 
17005 
17006 minimum n such that 10n is a normalized number 
17007 
17008 DBL_DIG 
17009 
17010 10 
17011 
17012 decimal digits of precision 
17013 
17014 DBL_EPSILON 
17015 
17016 1E-9 
17017 
17018 smallest number x such that 1.0+x != 1.0 
17019 
17020 DBL_MANT_DIG 
17021 
 
17024 number of base FLT_RADIX in mantissa 
17025 
17026 DBL_MAX 
17027 
17028 1E+37 
17029 
17030 maximum double floating-point number 
17031 
17032 DBL_MAX_EXP 
17033 
17034 maximum n such that FLT_RADIXn-1 is representable 
17035 
17036 DBL_MIN 
17037 
17038 1E-37 
17039 
17040 minimum normalized double floating-point number 
17041 
17042 DBL_MIN_EXP 
17043 
17044 minimum n such that 10n is a normalized number 
17045 
17046 
17047 
 
17050 
 
17053 Appendix C - Summary of Changes 
17054 
17055 Since the publication of the first edition of this book, the definition of the C language has 
17056 undergone changes. Almost all were extensions of the original language, and were carefully 
17057 designed to remain compatible with existing practice; some repaired ambiguities in the 
17058 original description; and some represent modifications that change existing practice. Many of 
17059 the new facilities were announced in the documents accompanying compilers available from 
17060 AT&T, and have subsequently been adopted by other suppliers of C compilers. More 
17061 recently, the ANSI committee standardizing the language incorporated most of the changes, 
17062 and also introduced other significant modifications. Their report was in part participated by 
17063 some commercial compilers even before issuance of the formal C standard. 
17064 
17065 This Appendix summarizes the differences between the language defined by the first edition 
17066 of this book, and that expected to be defined by the final standard. It treats only the language 
17067 itself, not its environment and library; although these are an important part of the standard, 
17068 there is little to compare with, because the first edition did not attempt to prescribe an 
17069 environment or library. 
17070 
17071  Preprocessing is more carefully defined in the Standard than in the first edition, and is 
17072 extended: it is explicitly token based; there are new operators for concatenation of 
17073 tokens (##), and creation of strings (#); there are new control lines like #elif and 
17074 #pragma; redeclaration of macros by the same token sequence is explicitly permitted; 
17075 parameters inside strings are no longer replaced. Splicing of lines by \ is permitted 
17076 everywhere, not just in strings and macro definitions. See Par.A.12. 
17077  Trigraph sequences introduced by ?? allow representation of characters lacking in 
17078 some character sets. Escapes for #\^[]{}|~ are defined, see Par.A.12.1. Observe that 
17079 the introduction of trigraphs may change the meaning of strings containing the 
17080 sequence ??. 
17081  New escape sequences, for use within character constants and string literals, are 
17082 defined. The effect of following \ by a character not part of an approved escape 
17083 sequence is undefined. See Par.A.2.5.2. 
17084  The standard introduces a larger set of suffixes to make the type of constants explicit: 
17085 U or L for integers, F or L for floating. It also refines the rules for the type of unsiffixed 
17086 constants (Par.A.2.5). 
17087  There is a notation for wide-character string literals and character constants; see 
17088 Par.A.2.6. 
17089 
17090 
17091 The minimum significance of all internal identifiers increased to 31 characters; the 
17092 smallest mandated significance of identifiers with external linkage remains 6 
17093 monocase letters. (Many implementations provide more.) 
17094 
17095 New keywords (void, const, volatile, signed, enum) are introduced. The 
17096 stillborn entry keyword is withdrawn. 
17097 
17098 Everyone's favorite trivial change: 8 and 9 are not octal digits. 
17099 
17100 Adjacent string literals are concatenated. 
17101 
17102  Characters as well as other types, may be explicitly declared to carry, or not to carry, a 
17103 sign by using the keywords signed or unsigned. The locution long float as a 
17104 synonym for double is withdrawn, but long double may be used to declare an extra-
17105 precision floating quantity. 
17106 
17107  For some time, type unsigned char has been available. The standard introduces the 
17108 signed keyword to make signedness explicit for char and other integral objects. 
17109 
17110 
17111  The Standard adopts from C++ the notion of type qualifier, for example const 
17112 (Par.A.8.2). 
17113  The ``usual arithmetic conversions'' are changed, essentially from ``for integers, 
17114 unsigned always wins; for floating point, always use double'' to ``promote to the 
17115 smallest capacious-enough type.'' See Par.A.6.5. 
17116  A pointer to a function may be used as a function designator without an explicit * 
17117 operator. See Par.A.7.3.2. 
17118  The sizeof operator, in the first edition, yielded type int; subsequently, many 
17119 implementations made it unsigned. The Standard makes its type explicitly 
17120 implementation-dependent, but requires the type, size_t, to be defined in a standard 
17121 header (<stddef.h>). A similar change occurs in the type (ptrdiff_t) of the 
17122 difference between pointers. See Par.A.7.4.8 and Par.A.7.7. 
17123 The type of a shift expression is that of the left operand; the right operand can't 
17124 promote the result. See Par.A.7.8. 
17125 The Standard legalizes the creation of a pointer just beyond the end of an array, and 
17126 allows arithmetic and relations on it; see Par.A.7.7. 
17127  The Standard introduces (borrowing from C++) the notion of a function prototype 
17128 declaration that incorporates the types of the parameters, and includes an explicit 
17129 recognition of variadic functions together with an approved way of dealing with them. 
17130 See Pars. A.7.3.2, A.8.6.3, B.7. The older style is still accepted, with restrictions. 
17131 
17132 
17133  The void type has been available in most implementations for some years. The 
17134 Standard introduces the use of the void * type as a generic pointer type; previously 
17135 char * played this role. At the same time, explicit rules are enacted against mixing 
17136 pointers and integers, and pointers of different type, without the use of casts. 
17137 
17138  The Standard places explicit minima on the ranges of the arithmetic types, and 
17139 mandates headers (<limits.h> and <float.h>) giving the characteristics of each 
17140 particular implementation. 
17141 
17142 Enumerations are new since the first edition of this book. 
17143 
17144 Strings are no longer modifiable, and so may be placed in read-only memory. 
17145 
17146  The old assignment operators like =+ are truly gone. Also, assignment operators are 
17147 now single tokens; in the first edition, they were pairs, and could be separated by 
17148 white space. 
17149 
17150  A compiler's license to treat mathematically associative operators as computationally 
17151 associative is revoked. 
17152 
17153 A unary + operator is introduced for symmetry with unary -. 
17154 
17155  Structures may be assigned, passed to functions, and returned by functions. 
17156 
17157 Applying the address-of operator to arrays is permitted, and the result is a pointer to 
17158 the array. 
17159 
17160 The address-of operator & may not be applied to an object declared register, even if 
17161 the implementation chooses not to keep the object in a register. 
17162 
17163  Empty declarations, which have no declarators and don't declare at least a structure, 
17164 union, or enumeration, are forbidden by the Standard. On the other hand, a declaration 
17165 with just a structure or union tag redeclares that tag even if it was declared in an outer 
17166 scope. 
17167 
17168  External data declarations without any specifiers or qualifiers (just a naked declarator) 
17169 are forbidden. 
17170 
17171  Some implementations, when presented with an extern declaration in an inner block, 
17172 would export the declaration to the rest of the file. The Standard makes it clear that the 
17173 scope of such a declaration is just the block. 
17174 
17175 The scope of parameters is injected into a function's compound statement, so that 
17176 variable declarations at the top level of the function cannot hide the parameters. 
17177 
17178 
17179  The name spaces of identifiers are somewhat different. The Standard puts all tags in a 
17180 single name space, and also introduces a separate name space for labels; see 
17181 Par.A.11.1. Also, member names are associated with the structure or union of which 
17182 they are a part. (This has been common practice from some time.) 
17183 
17184 
17185  Unions may be initialized; the initializer refers to the first member. 
17186 
